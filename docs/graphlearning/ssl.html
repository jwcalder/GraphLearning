<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.3.0"/>
    <title>graphlearning.ssl API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style><script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
    };
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    /* Re-invoke MathJax when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => MathJax.typeset()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script>
<style>
    mjx-container {
        overflow-x: auto;
    }
</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../graphlearning.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;graphlearning</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>

            <h2>Contents</h2>
            <ul>
  <li><a href="#semi-supervised-learning">Semi-Supervised Learning</a></li>
</ul>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#results_dir">results_dir</a>
            </li>
            <li>
                    <a class="class" href="#ssl">ssl</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ssl.__init__">ssl</a>
                        </li>
                        <li>
                                <a class="variable" href="#ssl.prob">prob</a>
                        </li>
                        <li>
                                <a class="variable" href="#ssl.fitted">fitted</a>
                        </li>
                        <li>
                                <a class="variable" href="#ssl.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#ssl.accuracy_filename">accuracy_filename</a>
                        </li>
                        <li>
                                <a class="variable" href="#ssl.requires_eig">requires_eig</a>
                        </li>
                        <li>
                                <a class="variable" href="#ssl.onevsrest">onevsrest</a>
                        </li>
                        <li>
                                <a class="variable" href="#ssl.similarity">similarity</a>
                        </li>
                        <li>
                                <a class="variable" href="#ssl.class_priors">class_priors</a>
                        </li>
                        <li>
                                <a class="variable" href="#ssl.weights">weights</a>
                        </li>
                        <li>
                                <a class="variable" href="#ssl.class_priors_error">class_priors_error</a>
                        </li>
                        <li>
                                <a class="function" href="#ssl.set_graph">set_graph</a>
                        </li>
                        <li>
                                <a class="function" href="#ssl.volume_label_projection">volume_label_projection</a>
                        </li>
                        <li>
                                <a class="function" href="#ssl.get_accuracy_filename">get_accuracy_filename</a>
                        </li>
                        <li>
                                <a class="function" href="#ssl.predict">predict</a>
                        </li>
                        <li>
                                <a class="function" href="#ssl.fit_predict">fit_predict</a>
                        </li>
                        <li>
                                <a class="function" href="#ssl.ssl_trials">ssl_trials</a>
                        </li>
                        <li>
                                <a class="function" href="#ssl.trials_statistics">trials_statistics</a>
                        </li>
                        <li>
                                <a class="function" href="#ssl.fit">fit</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#poisson">poisson</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#poisson.__init__">poisson</a>
                        </li>
                        <li>
                                <a class="variable" href="#poisson.solver">solver</a>
                        </li>
                        <li>
                                <a class="variable" href="#poisson.p">p</a>
                        </li>
                        <li>
                                <a class="variable" href="#poisson.use_cuda">use_cuda</a>
                        </li>
                        <li>
                                <a class="variable" href="#poisson.min_iter">min_iter</a>
                        </li>
                        <li>
                                <a class="variable" href="#poisson.max_iter">max_iter</a>
                        </li>
                        <li>
                                <a class="variable" href="#poisson.tol">tol</a>
                        </li>
                        <li>
                                <a class="variable" href="#poisson.spectral_cutoff">spectral_cutoff</a>
                        </li>
                        <li>
                                <a class="variable" href="#poisson.accuracy_filename">accuracy_filename</a>
                        </li>
                        <li>
                                <a class="variable" href="#poisson.name">name</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#poisson_mbo">poisson_mbo</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#poisson_mbo.__init__">poisson_mbo</a>
                        </li>
                        <li>
                                <a class="variable" href="#poisson_mbo.poisson_model">poisson_model</a>
                        </li>
                        <li>
                                <a class="variable" href="#poisson_mbo.Ns">Ns</a>
                        </li>
                        <li>
                                <a class="variable" href="#poisson_mbo.mu">mu</a>
                        </li>
                        <li>
                                <a class="variable" href="#poisson_mbo.T">T</a>
                        </li>
                        <li>
                                <a class="variable" href="#poisson_mbo.use_cuda">use_cuda</a>
                        </li>
                        <li>
                                <a class="variable" href="#poisson_mbo.accuracy_filename">accuracy_filename</a>
                        </li>
                        <li>
                                <a class="variable" href="#poisson_mbo.name">name</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#volume_mbo">volume_mbo</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#volume_mbo.__init__">volume_mbo</a>
                        </li>
                        <li>
                                <a class="variable" href="#volume_mbo.class_counts">class_counts</a>
                        </li>
                        <li>
                                <a class="variable" href="#volume_mbo.temperature">temperature</a>
                        </li>
                        <li>
                                <a class="variable" href="#volume_mbo.volume_constraint">volume_constraint</a>
                        </li>
                        <li>
                                <a class="variable" href="#volume_mbo.accuracy_filename">accuracy_filename</a>
                        </li>
                        <li>
                                <a class="variable" href="#volume_mbo.name">name</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#multiclass_mbo">multiclass_mbo</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#multiclass_mbo.__init__">multiclass_mbo</a>
                        </li>
                        <li>
                                <a class="variable" href="#multiclass_mbo.Ns">Ns</a>
                        </li>
                        <li>
                                <a class="variable" href="#multiclass_mbo.T">T</a>
                        </li>
                        <li>
                                <a class="variable" href="#multiclass_mbo.dt">dt</a>
                        </li>
                        <li>
                                <a class="variable" href="#multiclass_mbo.mu">mu</a>
                        </li>
                        <li>
                                <a class="variable" href="#multiclass_mbo.num_eig">num_eig</a>
                        </li>
                        <li>
                                <a class="variable" href="#multiclass_mbo.requires_eig">requires_eig</a>
                        </li>
                        <li>
                                <a class="variable" href="#multiclass_mbo.accuracy_filename">accuracy_filename</a>
                        </li>
                        <li>
                                <a class="variable" href="#multiclass_mbo.name">name</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#modularity_mbo">modularity_mbo</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#modularity_mbo.__init__">modularity_mbo</a>
                        </li>
                        <li>
                                <a class="variable" href="#modularity_mbo.gamma">gamma</a>
                        </li>
                        <li>
                                <a class="variable" href="#modularity_mbo.epsilon">epsilon</a>
                        </li>
                        <li>
                                <a class="variable" href="#modularity_mbo.lamb">lamb</a>
                        </li>
                        <li>
                                <a class="variable" href="#modularity_mbo.requires_eig">requires_eig</a>
                        </li>
                        <li>
                                <a class="variable" href="#modularity_mbo.T">T</a>
                        </li>
                        <li>
                                <a class="variable" href="#modularity_mbo.Ns">Ns</a>
                        </li>
                        <li>
                                <a class="variable" href="#modularity_mbo.accuracy_filename">accuracy_filename</a>
                        </li>
                        <li>
                                <a class="variable" href="#modularity_mbo.name">name</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#laplace">laplace</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#laplace.__init__">laplace</a>
                        </li>
                        <li>
                                <a class="variable" href="#laplace.reweighting">reweighting</a>
                        </li>
                        <li>
                                <a class="variable" href="#laplace.normalization">normalization</a>
                        </li>
                        <li>
                                <a class="variable" href="#laplace.mean_shift">mean_shift</a>
                        </li>
                        <li>
                                <a class="variable" href="#laplace.tol">tol</a>
                        </li>
                        <li>
                                <a class="variable" href="#laplace.order">order</a>
                        </li>
                        <li>
                                <a class="variable" href="#laplace.X">X</a>
                        </li>
                        <li>
                                <a class="variable" href="#laplace.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#laplace.accuracy_filename">accuracy_filename</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#dynamic_label_propagation">dynamic_label_propagation</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#dynamic_label_propagation.__init__">dynamic_label_propagation</a>
                        </li>
                        <li>
                                <a class="variable" href="#dynamic_label_propagation.alpha">alpha</a>
                        </li>
                        <li>
                                <a class="variable" href="#dynamic_label_propagation.lam">lam</a>
                        </li>
                        <li>
                                <a class="variable" href="#dynamic_label_propagation.T">T</a>
                        </li>
                        <li>
                                <a class="variable" href="#dynamic_label_propagation.accuracy_filename">accuracy_filename</a>
                        </li>
                        <li>
                                <a class="variable" href="#dynamic_label_propagation.name">name</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#centered_kernel">centered_kernel</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#centered_kernel.__init__">centered_kernel</a>
                        </li>
                        <li>
                                <a class="variable" href="#centered_kernel.tol">tol</a>
                        </li>
                        <li>
                                <a class="variable" href="#centered_kernel.power_it">power_it</a>
                        </li>
                        <li>
                                <a class="variable" href="#centered_kernel.alpha">alpha</a>
                        </li>
                        <li>
                                <a class="variable" href="#centered_kernel.accuracy_filename">accuracy_filename</a>
                        </li>
                        <li>
                                <a class="variable" href="#centered_kernel.name">name</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#sparse_label_propagation">sparse_label_propagation</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#sparse_label_propagation.__init__">sparse_label_propagation</a>
                        </li>
                        <li>
                                <a class="variable" href="#sparse_label_propagation.T">T</a>
                        </li>
                        <li>
                                <a class="variable" href="#sparse_label_propagation.accuracy_filename">accuracy_filename</a>
                        </li>
                        <li>
                                <a class="variable" href="#sparse_label_propagation.name">name</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#graph_nearest_neighbor">graph_nearest_neighbor</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#graph_nearest_neighbor.__init__">graph_nearest_neighbor</a>
                        </li>
                        <li>
                                <a class="variable" href="#graph_nearest_neighbor.alpha">alpha</a>
                        </li>
                        <li>
                                <a class="variable" href="#graph_nearest_neighbor.accuracy_filename">accuracy_filename</a>
                        </li>
                        <li>
                                <a class="variable" href="#graph_nearest_neighbor.name">name</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#amle">amle</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#amle.__init__">amle</a>
                        </li>
                        <li>
                                <a class="variable" href="#amle.tol">tol</a>
                        </li>
                        <li>
                                <a class="variable" href="#amle.max_num_it">max_num_it</a>
                        </li>
                        <li>
                                <a class="variable" href="#amle.weighted">weighted</a>
                        </li>
                        <li>
                                <a class="variable" href="#amle.prog">prog</a>
                        </li>
                        <li>
                                <a class="variable" href="#amle.onevsrest">onevsrest</a>
                        </li>
                        <li>
                                <a class="variable" href="#amle.accuracy_filename">accuracy_filename</a>
                        </li>
                        <li>
                                <a class="variable" href="#amle.name">name</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#peikonal">peikonal</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#peikonal.__init__">peikonal</a>
                        </li>
                        <li>
                                <a class="variable" href="#peikonal.p">p</a>
                        </li>
                        <li>
                                <a class="variable" href="#peikonal.alpha">alpha</a>
                        </li>
                        <li>
                                <a class="variable" href="#peikonal.max_num_it">max_num_it</a>
                        </li>
                        <li>
                                <a class="variable" href="#peikonal.tol">tol</a>
                        </li>
                        <li>
                                <a class="variable" href="#peikonal.num_bisection_it">num_bisection_it</a>
                        </li>
                        <li>
                                <a class="variable" href="#peikonal.onevsrest">onevsrest</a>
                        </li>
                        <li>
                                <a class="variable" href="#peikonal.similarity">similarity</a>
                        </li>
                        <li>
                                <a class="variable" href="#peikonal.accuracy_filename">accuracy_filename</a>
                        </li>
                        <li>
                                <a class="variable" href="#peikonal.name">name</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#plaplace">plaplace</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#plaplace.__init__">plaplace</a>
                        </li>
                        <li>
                                <a class="variable" href="#plaplace.p">p</a>
                        </li>
                        <li>
                                <a class="variable" href="#plaplace.max_num_it">max_num_it</a>
                        </li>
                        <li>
                                <a class="variable" href="#plaplace.tol">tol</a>
                        </li>
                        <li>
                                <a class="variable" href="#plaplace.onevsrest">onevsrest</a>
                        </li>
                        <li>
                                <a class="variable" href="#plaplace.fast">fast</a>
                        </li>
                        <li>
                                <a class="variable" href="#plaplace.accuracy_filename">accuracy_filename</a>
                        </li>
                        <li>
                                <a class="variable" href="#plaplace.name">name</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#randomwalk">randomwalk</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#randomwalk.__init__">randomwalk</a>
                        </li>
                        <li>
                                <a class="variable" href="#randomwalk.alpha">alpha</a>
                        </li>
                        <li>
                                <a class="variable" href="#randomwalk.accuracy_filename">accuracy_filename</a>
                        </li>
                        <li>
                                <a class="variable" href="#randomwalk.name">name</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#ssl_accuracy">ssl_accuracy</a>
            </li>
            <li>
                    <a class="function" href="#accuracy_plot">accuracy_plot</a>
            </li>
            <li>
                    <a class="function" href="#accuracy_table">accuracy_table</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../graphlearning.html">graphlearning</a><wbr>.ssl    </h1>

                        <div class="docstring"><h1 id="semi-supervised-learning">Semi-Supervised Learning</h1>

<p>This module implements many graph-based semi-supervised learning algorithms in an objected-oriented
fashion, similar to <a href="https://scikit-learn.org/stable/">sklearn</a>. The usage is similar for all algorithms.
Below, we give some high-level examples of how to use this module. There are also examples for some
individual functions, given in the documentation below.</p>

<h6 id="two-moons-example">Two Moons Example</h6>

<p>Semi-supervised learning on the two-moons dataset: <a href="https://github.com/jwcalder/GraphLearning/blob/master/examples/ssl_twomoons.py">ssl_twomoons.py</a>.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">graphlearning</span> <span class="k">as</span> <span class="nn">gl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">sklearn.datasets</span> <span class="k">as</span> <span class="nn">datasets</span>

<span class="n">X</span><span class="p">,</span><span class="n">labels</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">make_moons</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">noise</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">W</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">weightmatrix</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>

<span class="n">train_ind</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">trainsets</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">train_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">ssl</span><span class="o">.</span><span class="n">laplace</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
<span class="n">pred_labels</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>

<span class="n">accuracy</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">ssl</span><span class="o">.</span><span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">pred_labels</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">)</span>   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy: </span><span class="si">%.2f%%</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">accuracy</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">pred_labels</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">X</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre>
</div>

<h6 id="handwritten-digit-classification">Handwritten digit classification</h6>

<p>Laplace and Poisson learning on MNIST at 1 label per class: <a href="https://github.com/jwcalder/GraphLearning/blob/master/examples/ssl_mnist.py">ssl_mnist.py</a>.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">import</span> <span class="nn">graphlearning</span> <span class="k">as</span> <span class="nn">gl</span>

<span class="n">labels</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;mnist&#39;</span><span class="p">,</span> <span class="n">labels_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">W</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">weightmatrix</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="s1">&#39;mnist&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;vae&#39;</span><span class="p">)</span>

<span class="n">num_train_per_class</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">train_ind</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">trainsets</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="n">num_train_per_class</span><span class="p">)</span>
<span class="n">train_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span>

<span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="n">gl</span><span class="o">.</span><span class="n">ssl</span><span class="o">.</span><span class="n">laplace</span><span class="p">(</span><span class="n">W</span><span class="p">),</span> <span class="n">gl</span><span class="o">.</span><span class="n">ssl</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">W</span><span class="p">)]</span>

<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
    <span class="n">pred_labels</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span><span class="n">train_labels</span><span class="p">)</span>
    <span class="n">accuracy</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">ssl</span><span class="o">.</span><span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">pred_labels</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;: </span><span class="si">%.2f%%</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">accuracy</span><span class="p">)</span>
</code></pre>
</div>

<h6 id="comparing-different-methods">Comparing different methods</h6>

<p>The <code><a href="#ssl">ssl</a></code> module contains functions for running large scale experiments, with parallel processing,
to compare many different semi-supervised learning algorithms at different label rates
and with different, randomly chosen, training data. The package includes functions to automatically
create LaTeX tables and plots comparing accuracy or test error. This example compares several methods over 100 
randomized trials: <a href="https://github.com/jwcalder/GraphLearning/blob/master/examples/ssl_trials.py">ssl_trials.py</a>.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">import</span> <span class="nn">graphlearning</span> <span class="k">as</span> <span class="nn">gl</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="s1">&#39;mnist&#39;</span>
<span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;vae&#39;</span> 
<span class="n">k</span> <span class="o">=</span> <span class="mi">10</span> 

<span class="n">W</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">weightmatrix</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span>
<span class="n">D</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">weightmatrix</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;distance&#39;</span><span class="p">)</span>

<span class="n">labels</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span> <span class="n">labels_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">trainsets</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">trainsets</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

<span class="n">model_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">gl</span><span class="o">.</span><span class="n">ssl</span><span class="o">.</span><span class="n">graph_nearest_neighbor</span><span class="p">(</span><span class="n">D</span><span class="p">),</span>
              <span class="n">gl</span><span class="o">.</span><span class="n">ssl</span><span class="o">.</span><span class="n">laplace</span><span class="p">(</span><span class="n">W</span><span class="p">),</span>
              <span class="n">gl</span><span class="o">.</span><span class="n">ssl</span><span class="o">.</span><span class="n">laplace</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">reweighting</span><span class="o">=</span><span class="s1">&#39;wnll&#39;</span><span class="p">),</span> 
              <span class="n">gl</span><span class="o">.</span><span class="n">ssl</span><span class="o">.</span><span class="n">laplace</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">reweighting</span><span class="o">=</span><span class="s1">&#39;poisson&#39;</span><span class="p">),</span>
              <span class="n">gl</span><span class="o">.</span><span class="n">ssl</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;gradient_descent&#39;</span><span class="p">)]</span>

<span class="n">tag</span> <span class="o">=</span> <span class="n">dataset</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">metric</span> <span class="o">+</span> <span class="s1">&#39;_k</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">k</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model_list</span><span class="p">:</span>
    <span class="n">model</span><span class="o">.</span><span class="n">ssl_trials</span><span class="p">(</span><span class="n">trainsets</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">num_cores</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>

<span class="n">gl</span><span class="o">.</span><span class="n">ssl</span><span class="o">.</span><span class="n">accuracy_table</span><span class="p">(</span><span class="n">model_list</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span> <span class="n">savefile</span><span class="o">=</span><span class="s1">&#39;SSL_&#39;</span><span class="o">+</span><span class="n">dataset</span><span class="o">+</span><span class="s1">&#39;.tex&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;SSL Comparison: &quot;</span><span class="o">+</span><span class="n">dataset</span><span class="p">)</span>
<span class="n">gl</span><span class="o">.</span><span class="n">ssl</span><span class="o">.</span><span class="n">accuracy_plot</span><span class="p">(</span><span class="n">model_list</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;SSL&#39;</span><span class="p">)</span>
</code></pre>
</div>

<h6 id="class-priors">Class Priors</h6>

<p>Prior information about relative class sizes can be used to improve performance: <a href="https://github.com/jwcalder/GraphLearning/blob/master/examples/ssl_classpriors.py">ssl_classpriors.py</a>.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">import</span> <span class="nn">graphlearning</span> <span class="k">as</span> <span class="nn">gl</span>

<span class="n">labels</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;mnist&#39;</span><span class="p">,</span> <span class="n">labels_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">W</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">weightmatrix</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="s1">&#39;mnist&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;vae&#39;</span><span class="p">)</span>

<span class="n">num_train_per_class</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">train_ind</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">trainsets</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="n">num_train_per_class</span><span class="p">)</span>
<span class="n">train_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span>

<span class="n">class_priors</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">class_priors</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">ssl</span><span class="o">.</span><span class="n">laplace</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="n">class_priors</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span><span class="n">train_labels</span><span class="p">)</span>

<span class="n">pred_labels</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">ignore_class_priors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">ssl</span><span class="o">.</span><span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">pred_labels</span><span class="p">,</span><span class="n">train_ind</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; without class priors: </span><span class="si">%.2f%%</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">accuracy</span><span class="p">)</span>

<span class="n">pred_labels</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">ssl</span><span class="o">.</span><span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">pred_labels</span><span class="p">,</span><span class="n">train_ind</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; with class priors: </span><span class="si">%.2f%%</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">accuracy</span><span class="p">)</span>
</code></pre>
</div>
</div>

                        <input id="mod-ssl-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-ssl-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="sd">Semi-Supervised Learning</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="sd">========================</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="sd">This module implements many graph-based semi-supervised learning algorithms in an objected-oriented</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="sd">fashion, similar to [sklearn](https://scikit-learn.org/stable/). The usage is similar for all algorithms.</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="sd">Below, we give some high-level examples of how to use this module. There are also examples for some</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="sd">individual functions, given in the documentation below.</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="sd">Two Moons Example</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="sd">----</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="sd">Semi-supervised learning on the two-moons dataset: [ssl_twomoons.py](https://github.com/jwcalder/GraphLearning/blob/master/examples/ssl_twomoons.py).</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="sd">```py</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="sd">import numpy as np</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="sd">import graphlearning as gl</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="sd">import matplotlib.pyplot as plt</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="sd">import sklearn.datasets as datasets</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="sd">X,labels = datasets.make_moons(n_samples=500,noise=0.1)</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="sd">W = gl.weightmatrix.knn(X,10)</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="sd">train_ind = gl.trainsets.generate(labels, rate=5)</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="sd">train_labels = labels[train_ind]</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="sd">model = gl.ssl.laplace(W)</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="sd">pred_labels = model.fit_predict(train_ind, train_labels)</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="sd">accuracy = gl.ssl.ssl_accuracy(pred_labels, labels, train_ind)   </span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="sd">print(&quot;Accuracy: %.2f%%&quot;%accuracy)</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="sd">plt.scatter(X[:,0],X[:,1], c=pred_labels)</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="sd">plt.scatter(X[train_ind,0],X[train_ind,1], c=&#39;r&#39;)</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="sd">plt.show()</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="sd">```</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="sd">Handwritten digit classification</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="sd">-----</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="sd">Laplace and Poisson learning on MNIST at 1 label per class: [ssl_mnist.py](https://github.com/jwcalder/GraphLearning/blob/master/examples/ssl_mnist.py).</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="sd">```py</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="sd">import graphlearning as gl</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="sd">labels = gl.datasets.load(&#39;mnist&#39;, labels_only=True)</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="sd">W = gl.weightmatrix.knn(&#39;mnist&#39;, 10, metric=&#39;vae&#39;)</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="sd">num_train_per_class = 1</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="sd">train_ind = gl.trainsets.generate(labels, rate=num_train_per_class)</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="sd">train_labels = labels[train_ind]</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="sd">models = [gl.ssl.laplace(W), gl.ssl.poisson(W)]</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="sd">for model in models:</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="sd">    pred_labels = model.fit_predict(train_ind,train_labels)</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a><span class="sd">    accuracy = gl.ssl.ssl_accuracy(pred_labels, labels, train_ind)</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="sd">    print(model.name + &#39;: %.2f%%&#39;%accuracy)</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a><span class="sd">```</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a><span class="sd">Comparing different methods</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a><span class="sd">-----------</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a><span class="sd">The `ssl` module contains functions for running large scale experiments, with parallel processing,</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a><span class="sd">to compare many different semi-supervised learning algorithms at different label rates</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a><span class="sd">and with different, randomly chosen, training data. The package includes functions to automatically</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a><span class="sd">create LaTeX tables and plots comparing accuracy or test error. This example compares several methods over 100 </span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a><span class="sd">randomized trials: [ssl_trials.py](https://github.com/jwcalder/GraphLearning/blob/master/examples/ssl_trials.py).</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="sd">```py</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a><span class="sd">import graphlearning as gl</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a><span class="sd">dataset = &#39;mnist&#39;</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="sd">metric = &#39;vae&#39; </span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a><span class="sd">k = 10 </span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a><span class="sd">W = gl.weightmatrix.knn(dataset, k, metric=metric)</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a><span class="sd">D = gl.weightmatrix.knn(dataset, k, metric=metric, kernel=&#39;distance&#39;)</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="sd">labels = gl.datasets.load(dataset, metric=metric, labels_only=True)</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a><span class="sd">trainsets = gl.trainsets.load(dataset)</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a><span class="sd">model_list = [gl.ssl.graph_nearest_neighbor(D),</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a><span class="sd">              gl.ssl.laplace(W),</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a><span class="sd">              gl.ssl.laplace(W, reweighting=&#39;wnll&#39;), </span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="sd">              gl.ssl.laplace(W, reweighting=&#39;poisson&#39;),</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a><span class="sd">              gl.ssl.poisson(W, solver=&#39;gradient_descent&#39;)]</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a><span class="sd">tag = dataset + &#39;_&#39; + metric + &#39;_k%d&#39;%k</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a><span class="sd">for model in model_list:</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a><span class="sd">    model.ssl_trials(trainsets, labels, num_cores=20, tag=tag)</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="sd">gl.ssl.accuracy_table(model_list, tag=tag, savefile=&#39;SSL_&#39;+dataset+&#39;.tex&#39;, title=&quot;SSL Comparison: &quot;+dataset)</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a><span class="sd">gl.ssl.accuracy_plot(model_list, tag=tag, title=&#39;SSL&#39;)</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a><span class="sd">```</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a><span class="sd">Class Priors</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a><span class="sd">-----------</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a><span class="sd">Prior information about relative class sizes can be used to improve performance: [ssl_classpriors.py](https://github.com/jwcalder/GraphLearning/blob/master/examples/ssl_classpriors.py).</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a><span class="sd">```py</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a><span class="sd">import graphlearning as gl</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a><span class="sd">labels = gl.datasets.load(&#39;mnist&#39;, labels_only=True)</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a><span class="sd">W = gl.weightmatrix.knn(&#39;mnist&#39;, 10, metric=&#39;vae&#39;)</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a><span class="sd">num_train_per_class = 1</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a><span class="sd">train_ind = gl.trainsets.generate(labels, rate=num_train_per_class)</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a><span class="sd">train_labels = labels[train_ind]</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a><span class="sd">class_priors = gl.utils.class_priors(labels)</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a><span class="sd">model = gl.ssl.laplace(W, class_priors=class_priors)</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a><span class="sd">model.fit(train_ind,train_labels)</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a><span class="sd">pred_labels = model.predict(ignore_class_priors=True)</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a><span class="sd">accuracy = gl.ssl.ssl_accuracy(labels,pred_labels,train_ind)</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a><span class="sd">print(model.name + &#39; without class priors: %.2f%%&#39;%accuracy)</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a><span class="sd">pred_labels = model.predict()</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a><span class="sd">accuracy = gl.ssl.ssl_accuracy(labels,pred_labels,train_ind)</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a><span class="sd">print(model.name + &#39; with class priors: %.2f%%&#39;%accuracy)</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a><span class="sd">```</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">sparse</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a><span class="kn">import</span> <span class="nn">multiprocessing</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a><span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">datetime</span><span class="o">,</span> <span class="nn">matplotlib</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">utils</span> 
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">graph</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a><span class="c1">#Directories</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a><span class="n">results_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="s1">&#39;results&#39;</span><span class="p">)</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a><span class="k">class</span> <span class="nc">ssl</span><span class="p">:</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">):</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>        <span class="k">if</span> <span class="n">W</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_graph</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fitted</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">requires_eig</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onevsrest</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">similarity</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="o">=</span> <span class="n">class_priors</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span><span class="p">)</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">class_priors_error</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>    <span class="k">def</span> <span class="nf">set_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set Graph</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a><span class="sd">        ===================</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a><span class="sd">        Sets the graph object for semi-supervised learning.</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a><span class="sd">        Implements 3 different solvers, spectral, gradient_descent, and conjugate_gradient. </span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a><span class="sd">        GPU acceleration is available for gradient descent. See [1] for details.</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a><span class="sd">        Parameters</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a><span class="sd">        ----------</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">==</span> <span class="n">graph</span><span class="o">.</span><span class="n">graph</span><span class="p">:</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">W</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">graph</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>    <span class="k">def</span> <span class="nf">volume_label_projection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Volume label projection</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a><span class="sd">        ======</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a><span class="sd">    </span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a><span class="sd">        Projects class probabilities to labels while enforcing a constraint on </span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a><span class="sd">        class priors (i.e., class volumes). Does not return anything, just modifies `self.weights`.</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a><span class="sd">        </span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a><span class="sd">        Returns</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a><span class="sd">        -------</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a><span class="sd">        labels : numpy array (int)</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a><span class="sd">            Predicted labels after volume correction.</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">k</span><span class="p">,))</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>        <span class="c1">#Time step</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>        <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarity</span><span class="p">:</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>            <span class="n">dt</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>        <span class="c1">#np.set_printoptions(formatter={&#39;float&#39;: lambda x: &quot;{0:0.3f}&quot;.format(x)})</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>        <span class="n">err</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mf">1e4</span> <span class="ow">and</span> <span class="n">err</span> <span class="o">&gt;</span> <span class="mf">1e-3</span><span class="p">:</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>            <span class="n">class_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>            <span class="c1">#print(class_size-self.class_priors)</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>            <span class="n">grad</span> <span class="o">=</span> <span class="n">class_size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>            <span class="n">err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">grad</span><span class="p">))</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">+=</span> <span class="n">dt</span><span class="o">*</span><span class="n">grad</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">class_priors_error</span> <span class="o">=</span> <span class="n">err</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>    <span class="k">def</span> <span class="nf">get_accuracy_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get accuracy filename</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a><span class="sd">        ========</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a><span class="sd">        Returns name of the file that will store the accuracy results for `ssl_trials.py`.</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a><span class="sd">        Returns</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a><span class="sd">        -------</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a><span class="sd">        fname : str</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a><span class="sd">            Accuracy filename.</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>        <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>            <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_classpriors&#39;</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>        <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_accuracy.csv&#39;</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>        <span class="k">return</span> <span class="n">fname</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignore_class_priors</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Predict</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a><span class="sd">        ========</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a><span class="sd">        Makes label predictions based on the probabilities computed by `fit()`.</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a><span class="sd">        Will use a volume label projection if `class_priors` were given, to ensure </span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a><span class="sd">        the number of nodes predicted in each class is correct.</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a><span class="sd">        </span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a><span class="sd">        Parameters</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a><span class="sd">        ----------</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a><span class="sd">        ignore_class_priors : bool (optional), default=False</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a><span class="sd">            Used to disable the volume constrained label decision, when `class_priors` has been provided. </span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a><span class="sd">        Returns</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a><span class="sd">        -------</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="sd">        pred_labels : (int) numpy array</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a><span class="sd">            Predicted labels as integers for all datapoints in the graph.</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitted</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Model has not been fitted yet.&#39;</span><span class="p">)</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>        <span class="k">if</span> <span class="n">ignore_class_priors</span><span class="p">:</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>            <span class="n">w</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>        <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prob</span><span class="p">)</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>        <span class="n">scores</span> <span class="o">=</span> <span class="n">scores</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>        <span class="c1">#Check if scores are similarity or distance</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarity</span><span class="p">:</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>            <span class="n">pred_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">scores</span><span class="o">*</span><span class="n">w</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>        <span class="k">else</span><span class="p">:</span> <span class="c1">#Then distances</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>            <span class="n">pred_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">scores</span><span class="o">*</span><span class="n">w</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>        <span class="k">return</span> <span class="n">pred_labels</span> 
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>    <span class="k">def</span> <span class="nf">fit_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit and predict</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a><span class="sd">        ======</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a><span class="sd">        Calls fit() and predict() sequentially.</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a><span class="sd">        Parameters</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a><span class="sd">        ----------</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a><span class="sd">        train_ind : numpy array, int</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a><span class="sd">            Indicies of training points.</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a><span class="sd">        train_labels : numpy array, int</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a><span class="sd">            Training labels as integers \\(0,1,\\dots,k-1\\) for \\(k\\) classes.</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a><span class="sd">        all_labels : numpy array, int (optional)</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a><span class="sd">            True labels for all datapoints.</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a><span class="sd">        Returns</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a><span class="sd">        -------</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a><span class="sd">        pred_labels : (int) numpy array</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a><span class="sd">            Predicted labels as integers for all datapoints in the graph.</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="n">all_labels</span><span class="p">)</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>    <span class="k">def</span> <span class="nf">ssl_trials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trainsets</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">num_cores</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">save_results</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_trials</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Semi-supervised learning trials</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a><span class="sd">        ===================</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a><span class="sd">        Runs a semi-supervised learning algorithm on a list of training sets,</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a><span class="sd">        recording the label rates and saves the results to a csv file in the</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a><span class="sd">        local folder results/. The filename is controlled by the member function</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a><span class="sd">        model.get_accuracy_filename(). The trial will abort if the accuracy result</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a><span class="sd">        file already exists, unless `overwrite=True`.</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a><span class="sd">        Parameters</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a><span class="sd">        ----------</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a><span class="sd">        trainsets : list of numpy arrays</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a><span class="sd">            Collection of training sets to run semi-supervised learning on. This is the output</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a><span class="sd">            of `graphlearning.trainsets.generate` or `graphlearning.trainsets.load`.</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a><span class="sd">        labels : numpy array (int)</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a><span class="sd">            Integer array of labels for entire dataset.</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a><span class="sd">        num_cores : int</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a><span class="sd">            Number of cores to use for parallel processing over trials</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a><span class="sd">        tag : str (optional), default=&#39;&#39;</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a><span class="sd">            An extra identifying tag to add to the accuracy filename.</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a><span class="sd">        save_results : bool (optional), default=True</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a><span class="sd">            Whether to save results to csv file or just print to the screen.</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a><span class="sd">        overwrite : bool (optional), default = False</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a><span class="sd">            Whether to overwrite existing results file, if found. If `overwrite=False`, </span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a><span class="sd">            `save_results=True`, and the results file is found, the trial is aborted.</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a><span class="sd">        num_trials: int (optional), defualt = -1</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a><span class="sd">            Number of trials. Any negative number runs all trials.</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>        <span class="k">if</span> <span class="n">num_trials</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>            <span class="n">trainsets</span> <span class="o">=</span> <span class="n">trainsets</span><span class="p">[:</span><span class="n">num_trials</span><span class="p">]</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>        <span class="c1">#Print name</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Model: &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>        <span class="k">if</span> <span class="n">save_results</span><span class="p">:</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">results_dir</span><span class="p">):</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">results_dir</span><span class="p">)</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>            <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="n">tag</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_accuracy_filename</span><span class="p">())</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">overwrite</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outfile</span><span class="p">):</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Aborting: SSL trial already completed, and overwrite is False.&#39;</span><span class="p">)</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>                <span class="k">return</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>            <span class="c1">#now = datetime.datetime.now()</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>            <span class="c1">#f.write(&quot;Date/Time, &quot;+now.strftime(&quot;%Y-%m-%d_%H:%M&quot;)+&quot;\n&quot;)</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Number of labels,Accuracy</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Number of labels,Accuracy,Accuracy with class priors,Class priors error</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>        <span class="k">if</span> <span class="n">save_results</span><span class="p">:</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Results File: &#39;</span><span class="o">+</span><span class="n">outfile</span><span class="p">)</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Number of labels,Accuracy&#39;</span><span class="p">)</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Number of labels,Accuracy,Accuracy with class priors,Class priors error&#39;</span><span class="p">)</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>        <span class="c1">#Trial run to trigger eigensolvers, when needed</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires_eig</span><span class="p">:</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>            <span class="n">pred_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">trainsets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">labels</span><span class="p">[</span><span class="n">trainsets</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>     
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>        <span class="k">def</span> <span class="nf">one_trial</span><span class="p">(</span><span class="n">train_ind</span><span class="p">):</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>            <span class="c1">#Number of labels</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>            <span class="n">num_train</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>            <span class="n">train_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>            <span class="c1">#Run semi-supervised learning</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>            <span class="n">pred_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>            <span class="c1">#Compute accuracy</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>            <span class="n">accuracy</span> <span class="o">=</span> <span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">pred_labels</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>            <span class="c1">#If class priors were provided, check accuracy without priors</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>                <span class="n">pred_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">ignore_class_priors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>                <span class="n">accuracy_without_priors</span> <span class="o">=</span> <span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">pred_labels</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>            
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>            <span class="c1">#Print to terminal</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">num_train</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">accuracy</span><span class="p">)</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">,</span><span class="si">%.2f</span><span class="s2">,</span><span class="si">%.2f</span><span class="s2">,</span><span class="si">%.5f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_train</span><span class="p">,</span><span class="n">accuracy_without_priors</span><span class="p">,</span><span class="n">accuracy</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">class_priors_error</span><span class="p">))</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>            <span class="c1">#Write to file</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>            <span class="k">if</span> <span class="n">save_results</span><span class="p">:</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="s2">&quot;a+&quot;</span><span class="p">)</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">num_train</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="si">%.2f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">accuracy</span><span class="p">)</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">,</span><span class="si">%.2f</span><span class="s2">,</span><span class="si">%.2f</span><span class="s2">,</span><span class="si">%.5f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_train</span><span class="p">,</span><span class="n">accuracy_without_priors</span><span class="p">,</span><span class="n">accuracy</span><span class="p">,</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>                                                                            <span class="bp">self</span><span class="o">.</span><span class="n">class_priors_error</span><span class="p">))</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>        <span class="n">num_cores</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">(),</span><span class="n">num_cores</span><span class="p">)</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>        <span class="k">if</span> <span class="n">num_cores</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>            <span class="k">for</span> <span class="n">train_ind</span> <span class="ow">in</span> <span class="n">trainsets</span><span class="p">:</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>                <span class="n">one_trial</span><span class="p">(</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>            <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">num_cores</span><span class="p">)(</span><span class="n">delayed</span><span class="p">(</span><span class="n">one_trial</span><span class="p">)(</span><span class="n">train_ind</span><span class="p">)</span> <span class="k">for</span> <span class="n">train_ind</span> <span class="ow">in</span> <span class="n">trainsets</span><span class="p">)</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>    <span class="k">def</span> <span class="nf">trials_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trials statistics</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a><span class="sd">        ===================</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a><span class="sd">        Loads accuracy scores from each trial from csv files created by `ssl_trials`</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a><span class="sd">        and returns summary statistics (mean and standard deviation of accuracy).</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a><span class="sd">        Parameters</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a><span class="sd">        ----------</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a><span class="sd">        tag : str (optional), default=&#39;&#39;</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a><span class="sd">            An extra identifying tag to add to the accuracy filename.</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a><span class="sd">        Returns</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a><span class="sd">        -------</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a><span class="sd">        num_train : numpy array</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a><span class="sd">            Number of training examples in each label rate experiment.</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a><span class="sd">        acc_mean : numpy array</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a><span class="sd">            Mean accuracy over all trials in each experiment.</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a><span class="sd">        acc_stddev : numpy array</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a><span class="sd">            Standard deviation of accuracy over all trials in each experiment.</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a><span class="sd">        num_trials : int</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a><span class="sd">            Number of trials for each label rate.</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>        <span class="n">accuracy_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="n">tag</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_accuracy_filename</span><span class="p">())</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">csvread</span><span class="p">(</span><span class="n">accuracy_filename</span><span class="p">)</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>        <span class="n">num_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>        <span class="n">acc_mean</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>        <span class="n">acc_stddev</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">num_train</span><span class="p">:</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>            <span class="n">Y</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>            <span class="n">acc_mean</span> <span class="o">+=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>            <span class="n">acc_stddev</span> <span class="o">+=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>        <span class="n">num_trials</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">num_train</span><span class="p">))</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>        <span class="n">acc_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">acc_mean</span><span class="p">)</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>        <span class="n">acc_stddev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">acc_stddev</span><span class="p">)</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>        <span class="k">return</span> <span class="n">num_train</span><span class="p">,</span> <span class="n">acc_mean</span><span class="p">,</span> <span class="n">acc_stddev</span><span class="p">,</span> <span class="n">num_trials</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>   
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a><span class="sd">        ======</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a><span class="sd">        Solves graph-based learning problem, computing the probability </span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a><span class="sd">        that each node belongs to each class. If `all_labels` is provided, </span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a><span class="sd">        then the solver operates in verbose mode, printing out accuracy</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a><span class="sd">        at each iteration.</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a><span class="sd">        Parameters</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a><span class="sd">        ----------</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a><span class="sd">        train_ind : numpy array, int</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a><span class="sd">            Indicies of training points.</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a><span class="sd">        train_labels : numpy array, int</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a><span class="sd">            Training labels as integers \\(0,1,\\dots,k-1\\) for \\(k\\) classes.</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a><span class="sd">        all_labels : numpy array, int (optional)</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a><span class="sd">            True labels for all datapoints.</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a><span class="sd">        Returns</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a><span class="sd">        -------</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a><span class="sd">        u : (n,k) numpy array, float</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a><span class="sd">            Probabilities computed by graph-based learning for each node and each class.</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;SSL object has no graph. Use graph.set_graph() to provide a graph for SSL.&#39;</span><span class="p">)</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fitted</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>        <span class="c1">#If a one-vs-rest classifier</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">onevsrest</span><span class="p">:</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>            <span class="n">unique_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>            <span class="n">num_labels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">)</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span><span class="n">num_labels</span><span class="p">))</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">):</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">prob</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="o">==</span><span class="n">l</span><span class="p">)</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="n">all_labels</span><span class="p">)</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">volume_label_projection</span><span class="p">()</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal Fit Function</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a><span class="sd">        ======</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a><span class="sd">        Internal fit function that any ssl object must override. If `self.onevsrest=True` then</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a><span class="sd">        `train_labels` are binary in the one-vs-rest framework, and `_fit` must return</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a><span class="sd">        a scalar numpy array. Otherwise the labels are integer and `_fit` must return an (n,k)</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a><span class="sd">        numpy array of probabilities, where `k` is the number of classes.</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a><span class="sd">        Parameters</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a><span class="sd">        ----------</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a><span class="sd">        train_ind : numpy array, int</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a><span class="sd">            Indicies of training points.</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a><span class="sd">        train_labels : numpy array, int</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a><span class="sd">            Training labels as integers \\(0,1,\\dots,k-1\\) for \\(k\\) classes, or binary</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a><span class="sd">            if `self.onevsrest=True`.</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a><span class="sd">        all_labels : numpy array, int (optional)</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a><span class="sd">            True labels for all datapoints.</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a><span class="sd">        Returns</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a><span class="sd">        -------</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a><span class="sd">        u : numpy array, float</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a><span class="sd">            (n,k) array of probabilities computed by graph-based learning for each node and each class, unless</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a><span class="sd">            `self.onevsrest=True`, in which case it is a length n numpy array of probablities for the current </span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a><span class="sd">            class.</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Must override _fit&quot;</span><span class="p">)</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a><span class="k">class</span> <span class="nc">poisson</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;conjugate_gradient&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">use_cuda</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">min_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">spectral_cutoff</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Poisson Learning</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a><span class="sd">        ===================</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a><span class="sd">        Semi-supervised learning via the solution of the Poisson equation </span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a><span class="sd">        \\[L^p u = \\sum_{j=1}^m \\delta_j(y_j - \\overline{y})^T,\\]</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a><span class="sd">        where \\(L=D-W\\) is the combinatorial graph Laplacian, </span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a><span class="sd">        \\(y_j\\) are the label vectors, \\(\\overline{y} = \\frac{1}{m}\\sum_{i=1}^m y_j\\) </span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a><span class="sd">        is the average label vector, \\(m\\) is the number of training points, and </span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a><span class="sd">        \\(\\delta_j\\) are standard basis vectors. See the reference for more details.</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a><span class="sd">        Implements 3 different solvers, spectral, gradient_descent, and conjugate_gradient. </span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a><span class="sd">        GPU acceleration is available for gradient descent. See [1] for details.</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a><span class="sd">        Parameters</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a><span class="sd">        ----------</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a><span class="sd">            nodes in each class.</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a><span class="sd">        solver : {&#39;spectral&#39;, &#39;conjugate_gradient&#39;, &#39;gradient_descent&#39;} (optional), default=&#39;conjugate_gradient&#39;</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a><span class="sd">            Choice of solver for Poisson learning.</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a><span class="sd">        p : int (optional), default=1</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a><span class="sd">            Power for Laplacian, can be any positive real number. Solver will default to &#39;spectral&#39; if p!=1.</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a><span class="sd">        use_cuda : bool (optional), default=False</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a><span class="sd">            Whether to use GPU acceleration for gradient descent solver.</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a><span class="sd">        min_iter : int (optional), default=50</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a><span class="sd">            Minimum number of iterations of gradient descent before checking stopping condition.</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a><span class="sd">        max_iter : int (optional), default=1000</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a><span class="sd">            Maximum number of iterations of gradient descent.</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a><span class="sd">        tol : float (optional), default=1e-3</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a><span class="sd">            Tolerance for conjugate gradient solver.</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a><span class="sd">        spectral_cutoff : int (optional), default=10</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a><span class="sd">            Number of eigenvectors to use for spectral solver.</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a><span class="sd">        Examples</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a><span class="sd">        --------</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a><span class="sd">        Poisson learning works on directed (i.e., nonsymmetric) graphs with the gradient descent solver: [poisson_directed.py](https://github.com/jwcalder/GraphLearning/blob/master/examples/poisson_directed.py).</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a><span class="sd">        ```py</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a><span class="sd">        import numpy as np</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a><span class="sd">        import graphlearning as gl</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a><span class="sd">        import matplotlib.pyplot as plt</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a><span class="sd">        import sklearn.datasets as datasets</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a><span class="sd">        X,labels = datasets.make_moons(n_samples=500,noise=0.1)</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a><span class="sd">        W = gl.weightmatrix.knn(X,10,symmetrize=False)</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a><span class="sd">        train_ind = gl.trainsets.generate(labels, rate=5)</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a><span class="sd">        train_labels = labels[train_ind]</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a><span class="sd">        model = gl.ssl.poisson(W, solver=&#39;gradient_descent&#39;)</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a><span class="sd">        pred_labels = model.fit_predict(train_ind, train_labels)</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a><span class="sd">        accuracy = gl.ssl.ssl_accuracy(pred_labels, labels, train_ind)   </span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a><span class="sd">        print(&quot;Accuracy: %.2f%%&quot;%accuracy)</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a><span class="sd">        plt.scatter(X[:,0],X[:,1], c=pred_labels)</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a><span class="sd">        plt.scatter(X[train_ind,0],X[train_ind,1], c=&#39;r&#39;)</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a><span class="sd">        plt.show()</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a><span class="sd">        ```</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a><span class="sd">        Reference</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a><span class="sd">        ---------</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a><span class="sd">        [1] J. Calder, B. Cook, M. Thorpe, D. Slepcev. [Poisson Learning: Graph Based Semi-Supervised</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a><span class="sd">        Learning at Very Low Label Rates.](http://proceedings.mlr.press/v119/calder20a.html), </span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a><span class="sd">        Proceedings of the 37th International Conference on Machine Learning, PMLR 119:1306-1316, 2020.</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>        <span class="k">if</span> <span class="n">solver</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;conjugate_gradient&#39;</span><span class="p">,</span> <span class="s1">&#39;spectral&#39;</span><span class="p">,</span> <span class="s1">&#39;gradient_descent&#39;</span><span class="p">]:</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Invalid Poisson solver&quot;</span><span class="p">)</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">solver</span> <span class="o">=</span> <span class="n">solver</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>        <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">solver</span> <span class="o">=</span> <span class="s1">&#39;spectral&#39;</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_cuda</span> <span class="o">=</span> <span class="n">use_cuda</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">min_iter</span> <span class="o">=</span> <span class="n">min_iter</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_iter</span> <span class="o">=</span> <span class="n">max_iter</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">spectral_cutoff</span> <span class="o">=</span> <span class="n">spectral_cutoff</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>        <span class="c1">#Setup accuracy filename</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>        <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;_poisson&#39;</span> 
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>            <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_p</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">p</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solver</span> <span class="o">==</span> <span class="s1">&#39;spectral&#39;</span><span class="p">:</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>            <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_N</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">spectral_cutoff</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">requries_eig</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="n">fname</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>        <span class="c1">#Setup Algorithm name</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Poisson Learning&#39;</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>        <span class="n">unique_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>        <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">)</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>        
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>        <span class="c1">#Zero out diagonal for faster convergence</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">weight_matrix</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="n">W</span> <span class="o">-</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">diagonal</span><span class="p">(),</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>        <span class="n">G</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">graph</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>        <span class="c1">#Poisson source term</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>        <span class="n">onehot</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>        <span class="n">source</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">onehot</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>        <span class="n">source</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">onehot</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">onehot</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>        
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solver</span> <span class="o">==</span> <span class="s1">&#39;conjugate_gradient&#39;</span><span class="p">:</span>  <span class="c1">#Conjugate gradient solver</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>            <span class="n">L</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">laplacian</span><span class="p">(</span><span class="n">normalization</span><span class="o">=</span><span class="s1">&#39;normalized&#39;</span><span class="p">)</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>            <span class="n">D</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">degree_matrix</span><span class="p">(</span><span class="n">p</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">conjgrad</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">D</span><span class="o">*</span><span class="n">source</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tol</span><span class="p">)</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">D</span><span class="o">*</span><span class="n">u</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">solver</span> <span class="o">==</span> <span class="s2">&quot;gradient_descent&quot;</span><span class="p">:</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>            <span class="c1">#Setup matrices</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>            <span class="n">D</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">degree_matrix</span><span class="p">(</span><span class="n">p</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>            <span class="n">P</span> <span class="o">=</span> <span class="n">D</span><span class="o">*</span><span class="n">W</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>            <span class="n">Db</span> <span class="o">=</span> <span class="n">D</span><span class="o">*</span><span class="n">source</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>            <span class="c1">#Invariant distribution</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>            <span class="n">v</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>            <span class="n">deg</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">degree_vector</span><span class="p">()</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>            <span class="n">vinf</span> <span class="o">=</span> <span class="n">deg</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">deg</span><span class="p">)</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>            <span class="n">RW</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">*</span><span class="n">D</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>            <span class="c1">#Number of iterations</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>            <span class="n">T</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_cuda</span><span class="p">:</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>                <span class="kn">import</span> <span class="nn">torch</span> 
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>                <span class="n">Pt</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">torch_sparse</span><span class="p">(</span><span class="n">P</span><span class="p">)</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>                <span class="n">ut</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>                <span class="n">Dbt</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">Db</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>                <span class="k">while</span> <span class="p">(</span><span class="n">T</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_iter</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">v</span><span class="o">-</span><span class="n">vinf</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">/</span><span class="n">n</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">T</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_iter</span><span class="p">):</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>                    <span class="n">ut</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">addmm</span><span class="p">(</span><span class="n">Dbt</span><span class="p">,</span><span class="n">Pt</span><span class="p">,</span><span class="n">ut</span><span class="p">)</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>                    <span class="n">v</span> <span class="o">=</span> <span class="n">RW</span><span class="o">*</span><span class="n">v</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>                    <span class="n">T</span> <span class="o">=</span> <span class="n">T</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>                <span class="c1">#Transfer to CPU and convert to numpy</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>                <span class="n">u</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>            <span class="k">else</span><span class="p">:</span> <span class="c1">#Use CPU</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>                <span class="k">while</span> <span class="p">(</span><span class="n">T</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_iter</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">v</span><span class="o">-</span><span class="n">vinf</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">/</span><span class="n">n</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">T</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_iter</span><span class="p">):</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>                    <span class="n">u</span> <span class="o">=</span> <span class="n">Db</span> <span class="o">+</span> <span class="n">P</span><span class="o">*</span><span class="n">u</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>                    <span class="n">v</span> <span class="o">=</span> <span class="n">RW</span><span class="o">*</span><span class="n">v</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>                    <span class="n">T</span> <span class="o">=</span> <span class="n">T</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>                    <span class="c1">#Compute accuracy if all labels are provided</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>                    <span class="k">if</span> <span class="n">all_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">=</span> <span class="n">u</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>                        <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>                        <span class="n">acc</span> <span class="o">=</span> <span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">all_labels</span><span class="p">,</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,Accuracy = </span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">acc</span><span class="p">))</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>                
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>        <span class="c1">#Use spectral solver</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">solver</span> <span class="o">==</span> <span class="s1">&#39;spectral&#39;</span><span class="p">:</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>            <span class="n">vals</span><span class="p">,</span> <span class="n">vecs</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">eigen_decomp</span><span class="p">(</span><span class="n">normalization</span><span class="o">=</span><span class="s1">&#39;randomwalk&#39;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spectral_cutoff</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>            <span class="n">V</span> <span class="o">=</span> <span class="n">vecs</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>            <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>                <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>            <span class="n">L</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">vals</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectral_cutoff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectral_cutoff</span><span class="p">)</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">V</span><span class="o">@</span><span class="p">(</span><span class="n">L</span><span class="o">@</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="nd">@source</span><span class="p">))</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Invalid Poisson solver &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">solver</span><span class="p">)</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>        <span class="k">return</span> <span class="n">u</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a><span class="k">class</span> <span class="nc">poisson_mbo</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;conjugate_gradient&#39;</span><span class="p">,</span> <span class="n">use_cuda</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">min_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">spectral_cutoff</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">Ns</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;PoissonMBO </span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a><span class="sd">        ===================</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a><span class="sd">        Semi-supervised learning via Poisson MBO method [1]. class_priors must be provided.</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a><span class="sd">        Parameters</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a><span class="sd">        ----------</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a><span class="sd">            Class priors (fraction of data belonging to each class). </span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a><span class="sd">        solver : {&#39;spectral&#39;, &#39;conjugate_gradient&#39;, &#39;gradient_descent&#39;} (optional), default=&#39;conjugate_gradient&#39;</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a><span class="sd">            Choice of solver for Poisson learning.</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a><span class="sd">        use_cuda : bool (optional), default=False</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a><span class="sd">            Whether to use GPU acceleration for gradient descent solver.</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a><span class="sd">        min_iter : int (optional), default=50</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a><span class="sd">            Minimum number of iterations of gradient descent before checking stopping condition.</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a><span class="sd">        max_iter : int (optional), default=1000</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a><span class="sd">            Maximum number of iterations of gradient descent.</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a><span class="sd">        tol : float (optional), default=1e-3</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a><span class="sd">            Tolerance for conjugate gradient solver.</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a><span class="sd">        spectral_cutoff : int (optional), default=10</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a><span class="sd">            Number of eigenvectors to use for spectral solver.</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a><span class="sd">        Ns : int (optional), default=40</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a><span class="sd">            Number of inner iterations in PoissonMBO.</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a><span class="sd">        mu : float (optional), default=1</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a><span class="sd">            Fidelity parameter.</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a><span class="sd">        T : int (optional), default=20</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a><span class="sd">            Number of MBO iterations.</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a><span class="sd">        </span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a><span class="sd">        Example</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a><span class="sd">        -------</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a><span class="sd">        Running PoissonMBO on MNIST at 1 label per class: [poisson_mbo.py](https://github.com/jwcalder/GraphLearning/blob/master/examples/poisson_mbo.py).</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a><span class="sd">        ```py</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a><span class="sd">        import graphlearning as gl</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a><span class="sd">        labels = gl.datasets.load(&#39;mnist&#39;, labels_only=True)</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a><span class="sd">        W = gl.weightmatrix.knn(&#39;mnist&#39;, 10, metric=&#39;vae&#39;)</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a><span class="sd">        num_train_per_class = 1</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a><span class="sd">        train_ind = gl.trainsets.generate(labels, rate=num_train_per_class)</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a><span class="sd">        train_labels = labels[train_ind]</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a><span class="sd">        class_priors = gl.utils.class_priors(labels)</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a><span class="sd">        model = gl.ssl.poisson_mbo(W, class_priors)</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a><span class="sd">        pred_labels = model.fit_predict(train_ind,train_labels,all_labels=labels)</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a><span class="sd">        accuracy = gl.ssl.ssl_accuracy(labels,pred_labels,train_ind)</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a><span class="sd">        print(model.name + &#39;: %.2f%%&#39;%accuracy)</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a><span class="sd">        ```</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a><span class="sd">        Reference</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a><span class="sd">        ---------</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a><span class="sd">        [1] J. Calder, B. Cook, M. Thorpe, D. Slepcev. [Poisson Learning: Graph Based Semi-Supervised</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a><span class="sd">        Learning at Very Low Label Rates.](http://proceedings.mlr.press/v119/calder20a.html), </span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a><span class="sd">        Proceedings of the 37th International Conference on Machine Learning, PMLR 119:1306-1316, 2020.</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">poisson_model</span> <span class="o">=</span> <span class="n">poisson</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="n">solver</span><span class="p">,</span> <span class="n">use_cuda</span><span class="o">=</span><span class="n">use_cuda</span><span class="p">,</span> <span class="n">min_iter</span><span class="o">=</span><span class="n">min_iter</span><span class="p">,</span> 
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>                                     <span class="n">max_iter</span><span class="o">=</span><span class="n">max_iter</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span> <span class="n">spectral_cutoff</span><span class="o">=</span><span class="n">spectral_cutoff</span><span class="p">)</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span> <span class="o">=</span> <span class="n">Ns</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_cuda</span> <span class="o">=</span> <span class="n">use_cuda</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>        <span class="c1">#Setup accuracy filename</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>        <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;_poisson_mbo&#39;</span> 
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>        <span class="k">if</span> <span class="n">solver</span> <span class="o">==</span> <span class="s1">&#39;spectral&#39;</span><span class="p">:</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>            <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_N</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">spectral_cutoff</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">requries_eig</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>        <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_Ns_</span><span class="si">%d</span><span class="s1">_mu_</span><span class="si">%.2f</span><span class="s1">_T_</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Ns</span><span class="p">,</span><span class="n">mu</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="n">fname</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>        <span class="c1">#Setup Algorithm name</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Poisson MBO&#39;</span> 
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>        <span class="c1">#Short forms</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>        <span class="n">Ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>        <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>        <span class="n">use_cuda</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_cuda</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>        <span class="n">unique_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>        <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">)</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>        <span class="c1">#Zero out diagonal for faster convergence</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">weight_matrix</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="n">W</span> <span class="o">-</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">diagonal</span><span class="p">(),</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>        <span class="n">G</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">graph</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>        
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>        <span class="c1">#Poisson source term</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>        <span class="n">onehot</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>        <span class="n">source</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">onehot</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>        <span class="n">source</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">onehot</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">onehot</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>        <span class="c1">#Initialize via Poisson learning</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>        <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poisson_model</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="n">all_labels</span><span class="p">)</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>        <span class="c1">#Time step for stability</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>        <span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">degree_vector</span><span class="p">())</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>        <span class="c1">#Precompute some things</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>        <span class="n">P</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">dt</span><span class="o">*</span><span class="n">G</span><span class="o">.</span><span class="n">laplacian</span><span class="p">()</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>        <span class="n">Db</span> <span class="o">=</span> <span class="n">mu</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">source</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>        <span class="k">if</span> <span class="n">use_cuda</span><span class="p">:</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>            <span class="kn">import</span> <span class="nn">torch</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>            <span class="n">Pt</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">torch_sparse</span><span class="p">(</span><span class="n">P</span><span class="p">)</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>            <span class="n">Dbt</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">Db</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>            <span class="c1">#Heat equation step</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>            <span class="k">if</span> <span class="n">use_cuda</span><span class="p">:</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>                <span class="c1">#Put on GPU and run heat equation</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>                <span class="n">ut</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>                    <span class="n">ut</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">addmm</span><span class="p">(</span><span class="n">Dbt</span><span class="p">,</span><span class="n">Pt</span><span class="p">,</span><span class="n">ut</span><span class="p">)</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>                <span class="c1">#Put back on CPU</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>                <span class="n">u</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>             
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>            <span class="k">else</span><span class="p">:</span> <span class="c1">#Use CPU </span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>                    <span class="n">u</span> <span class="o">=</span> <span class="n">P</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span> <span class="n">Db</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>            <span class="c1">#Projection step</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">=</span> <span class="n">u</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>            <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">volume_label_projection</span><span class="p">()</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>            <span class="c1">#Compute accuracy if all labels are provided</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>            <span class="k">if</span> <span class="n">all_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>                <span class="n">acc</span> <span class="o">=</span> <span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">all_labels</span><span class="p">,</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">, Accuracy = </span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">acc</span><span class="p">))</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>        <span class="k">return</span> <span class="n">u</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a><span class="k">class</span> <span class="nc">volume_mbo</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">volume_constraint</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Volume MBO</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a><span class="sd">        ===================</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a><span class="sd">        Semi-supervised learning with the VolumeMBO method [1]. class_priors must be provided.</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a><span class="sd">        Parameters</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a><span class="sd">        ----------</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a><span class="sd">        class_priors : numpy array</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a><span class="sd">            Class priors (fraction of data belonging to each class). </span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a><span class="sd">        temperature : float (optional), default=0.1</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a><span class="sd">            Temperature for volume constrained MBO.</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a><span class="sd">        volume_constraint : float (optional), default=0.5</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a><span class="sd">            The number of points in each class is constrained to be a mulitple \\(\\lambda\\) of the true</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a><span class="sd">            class size, where </span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a><span class="sd">            \\[ \\text{volume_constraint} \\leq \\lambda \\leq 2-\\text{volume_constraint}.\\]</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a><span class="sd">            Setting `volume_constraint=1` yields the tightest constraint.</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a><span class="sd">        References</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a><span class="sd">        ----------</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a><span class="sd">        [1] M. Jacobs, E. Merkurjev, and S. Esedolu. [Auction dynamics: A volume constrained MBO scheme.](https://www.sciencedirect.com/science/article/pii/S0021999117308033?casa_token=kNahPd2vu50AAAAA:uJQYQVnmMBV_oL0CG1UcOIulY4vhclMGTztm-jjAzy9Lns7rtoOnKs4iyvLOjKXaHU-D6qrQJT4) Journal of Computational Physics 354:288-310, 2018. </span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>        <span class="k">if</span> <span class="n">class_priors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Class priors must be provided for Volume MBO.&quot;</span><span class="p">)</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">class_counts</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span><span class="o">*</span><span class="n">class_priors</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span> <span class="o">=</span> <span class="n">temperature</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">volume_constraint</span> <span class="o">=</span> <span class="n">volume_constraint</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>        <span class="c1">#Setup accuracy filename and model name</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_volume_mbo_temp_</span><span class="si">%.2f</span><span class="s1">_vol_</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span><span class="n">volume_constraint</span><span class="p">)</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Volume MBO (T=</span><span class="si">%.2f</span><span class="s1">, V=</span><span class="si">%.2f</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span><span class="n">volume_constraint</span><span class="p">)</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>        <span class="c1">#Import c extensions</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">cextensions</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>        <span class="c1">#Set diagonal entries to zero</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">weight_matrix</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="n">W</span> <span class="o">-</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">diagonal</span><span class="p">(),</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>        <span class="n">G</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">graph</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>        <span class="c1">#Set up graph for C-code</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>        <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_labels</span><span class="p">))</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,))</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>        <span class="n">WI</span><span class="p">,</span><span class="n">WJ</span><span class="p">,</span><span class="n">WV</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>        <span class="c1">#Type casting and memory blocking</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>        <span class="n">WI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">WI</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>        <span class="n">WJ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">WJ</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>        <span class="n">WV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">WV</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>        <span class="n">train_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>        <span class="n">train_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">train_labels</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>        <span class="n">ClassCounts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">class_counts</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>        <span class="n">cextensions</span><span class="o">.</span><span class="n">volume_mbo</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">WI</span><span class="p">,</span><span class="n">WJ</span><span class="p">,</span><span class="n">WV</span><span class="p">,</span><span class="n">train_ind</span><span class="p">,</span><span class="n">train_labels</span><span class="p">,</span><span class="n">ClassCounts</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">volume_constraint</span><span class="p">)</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>        <span class="c1">#Set given labels and convert to vector format</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>        <span class="n">u</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_labels</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>        <span class="k">return</span> <span class="n">u</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a><span class="k">class</span> <span class="nc">multiclass_mbo</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Ns</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">num_eig</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Multiclass MBO</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a><span class="sd">        ===================</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a><span class="sd">        Semi-supervised learning via the Multiclass MBO method [1].</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a><span class="sd">        Parameters</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a><span class="sd">        ----------</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a><span class="sd">            nodes in each class.</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a><span class="sd">        Ns : int (optional), default=6</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a><span class="sd">            Number of inner iterations.</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a><span class="sd">        T : int (optional), default=10</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a><span class="sd">            Number of outer iterations.</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a><span class="sd">        dt : float (optional), default=0.15</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a><span class="sd">            Time step.</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a><span class="sd">        mu : float (optional), default=50</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a><span class="sd">            Fidelity penalty.</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a><span class="sd">        num_eig : int (optional), default=300</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a><span class="sd">            Number of eigenvectors.</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a><span class="sd">        </span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a><span class="sd">        References</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a><span class="sd">        ---------</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a><span class="sd">        [1] C. Garcia-Cardona, E. Merkurjev, A.L. Bertozzi, A. Flenner, and A.G. Percus. [Multiclass data segmentation using diffuse interface methods on graphs.](http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.743.9516&amp;rep=rep1&amp;type=pdf) IEEE transactions on pattern analysis and machine intelligence, 36(8), 1600-1613, 2014.</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span> <span class="o">=</span> <span class="n">Ns</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_eig</span> <span class="o">=</span> <span class="n">num_eig</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">requires_eig</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>        <span class="c1">#Setup accuracy filename</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_multiclass_mbo_Ns_</span><span class="si">%d</span><span class="s1">_T_</span><span class="si">%d</span><span class="s1">_dt_</span><span class="si">%.3f</span><span class="s1">_mu_</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Ns</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">mu</span><span class="p">)</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Multiclass MBO&#39;</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>        <span class="c1">#Shorten names</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>        <span class="n">Ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>        <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>        <span class="n">num_eig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_eig</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>        <span class="c1">#Basic parameters</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>        <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_labels</span><span class="p">))</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>        <span class="c1">#Spectral decomposition</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>        <span class="n">eigvals</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">eigen_decomp</span><span class="p">(</span><span class="n">normalization</span><span class="o">=</span><span class="s1">&#39;normalized&#39;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_eig</span><span class="p">)</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>        <span class="c1">#Form matrices</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>        <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dt</span><span class="o">/</span><span class="n">Ns</span><span class="p">)</span><span class="o">*</span><span class="n">eigvals</span><span class="p">))</span> 
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>        <span class="n">Y</span> <span class="o">=</span> <span class="n">X</span><span class="nd">@V</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>        <span class="n">Xt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>        <span class="c1">#Random initial labeling</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>        <span class="n">u</span><span class="p">[:,</span><span class="n">train_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>        <span class="c1">#Indicator of train_ind</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>        <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,)</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>        <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,)</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>        <span class="n">J</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>        <span class="n">K</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_labels</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>        <span class="n">K</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">K</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>            <span class="c1">#Diffusion step</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>                <span class="n">Z</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="p">(</span><span class="n">dt</span><span class="o">/</span><span class="n">Ns</span><span class="p">)</span><span class="o">*</span><span class="n">mu</span><span class="o">*</span><span class="n">J</span><span class="o">*</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">K</span><span class="p">))</span><span class="nd">@Y</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>                <span class="n">u</span> <span class="o">=</span> <span class="n">Z</span><span class="nd">@Xt</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>                
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>            <span class="c1">#Projection step</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>            <span class="c1">#Compute accuracy if all labels are provided</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>            <span class="k">if</span> <span class="n">all_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>                <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>                <span class="n">acc</span> <span class="o">=</span> <span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">all_labels</span><span class="p">,</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accuracy = </span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">acc</span><span class="p">)</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>        <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a><span class="k">class</span> <span class="nc">modularity_mbo</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">lamb</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">Ns</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Modularity MBO</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a><span class="sd">        ===================</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a><span class="sd">        Semi-supervised learning via the Modularity MBO method [1].</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a><span class="sd">        Parameters</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a><span class="sd">        ----------</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a><span class="sd">            nodes in each class.</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a><span class="sd">        gamma : float (optional), default=0.5</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a><span class="sd">            Parameter in algorithm.</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a><span class="sd">        epsilon : float (optional), default=1</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a><span class="sd">            Parameter in algorithm.</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a><span class="sd">        lamb : float (optional), default=1</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a><span class="sd">            Parameter in algorithm.</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a><span class="sd">        T : int (optional), default=20</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a><span class="sd">            Number of outer iterations.</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a><span class="sd">        Ns : int (optional), default=5</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a><span class="sd">            Number of inner iterations.</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a><span class="sd">        </span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a><span class="sd">        References</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a><span class="sd">        ---------</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a><span class="sd">        [1] Z.M. Boyd, E. Bae, X.C. Tai, and A.L. Bertozzi. [Simplified energy landscape for modularity using total variation.](https://publications.ffi.no/nb/item/asset/dspace:4288/1619750.pdf) SIAM Journal on Applied Mathematics, 78(5), 2439-2464, 2018.</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">epsilon</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lamb</span> <span class="o">=</span> <span class="n">lamb</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">requires_eig</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span> <span class="o">=</span> <span class="n">Ns</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>        <span class="c1">#Setup accuracy filename</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_modularity_mbo_gamma_</span><span class="si">%.2f</span><span class="s1">_epsilon_</span><span class="si">%.2f</span><span class="s1">_lamb_</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span><span class="n">epsilon</span><span class="p">,</span><span class="n">lamb</span><span class="p">)</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Modularity MBO&#39;</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>        <span class="c1">#Short form</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>        <span class="n">gamma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>        <span class="n">eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>        <span class="n">lamb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lamb</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>        <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>        <span class="n">Ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>        <span class="c1">#One-hot initialization</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>        <span class="n">num_classes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_labels</span><span class="p">))</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>        <span class="n">train_onehot</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">num_classes</span><span class="p">))</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>        <span class="n">u</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">train_onehot</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>        <span class="c1">#Spectral decomposition</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>        <span class="n">num_eig</span> <span class="o">=</span> <span class="mi">5</span><span class="o">*</span><span class="n">num_classes</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>        <span class="n">D</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">eigen_decomp</span><span class="p">(</span><span class="n">normalization</span><span class="o">=</span><span class="s1">&#39;combinatorial&#39;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">num_eig</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">)</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>        <span class="c1">#Time step selection</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>        <span class="n">deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">degree_vector</span><span class="p">()</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>        <span class="n">dtlow</span> <span class="o">=</span> <span class="mf">0.15</span><span class="o">/</span><span class="p">((</span><span class="n">gamma</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">deg</span><span class="p">))</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>        <span class="n">dthigh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">/</span><span class="n">eps</span><span class="p">)</span><span class="o">/</span><span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>        <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dtlow</span><span class="o">*</span><span class="n">dthigh</span><span class="p">)</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>        <span class="c1">#Diffusion matrix</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>        <span class="n">P</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">D</span><span class="o">*</span><span class="n">dt</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">num_eig</span><span class="p">,</span><span class="n">num_eig</span><span class="p">)</span><span class="nd">@V</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>        <span class="c1">#Main MBO iterations</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>            <span class="c1">#Diffusion </span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">V</span><span class="o">@</span><span class="p">(</span><span class="n">P</span><span class="nd">@u</span><span class="p">)</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>            <span class="c1">#Training labels</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>            <span class="k">if</span> <span class="n">lamb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>                    <span class="n">u</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,:]</span> <span class="o">-=</span> <span class="p">(</span><span class="n">dt</span><span class="o">/</span><span class="n">Ns</span><span class="p">)</span><span class="o">*</span><span class="n">lamb</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">train_onehot</span><span class="p">)</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>            <span class="c1">#Threshold to labels</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>            <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>            
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>            <span class="c1">#Convert to 1-hot vectors</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>            <span class="c1">#Compute accuracy if all labels are provided</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>            <span class="k">if</span> <span class="n">all_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">=</span> <span class="n">u</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>                <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>                <span class="n">acc</span> <span class="o">=</span> <span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">all_labels</span><span class="p">,</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accuracy = </span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">acc</span><span class="p">)</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>        <span class="k">return</span> <span class="n">u</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a><span class="k">class</span> <span class="nc">laplace</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reweighting</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">normalization</span><span class="o">=</span><span class="s1">&#39;combinatorial&#39;</span><span class="p">,</span> 
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>                 <span class="n">tau</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mean_shift</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">zeta</span><span class="o">=</span><span class="mf">1e7</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Laplace Learning</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a><span class="sd">        ===================</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a><span class="sd">        Semi-supervised learning via the solution of the Laplace equation</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a><span class="sd">        \\[\\tau u_j + L^m u_j = 0, \\ \\ j \\geq m+1,\\]</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a><span class="sd">        subject to \\(u_j = y_j\\) for \\(j=1,\\dots,m\\), where \\(L=D-W\\) is the </span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a><span class="sd">        combinatorial graph Laplacian and \\(y_j\\) for \\(j=1,\\dots,m\\) are the </span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a><span class="sd">        label vectors. Default order is m=1, and m &gt; 1 corresponds to higher order Laplace Learning.</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a><span class="sd">        The original method was introduced in [1]. This class also implements reweighting </span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a><span class="sd">        schemes `poisson` proposed in [2], `wnll` proposed in [3], and `properly`, proposed in [4].</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a><span class="sd">        If `properly` is selected, the user must additionally provide the data features `X`.</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a><span class="sd">        Parameters</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a><span class="sd">        ----------</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a><span class="sd">            nodes in each class.</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a><span class="sd">        X : numpy array (optional)</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a><span class="sd">            Data features, used to construct the graph. This is required for the `properly` weighted </span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a><span class="sd">            graph Laplacian method.</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a><span class="sd">        normalization : {&#39;combinatorial&#39;,&#39;randomwalk&#39;,&#39;normalized&#39;} (optional), defualt=&#39;combinatorial&#39;</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a><span class="sd">            Normalization for the graph Laplacian.</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a><span class="sd">        reweighting : {&#39;none&#39;, &#39;wnll&#39;, &#39;poisson&#39;, &#39;properly&#39;} (optional), default=&#39;none&#39;</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a><span class="sd">            Reweighting scheme for low label rate problems. If &#39;properly&#39; is selected, the user</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a><span class="sd">            must supply the data features `X`.</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a><span class="sd">        tau : float or numpy array (optional), default=0</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a><span class="sd">            Zeroth order term in Laplace equation. Can be a scalar or vector.</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a><span class="sd">        order : integer (optional), default=1</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a><span class="sd">            Power m for higher order Laplace learning. Currently only integers are allowed. </span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a><span class="sd">        mean_shift : bool (optional), default=False</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a><span class="sd">            Whether to shift output to mean zero.</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a><span class="sd">        tol : float (optional), default=1e-5</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a><span class="sd">            Tolerance for conjugate gradient solver.</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a><span class="sd">        alpha : float (optional), default=2</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a><span class="sd">            Parameter for `properly` reweighting.</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a><span class="sd">        zeta : float (optional), default=1e7</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a><span class="sd">            Parameter for `properly` reweighting.</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a><span class="sd">        r : float (optional), default=0.1</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a><span class="sd">            Radius for `properly` reweighting.</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a><span class="sd">        References</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a><span class="sd">        ---------</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a><span class="sd">        [1] X. Zhu, Z. Ghahramani, and J. D. Lafferty. [Semi-supervised learning using gaussian fields </span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a><span class="sd">        and harmonic functions.](https://www.aaai.org/Papers/ICML/2003/ICML03-118.pdf) Proceedings </span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a><span class="sd">        of the 20th International Conference on Machine Learning (ICML-03), 2003.</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a><span class="sd">        [2] J. Calder, B. Cook, M. Thorpe, D. Slepcev. [Poisson Learning: Graph Based Semi-Supervised</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a><span class="sd">        Learning at Very Low Label Rates.](http://proceedings.mlr.press/v119/calder20a.html), </span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a><span class="sd">        Proceedings of the 37th International Conference on Machine Learning, PMLR 119:1306-1316, 2020.</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a><span class="sd">        [3] Z. Shi, S. Osher, and W. Zhu. [Weighted nonlocal laplacian on interpolation from sparse data.](https://idp.springer.com/authorize/casa?redirect_uri=https://link.springer.com/article/10.1007/s10915-017-0421-z&amp;casa_token=33Z7gqJy3mMAAAAA:iMO0pGmpn_qf5PioVIGocSRq_p4CDm-KNOQhgIC1uvqG9pWlZ6t7I-IZtSJfocFDEHCdMpK8j7Fx1XbzDQ)</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a><span class="sd">        Journal of Scientific Computing 73.2 (2017): 1164-1177.</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a><span class="sd">        [4] J. Calder, D. Slepev. [Properly-weighted graph Laplacian for semi-supervised learning.](https://link.springer.com/article/10.1007/s00245-019-09637-3) Applied mathematics &amp; optimization (2019): 1-49.</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reweighting</span> <span class="o">=</span> <span class="n">reweighting</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">normalization</span> <span class="o">=</span> <span class="n">normalization</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mean_shift</span> <span class="o">=</span> <span class="n">mean_shift</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">order</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>        <span class="c1">#Set up tau</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">)</span><span class="o">*</span><span class="n">tau</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="n">tau</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a>        <span class="c1">#Setup accuracy filename</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>        <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;_laplace&#39;</span> 
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Laplace Learning&#39;</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reweighting</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>            <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">reweighting</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">reweighting</span> <span class="o">+</span> <span class="s1">&#39; reweighted&#39;</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalization</span> <span class="o">!=</span> <span class="s1">&#39;combinatorial&#39;</span><span class="p">:</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>            <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalization</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalization</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_shift</span><span class="p">:</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>            <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_meanshift&#39;</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39; with meanshift&#39;</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39; order </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>            <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_tau_</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">)</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39; tau=</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">)</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="n">fname</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>        <span class="c1">#Reweighting</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reweighting</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>            <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>            <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">reweight</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reweighting</span><span class="p">,</span> <span class="n">normalization</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">normalization</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>            <span class="c1">#W = self.graph.reweight(train_ind, method=self.reweighting, X=self.X)</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>            <span class="n">G</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">graph</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>        <span class="c1">#Get some attributes</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">num_nodes</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>        <span class="n">unique_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>        <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">)</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>        
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>        <span class="c1">#tau + Graph Laplacian and one-hot labels</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>        <span class="n">L</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">)</span> <span class="o">+</span> <span class="n">G</span><span class="o">.</span><span class="n">laplacian</span><span class="p">(</span><span class="n">normalization</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">normalization</span><span class="p">)</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>            <span class="n">Lpow</span> <span class="o">=</span> <span class="n">L</span><span class="o">*</span><span class="n">L</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">):</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>                    <span class="n">Lpow</span> <span class="o">=</span> <span class="n">L</span><span class="o">*</span><span class="n">Lpow</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>            <span class="n">L</span> <span class="o">=</span> <span class="n">Lpow</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>        <span class="n">F</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>        <span class="c1">#Locations of unlabeled points</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">n</span><span class="p">,),</span> <span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>        <span class="n">idx</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>        <span class="c1">#Right hand side</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="n">L</span><span class="p">[:,</span><span class="n">train_ind</span><span class="p">]</span><span class="o">*</span><span class="n">F</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">idx</span><span class="p">,:]</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>        <span class="c1">#Left hand side matrix</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>        <span class="n">A</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">idx</span><span class="p">,:]</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>        <span class="n">A</span> <span class="o">=</span> <span class="n">A</span><span class="p">[:,</span><span class="n">idx</span><span class="p">]</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>        <span class="c1">#Preconditioner</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>        <span class="n">m</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">M</span><span class="o">+</span><span class="mf">1e-10</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">tocsr</span><span class="p">()</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>       
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>        <span class="c1">#Conjugate gradient solver</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>        <span class="n">v</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">conjgrad</span><span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">M</span><span class="p">,</span> <span class="n">M</span><span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tol</span><span class="p">)</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>        <span class="n">v</span> <span class="o">=</span> <span class="n">M</span><span class="o">*</span><span class="n">v</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>        <span class="c1">#Add labels back into array</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>        <span class="n">u</span><span class="p">[</span><span class="n">idx</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>        <span class="n">u</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">F</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>        <span class="c1">#Mean shift</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_shift</span><span class="p">:</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>            <span class="n">u</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>        <span class="k">return</span> <span class="n">u</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a><span class="k">class</span> <span class="nc">dynamic_label_propagation</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">lam</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dynamic Label Propagation</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a><span class="sd">        ===================</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a><span class="sd">        Semi-supervised learning via dynamic label propagation [1].</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a><span class="sd">        Parameters</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a><span class="sd">        ----------</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a><span class="sd">            nodes in each class.</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a><span class="sd">        alpha : float (optional), default=0.05</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a><span class="sd">            Value of parameter \\(\\alpha\\).</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a><span class="sd">        lam : float (optional), default=0.1</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a><span class="sd">            Value of parameter \\(\\lambda\\).</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a><span class="sd">        T : int (optional), default=2</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a><span class="sd">            Number of iterations.</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a><span class="sd">        References</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a><span class="sd">        ---------</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a><span class="sd">        [1] B. Wang, Z. Tu, and J.K. Tsotsos. [Dynamic label propagation for semi-supervised multi-class multi-label classification.](https://openaccess.thecvf.com/content_iccv_2013/html/Wang_Dynamic_Label_Propagation_2013_ICCV_paper.html) Proceedings of the IEEE international conference on computer vision. 2013.</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lam</span> <span class="o">=</span> <span class="n">lam</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_dynamic_label_propagation&#39;</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Dynamic Label Propagation&#39;</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a> 
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>        <span class="c1">#Short forms</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>        <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>        <span class="n">lam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lam</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>        <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>        <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_labels</span><span class="p">))</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>        <span class="c1">#Zero out diagonal </span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">weight_matrix</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="n">W</span> <span class="o">-</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">diagonal</span><span class="p">(),</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>        <span class="n">G</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">graph</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>        
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>        <span class="c1">#Labels to vector and correct position</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>        <span class="n">K</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>        <span class="n">u</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">K</span> 
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>      
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a>        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">5000</span><span class="p">:</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot use Dynamic Label Propagation on large datasets.&quot;</span><span class="p">)</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a>            <span class="c1">#Setup matrices</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a>            <span class="n">Id</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> 
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>            <span class="n">D</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">degree_matrix</span><span class="p">(</span><span class="n">p</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a>            <span class="n">P</span> <span class="o">=</span> <span class="n">D</span><span class="o">*</span><span class="n">W</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a>            <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">todense</span><span class="p">())</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>            <span class="n">Pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>                <span class="n">v</span> <span class="o">=</span> <span class="n">P</span><span class="nd">@u</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a>                <span class="n">u</span> <span class="o">=</span> <span class="n">Pt</span><span class="nd">@u</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a>                <span class="n">u</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">K</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a>                <span class="n">Pt</span> <span class="o">=</span> <span class="n">P</span><span class="nd">@Pt@np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="n">v</span><span class="nd">@np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="n">lam</span><span class="o">*</span><span class="n">Id</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a>                <span class="c1">#Compute accuracy if all labels are provided</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a>                <span class="k">if</span> <span class="n">all_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a>                    <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a>                    <span class="n">acc</span> <span class="o">=</span> <span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">all_labels</span><span class="p">,</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accuracy = </span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">acc</span><span class="p">)</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a>        <span class="k">return</span> <span class="n">u</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a><span class="k">class</span> <span class="nc">centered_kernel</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span> <span class="n">power_it</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.05</span><span class="p">):</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Centered Kernel Method</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a><span class="sd">        ===================</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a><span class="sd">        Semi-supervised learning via the centered kernel method of [1].</span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a><span class="sd">        Parameters</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a><span class="sd">        ----------</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a><span class="sd">            nodes in each class.</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a><span class="sd">        tol : float (optional), default=1e-10</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a><span class="sd">            Tolerance to solve equation.</span>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a><span class="sd">        power_it : int (optional), default=100</span>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a><span class="sd">            Number of power iterations to find largest eigenvalue.</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a><span class="sd">        alpha : float (optional), default = 1.05</span>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a><span class="sd">            Value of \\(\\alpha\\) as a fraction of largest eigenvalue.</span>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a><span class="sd">        References</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a><span class="sd">        ---------</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a><span class="sd">        [1] X. Mai and R. Couillet. [Random matrix-inspired improved semi-supervised learning on graphs.](https://romaincouillet.hebfree.org/docs/conf/SSL_ICML18.pdf) International Conference on Machine Learning. 2018.</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">power_it</span> <span class="o">=</span> <span class="n">power_it</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_centered_kernel&#39;</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Centered Kernel&#39;</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a>        
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a>        <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_labels</span><span class="p">))</span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a>        <span class="c1">#Zero diagonal</span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">weight_matrix</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="n">W</span> <span class="o">-</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">diagonal</span><span class="p">(),</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a>        <span class="c1">#Indicator of train_ind</span>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a>        <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a>        <span class="n">K</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a>        
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a>        <span class="c1">#Center labels</span>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a>        <span class="n">K</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,:]</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a>        <span class="c1">#Initialization</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a>        <span class="n">vt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a>        <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">power_it</span><span class="p">):</span>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">W</span><span class="o">*</span><span class="p">(</span><span class="n">e</span> <span class="o">-</span>  <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">v</span><span class="o">@</span><span class="p">(</span><span class="n">vt</span><span class="nd">@e</span><span class="p">))</span>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a>            <span class="n">w</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">v</span><span class="o">@</span><span class="p">(</span><span class="n">vt</span><span class="nd">@y</span><span class="p">)</span> <span class="c1">#=Ae</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a>            <span class="n">l</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="nd">@w</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="nd">@e</span><span class="p">))</span>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a>            <span class="n">e</span> <span class="o">=</span> <span class="n">w</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a>        <span class="c1">#Number of iterations</span>
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a>        <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">l</span>
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a>        <span class="n">err</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1410"><a href="#L-1410"><span class="linenos">1410</span></a>        <span class="k">while</span> <span class="n">err</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tol</span><span class="p">:</span>
</span><span id="L-1411"><a href="#L-1411"><span class="linenos">1411</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">W</span><span class="o">*</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span>  <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">v</span><span class="o">@</span><span class="p">(</span><span class="n">vt</span><span class="nd">@u</span><span class="p">))</span>
</span><span id="L-1412"><a href="#L-1412"><span class="linenos">1412</span></a>            <span class="n">w</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">v</span><span class="o">@</span><span class="p">(</span><span class="n">vt</span><span class="nd">@y</span><span class="p">))</span> <span class="o">-</span> <span class="n">u</span> <span class="c1">#Laplacian</span>
</span><span id="L-1413"><a href="#L-1413"><span class="linenos">1413</span></a>            <span class="n">w</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,:]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1414"><a href="#L-1414"><span class="linenos">1414</span></a>            <span class="n">err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
</span><span id="L-1415"><a href="#L-1415"><span class="linenos">1415</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">u</span> <span class="o">+</span> <span class="n">w</span>
</span><span id="L-1416"><a href="#L-1416"><span class="linenos">1416</span></a>
</span><span id="L-1417"><a href="#L-1417"><span class="linenos">1417</span></a>            <span class="c1">#Compute accuracy if all labels are provided</span>
</span><span id="L-1418"><a href="#L-1418"><span class="linenos">1418</span></a>            <span class="k">if</span> <span class="n">all_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1419"><a href="#L-1419"><span class="linenos">1419</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">=</span> <span class="n">u</span>
</span><span id="L-1420"><a href="#L-1420"><span class="linenos">1420</span></a>                <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</span><span id="L-1421"><a href="#L-1421"><span class="linenos">1421</span></a>                <span class="n">acc</span> <span class="o">=</span> <span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">all_labels</span><span class="p">,</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="L-1422"><a href="#L-1422"><span class="linenos">1422</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accuracy = </span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">acc</span><span class="p">)</span>
</span><span id="L-1423"><a href="#L-1423"><span class="linenos">1423</span></a>            
</span><span id="L-1424"><a href="#L-1424"><span class="linenos">1424</span></a>        <span class="k">return</span> <span class="n">u</span>
</span><span id="L-1425"><a href="#L-1425"><span class="linenos">1425</span></a>
</span><span id="L-1426"><a href="#L-1426"><span class="linenos">1426</span></a>
</span><span id="L-1427"><a href="#L-1427"><span class="linenos">1427</span></a><span class="k">class</span> <span class="nc">sparse_label_propagation</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="L-1428"><a href="#L-1428"><span class="linenos">1428</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
</span><span id="L-1429"><a href="#L-1429"><span class="linenos">1429</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sparse Label Propagation</span>
</span><span id="L-1430"><a href="#L-1430"><span class="linenos">1430</span></a><span class="sd">        ===================</span>
</span><span id="L-1431"><a href="#L-1431"><span class="linenos">1431</span></a>
</span><span id="L-1432"><a href="#L-1432"><span class="linenos">1432</span></a><span class="sd">        Semi-supervised learning via the sparse label propagation method of [1].</span>
</span><span id="L-1433"><a href="#L-1433"><span class="linenos">1433</span></a>
</span><span id="L-1434"><a href="#L-1434"><span class="linenos">1434</span></a><span class="sd">        Parameters</span>
</span><span id="L-1435"><a href="#L-1435"><span class="linenos">1435</span></a><span class="sd">        ----------</span>
</span><span id="L-1436"><a href="#L-1436"><span class="linenos">1436</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="L-1437"><a href="#L-1437"><span class="linenos">1437</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="L-1438"><a href="#L-1438"><span class="linenos">1438</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="L-1439"><a href="#L-1439"><span class="linenos">1439</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="L-1440"><a href="#L-1440"><span class="linenos">1440</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="L-1441"><a href="#L-1441"><span class="linenos">1441</span></a><span class="sd">            nodes in each class.</span>
</span><span id="L-1442"><a href="#L-1442"><span class="linenos">1442</span></a><span class="sd">        T : int (optional), default=100</span>
</span><span id="L-1443"><a href="#L-1443"><span class="linenos">1443</span></a><span class="sd">            Number of iterations</span>
</span><span id="L-1444"><a href="#L-1444"><span class="linenos">1444</span></a>
</span><span id="L-1445"><a href="#L-1445"><span class="linenos">1445</span></a><span class="sd">        References</span>
</span><span id="L-1446"><a href="#L-1446"><span class="linenos">1446</span></a><span class="sd">        ---------</span>
</span><span id="L-1447"><a href="#L-1447"><span class="linenos">1447</span></a><span class="sd">        [1] A. Jung, A.O. Hero III, A. Mara, and S. Jahromi. [Semi-supervised learning via sparse label propagation.](https://arxiv.org/abs/1612.01414) arXiv:1612.01414, 2016.</span>
</span><span id="L-1448"><a href="#L-1448"><span class="linenos">1448</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1449"><a href="#L-1449"><span class="linenos">1449</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="L-1450"><a href="#L-1450"><span class="linenos">1450</span></a>
</span><span id="L-1451"><a href="#L-1451"><span class="linenos">1451</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
</span><span id="L-1452"><a href="#L-1452"><span class="linenos">1452</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_sparse_label_propagation&#39;</span>
</span><span id="L-1453"><a href="#L-1453"><span class="linenos">1453</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Sparse LP&#39;</span>
</span><span id="L-1454"><a href="#L-1454"><span class="linenos">1454</span></a>        
</span><span id="L-1455"><a href="#L-1455"><span class="linenos">1455</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1456"><a href="#L-1456"><span class="linenos">1456</span></a>
</span><span id="L-1457"><a href="#L-1457"><span class="linenos">1457</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span>
</span><span id="L-1458"><a href="#L-1458"><span class="linenos">1458</span></a>        <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_labels</span><span class="p">))</span>
</span><span id="L-1459"><a href="#L-1459"><span class="linenos">1459</span></a>
</span><span id="L-1460"><a href="#L-1460"><span class="linenos">1460</span></a>        <span class="c1">#Sparse matrix with ones in all entries</span>
</span><span id="L-1461"><a href="#L-1461"><span class="linenos">1461</span></a>        <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">adjacency</span><span class="p">()</span>
</span><span id="L-1462"><a href="#L-1462"><span class="linenos">1462</span></a>
</span><span id="L-1463"><a href="#L-1463"><span class="linenos">1463</span></a>        <span class="c1">#Construct matrix 1/2W and 1/deg</span>
</span><span id="L-1464"><a href="#L-1464"><span class="linenos">1464</span></a>        <span class="n">lam</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">weight_matrix</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">1e-10</span><span class="p">)</span><span class="o">*</span><span class="n">B</span>
</span><span id="L-1465"><a href="#L-1465"><span class="linenos">1465</span></a>        <span class="n">lam</span> <span class="o">=</span> <span class="o">-</span><span class="n">lam</span><span class="o">.</span><span class="n">log1p</span><span class="p">()</span>
</span><span id="L-1466"><a href="#L-1466"><span class="linenos">1466</span></a>        <span class="n">lam</span> <span class="o">=</span> <span class="n">lam</span><span class="o">.</span><span class="n">expm1</span><span class="p">()</span> <span class="o">+</span> <span class="n">B</span>
</span><span id="L-1467"><a href="#L-1467"><span class="linenos">1467</span></a>        <span class="n">Id</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> 
</span><span id="L-1468"><a href="#L-1468"><span class="linenos">1468</span></a>        <span class="n">gamma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">degree_matrix</span><span class="p">(</span><span class="n">p</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1469"><a href="#L-1469"><span class="linenos">1469</span></a>
</span><span id="L-1470"><a href="#L-1470"><span class="linenos">1470</span></a>        <span class="c1">#Random initial labeling</span>
</span><span id="L-1471"><a href="#L-1471"><span class="linenos">1471</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
</span><span id="L-1472"><a href="#L-1472"><span class="linenos">1472</span></a>
</span><span id="L-1473"><a href="#L-1473"><span class="linenos">1473</span></a>        <span class="c1">#Indicator of train_ind</span>
</span><span id="L-1474"><a href="#L-1474"><span class="linenos">1474</span></a>        <span class="n">one_hot_labels</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1475"><a href="#L-1475"><span class="linenos">1475</span></a>
</span><span id="L-1476"><a href="#L-1476"><span class="linenos">1476</span></a>        <span class="c1">#Initialization</span>
</span><span id="L-1477"><a href="#L-1477"><span class="linenos">1477</span></a>        <span class="n">Y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-1478"><a href="#L-1478"><span class="linenos">1478</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
</span><span id="L-1479"><a href="#L-1479"><span class="linenos">1479</span></a>            <span class="n">Gu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,:],</span> <span class="n">weighted</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1480"><a href="#L-1480"><span class="linenos">1480</span></a>            <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gu</span><span class="p">)</span>
</span><span id="L-1481"><a href="#L-1481"><span class="linenos">1481</span></a>
</span><span id="L-1482"><a href="#L-1482"><span class="linenos">1482</span></a>        <span class="c1">#Main loop for sparse label propagation</span>
</span><span id="L-1483"><a href="#L-1483"><span class="linenos">1483</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-1484"><a href="#L-1484"><span class="linenos">1484</span></a>
</span><span id="L-1485"><a href="#L-1485"><span class="linenos">1485</span></a>            <span class="n">u_prev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</span><span id="L-1486"><a href="#L-1486"><span class="linenos">1486</span></a>            <span class="c1">#Compute div</span>
</span><span id="L-1487"><a href="#L-1487"><span class="linenos">1487</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
</span><span id="L-1488"><a href="#L-1488"><span class="linenos">1488</span></a>                <span class="n">div</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">divergence</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-1489"><a href="#L-1489"><span class="linenos">1489</span></a>                <span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">u_prev</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">gamma</span><span class="o">*</span><span class="n">div</span>
</span><span id="L-1490"><a href="#L-1490"><span class="linenos">1490</span></a>                <span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">train_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">one_hot_labels</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span>  <span class="c1">#Set labels</span>
</span><span id="L-1491"><a href="#L-1491"><span class="linenos">1491</span></a>                <span class="n">u_tilde</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">u_prev</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span>
</span><span id="L-1492"><a href="#L-1492"><span class="linenos">1492</span></a>
</span><span id="L-1493"><a href="#L-1493"><span class="linenos">1493</span></a>                <span class="n">Gu</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">u_tilde</span><span class="p">,</span> <span class="n">weighted</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1494"><a href="#L-1494"><span class="linenos">1494</span></a>                <span class="n">Y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">Gu</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">lam</span><span class="p">)</span>
</span><span id="L-1495"><a href="#L-1495"><span class="linenos">1495</span></a>                <span class="n">ind1</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1496"><a href="#L-1496"><span class="linenos">1496</span></a>                <span class="n">ind2</span> <span class="o">=</span> <span class="n">B</span> <span class="o">-</span> <span class="n">ind1</span>
</span><span id="L-1497"><a href="#L-1497"><span class="linenos">1497</span></a>                <span class="n">Y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">ind1</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">sign</span><span class="p">())</span> <span class="o">+</span> <span class="n">ind2</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-1498"><a href="#L-1498"><span class="linenos">1498</span></a>
</span><span id="L-1499"><a href="#L-1499"><span class="linenos">1499</span></a>            <span class="c1">#Compute accuracy if all labels are provided</span>
</span><span id="L-1500"><a href="#L-1500"><span class="linenos">1500</span></a>            <span class="k">if</span> <span class="n">all_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1501"><a href="#L-1501"><span class="linenos">1501</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1502"><a href="#L-1502"><span class="linenos">1502</span></a>                <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</span><span id="L-1503"><a href="#L-1503"><span class="linenos">1503</span></a>                <span class="n">acc</span> <span class="o">=</span> <span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">all_labels</span><span class="p">,</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="L-1504"><a href="#L-1504"><span class="linenos">1504</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,Accuracy = </span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">acc</span><span class="p">))</span>
</span><span id="L-1505"><a href="#L-1505"><span class="linenos">1505</span></a> 
</span><span id="L-1506"><a href="#L-1506"><span class="linenos">1506</span></a>        <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1507"><a href="#L-1507"><span class="linenos">1507</span></a>
</span><span id="L-1508"><a href="#L-1508"><span class="linenos">1508</span></a>
</span><span id="L-1509"><a href="#L-1509"><span class="linenos">1509</span></a><span class="k">class</span> <span class="nc">graph_nearest_neighbor</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="L-1510"><a href="#L-1510"><span class="linenos">1510</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-1511"><a href="#L-1511"><span class="linenos">1511</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Graph nearest neighbor classifier</span>
</span><span id="L-1512"><a href="#L-1512"><span class="linenos">1512</span></a><span class="sd">        ===================</span>
</span><span id="L-1513"><a href="#L-1513"><span class="linenos">1513</span></a>
</span><span id="L-1514"><a href="#L-1514"><span class="linenos">1514</span></a><span class="sd">        Semi-supervised learning by graph (geodesic) nearest neighbor classifier. The </span>
</span><span id="L-1515"><a href="#L-1515"><span class="linenos">1515</span></a><span class="sd">        graph geodesic distance is defined by</span>
</span><span id="L-1516"><a href="#L-1516"><span class="linenos">1516</span></a><span class="sd">        \\[ d_{ij} = \\min_p \\sum_{k=1}^M w_{p_k,p_{k+1}},\\]</span>
</span><span id="L-1517"><a href="#L-1517"><span class="linenos">1517</span></a><span class="sd">        where the minimum is over paths \\(p\\) connecting nodes \\(i\\) and \\(j\\). The label</span>
</span><span id="L-1518"><a href="#L-1518"><span class="linenos">1518</span></a><span class="sd">        returned for each testing point is the label of the closest labeled point.</span>
</span><span id="L-1519"><a href="#L-1519"><span class="linenos">1519</span></a>
</span><span id="L-1520"><a href="#L-1520"><span class="linenos">1520</span></a><span class="sd">        Parameters</span>
</span><span id="L-1521"><a href="#L-1521"><span class="linenos">1521</span></a><span class="sd">        ----------</span>
</span><span id="L-1522"><a href="#L-1522"><span class="linenos">1522</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="L-1523"><a href="#L-1523"><span class="linenos">1523</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="L-1524"><a href="#L-1524"><span class="linenos">1524</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="L-1525"><a href="#L-1525"><span class="linenos">1525</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="L-1526"><a href="#L-1526"><span class="linenos">1526</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="L-1527"><a href="#L-1527"><span class="linenos">1527</span></a><span class="sd">            nodes in each class.</span>
</span><span id="L-1528"><a href="#L-1528"><span class="linenos">1528</span></a><span class="sd">        D : numpy array or scipy sparse matrix (optional)</span>
</span><span id="L-1529"><a href="#L-1529"><span class="linenos">1529</span></a><span class="sd">            (n,n) Distance matrix, giving distances between neighbors. If provided,</span>
</span><span id="L-1530"><a href="#L-1530"><span class="linenos">1530</span></a><span class="sd">            this is used to construct a knn density estimator for reweighting the eikonal equation.</span>
</span><span id="L-1531"><a href="#L-1531"><span class="linenos">1531</span></a><span class="sd">        alpha : float (optional), default=1</span>
</span><span id="L-1532"><a href="#L-1532"><span class="linenos">1532</span></a><span class="sd">            Reweighting exponent.</span>
</span><span id="L-1533"><a href="#L-1533"><span class="linenos">1533</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1534"><a href="#L-1534"><span class="linenos">1534</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="L-1535"><a href="#L-1535"><span class="linenos">1535</span></a>
</span><span id="L-1536"><a href="#L-1536"><span class="linenos">1536</span></a>
</span><span id="L-1537"><a href="#L-1537"><span class="linenos">1537</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="L-1538"><a href="#L-1538"><span class="linenos">1538</span></a>
</span><span id="L-1539"><a href="#L-1539"><span class="linenos">1539</span></a>        <span class="k">if</span> <span class="n">class_priors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1540"><a href="#L-1540"><span class="linenos">1540</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">onevsrest</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1541"><a href="#L-1541"><span class="linenos">1541</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">similarity</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1542"><a href="#L-1542"><span class="linenos">1542</span></a>
</span><span id="L-1543"><a href="#L-1543"><span class="linenos">1543</span></a>        <span class="c1">#Cannot reweight if distance matrix not provided</span>
</span><span id="L-1544"><a href="#L-1544"><span class="linenos">1544</span></a>        <span class="k">if</span> <span class="n">D</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1545"><a href="#L-1545"><span class="linenos">1545</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1546"><a href="#L-1546"><span class="linenos">1546</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1547"><a href="#L-1547"><span class="linenos">1547</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="c1">#distance to furtherest neighbor</span>
</span><span id="L-1548"><a href="#L-1548"><span class="linenos">1548</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="o">**</span><span class="n">alpha</span>
</span><span id="L-1549"><a href="#L-1549"><span class="linenos">1549</span></a>
</span><span id="L-1550"><a href="#L-1550"><span class="linenos">1550</span></a>        <span class="c1">#Setup accuracy filename and model name</span>
</span><span id="L-1551"><a href="#L-1551"><span class="linenos">1551</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_graph_nearest_neighbor_alpha</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span> 
</span><span id="L-1552"><a href="#L-1552"><span class="linenos">1552</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Graph NN (alpha=</span><span class="si">%.2f</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
</span><span id="L-1553"><a href="#L-1553"><span class="linenos">1553</span></a>
</span><span id="L-1554"><a href="#L-1554"><span class="linenos">1554</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1555"><a href="#L-1555"><span class="linenos">1555</span></a>
</span><span id="L-1556"><a href="#L-1556"><span class="linenos">1556</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">onevsrest</span><span class="p">:</span>
</span><span id="L-1557"><a href="#L-1557"><span class="linenos">1557</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">dijkstra</span><span class="p">(</span><span class="n">train_ind</span><span class="p">[</span><span class="n">train_labels</span><span class="p">],</span> <span class="n">bdy_val</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
</span><span id="L-1558"><a href="#L-1558"><span class="linenos">1558</span></a>        <span class="k">else</span><span class="p">:</span> 
</span><span id="L-1559"><a href="#L-1559"><span class="linenos">1559</span></a>            <span class="n">_</span><span class="p">,</span><span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">dijkstra</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">bdy_val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">train_ind</span><span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">return_cp</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1560"><a href="#L-1560"><span class="linenos">1560</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-1561"><a href="#L-1561"><span class="linenos">1561</span></a>            <span class="n">u</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_labels</span>
</span><span id="L-1562"><a href="#L-1562"><span class="linenos">1562</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">l</span><span class="p">])</span>
</span><span id="L-1563"><a href="#L-1563"><span class="linenos">1563</span></a>
</span><span id="L-1564"><a href="#L-1564"><span class="linenos">1564</span></a>        <span class="k">return</span> <span class="n">u</span>
</span><span id="L-1565"><a href="#L-1565"><span class="linenos">1565</span></a>
</span><span id="L-1566"><a href="#L-1566"><span class="linenos">1566</span></a><span class="k">class</span> <span class="nc">amle</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="L-1567"><a href="#L-1567"><span class="linenos">1567</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">max_num_it</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span> <span class="n">weighted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prog</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-1568"><a href="#L-1568"><span class="linenos">1568</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;AMLE learning</span>
</span><span id="L-1569"><a href="#L-1569"><span class="linenos">1569</span></a><span class="sd">        ===================</span>
</span><span id="L-1570"><a href="#L-1570"><span class="linenos">1570</span></a>
</span><span id="L-1571"><a href="#L-1571"><span class="linenos">1571</span></a><span class="sd">        Semi-supervised learning by the Absolutely Minimal Lipschitz Extension (AMLE). This is the same as</span>
</span><span id="L-1572"><a href="#L-1572"><span class="linenos">1572</span></a><span class="sd">        p-Laplace with \\(p=\\infty\\), except that AMLE has an option `weighted=False` that significantly </span>
</span><span id="L-1573"><a href="#L-1573"><span class="linenos">1573</span></a><span class="sd">        accelerates the solver.</span>
</span><span id="L-1574"><a href="#L-1574"><span class="linenos">1574</span></a>
</span><span id="L-1575"><a href="#L-1575"><span class="linenos">1575</span></a><span class="sd">        Parameters</span>
</span><span id="L-1576"><a href="#L-1576"><span class="linenos">1576</span></a><span class="sd">        ----------</span>
</span><span id="L-1577"><a href="#L-1577"><span class="linenos">1577</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="L-1578"><a href="#L-1578"><span class="linenos">1578</span></a><span class="sd">            (n,n) Weight matrix representing the graph.</span>
</span><span id="L-1579"><a href="#L-1579"><span class="linenos">1579</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="L-1580"><a href="#L-1580"><span class="linenos">1580</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="L-1581"><a href="#L-1581"><span class="linenos">1581</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="L-1582"><a href="#L-1582"><span class="linenos">1582</span></a><span class="sd">            nodes in each class.</span>
</span><span id="L-1583"><a href="#L-1583"><span class="linenos">1583</span></a><span class="sd">        tol : float (optional), default=1e-3</span>
</span><span id="L-1584"><a href="#L-1584"><span class="linenos">1584</span></a><span class="sd">            Tolerance with which to solve the equation.</span>
</span><span id="L-1585"><a href="#L-1585"><span class="linenos">1585</span></a><span class="sd">        max_num_it : int (optional), default=1e5</span>
</span><span id="L-1586"><a href="#L-1586"><span class="linenos">1586</span></a><span class="sd">            Maximum number of iterations</span>
</span><span id="L-1587"><a href="#L-1587"><span class="linenos">1587</span></a><span class="sd">        weighted : bool (optional), default=False</span>
</span><span id="L-1588"><a href="#L-1588"><span class="linenos">1588</span></a><span class="sd">            When False, the graph is converted to a 0/1 adjacency matrix, which affords a much faster solver.</span>
</span><span id="L-1589"><a href="#L-1589"><span class="linenos">1589</span></a><span class="sd">        prog : bool (optional), default=False</span>
</span><span id="L-1590"><a href="#L-1590"><span class="linenos">1590</span></a><span class="sd">            Whether to print progress information.</span>
</span><span id="L-1591"><a href="#L-1591"><span class="linenos">1591</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1592"><a href="#L-1592"><span class="linenos">1592</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="L-1593"><a href="#L-1593"><span class="linenos">1593</span></a>
</span><span id="L-1594"><a href="#L-1594"><span class="linenos">1594</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span>
</span><span id="L-1595"><a href="#L-1595"><span class="linenos">1595</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_num_it</span> <span class="o">=</span> <span class="n">max_num_it</span>
</span><span id="L-1596"><a href="#L-1596"><span class="linenos">1596</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">weighted</span> <span class="o">=</span> <span class="n">weighted</span>
</span><span id="L-1597"><a href="#L-1597"><span class="linenos">1597</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prog</span> <span class="o">=</span> <span class="n">prog</span>
</span><span id="L-1598"><a href="#L-1598"><span class="linenos">1598</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onevsrest</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1599"><a href="#L-1599"><span class="linenos">1599</span></a>
</span><span id="L-1600"><a href="#L-1600"><span class="linenos">1600</span></a>        <span class="c1">#Setup accuracy filename and model name</span>
</span><span id="L-1601"><a href="#L-1601"><span class="linenos">1601</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_amle&#39;</span>
</span><span id="L-1602"><a href="#L-1602"><span class="linenos">1602</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">weighted</span><span class="p">:</span>
</span><span id="L-1603"><a href="#L-1603"><span class="linenos">1603</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">+=</span> <span class="s1">&#39;_unweighted&#39;</span>
</span><span id="L-1604"><a href="#L-1604"><span class="linenos">1604</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;AMLE&#39;</span>
</span><span id="L-1605"><a href="#L-1605"><span class="linenos">1605</span></a>
</span><span id="L-1606"><a href="#L-1606"><span class="linenos">1606</span></a>
</span><span id="L-1607"><a href="#L-1607"><span class="linenos">1607</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1608"><a href="#L-1608"><span class="linenos">1608</span></a>
</span><span id="L-1609"><a href="#L-1609"><span class="linenos">1609</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">amle</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tol</span><span class="p">,</span> <span class="n">max_num_it</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_num_it</span><span class="p">,</span> 
</span><span id="L-1610"><a href="#L-1610"><span class="linenos">1610</span></a>                                                     <span class="n">weighted</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weighted</span><span class="p">,</span> <span class="n">prog</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="p">)</span>
</span><span id="L-1611"><a href="#L-1611"><span class="linenos">1611</span></a>        <span class="k">return</span> <span class="n">u</span>
</span><span id="L-1612"><a href="#L-1612"><span class="linenos">1612</span></a>
</span><span id="L-1613"><a href="#L-1613"><span class="linenos">1613</span></a><span class="k">class</span> <span class="nc">peikonal</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="L-1614"><a href="#L-1614"><span class="linenos">1614</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_num_it</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">num_bisection_it</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">eps_ball_graph</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-1615"><a href="#L-1615"><span class="linenos">1615</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Graph p-eikonal classifier</span>
</span><span id="L-1616"><a href="#L-1616"><span class="linenos">1616</span></a><span class="sd">        ===================</span>
</span><span id="L-1617"><a href="#L-1617"><span class="linenos">1617</span></a>
</span><span id="L-1618"><a href="#L-1618"><span class="linenos">1618</span></a><span class="sd">        Semi-supervised learning by via the solution of the graph `graph.peikonal` equation.</span>
</span><span id="L-1619"><a href="#L-1619"><span class="linenos">1619</span></a>
</span><span id="L-1620"><a href="#L-1620"><span class="linenos">1620</span></a><span class="sd">        Parameters</span>
</span><span id="L-1621"><a href="#L-1621"><span class="linenos">1621</span></a><span class="sd">        ----------</span>
</span><span id="L-1622"><a href="#L-1622"><span class="linenos">1622</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="L-1623"><a href="#L-1623"><span class="linenos">1623</span></a><span class="sd">            (n,n) Weight matrix representing the graph.</span>
</span><span id="L-1624"><a href="#L-1624"><span class="linenos">1624</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="L-1625"><a href="#L-1625"><span class="linenos">1625</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="L-1626"><a href="#L-1626"><span class="linenos">1626</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="L-1627"><a href="#L-1627"><span class="linenos">1627</span></a><span class="sd">            nodes in each class.</span>
</span><span id="L-1628"><a href="#L-1628"><span class="linenos">1628</span></a><span class="sd">        D : numpy array or scipy sparse matrix (optional)</span>
</span><span id="L-1629"><a href="#L-1629"><span class="linenos">1629</span></a><span class="sd">            (n,n) Distance matrix, giving distances between neighbors. If provided,</span>
</span><span id="L-1630"><a href="#L-1630"><span class="linenos">1630</span></a><span class="sd">            this is used to construct a knn density estimator for reweighting the p-eikonal equation.</span>
</span><span id="L-1631"><a href="#L-1631"><span class="linenos">1631</span></a><span class="sd">        p : float (optional), default=1</span>
</span><span id="L-1632"><a href="#L-1632"><span class="linenos">1632</span></a><span class="sd">            Value of exponent p in the p-eikonal equation</span>
</span><span id="L-1633"><a href="#L-1633"><span class="linenos">1633</span></a><span class="sd">        alpha : float (optional), default=1</span>
</span><span id="L-1634"><a href="#L-1634"><span class="linenos">1634</span></a><span class="sd">            Reweighting exponent.</span>
</span><span id="L-1635"><a href="#L-1635"><span class="linenos">1635</span></a><span class="sd">        max_num_it : int (optional), default=1e5</span>
</span><span id="L-1636"><a href="#L-1636"><span class="linenos">1636</span></a><span class="sd">            Maximum number of iterations.</span>
</span><span id="L-1637"><a href="#L-1637"><span class="linenos">1637</span></a><span class="sd">        tol : float (optional), default=1e-3</span>
</span><span id="L-1638"><a href="#L-1638"><span class="linenos">1638</span></a><span class="sd">            Tolerance with which to solve the equation.</span>
</span><span id="L-1639"><a href="#L-1639"><span class="linenos">1639</span></a><span class="sd">        num_bisection_it : int (optional), default=30</span>
</span><span id="L-1640"><a href="#L-1640"><span class="linenos">1640</span></a><span class="sd">            Number of bisection iterations for solver.</span>
</span><span id="L-1641"><a href="#L-1641"><span class="linenos">1641</span></a><span class="sd">        eps_ball_graph : bool (optional), default=False</span>
</span><span id="L-1642"><a href="#L-1642"><span class="linenos">1642</span></a><span class="sd">            Whether the graph is an epsilon-ball graph or not. If it is, then the density reweighting</span>
</span><span id="L-1643"><a href="#L-1643"><span class="linenos">1643</span></a><span class="sd">            will be done with the degree vector, which is a kernel density estimator in this case</span>
</span><span id="L-1644"><a href="#L-1644"><span class="linenos">1644</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1645"><a href="#L-1645"><span class="linenos">1645</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="L-1646"><a href="#L-1646"><span class="linenos">1646</span></a>
</span><span id="L-1647"><a href="#L-1647"><span class="linenos">1647</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="L-1648"><a href="#L-1648"><span class="linenos">1648</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="L-1649"><a href="#L-1649"><span class="linenos">1649</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_num_it</span> <span class="o">=</span> <span class="n">max_num_it</span>
</span><span id="L-1650"><a href="#L-1650"><span class="linenos">1650</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span>
</span><span id="L-1651"><a href="#L-1651"><span class="linenos">1651</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_bisection_it</span> <span class="o">=</span> <span class="n">num_bisection_it</span>
</span><span id="L-1652"><a href="#L-1652"><span class="linenos">1652</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onevsrest</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1653"><a href="#L-1653"><span class="linenos">1653</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">similarity</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1654"><a href="#L-1654"><span class="linenos">1654</span></a>
</span><span id="L-1655"><a href="#L-1655"><span class="linenos">1655</span></a>        <span class="c1">#Cannot reweight if distance matrix not provided</span>
</span><span id="L-1656"><a href="#L-1656"><span class="linenos">1656</span></a>        <span class="k">if</span> <span class="n">D</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1657"><a href="#L-1657"><span class="linenos">1657</span></a>            <span class="k">if</span> <span class="n">eps_ball_graph</span><span class="p">:</span>
</span><span id="L-1658"><a href="#L-1658"><span class="linenos">1658</span></a>                <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">degree_vector</span><span class="p">()</span>
</span><span id="L-1659"><a href="#L-1659"><span class="linenos">1659</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span>
</span><span id="L-1660"><a href="#L-1660"><span class="linenos">1660</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1661"><a href="#L-1661"><span class="linenos">1661</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1662"><a href="#L-1662"><span class="linenos">1662</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1663"><a href="#L-1663"><span class="linenos">1663</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="c1">#distance to furtherest neighbor</span>
</span><span id="L-1664"><a href="#L-1664"><span class="linenos">1664</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="o">**</span><span class="n">alpha</span>
</span><span id="L-1665"><a href="#L-1665"><span class="linenos">1665</span></a>
</span><span id="L-1666"><a href="#L-1666"><span class="linenos">1666</span></a>        <span class="c1">#Setup accuracy filename and model name</span>
</span><span id="L-1667"><a href="#L-1667"><span class="linenos">1667</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_peikonal_p</span><span class="si">%.2f</span><span class="s1">_alpha</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span> 
</span><span id="L-1668"><a href="#L-1668"><span class="linenos">1668</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;p-eikonal (p=</span><span class="si">%.2f</span><span class="s1">, alpha=</span><span class="si">%.2f</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
</span><span id="L-1669"><a href="#L-1669"><span class="linenos">1669</span></a>
</span><span id="L-1670"><a href="#L-1670"><span class="linenos">1670</span></a>
</span><span id="L-1671"><a href="#L-1671"><span class="linenos">1671</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1672"><a href="#L-1672"><span class="linenos">1672</span></a>
</span><span id="L-1673"><a href="#L-1673"><span class="linenos">1673</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">peikonal</span><span class="p">(</span><span class="n">train_ind</span><span class="p">[</span><span class="n">train_labels</span><span class="p">],</span> <span class="n">bdy_val</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">max_num_it</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_num_it</span><span class="p">,</span> 
</span><span id="L-1674"><a href="#L-1674"><span class="linenos">1674</span></a>                                                <span class="n">tol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tol</span><span class="p">,</span> <span class="n">num_bisection_it</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_bisection_it</span><span class="p">,</span> <span class="n">prog</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-1675"><a href="#L-1675"><span class="linenos">1675</span></a>        <span class="k">return</span> <span class="n">u</span>
</span><span id="L-1676"><a href="#L-1676"><span class="linenos">1676</span></a>
</span><span id="L-1677"><a href="#L-1677"><span class="linenos">1677</span></a>
</span><span id="L-1678"><a href="#L-1678"><span class="linenos">1678</span></a><span class="k">class</span> <span class="nc">plaplace</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="L-1679"><a href="#L-1679"><span class="linenos">1679</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_num_it</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-1680"><a href="#L-1680"><span class="linenos">1680</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Graph p-laplace classifier</span>
</span><span id="L-1681"><a href="#L-1681"><span class="linenos">1681</span></a><span class="sd">        ===================</span>
</span><span id="L-1682"><a href="#L-1682"><span class="linenos">1682</span></a>
</span><span id="L-1683"><a href="#L-1683"><span class="linenos">1683</span></a><span class="sd">        Semi-supervised learning by via the solution of the game-theoretic p-Laplace equation [1].</span>
</span><span id="L-1684"><a href="#L-1684"><span class="linenos">1684</span></a>
</span><span id="L-1685"><a href="#L-1685"><span class="linenos">1685</span></a><span class="sd">        Parameters</span>
</span><span id="L-1686"><a href="#L-1686"><span class="linenos">1686</span></a><span class="sd">        ----------</span>
</span><span id="L-1687"><a href="#L-1687"><span class="linenos">1687</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="L-1688"><a href="#L-1688"><span class="linenos">1688</span></a><span class="sd">            (n,n) Weight matrix representing the graph.</span>
</span><span id="L-1689"><a href="#L-1689"><span class="linenos">1689</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="L-1690"><a href="#L-1690"><span class="linenos">1690</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="L-1691"><a href="#L-1691"><span class="linenos">1691</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="L-1692"><a href="#L-1692"><span class="linenos">1692</span></a><span class="sd">            nodes in each class.</span>
</span><span id="L-1693"><a href="#L-1693"><span class="linenos">1693</span></a><span class="sd">        p : float (optional), default=10</span>
</span><span id="L-1694"><a href="#L-1694"><span class="linenos">1694</span></a><span class="sd">            Value of p in the p-Laplace equation (\\( 2 \\leq p \\leq \\infty\\).</span>
</span><span id="L-1695"><a href="#L-1695"><span class="linenos">1695</span></a><span class="sd">        max_num_it : int (optional), default=1e5</span>
</span><span id="L-1696"><a href="#L-1696"><span class="linenos">1696</span></a><span class="sd">            Maximum number of iterations</span>
</span><span id="L-1697"><a href="#L-1697"><span class="linenos">1697</span></a><span class="sd">        tol : float (optional), default=1e-3</span>
</span><span id="L-1698"><a href="#L-1698"><span class="linenos">1698</span></a><span class="sd">            Tolerance with which to solve the equation.</span>
</span><span id="L-1699"><a href="#L-1699"><span class="linenos">1699</span></a><span class="sd">        fast : bool (optional), default=True</span>
</span><span id="L-1700"><a href="#L-1700"><span class="linenos">1700</span></a><span class="sd">            Whether to use constant \\(w_{ij}=1\\) weights for the infinity-Laplacian</span>
</span><span id="L-1701"><a href="#L-1701"><span class="linenos">1701</span></a><span class="sd">            which allows a faster algorithm to be used.</span>
</span><span id="L-1702"><a href="#L-1702"><span class="linenos">1702</span></a>
</span><span id="L-1703"><a href="#L-1703"><span class="linenos">1703</span></a><span class="sd">        References</span>
</span><span id="L-1704"><a href="#L-1704"><span class="linenos">1704</span></a><span class="sd">        ----------</span>
</span><span id="L-1705"><a href="#L-1705"><span class="linenos">1705</span></a><span class="sd">        [1] M. Flores Rios, J. Calder, and G. Lerman. [Algorithms for \\( \\ell_p\\)-based semi-supervised learning on graphs.](https://arxiv.org/abs/1901.05031) arXiv:1901.05031, 2019.</span>
</span><span id="L-1706"><a href="#L-1706"><span class="linenos">1706</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1707"><a href="#L-1707"><span class="linenos">1707</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="L-1708"><a href="#L-1708"><span class="linenos">1708</span></a>
</span><span id="L-1709"><a href="#L-1709"><span class="linenos">1709</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="L-1710"><a href="#L-1710"><span class="linenos">1710</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_num_it</span> <span class="o">=</span> <span class="n">max_num_it</span>
</span><span id="L-1711"><a href="#L-1711"><span class="linenos">1711</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span>
</span><span id="L-1712"><a href="#L-1712"><span class="linenos">1712</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onevsrest</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1713"><a href="#L-1713"><span class="linenos">1713</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fast</span> <span class="o">=</span> <span class="n">fast</span>
</span><span id="L-1714"><a href="#L-1714"><span class="linenos">1714</span></a>
</span><span id="L-1715"><a href="#L-1715"><span class="linenos">1715</span></a>        <span class="c1">#Setup accuracy filename and model name</span>
</span><span id="L-1716"><a href="#L-1716"><span class="linenos">1716</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_plaplace_p</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span> 
</span><span id="L-1717"><a href="#L-1717"><span class="linenos">1717</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;p-Laplace (p=</span><span class="si">%.2f</span><span class="s1">)&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span>
</span><span id="L-1718"><a href="#L-1718"><span class="linenos">1718</span></a>
</span><span id="L-1719"><a href="#L-1719"><span class="linenos">1719</span></a>
</span><span id="L-1720"><a href="#L-1720"><span class="linenos">1720</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1721"><a href="#L-1721"><span class="linenos">1721</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">plaplace</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">max_num_it</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_num_it</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tol</span><span class="p">,</span><span class="n">fast</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fast</span><span class="p">)</span>
</span><span id="L-1722"><a href="#L-1722"><span class="linenos">1722</span></a>        <span class="k">return</span> <span class="n">u</span>
</span><span id="L-1723"><a href="#L-1723"><span class="linenos">1723</span></a>
</span><span id="L-1724"><a href="#L-1724"><span class="linenos">1724</span></a>
</span><span id="L-1725"><a href="#L-1725"><span class="linenos">1725</span></a>
</span><span id="L-1726"><a href="#L-1726"><span class="linenos">1726</span></a><span class="k">class</span> <span class="nc">randomwalk</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="L-1727"><a href="#L-1727"><span class="linenos">1727</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.95</span><span class="p">):</span>
</span><span id="L-1728"><a href="#L-1728"><span class="linenos">1728</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Lazy random walk classification</span>
</span><span id="L-1729"><a href="#L-1729"><span class="linenos">1729</span></a><span class="sd">        ===================</span>
</span><span id="L-1730"><a href="#L-1730"><span class="linenos">1730</span></a>
</span><span id="L-1731"><a href="#L-1731"><span class="linenos">1731</span></a><span class="sd">        Add description.</span>
</span><span id="L-1732"><a href="#L-1732"><span class="linenos">1732</span></a>
</span><span id="L-1733"><a href="#L-1733"><span class="linenos">1733</span></a><span class="sd">        The original method was introduced in [1], and can be interpreted as a lazy random walk. </span>
</span><span id="L-1734"><a href="#L-1734"><span class="linenos">1734</span></a>
</span><span id="L-1735"><a href="#L-1735"><span class="linenos">1735</span></a><span class="sd">        Parameters</span>
</span><span id="L-1736"><a href="#L-1736"><span class="linenos">1736</span></a><span class="sd">        ----------</span>
</span><span id="L-1737"><a href="#L-1737"><span class="linenos">1737</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="L-1738"><a href="#L-1738"><span class="linenos">1738</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="L-1739"><a href="#L-1739"><span class="linenos">1739</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="L-1740"><a href="#L-1740"><span class="linenos">1740</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="L-1741"><a href="#L-1741"><span class="linenos">1741</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="L-1742"><a href="#L-1742"><span class="linenos">1742</span></a><span class="sd">            nodes in each class.</span>
</span><span id="L-1743"><a href="#L-1743"><span class="linenos">1743</span></a><span class="sd">        alpha : float (optional), default=0.95</span>
</span><span id="L-1744"><a href="#L-1744"><span class="linenos">1744</span></a><span class="sd">            Parameter in model.</span>
</span><span id="L-1745"><a href="#L-1745"><span class="linenos">1745</span></a>
</span><span id="L-1746"><a href="#L-1746"><span class="linenos">1746</span></a><span class="sd">        References</span>
</span><span id="L-1747"><a href="#L-1747"><span class="linenos">1747</span></a><span class="sd">        ---------</span>
</span><span id="L-1748"><a href="#L-1748"><span class="linenos">1748</span></a><span class="sd">        [1] D. Zhou and B. Schlkopf. [Learning from labeled and unlabeled data using random walks.](https://link.springer.com/chapter/10.1007/978-3-540-28649-3_29) Joint Pattern Recognition Symposium. </span>
</span><span id="L-1749"><a href="#L-1749"><span class="linenos">1749</span></a><span class="sd">        Springer, Berlin, Heidelberg, 2004.</span>
</span><span id="L-1750"><a href="#L-1750"><span class="linenos">1750</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1751"><a href="#L-1751"><span class="linenos">1751</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="L-1752"><a href="#L-1752"><span class="linenos">1752</span></a>
</span><span id="L-1753"><a href="#L-1753"><span class="linenos">1753</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="L-1754"><a href="#L-1754"><span class="linenos">1754</span></a>
</span><span id="L-1755"><a href="#L-1755"><span class="linenos">1755</span></a>        <span class="c1">#Setup accuracy filename and model name</span>
</span><span id="L-1756"><a href="#L-1756"><span class="linenos">1756</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_randomwalk&#39;</span> 
</span><span id="L-1757"><a href="#L-1757"><span class="linenos">1757</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Lazy Random Walks&#39;</span>
</span><span id="L-1758"><a href="#L-1758"><span class="linenos">1758</span></a>
</span><span id="L-1759"><a href="#L-1759"><span class="linenos">1759</span></a>
</span><span id="L-1760"><a href="#L-1760"><span class="linenos">1760</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1761"><a href="#L-1761"><span class="linenos">1761</span></a>        
</span><span id="L-1762"><a href="#L-1762"><span class="linenos">1762</span></a>        <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>
</span><span id="L-1763"><a href="#L-1763"><span class="linenos">1763</span></a>
</span><span id="L-1764"><a href="#L-1764"><span class="linenos">1764</span></a>        <span class="c1">#Zero diagonals</span>
</span><span id="L-1765"><a href="#L-1765"><span class="linenos">1765</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span>
</span><span id="L-1766"><a href="#L-1766"><span class="linenos">1766</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">weight_matrix</span>
</span><span id="L-1767"><a href="#L-1767"><span class="linenos">1767</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="n">W</span> <span class="o">-</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">diagonal</span><span class="p">(),</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-1768"><a href="#L-1768"><span class="linenos">1768</span></a>        <span class="n">G</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">graph</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</span><span id="L-1769"><a href="#L-1769"><span class="linenos">1769</span></a>
</span><span id="L-1770"><a href="#L-1770"><span class="linenos">1770</span></a>        <span class="c1">#Construct Laplacian matrix</span>
</span><span id="L-1771"><a href="#L-1771"><span class="linenos">1771</span></a>        <span class="n">L</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="n">sparse</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="n">G</span><span class="o">.</span><span class="n">laplacian</span><span class="p">(</span><span class="n">normalization</span><span class="o">=</span><span class="s1">&#39;normalized&#39;</span><span class="p">)</span>
</span><span id="L-1772"><a href="#L-1772"><span class="linenos">1772</span></a>
</span><span id="L-1773"><a href="#L-1773"><span class="linenos">1773</span></a>        <span class="c1">#Preconditioner</span>
</span><span id="L-1774"><a href="#L-1774"><span class="linenos">1774</span></a>        <span class="n">m</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1775"><a href="#L-1775"><span class="linenos">1775</span></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span>
</span><span id="L-1776"><a href="#L-1776"><span class="linenos">1776</span></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">M</span><span class="o">+</span><span class="mf">1e-10</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">tocsr</span><span class="p">()</span>
</span><span id="L-1777"><a href="#L-1777"><span class="linenos">1777</span></a>       
</span><span id="L-1778"><a href="#L-1778"><span class="linenos">1778</span></a>        <span class="c1">#Right hand side</span>
</span><span id="L-1779"><a href="#L-1779"><span class="linenos">1779</span></a>        <span class="n">onehot</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span>
</span><span id="L-1780"><a href="#L-1780"><span class="linenos">1780</span></a>        <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">onehot</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-1781"><a href="#L-1781"><span class="linenos">1781</span></a>        <span class="n">Y</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">onehot</span>
</span><span id="L-1782"><a href="#L-1782"><span class="linenos">1782</span></a>
</span><span id="L-1783"><a href="#L-1783"><span class="linenos">1783</span></a>        <span class="c1">#Conjugate gradient solver</span>
</span><span id="L-1784"><a href="#L-1784"><span class="linenos">1784</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">conjgrad</span><span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="n">M</span><span class="p">,</span> <span class="n">M</span><span class="o">*</span><span class="n">Y</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
</span><span id="L-1785"><a href="#L-1785"><span class="linenos">1785</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">M</span><span class="o">*</span><span class="n">u</span>
</span><span id="L-1786"><a href="#L-1786"><span class="linenos">1786</span></a>
</span><span id="L-1787"><a href="#L-1787"><span class="linenos">1787</span></a>        <span class="k">return</span> <span class="n">u</span>
</span><span id="L-1788"><a href="#L-1788"><span class="linenos">1788</span></a>
</span><span id="L-1789"><a href="#L-1789"><span class="linenos">1789</span></a><span class="k">def</span> <span class="nf">ssl_accuracy</span><span class="p">(</span><span class="n">pred_labels</span><span class="p">,</span> <span class="n">true_labels</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">):</span>   
</span><span id="L-1790"><a href="#L-1790"><span class="linenos">1790</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;SSL Accuacy</span>
</span><span id="L-1791"><a href="#L-1791"><span class="linenos">1791</span></a><span class="sd">    ======</span>
</span><span id="L-1792"><a href="#L-1792"><span class="linenos">1792</span></a>
</span><span id="L-1793"><a href="#L-1793"><span class="linenos">1793</span></a><span class="sd">    Accuracy for semi-supervised graph learning, taking care to remove training set.</span>
</span><span id="L-1794"><a href="#L-1794"><span class="linenos">1794</span></a><span class="sd">    NOTE: Any true labels with negative values will be removed from </span>
</span><span id="L-1795"><a href="#L-1795"><span class="linenos">1795</span></a><span class="sd">    accuracy computation.</span>
</span><span id="L-1796"><a href="#L-1796"><span class="linenos">1796</span></a>
</span><span id="L-1797"><a href="#L-1797"><span class="linenos">1797</span></a><span class="sd">    Parameters</span>
</span><span id="L-1798"><a href="#L-1798"><span class="linenos">1798</span></a><span class="sd">    ----------</span>
</span><span id="L-1799"><a href="#L-1799"><span class="linenos">1799</span></a><span class="sd">    pred_labels : numpy array, int</span>
</span><span id="L-1800"><a href="#L-1800"><span class="linenos">1800</span></a><span class="sd">        Predicted labels</span>
</span><span id="L-1801"><a href="#L-1801"><span class="linenos">1801</span></a><span class="sd">    true_labels : numpy array, int</span>
</span><span id="L-1802"><a href="#L-1802"><span class="linenos">1802</span></a><span class="sd">        True labels</span>
</span><span id="L-1803"><a href="#L-1803"><span class="linenos">1803</span></a><span class="sd">    train_ind : numpy array, int </span>
</span><span id="L-1804"><a href="#L-1804"><span class="linenos">1804</span></a><span class="sd">        Indices of training points, which will be removed from the accuracy computation.</span>
</span><span id="L-1805"><a href="#L-1805"><span class="linenos">1805</span></a>
</span><span id="L-1806"><a href="#L-1806"><span class="linenos">1806</span></a><span class="sd">    Returns</span>
</span><span id="L-1807"><a href="#L-1807"><span class="linenos">1807</span></a><span class="sd">    -------</span>
</span><span id="L-1808"><a href="#L-1808"><span class="linenos">1808</span></a><span class="sd">    accuracy : float</span>
</span><span id="L-1809"><a href="#L-1809"><span class="linenos">1809</span></a><span class="sd">        Accuracy as a number in [0,100].</span>
</span><span id="L-1810"><a href="#L-1810"><span class="linenos">1810</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1811"><a href="#L-1811"><span class="linenos">1811</span></a>
</span><span id="L-1812"><a href="#L-1812"><span class="linenos">1812</span></a>        <span class="c1">#Remove labeled data</span>
</span><span id="L-1813"><a href="#L-1813"><span class="linenos">1813</span></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pred_labels</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
</span><span id="L-1814"><a href="#L-1814"><span class="linenos">1814</span></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">train_ind</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-1815"><a href="#L-1815"><span class="linenos">1815</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: ssl_accuracy has been updated and now requires the user to provide the indices of the labeled points, and not just the number of labels. Accuracy computation will be incorrect unless you update your code accordingly. See https://jwcalder.github.io/GraphLearning/ssl.html#two-moons-example&quot;</span><span class="p">)</span>
</span><span id="L-1816"><a href="#L-1816"><span class="linenos">1816</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1817"><a href="#L-1817"><span class="linenos">1817</span></a>        <span class="n">mask</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-1818"><a href="#L-1818"><span class="linenos">1818</span></a>
</span><span id="L-1819"><a href="#L-1819"><span class="linenos">1819</span></a>    <span class="n">pred_labels</span> <span class="o">=</span> <span class="n">pred_labels</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</span><span id="L-1820"><a href="#L-1820"><span class="linenos">1820</span></a>    <span class="n">true_labels</span> <span class="o">=</span> <span class="n">true_labels</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</span><span id="L-1821"><a href="#L-1821"><span class="linenos">1821</span></a>
</span><span id="L-1822"><a href="#L-1822"><span class="linenos">1822</span></a>    <span class="c1">#Remove unlabeled nodes</span>
</span><span id="L-1823"><a href="#L-1823"><span class="linenos">1823</span></a>    <span class="n">I</span> <span class="o">=</span> <span class="n">true_labels</span> <span class="o">&gt;=</span><span class="mi">0</span>
</span><span id="L-1824"><a href="#L-1824"><span class="linenos">1824</span></a>    <span class="n">pred_labels</span> <span class="o">=</span> <span class="n">pred_labels</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
</span><span id="L-1825"><a href="#L-1825"><span class="linenos">1825</span></a>    <span class="n">true_labels</span> <span class="o">=</span> <span class="n">true_labels</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
</span><span id="L-1826"><a href="#L-1826"><span class="linenos">1826</span></a>
</span><span id="L-1827"><a href="#L-1827"><span class="linenos">1827</span></a>    <span class="c1">#Compute accuracy</span>
</span><span id="L-1828"><a href="#L-1828"><span class="linenos">1828</span></a>    <span class="k">return</span> <span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pred_labels</span><span class="o">==</span><span class="n">true_labels</span><span class="p">)</span>
</span><span id="L-1829"><a href="#L-1829"><span class="linenos">1829</span></a>
</span><span id="L-1830"><a href="#L-1830"><span class="linenos">1830</span></a>
</span><span id="L-1831"><a href="#L-1831"><span class="linenos">1831</span></a><span class="k">def</span> <span class="nf">accuracy_plot</span><span class="p">(</span><span class="n">model_list</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">testerror</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">savefile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">errorbars</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
</span><span id="L-1832"><a href="#L-1832"><span class="linenos">1832</span></a>                  <span class="n">loglog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">legend_fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">label_fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">):</span>
</span><span id="L-1833"><a href="#L-1833"><span class="linenos">1833</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Accuracy Plot</span>
</span><span id="L-1834"><a href="#L-1834"><span class="linenos">1834</span></a><span class="sd">    ======</span>
</span><span id="L-1835"><a href="#L-1835"><span class="linenos">1835</span></a>
</span><span id="L-1836"><a href="#L-1836"><span class="linenos">1836</span></a><span class="sd">    Creates a plot of accuracy scores for experiments run with `ssl_trials`.</span>
</span><span id="L-1837"><a href="#L-1837"><span class="linenos">1837</span></a>
</span><span id="L-1838"><a href="#L-1838"><span class="linenos">1838</span></a><span class="sd">    Parameters</span>
</span><span id="L-1839"><a href="#L-1839"><span class="linenos">1839</span></a><span class="sd">    ----------</span>
</span><span id="L-1840"><a href="#L-1840"><span class="linenos">1840</span></a><span class="sd">    model_list : list of ssl objects</span>
</span><span id="L-1841"><a href="#L-1841"><span class="linenos">1841</span></a><span class="sd">        Models to include in table.</span>
</span><span id="L-1842"><a href="#L-1842"><span class="linenos">1842</span></a><span class="sd">    tag : str (optional), default=&#39;&#39;</span>
</span><span id="L-1843"><a href="#L-1843"><span class="linenos">1843</span></a><span class="sd">        An extra identifying tag to add to the accuracy filename.</span>
</span><span id="L-1844"><a href="#L-1844"><span class="linenos">1844</span></a><span class="sd">    testerror : bool (optional), default=False</span>
</span><span id="L-1845"><a href="#L-1845"><span class="linenos">1845</span></a><span class="sd">        Show test error (instead of accuracy) in the table.</span>
</span><span id="L-1846"><a href="#L-1846"><span class="linenos">1846</span></a><span class="sd">    savefile : str (optional), default=None</span>
</span><span id="L-1847"><a href="#L-1847"><span class="linenos">1847</span></a><span class="sd">        If a savefile name is provided, then the plot is saved instead of displayed to the screen</span>
</span><span id="L-1848"><a href="#L-1848"><span class="linenos">1848</span></a><span class="sd">    title : str (optional), default=None</span>
</span><span id="L-1849"><a href="#L-1849"><span class="linenos">1849</span></a><span class="sd">        If title is provided, then it will be added to the plot.</span>
</span><span id="L-1850"><a href="#L-1850"><span class="linenos">1850</span></a><span class="sd">    errorbars : bool (optional), default=False</span>
</span><span id="L-1851"><a href="#L-1851"><span class="linenos">1851</span></a><span class="sd">        Whether to add error bars to plot.</span>
</span><span id="L-1852"><a href="#L-1852"><span class="linenos">1852</span></a><span class="sd">    loglog : bool (optional), default=False</span>
</span><span id="L-1853"><a href="#L-1853"><span class="linenos">1853</span></a><span class="sd">        Make the plot on a loglog scale.</span>
</span><span id="L-1854"><a href="#L-1854"><span class="linenos">1854</span></a><span class="sd">    ylim : tuple (optional), default=None</span>
</span><span id="L-1855"><a href="#L-1855"><span class="linenos">1855</span></a><span class="sd">        If provided, then y-limits are set with `plt.ylim(ylim)`</span>
</span><span id="L-1856"><a href="#L-1856"><span class="linenos">1856</span></a><span class="sd">    fontsize : int (optional), default=16</span>
</span><span id="L-1857"><a href="#L-1857"><span class="linenos">1857</span></a><span class="sd">        Font size text, other than legend and labels</span>
</span><span id="L-1858"><a href="#L-1858"><span class="linenos">1858</span></a><span class="sd">    legend_fontsize : int (optional), default=16</span>
</span><span id="L-1859"><a href="#L-1859"><span class="linenos">1859</span></a><span class="sd">        Font size for legend.</span>
</span><span id="L-1860"><a href="#L-1860"><span class="linenos">1860</span></a><span class="sd">    label_fontsize : int (optional), default=16</span>
</span><span id="L-1861"><a href="#L-1861"><span class="linenos">1861</span></a><span class="sd">        Font size for x and y labels.</span>
</span><span id="L-1862"><a href="#L-1862"><span class="linenos">1862</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1863"><a href="#L-1863"><span class="linenos">1863</span></a>
</span><span id="L-1864"><a href="#L-1864"><span class="linenos">1864</span></a>    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="L-1865"><a href="#L-1865"><span class="linenos">1865</span></a>    <span class="k">if</span> <span class="n">errorbars</span><span class="p">:</span>
</span><span id="L-1866"><a href="#L-1866"><span class="linenos">1866</span></a>        <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;errorbar.capsize&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span>
</span><span id="L-1867"><a href="#L-1867"><span class="linenos">1867</span></a>    <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="n">fontsize</span><span class="p">})</span>
</span><span id="L-1868"><a href="#L-1868"><span class="linenos">1868</span></a>    <span class="n">styles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;^b-&#39;</span><span class="p">,</span><span class="s1">&#39;or-&#39;</span><span class="p">,</span><span class="s1">&#39;dg-&#39;</span><span class="p">,</span><span class="s1">&#39;sk-&#39;</span><span class="p">,</span><span class="s1">&#39;pm-&#39;</span><span class="p">,</span><span class="s1">&#39;xc-&#39;</span><span class="p">,</span><span class="s1">&#39;*y-&#39;</span><span class="p">]</span>
</span><span id="L-1869"><a href="#L-1869"><span class="linenos">1869</span></a>    <span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-1870"><a href="#L-1870"><span class="linenos">1870</span></a>    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model_list</span><span class="p">:</span>
</span><span id="L-1871"><a href="#L-1871"><span class="linenos">1871</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">7</span>
</span><span id="L-1872"><a href="#L-1872"><span class="linenos">1872</span></a>        <span class="n">num_train</span><span class="p">,</span><span class="n">acc_mean</span><span class="p">,</span><span class="n">acc_stddev</span><span class="p">,</span><span class="n">num_trials</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">trials_statistics</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-1873"><a href="#L-1873"><span class="linenos">1873</span></a>        <span class="k">if</span> <span class="n">testerror</span><span class="p">:</span>
</span><span id="L-1874"><a href="#L-1874"><span class="linenos">1874</span></a>            <span class="n">acc_mean</span> <span class="o">=</span> <span class="mi">100</span><span class="o">-</span><span class="n">acc_mean</span>
</span><span id="L-1875"><a href="#L-1875"><span class="linenos">1875</span></a>
</span><span id="L-1876"><a href="#L-1876"><span class="linenos">1876</span></a>        <span class="k">if</span> <span class="n">errorbars</span><span class="p">:</span>
</span><span id="L-1877"><a href="#L-1877"><span class="linenos">1877</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">num_train</span><span class="p">,</span> <span class="n">acc_mean</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">fmt</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">yerr</span><span class="o">=</span><span class="n">acc_stddev</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-1878"><a href="#L-1878"><span class="linenos">1878</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1879"><a href="#L-1879"><span class="linenos">1879</span></a>            <span class="k">if</span> <span class="n">loglog</span><span class="p">:</span>
</span><span id="L-1880"><a href="#L-1880"><span class="linenos">1880</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">num_train</span><span class="p">,</span> <span class="n">acc_mean</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-1881"><a href="#L-1881"><span class="linenos">1881</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1882"><a href="#L-1882"><span class="linenos">1882</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num_train</span><span class="p">,</span> <span class="n">acc_mean</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="c1">#3rd argumnet=styles[i]</span>
</span><span id="L-1883"><a href="#L-1883"><span class="linenos">1883</span></a>
</span><span id="L-1884"><a href="#L-1884"><span class="linenos">1884</span></a>        <span class="c1">#If class priors were run as well</span>
</span><span id="L-1885"><a href="#L-1885"><span class="linenos">1885</span></a>        <span class="k">if</span> <span class="n">acc_mean</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1886"><a href="#L-1886"><span class="linenos">1886</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">7</span>
</span><span id="L-1887"><a href="#L-1887"><span class="linenos">1887</span></a>            <span class="k">if</span> <span class="n">errorbars</span><span class="p">:</span>
</span><span id="L-1888"><a href="#L-1888"><span class="linenos">1888</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">num_train</span><span class="p">,</span> <span class="n">acc_mean</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">fmt</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">yerr</span><span class="o">=</span><span class="n">acc_stddev</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;+CP&#39;</span><span class="p">)</span>
</span><span id="L-1889"><a href="#L-1889"><span class="linenos">1889</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1890"><a href="#L-1890"><span class="linenos">1890</span></a>                <span class="k">if</span> <span class="n">loglog</span><span class="p">:</span>
</span><span id="L-1891"><a href="#L-1891"><span class="linenos">1891</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">num_train</span><span class="p">,</span> <span class="n">acc_mean</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;+CP&#39;</span><span class="p">)</span>
</span><span id="L-1892"><a href="#L-1892"><span class="linenos">1892</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1893"><a href="#L-1893"><span class="linenos">1893</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num_train</span><span class="p">,</span> <span class="n">acc_mean</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;+CP&#39;</span><span class="p">)</span> <span class="c1">#3rd argumnet=styles[i]</span>
</span><span id="L-1894"><a href="#L-1894"><span class="linenos">1894</span></a>
</span><span id="L-1895"><a href="#L-1895"><span class="linenos">1895</span></a>     
</span><span id="L-1896"><a href="#L-1896"><span class="linenos">1896</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of labels&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">label_fontsize</span><span class="p">)</span>
</span><span id="L-1897"><a href="#L-1897"><span class="linenos">1897</span></a>    <span class="k">if</span> <span class="n">testerror</span><span class="p">:</span>
</span><span id="L-1898"><a href="#L-1898"><span class="linenos">1898</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Test error (%)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">label_fontsize</span><span class="p">)</span>
</span><span id="L-1899"><a href="#L-1899"><span class="linenos">1899</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">)</span>
</span><span id="L-1900"><a href="#L-1900"><span class="linenos">1900</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1901"><a href="#L-1901"><span class="linenos">1901</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Accuracy (%)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">label_fontsize</span><span class="p">)</span>
</span><span id="L-1902"><a href="#L-1902"><span class="linenos">1902</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">)</span>
</span><span id="L-1903"><a href="#L-1903"><span class="linenos">1903</span></a>    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1904"><a href="#L-1904"><span class="linenos">1904</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="L-1905"><a href="#L-1905"><span class="linenos">1905</span></a>
</span><span id="L-1906"><a href="#L-1906"><span class="linenos">1906</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-1907"><a href="#L-1907"><span class="linenos">1907</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1908"><a href="#L-1908"><span class="linenos">1908</span></a>
</span><span id="L-1909"><a href="#L-1909"><span class="linenos">1909</span></a>    <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1910"><a href="#L-1910"><span class="linenos">1910</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
</span><span id="L-1911"><a href="#L-1911"><span class="linenos">1911</span></a>
</span><span id="L-1912"><a href="#L-1912"><span class="linenos">1912</span></a>    <span class="c1">#ax.xaxis.set_major_locator(MaxNLocator(integer=True))</span>
</span><span id="L-1913"><a href="#L-1913"><span class="linenos">1913</span></a>
</span><span id="L-1914"><a href="#L-1914"><span class="linenos">1914</span></a>    <span class="k">if</span> <span class="n">savefile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1915"><a href="#L-1915"><span class="linenos">1915</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savefile</span><span class="p">)</span>
</span><span id="L-1916"><a href="#L-1916"><span class="linenos">1916</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1917"><a href="#L-1917"><span class="linenos">1917</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-1918"><a href="#L-1918"><span class="linenos">1918</span></a>
</span><span id="L-1919"><a href="#L-1919"><span class="linenos">1919</span></a><span class="k">def</span> <span class="nf">accuracy_table</span><span class="p">(</span><span class="n">model_list</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">testerror</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">savefile</span><span class="o">=</span><span class="s1">&#39;table.tex&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> 
</span><span id="L-1920"><a href="#L-1920"><span class="linenos">1920</span></a>                               <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">,</span> <span class="n">small_caps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">two_column</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-1921"><a href="#L-1921"><span class="linenos">1921</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Accuracy table</span>
</span><span id="L-1922"><a href="#L-1922"><span class="linenos">1922</span></a><span class="sd">    ======</span>
</span><span id="L-1923"><a href="#L-1923"><span class="linenos">1923</span></a>
</span><span id="L-1924"><a href="#L-1924"><span class="linenos">1924</span></a><span class="sd">    Creates a table of accuracy scores for experiments run with `ssl_trials` to be</span>
</span><span id="L-1925"><a href="#L-1925"><span class="linenos">1925</span></a><span class="sd">    included in a LaTeX document.</span>
</span><span id="L-1926"><a href="#L-1926"><span class="linenos">1926</span></a>
</span><span id="L-1927"><a href="#L-1927"><span class="linenos">1927</span></a><span class="sd">    Parameters</span>
</span><span id="L-1928"><a href="#L-1928"><span class="linenos">1928</span></a><span class="sd">    ----------</span>
</span><span id="L-1929"><a href="#L-1929"><span class="linenos">1929</span></a><span class="sd">    model_list : list of ssl objects</span>
</span><span id="L-1930"><a href="#L-1930"><span class="linenos">1930</span></a><span class="sd">        Models to include in table.</span>
</span><span id="L-1931"><a href="#L-1931"><span class="linenos">1931</span></a><span class="sd">    tag : str (optional), default=&#39;&#39;</span>
</span><span id="L-1932"><a href="#L-1932"><span class="linenos">1932</span></a><span class="sd">        An extra identifying tag to add to the accuracy filename.</span>
</span><span id="L-1933"><a href="#L-1933"><span class="linenos">1933</span></a><span class="sd">    testerror : bool (optional), default=False</span>
</span><span id="L-1934"><a href="#L-1934"><span class="linenos">1934</span></a><span class="sd">        Show test error (instead of accuracy) in the table.</span>
</span><span id="L-1935"><a href="#L-1935"><span class="linenos">1935</span></a><span class="sd">    savefile : str (optional), default=&#39;table.tex&#39;</span>
</span><span id="L-1936"><a href="#L-1936"><span class="linenos">1936</span></a><span class="sd">        Filename to save tex code for table.</span>
</span><span id="L-1937"><a href="#L-1937"><span class="linenos">1937</span></a><span class="sd">    title : str (optional), default=&#39;&#39;</span>
</span><span id="L-1938"><a href="#L-1938"><span class="linenos">1938</span></a><span class="sd">        Title for table.</span>
</span><span id="L-1939"><a href="#L-1939"><span class="linenos">1939</span></a><span class="sd">    append : bool (optional), default=False</span>
</span><span id="L-1940"><a href="#L-1940"><span class="linenos">1940</span></a><span class="sd">        Whether to create a new tex file or append table to existing file.</span>
</span><span id="L-1941"><a href="#L-1941"><span class="linenos">1941</span></a><span class="sd">    fontsize : str (optional), default=&#39;small&#39;</span>
</span><span id="L-1942"><a href="#L-1942"><span class="linenos">1942</span></a><span class="sd">        LaTeX font size.</span>
</span><span id="L-1943"><a href="#L-1943"><span class="linenos">1943</span></a><span class="sd">    small_caps : bool (optional), default=True</span>
</span><span id="L-1944"><a href="#L-1944"><span class="linenos">1944</span></a><span class="sd">        Whether to use small caps in LaTeX for table.</span>
</span><span id="L-1945"><a href="#L-1945"><span class="linenos">1945</span></a><span class="sd">    two_column : bool (optional), default=True</span>
</span><span id="L-1946"><a href="#L-1946"><span class="linenos">1946</span></a><span class="sd">        Whether the table will be in a two-column LaTeX document.</span>
</span><span id="L-1947"><a href="#L-1947"><span class="linenos">1947</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1948"><a href="#L-1948"><span class="linenos">1948</span></a>
</span><span id="L-1949"><a href="#L-1949"><span class="linenos">1949</span></a>
</span><span id="L-1950"><a href="#L-1950"><span class="linenos">1950</span></a>    <span class="n">num_train</span><span class="p">,</span><span class="n">acc_mean</span><span class="p">,</span><span class="n">acc_stddev</span><span class="p">,</span><span class="n">num_trials</span> <span class="o">=</span> <span class="n">model_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">trials_statistics</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-1951"><a href="#L-1951"><span class="linenos">1951</span></a>    <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">num_train</span><span class="p">)</span>
</span><span id="L-1952"><a href="#L-1952"><span class="linenos">1952</span></a>
</span><span id="L-1953"><a href="#L-1953"><span class="linenos">1953</span></a>    <span class="c1">#Determine best algorithm at each label rate</span>
</span><span id="L-1954"><a href="#L-1954"><span class="linenos">1954</span></a>    <span class="n">best</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="n">m</span>
</span><span id="L-1955"><a href="#L-1955"><span class="linenos">1955</span></a>    <span class="n">class_priors_best</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span><span class="o">*</span><span class="n">m</span>
</span><span id="L-1956"><a href="#L-1956"><span class="linenos">1956</span></a>    <span class="n">best_score</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">m</span>
</span><span id="L-1957"><a href="#L-1957"><span class="linenos">1957</span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model_list</span><span class="p">):</span>
</span><span id="L-1958"><a href="#L-1958"><span class="linenos">1958</span></a>        <span class="n">num_train</span><span class="p">,</span><span class="n">acc_mean</span><span class="p">,</span><span class="n">acc_stddev</span><span class="p">,</span><span class="n">num_trials</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">trials_statistics</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-1959"><a href="#L-1959"><span class="linenos">1959</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
</span><span id="L-1960"><a href="#L-1960"><span class="linenos">1960</span></a>            <span class="k">if</span> <span class="n">acc_mean</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">best_score</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
</span><span id="L-1961"><a href="#L-1961"><span class="linenos">1961</span></a>                <span class="n">best_score</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">acc_mean</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1962"><a href="#L-1962"><span class="linenos">1962</span></a>                <span class="n">best</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="L-1963"><a href="#L-1963"><span class="linenos">1963</span></a>
</span><span id="L-1964"><a href="#L-1964"><span class="linenos">1964</span></a>        <span class="c1">#Check if class priors accuracy was included as well</span>
</span><span id="L-1965"><a href="#L-1965"><span class="linenos">1965</span></a>        <span class="k">if</span> <span class="n">acc_mean</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1966"><a href="#L-1966"><span class="linenos">1966</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
</span><span id="L-1967"><a href="#L-1967"><span class="linenos">1967</span></a>                <span class="k">if</span> <span class="n">acc_mean</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">best_score</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
</span><span id="L-1968"><a href="#L-1968"><span class="linenos">1968</span></a>                    <span class="n">best_score</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">acc_mean</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1969"><a href="#L-1969"><span class="linenos">1969</span></a>                    <span class="n">class_priors_best</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1970"><a href="#L-1970"><span class="linenos">1970</span></a>                    <span class="n">best</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="L-1971"><a href="#L-1971"><span class="linenos">1971</span></a>
</span><span id="L-1972"><a href="#L-1972"><span class="linenos">1972</span></a>    
</span><span id="L-1973"><a href="#L-1973"><span class="linenos">1973</span></a>    <span class="k">if</span> <span class="n">append</span><span class="p">:</span>
</span><span id="L-1974"><a href="#L-1974"><span class="linenos">1974</span></a>        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">savefile</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
</span><span id="L-1975"><a href="#L-1975"><span class="linenos">1975</span></a>        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</span><span id="L-1976"><a href="#L-1976"><span class="linenos">1976</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-1977"><a href="#L-1977"><span class="linenos">1977</span></a>        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">savefile</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="L-1978"><a href="#L-1978"><span class="linenos">1978</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
</span><span id="L-1979"><a href="#L-1979"><span class="linenos">1979</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1980"><a href="#L-1980"><span class="linenos">1980</span></a>        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">savefile</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="L-1981"><a href="#L-1981"><span class="linenos">1981</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">documentclass</span><span class="si">{article}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1982"><a href="#L-1982"><span class="linenos">1982</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">usepackage[T1]</span><span class="si">{fontenc}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1983"><a href="#L-1983"><span class="linenos">1983</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">usepackage</span><span class="si">{booktabs}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1984"><a href="#L-1984"><span class="linenos">1984</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">usepackage[margin=1in]</span><span class="si">{geometry}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1985"><a href="#L-1985"><span class="linenos">1985</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin</span><span class="si">{document}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1986"><a href="#L-1986"><span class="linenos">1986</span></a>
</span><span id="L-1987"><a href="#L-1987"><span class="linenos">1987</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1988"><a href="#L-1988"><span class="linenos">1988</span></a>    <span class="k">if</span> <span class="n">two_column</span><span class="p">:</span>
</span><span id="L-1989"><a href="#L-1989"><span class="linenos">1989</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin{table*}[t!]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1990"><a href="#L-1990"><span class="linenos">1990</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1991"><a href="#L-1991"><span class="linenos">1991</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin</span><span class="si">{table}</span><span class="s2">[t!]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1992"><a href="#L-1992"><span class="linenos">1992</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">vspace{-3mm}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1993"><a href="#L-1993"><span class="linenos">1993</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">caption{&quot;</span><span class="o">+</span><span class="n">title</span><span class="o">+</span><span class="s2">&quot;: Average (standard deviation) classification accuracy over </span><span class="si">%d</span><span class="s2"> trials.}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">num_trials</span><span class="p">)</span>
</span><span id="L-1994"><a href="#L-1994"><span class="linenos">1994</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">vspace{-3mm}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1995"><a href="#L-1995"><span class="linenos">1995</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">label{tab:&quot;</span><span class="o">+</span><span class="n">title</span><span class="o">+</span><span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1996"><a href="#L-1996"><span class="linenos">1996</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">vskip 0.15in</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1997"><a href="#L-1997"><span class="linenos">1997</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin</span><span class="si">{center}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1998"><a href="#L-1998"><span class="linenos">1998</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin{&quot;</span><span class="o">+</span><span class="n">fontsize</span><span class="o">+</span><span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1999"><a href="#L-1999"><span class="linenos">1999</span></a>    <span class="k">if</span> <span class="n">small_caps</span><span class="p">:</span>
</span><span id="L-2000"><a href="#L-2000"><span class="linenos">2000</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin</span><span class="si">{sc}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2001"><a href="#L-2001"><span class="linenos">2001</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin</span><span class="si">{tabular}</span><span class="s2">{l&quot;</span><span class="p">)</span>
</span><span id="L-2002"><a href="#L-2002"><span class="linenos">2002</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
</span><span id="L-2003"><a href="#L-2003"><span class="linenos">2003</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">)</span>
</span><span id="L-2004"><a href="#L-2004"><span class="linenos">2004</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2005"><a href="#L-2005"><span class="linenos">2005</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">toprule</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2006"><a href="#L-2006"><span class="linenos">2006</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2"># Labels&quot;</span><span class="p">)</span>
</span><span id="L-2007"><a href="#L-2007"><span class="linenos">2007</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
</span><span id="L-2008"><a href="#L-2008"><span class="linenos">2008</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&amp;</span><span class="se">\\</span><span class="s2">textbf{</span><span class="si">%d</span><span class="s2">}&quot;</span><span class="o">%</span><span class="nb">int</span><span class="p">(</span><span class="n">num_train</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span><span id="L-2009"><a href="#L-2009"><span class="linenos">2009</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\\\\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2010"><a href="#L-2010"><span class="linenos">2010</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">midrule</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2011"><a href="#L-2011"><span class="linenos">2011</span></a>    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2012"><a href="#L-2012"><span class="linenos">2012</span></a>
</span><span id="L-2013"><a href="#L-2013"><span class="linenos">2013</span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model_list</span><span class="p">):</span>
</span><span id="L-2014"><a href="#L-2014"><span class="linenos">2014</span></a>        <span class="n">num_train</span><span class="p">,</span><span class="n">acc_mean</span><span class="p">,</span><span class="n">acc_stddev</span><span class="p">,</span><span class="n">num_trials</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">trials_statistics</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-2015"><a href="#L-2015"><span class="linenos">2015</span></a>
</span><span id="L-2016"><a href="#L-2016"><span class="linenos">2016</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>
</span><span id="L-2017"><a href="#L-2017"><span class="linenos">2017</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
</span><span id="L-2018"><a href="#L-2018"><span class="linenos">2018</span></a>            <span class="k">if</span> <span class="n">best</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">class_priors_best</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span> 
</span><span id="L-2019"><a href="#L-2019"><span class="linenos">2019</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&amp;{</span><span class="se">\\</span><span class="s2">bf </span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">acc_mean</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot; (</span><span class="si">%.1f</span><span class="s2">)}&quot;</span><span class="o">%</span><span class="n">acc_stddev</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-2020"><a href="#L-2020"><span class="linenos">2020</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2021"><a href="#L-2021"><span class="linenos">2021</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&amp;</span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">acc_mean</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot; (</span><span class="si">%.1f</span><span class="s2">)      &quot;</span><span class="o">%</span><span class="n">acc_stddev</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-2022"><a href="#L-2022"><span class="linenos">2022</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\\\\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2023"><a href="#L-2023"><span class="linenos">2023</span></a>        
</span><span id="L-2024"><a href="#L-2024"><span class="linenos">2024</span></a>        <span class="c1">#Check if class priors accuracy was included as well</span>
</span><span id="L-2025"><a href="#L-2025"><span class="linenos">2025</span></a>        <span class="k">if</span> <span class="n">acc_mean</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2026"><a href="#L-2026"><span class="linenos">2026</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;+CP&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>
</span><span id="L-2027"><a href="#L-2027"><span class="linenos">2027</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
</span><span id="L-2028"><a href="#L-2028"><span class="linenos">2028</span></a>                <span class="k">if</span> <span class="n">best</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span> <span class="ow">and</span> <span class="n">class_priors_best</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span> 
</span><span id="L-2029"><a href="#L-2029"><span class="linenos">2029</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&amp;{</span><span class="se">\\</span><span class="s2">bf </span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">acc_mean</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot; (</span><span class="si">%.1f</span><span class="s2">)}&quot;</span><span class="o">%</span><span class="n">acc_stddev</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-2030"><a href="#L-2030"><span class="linenos">2030</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2031"><a href="#L-2031"><span class="linenos">2031</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&amp;</span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">acc_mean</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot; (</span><span class="si">%.1f</span><span class="s2">)      &quot;</span><span class="o">%</span><span class="n">acc_stddev</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-2032"><a href="#L-2032"><span class="linenos">2032</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\\\\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2033"><a href="#L-2033"><span class="linenos">2033</span></a>
</span><span id="L-2034"><a href="#L-2034"><span class="linenos">2034</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bottomrule</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2035"><a href="#L-2035"><span class="linenos">2035</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">end</span><span class="si">{tabular}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2036"><a href="#L-2036"><span class="linenos">2036</span></a>    <span class="k">if</span> <span class="n">small_caps</span><span class="p">:</span>
</span><span id="L-2037"><a href="#L-2037"><span class="linenos">2037</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">end</span><span class="si">{sc}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2038"><a href="#L-2038"><span class="linenos">2038</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">end{&quot;</span><span class="o">+</span><span class="n">fontsize</span><span class="o">+</span><span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2039"><a href="#L-2039"><span class="linenos">2039</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">end</span><span class="si">{center}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2040"><a href="#L-2040"><span class="linenos">2040</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">vskip -0.1in</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2041"><a href="#L-2041"><span class="linenos">2041</span></a>    <span class="k">if</span> <span class="n">two_column</span><span class="p">:</span>
</span><span id="L-2042"><a href="#L-2042"><span class="linenos">2042</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">end{table*}&quot;</span><span class="p">)</span>
</span><span id="L-2043"><a href="#L-2043"><span class="linenos">2043</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-2044"><a href="#L-2044"><span class="linenos">2044</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">end</span><span class="si">{table}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2045"><a href="#L-2045"><span class="linenos">2045</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2046"><a href="#L-2046"><span class="linenos">2046</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">end</span><span class="si">{document}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2047"><a href="#L-2047"><span class="linenos">2047</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></pre></div>


            </section>
                <section id="results_dir">
                    <div class="attr variable">
            <span class="name">results_dir</span>        =
<span class="default_value">&#39;/Users/jwcalder/Dropbox/Work/Code/GraphLearning/results&#39;</span>

        
    </div>
    <a class="headerlink" href="#results_dir"></a>
    
    

                </section>
                <section id="ssl">
                            <input id="ssl-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ssl</span>:

                <label class="view-source-button" for="ssl-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ssl"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ssl-132"><a href="#ssl-132"><span class="linenos">132</span></a><span class="k">class</span> <span class="nc">ssl</span><span class="p">:</span>
</span><span id="ssl-133"><a href="#ssl-133"><span class="linenos">133</span></a>    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>
</span><span id="ssl-134"><a href="#ssl-134"><span class="linenos">134</span></a>
</span><span id="ssl-135"><a href="#ssl-135"><span class="linenos">135</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">):</span>
</span><span id="ssl-136"><a href="#ssl-136"><span class="linenos">136</span></a>        <span class="k">if</span> <span class="n">W</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ssl-137"><a href="#ssl-137"><span class="linenos">137</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ssl-138"><a href="#ssl-138"><span class="linenos">138</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ssl-139"><a href="#ssl-139"><span class="linenos">139</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_graph</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</span><span id="ssl-140"><a href="#ssl-140"><span class="linenos">140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ssl-141"><a href="#ssl-141"><span class="linenos">141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fitted</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ssl-142"><a href="#ssl-142"><span class="linenos">142</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="ssl-143"><a href="#ssl-143"><span class="linenos">143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="ssl-144"><a href="#ssl-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">requires_eig</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ssl-145"><a href="#ssl-145"><span class="linenos">145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onevsrest</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ssl-146"><a href="#ssl-146"><span class="linenos">146</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">similarity</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ssl-147"><a href="#ssl-147"><span class="linenos">147</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="o">=</span> <span class="n">class_priors</span>
</span><span id="ssl-148"><a href="#ssl-148"><span class="linenos">148</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ssl-149"><a href="#ssl-149"><span class="linenos">149</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span><span class="p">)</span>
</span><span id="ssl-150"><a href="#ssl-150"><span class="linenos">150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="ssl-151"><a href="#ssl-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">class_priors_error</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="ssl-152"><a href="#ssl-152"><span class="linenos">152</span></a>
</span><span id="ssl-153"><a href="#ssl-153"><span class="linenos">153</span></a>    <span class="k">def</span> <span class="nf">set_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
</span><span id="ssl-154"><a href="#ssl-154"><span class="linenos">154</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set Graph</span>
</span><span id="ssl-155"><a href="#ssl-155"><span class="linenos">155</span></a><span class="sd">        ===================</span>
</span><span id="ssl-156"><a href="#ssl-156"><span class="linenos">156</span></a>
</span><span id="ssl-157"><a href="#ssl-157"><span class="linenos">157</span></a><span class="sd">        Sets the graph object for semi-supervised learning.</span>
</span><span id="ssl-158"><a href="#ssl-158"><span class="linenos">158</span></a>
</span><span id="ssl-159"><a href="#ssl-159"><span class="linenos">159</span></a><span class="sd">        Implements 3 different solvers, spectral, gradient_descent, and conjugate_gradient. </span>
</span><span id="ssl-160"><a href="#ssl-160"><span class="linenos">160</span></a><span class="sd">        GPU acceleration is available for gradient descent. See [1] for details.</span>
</span><span id="ssl-161"><a href="#ssl-161"><span class="linenos">161</span></a>
</span><span id="ssl-162"><a href="#ssl-162"><span class="linenos">162</span></a><span class="sd">        Parameters</span>
</span><span id="ssl-163"><a href="#ssl-163"><span class="linenos">163</span></a><span class="sd">        ----------</span>
</span><span id="ssl-164"><a href="#ssl-164"><span class="linenos">164</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="ssl-165"><a href="#ssl-165"><span class="linenos">165</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="ssl-166"><a href="#ssl-166"><span class="linenos">166</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ssl-167"><a href="#ssl-167"><span class="linenos">167</span></a>
</span><span id="ssl-168"><a href="#ssl-168"><span class="linenos">168</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">==</span> <span class="n">graph</span><span class="o">.</span><span class="n">graph</span><span class="p">:</span>
</span><span id="ssl-169"><a href="#ssl-169"><span class="linenos">169</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">W</span>
</span><span id="ssl-170"><a href="#ssl-170"><span class="linenos">170</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ssl-171"><a href="#ssl-171"><span class="linenos">171</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">graph</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</span><span id="ssl-172"><a href="#ssl-172"><span class="linenos">172</span></a>
</span><span id="ssl-173"><a href="#ssl-173"><span class="linenos">173</span></a>    <span class="k">def</span> <span class="nf">volume_label_projection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ssl-174"><a href="#ssl-174"><span class="linenos">174</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Volume label projection</span>
</span><span id="ssl-175"><a href="#ssl-175"><span class="linenos">175</span></a><span class="sd">        ======</span>
</span><span id="ssl-176"><a href="#ssl-176"><span class="linenos">176</span></a><span class="sd">    </span>
</span><span id="ssl-177"><a href="#ssl-177"><span class="linenos">177</span></a><span class="sd">        Projects class probabilities to labels while enforcing a constraint on </span>
</span><span id="ssl-178"><a href="#ssl-178"><span class="linenos">178</span></a><span class="sd">        class priors (i.e., class volumes). Does not return anything, just modifies `self.weights`.</span>
</span><span id="ssl-179"><a href="#ssl-179"><span class="linenos">179</span></a><span class="sd">        </span>
</span><span id="ssl-180"><a href="#ssl-180"><span class="linenos">180</span></a><span class="sd">        Returns</span>
</span><span id="ssl-181"><a href="#ssl-181"><span class="linenos">181</span></a><span class="sd">        -------</span>
</span><span id="ssl-182"><a href="#ssl-182"><span class="linenos">182</span></a><span class="sd">        labels : numpy array (int)</span>
</span><span id="ssl-183"><a href="#ssl-183"><span class="linenos">183</span></a><span class="sd">            Predicted labels after volume correction.</span>
</span><span id="ssl-184"><a href="#ssl-184"><span class="linenos">184</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ssl-185"><a href="#ssl-185"><span class="linenos">185</span></a>
</span><span id="ssl-186"><a href="#ssl-186"><span class="linenos">186</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span>
</span><span id="ssl-187"><a href="#ssl-187"><span class="linenos">187</span></a>        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ssl-188"><a href="#ssl-188"><span class="linenos">188</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ssl-189"><a href="#ssl-189"><span class="linenos">189</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">k</span><span class="p">,))</span>
</span><span id="ssl-190"><a href="#ssl-190"><span class="linenos">190</span></a>
</span><span id="ssl-191"><a href="#ssl-191"><span class="linenos">191</span></a>        <span class="c1">#Time step</span>
</span><span id="ssl-192"><a href="#ssl-192"><span class="linenos">192</span></a>        <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span>
</span><span id="ssl-193"><a href="#ssl-193"><span class="linenos">193</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarity</span><span class="p">:</span>
</span><span id="ssl-194"><a href="#ssl-194"><span class="linenos">194</span></a>            <span class="n">dt</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="ssl-195"><a href="#ssl-195"><span class="linenos">195</span></a>
</span><span id="ssl-196"><a href="#ssl-196"><span class="linenos">196</span></a>        <span class="c1">#np.set_printoptions(formatter={&#39;float&#39;: lambda x: &quot;{0:0.3f}&quot;.format(x)})</span>
</span><span id="ssl-197"><a href="#ssl-197"><span class="linenos">197</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ssl-198"><a href="#ssl-198"><span class="linenos">198</span></a>        <span class="n">err</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="ssl-199"><a href="#ssl-199"><span class="linenos">199</span></a>        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mf">1e4</span> <span class="ow">and</span> <span class="n">err</span> <span class="o">&gt;</span> <span class="mf">1e-3</span><span class="p">:</span>
</span><span id="ssl-200"><a href="#ssl-200"><span class="linenos">200</span></a>            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ssl-201"><a href="#ssl-201"><span class="linenos">201</span></a>            <span class="n">class_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="ssl-202"><a href="#ssl-202"><span class="linenos">202</span></a>            <span class="c1">#print(class_size-self.class_priors)</span>
</span><span id="ssl-203"><a href="#ssl-203"><span class="linenos">203</span></a>            <span class="n">grad</span> <span class="o">=</span> <span class="n">class_size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span>
</span><span id="ssl-204"><a href="#ssl-204"><span class="linenos">204</span></a>            <span class="n">err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">grad</span><span class="p">))</span>
</span><span id="ssl-205"><a href="#ssl-205"><span class="linenos">205</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">+=</span> <span class="n">dt</span><span class="o">*</span><span class="n">grad</span>
</span><span id="ssl-206"><a href="#ssl-206"><span class="linenos">206</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ssl-207"><a href="#ssl-207"><span class="linenos">207</span></a>
</span><span id="ssl-208"><a href="#ssl-208"><span class="linenos">208</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">class_priors_error</span> <span class="o">=</span> <span class="n">err</span>
</span><span id="ssl-209"><a href="#ssl-209"><span class="linenos">209</span></a>
</span><span id="ssl-210"><a href="#ssl-210"><span class="linenos">210</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</span><span id="ssl-211"><a href="#ssl-211"><span class="linenos">211</span></a>
</span><span id="ssl-212"><a href="#ssl-212"><span class="linenos">212</span></a>    <span class="k">def</span> <span class="nf">get_accuracy_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ssl-213"><a href="#ssl-213"><span class="linenos">213</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get accuracy filename</span>
</span><span id="ssl-214"><a href="#ssl-214"><span class="linenos">214</span></a><span class="sd">        ========</span>
</span><span id="ssl-215"><a href="#ssl-215"><span class="linenos">215</span></a>
</span><span id="ssl-216"><a href="#ssl-216"><span class="linenos">216</span></a><span class="sd">        Returns name of the file that will store the accuracy results for `ssl_trials.py`.</span>
</span><span id="ssl-217"><a href="#ssl-217"><span class="linenos">217</span></a>
</span><span id="ssl-218"><a href="#ssl-218"><span class="linenos">218</span></a><span class="sd">        Returns</span>
</span><span id="ssl-219"><a href="#ssl-219"><span class="linenos">219</span></a><span class="sd">        -------</span>
</span><span id="ssl-220"><a href="#ssl-220"><span class="linenos">220</span></a><span class="sd">        fname : str</span>
</span><span id="ssl-221"><a href="#ssl-221"><span class="linenos">221</span></a><span class="sd">            Accuracy filename.</span>
</span><span id="ssl-222"><a href="#ssl-222"><span class="linenos">222</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ssl-223"><a href="#ssl-223"><span class="linenos">223</span></a>
</span><span id="ssl-224"><a href="#ssl-224"><span class="linenos">224</span></a>        <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span>
</span><span id="ssl-225"><a href="#ssl-225"><span class="linenos">225</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ssl-226"><a href="#ssl-226"><span class="linenos">226</span></a>            <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_classpriors&#39;</span>
</span><span id="ssl-227"><a href="#ssl-227"><span class="linenos">227</span></a>        <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_accuracy.csv&#39;</span>
</span><span id="ssl-228"><a href="#ssl-228"><span class="linenos">228</span></a>        <span class="k">return</span> <span class="n">fname</span>
</span><span id="ssl-229"><a href="#ssl-229"><span class="linenos">229</span></a>
</span><span id="ssl-230"><a href="#ssl-230"><span class="linenos">230</span></a>
</span><span id="ssl-231"><a href="#ssl-231"><span class="linenos">231</span></a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignore_class_priors</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="ssl-232"><a href="#ssl-232"><span class="linenos">232</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Predict</span>
</span><span id="ssl-233"><a href="#ssl-233"><span class="linenos">233</span></a><span class="sd">        ========</span>
</span><span id="ssl-234"><a href="#ssl-234"><span class="linenos">234</span></a>
</span><span id="ssl-235"><a href="#ssl-235"><span class="linenos">235</span></a><span class="sd">        Makes label predictions based on the probabilities computed by `fit()`.</span>
</span><span id="ssl-236"><a href="#ssl-236"><span class="linenos">236</span></a><span class="sd">        Will use a volume label projection if `class_priors` were given, to ensure </span>
</span><span id="ssl-237"><a href="#ssl-237"><span class="linenos">237</span></a><span class="sd">        the number of nodes predicted in each class is correct.</span>
</span><span id="ssl-238"><a href="#ssl-238"><span class="linenos">238</span></a><span class="sd">        </span>
</span><span id="ssl-239"><a href="#ssl-239"><span class="linenos">239</span></a><span class="sd">        Parameters</span>
</span><span id="ssl-240"><a href="#ssl-240"><span class="linenos">240</span></a><span class="sd">        ----------</span>
</span><span id="ssl-241"><a href="#ssl-241"><span class="linenos">241</span></a><span class="sd">        ignore_class_priors : bool (optional), default=False</span>
</span><span id="ssl-242"><a href="#ssl-242"><span class="linenos">242</span></a><span class="sd">            Used to disable the volume constrained label decision, when `class_priors` has been provided. </span>
</span><span id="ssl-243"><a href="#ssl-243"><span class="linenos">243</span></a>
</span><span id="ssl-244"><a href="#ssl-244"><span class="linenos">244</span></a><span class="sd">        Returns</span>
</span><span id="ssl-245"><a href="#ssl-245"><span class="linenos">245</span></a><span class="sd">        -------</span>
</span><span id="ssl-246"><a href="#ssl-246"><span class="linenos">246</span></a><span class="sd">        pred_labels : (int) numpy array</span>
</span><span id="ssl-247"><a href="#ssl-247"><span class="linenos">247</span></a><span class="sd">            Predicted labels as integers for all datapoints in the graph.</span>
</span><span id="ssl-248"><a href="#ssl-248"><span class="linenos">248</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ssl-249"><a href="#ssl-249"><span class="linenos">249</span></a>
</span><span id="ssl-250"><a href="#ssl-250"><span class="linenos">250</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitted</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="ssl-251"><a href="#ssl-251"><span class="linenos">251</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Model has not been fitted yet.&#39;</span><span class="p">)</span>
</span><span id="ssl-252"><a href="#ssl-252"><span class="linenos">252</span></a>
</span><span id="ssl-253"><a href="#ssl-253"><span class="linenos">253</span></a>        <span class="k">if</span> <span class="n">ignore_class_priors</span><span class="p">:</span>
</span><span id="ssl-254"><a href="#ssl-254"><span class="linenos">254</span></a>            <span class="n">w</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="ssl-255"><a href="#ssl-255"><span class="linenos">255</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ssl-256"><a href="#ssl-256"><span class="linenos">256</span></a>            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span>
</span><span id="ssl-257"><a href="#ssl-257"><span class="linenos">257</span></a>
</span><span id="ssl-258"><a href="#ssl-258"><span class="linenos">258</span></a>        <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prob</span><span class="p">)</span>
</span><span id="ssl-259"><a href="#ssl-259"><span class="linenos">259</span></a>        <span class="n">scores</span> <span class="o">=</span> <span class="n">scores</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
</span><span id="ssl-260"><a href="#ssl-260"><span class="linenos">260</span></a>
</span><span id="ssl-261"><a href="#ssl-261"><span class="linenos">261</span></a>        <span class="c1">#Check if scores are similarity or distance</span>
</span><span id="ssl-262"><a href="#ssl-262"><span class="linenos">262</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarity</span><span class="p">:</span>
</span><span id="ssl-263"><a href="#ssl-263"><span class="linenos">263</span></a>            <span class="n">pred_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">scores</span><span class="o">*</span><span class="n">w</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ssl-264"><a href="#ssl-264"><span class="linenos">264</span></a>        <span class="k">else</span><span class="p">:</span> <span class="c1">#Then distances</span>
</span><span id="ssl-265"><a href="#ssl-265"><span class="linenos">265</span></a>            <span class="n">pred_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">scores</span><span class="o">*</span><span class="n">w</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ssl-266"><a href="#ssl-266"><span class="linenos">266</span></a>
</span><span id="ssl-267"><a href="#ssl-267"><span class="linenos">267</span></a>        <span class="k">return</span> <span class="n">pred_labels</span> 
</span><span id="ssl-268"><a href="#ssl-268"><span class="linenos">268</span></a>
</span><span id="ssl-269"><a href="#ssl-269"><span class="linenos">269</span></a>    <span class="k">def</span> <span class="nf">fit_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="ssl-270"><a href="#ssl-270"><span class="linenos">270</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit and predict</span>
</span><span id="ssl-271"><a href="#ssl-271"><span class="linenos">271</span></a><span class="sd">        ======</span>
</span><span id="ssl-272"><a href="#ssl-272"><span class="linenos">272</span></a>
</span><span id="ssl-273"><a href="#ssl-273"><span class="linenos">273</span></a><span class="sd">        Calls fit() and predict() sequentially.</span>
</span><span id="ssl-274"><a href="#ssl-274"><span class="linenos">274</span></a>
</span><span id="ssl-275"><a href="#ssl-275"><span class="linenos">275</span></a><span class="sd">        Parameters</span>
</span><span id="ssl-276"><a href="#ssl-276"><span class="linenos">276</span></a><span class="sd">        ----------</span>
</span><span id="ssl-277"><a href="#ssl-277"><span class="linenos">277</span></a><span class="sd">        train_ind : numpy array, int</span>
</span><span id="ssl-278"><a href="#ssl-278"><span class="linenos">278</span></a><span class="sd">            Indicies of training points.</span>
</span><span id="ssl-279"><a href="#ssl-279"><span class="linenos">279</span></a><span class="sd">        train_labels : numpy array, int</span>
</span><span id="ssl-280"><a href="#ssl-280"><span class="linenos">280</span></a><span class="sd">            Training labels as integers \\(0,1,\\dots,k-1\\) for \\(k\\) classes.</span>
</span><span id="ssl-281"><a href="#ssl-281"><span class="linenos">281</span></a><span class="sd">        all_labels : numpy array, int (optional)</span>
</span><span id="ssl-282"><a href="#ssl-282"><span class="linenos">282</span></a><span class="sd">            True labels for all datapoints.</span>
</span><span id="ssl-283"><a href="#ssl-283"><span class="linenos">283</span></a>
</span><span id="ssl-284"><a href="#ssl-284"><span class="linenos">284</span></a><span class="sd">        Returns</span>
</span><span id="ssl-285"><a href="#ssl-285"><span class="linenos">285</span></a><span class="sd">        -------</span>
</span><span id="ssl-286"><a href="#ssl-286"><span class="linenos">286</span></a><span class="sd">        pred_labels : (int) numpy array</span>
</span><span id="ssl-287"><a href="#ssl-287"><span class="linenos">287</span></a><span class="sd">            Predicted labels as integers for all datapoints in the graph.</span>
</span><span id="ssl-288"><a href="#ssl-288"><span class="linenos">288</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ssl-289"><a href="#ssl-289"><span class="linenos">289</span></a>
</span><span id="ssl-290"><a href="#ssl-290"><span class="linenos">290</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="n">all_labels</span><span class="p">)</span>
</span><span id="ssl-291"><a href="#ssl-291"><span class="linenos">291</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</span><span id="ssl-292"><a href="#ssl-292"><span class="linenos">292</span></a>
</span><span id="ssl-293"><a href="#ssl-293"><span class="linenos">293</span></a>    <span class="k">def</span> <span class="nf">ssl_trials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trainsets</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">num_cores</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">save_results</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_trials</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="ssl-294"><a href="#ssl-294"><span class="linenos">294</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Semi-supervised learning trials</span>
</span><span id="ssl-295"><a href="#ssl-295"><span class="linenos">295</span></a><span class="sd">        ===================</span>
</span><span id="ssl-296"><a href="#ssl-296"><span class="linenos">296</span></a>
</span><span id="ssl-297"><a href="#ssl-297"><span class="linenos">297</span></a><span class="sd">        Runs a semi-supervised learning algorithm on a list of training sets,</span>
</span><span id="ssl-298"><a href="#ssl-298"><span class="linenos">298</span></a><span class="sd">        recording the label rates and saves the results to a csv file in the</span>
</span><span id="ssl-299"><a href="#ssl-299"><span class="linenos">299</span></a><span class="sd">        local folder results/. The filename is controlled by the member function</span>
</span><span id="ssl-300"><a href="#ssl-300"><span class="linenos">300</span></a><span class="sd">        model.get_accuracy_filename(). The trial will abort if the accuracy result</span>
</span><span id="ssl-301"><a href="#ssl-301"><span class="linenos">301</span></a><span class="sd">        file already exists, unless `overwrite=True`.</span>
</span><span id="ssl-302"><a href="#ssl-302"><span class="linenos">302</span></a>
</span><span id="ssl-303"><a href="#ssl-303"><span class="linenos">303</span></a><span class="sd">        Parameters</span>
</span><span id="ssl-304"><a href="#ssl-304"><span class="linenos">304</span></a><span class="sd">        ----------</span>
</span><span id="ssl-305"><a href="#ssl-305"><span class="linenos">305</span></a><span class="sd">        trainsets : list of numpy arrays</span>
</span><span id="ssl-306"><a href="#ssl-306"><span class="linenos">306</span></a><span class="sd">            Collection of training sets to run semi-supervised learning on. This is the output</span>
</span><span id="ssl-307"><a href="#ssl-307"><span class="linenos">307</span></a><span class="sd">            of `graphlearning.trainsets.generate` or `graphlearning.trainsets.load`.</span>
</span><span id="ssl-308"><a href="#ssl-308"><span class="linenos">308</span></a><span class="sd">        labels : numpy array (int)</span>
</span><span id="ssl-309"><a href="#ssl-309"><span class="linenos">309</span></a><span class="sd">            Integer array of labels for entire dataset.</span>
</span><span id="ssl-310"><a href="#ssl-310"><span class="linenos">310</span></a><span class="sd">        num_cores : int</span>
</span><span id="ssl-311"><a href="#ssl-311"><span class="linenos">311</span></a><span class="sd">            Number of cores to use for parallel processing over trials</span>
</span><span id="ssl-312"><a href="#ssl-312"><span class="linenos">312</span></a><span class="sd">        tag : str (optional), default=&#39;&#39;</span>
</span><span id="ssl-313"><a href="#ssl-313"><span class="linenos">313</span></a><span class="sd">            An extra identifying tag to add to the accuracy filename.</span>
</span><span id="ssl-314"><a href="#ssl-314"><span class="linenos">314</span></a><span class="sd">        save_results : bool (optional), default=True</span>
</span><span id="ssl-315"><a href="#ssl-315"><span class="linenos">315</span></a><span class="sd">            Whether to save results to csv file or just print to the screen.</span>
</span><span id="ssl-316"><a href="#ssl-316"><span class="linenos">316</span></a><span class="sd">        overwrite : bool (optional), default = False</span>
</span><span id="ssl-317"><a href="#ssl-317"><span class="linenos">317</span></a><span class="sd">            Whether to overwrite existing results file, if found. If `overwrite=False`, </span>
</span><span id="ssl-318"><a href="#ssl-318"><span class="linenos">318</span></a><span class="sd">            `save_results=True`, and the results file is found, the trial is aborted.</span>
</span><span id="ssl-319"><a href="#ssl-319"><span class="linenos">319</span></a><span class="sd">        num_trials: int (optional), defualt = -1</span>
</span><span id="ssl-320"><a href="#ssl-320"><span class="linenos">320</span></a><span class="sd">            Number of trials. Any negative number runs all trials.</span>
</span><span id="ssl-321"><a href="#ssl-321"><span class="linenos">321</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ssl-322"><a href="#ssl-322"><span class="linenos">322</span></a>
</span><span id="ssl-323"><a href="#ssl-323"><span class="linenos">323</span></a>        <span class="k">if</span> <span class="n">num_trials</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ssl-324"><a href="#ssl-324"><span class="linenos">324</span></a>            <span class="n">trainsets</span> <span class="o">=</span> <span class="n">trainsets</span><span class="p">[:</span><span class="n">num_trials</span><span class="p">]</span>
</span><span id="ssl-325"><a href="#ssl-325"><span class="linenos">325</span></a>
</span><span id="ssl-326"><a href="#ssl-326"><span class="linenos">326</span></a>        <span class="c1">#Print name</span>
</span><span id="ssl-327"><a href="#ssl-327"><span class="linenos">327</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Model: &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="ssl-328"><a href="#ssl-328"><span class="linenos">328</span></a>
</span><span id="ssl-329"><a href="#ssl-329"><span class="linenos">329</span></a>        <span class="k">if</span> <span class="n">save_results</span><span class="p">:</span>
</span><span id="ssl-330"><a href="#ssl-330"><span class="linenos">330</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">results_dir</span><span class="p">):</span>
</span><span id="ssl-331"><a href="#ssl-331"><span class="linenos">331</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">results_dir</span><span class="p">)</span>
</span><span id="ssl-332"><a href="#ssl-332"><span class="linenos">332</span></a>
</span><span id="ssl-333"><a href="#ssl-333"><span class="linenos">333</span></a>            <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="n">tag</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_accuracy_filename</span><span class="p">())</span>
</span><span id="ssl-334"><a href="#ssl-334"><span class="linenos">334</span></a>            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">overwrite</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outfile</span><span class="p">):</span>
</span><span id="ssl-335"><a href="#ssl-335"><span class="linenos">335</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Aborting: SSL trial already completed, and overwrite is False.&#39;</span><span class="p">)</span>
</span><span id="ssl-336"><a href="#ssl-336"><span class="linenos">336</span></a>                <span class="k">return</span>
</span><span id="ssl-337"><a href="#ssl-337"><span class="linenos">337</span></a>            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="ssl-338"><a href="#ssl-338"><span class="linenos">338</span></a>            <span class="c1">#now = datetime.datetime.now()</span>
</span><span id="ssl-339"><a href="#ssl-339"><span class="linenos">339</span></a>            <span class="c1">#f.write(&quot;Date/Time, &quot;+now.strftime(&quot;%Y-%m-%d_%H:%M&quot;)+&quot;\n&quot;)</span>
</span><span id="ssl-340"><a href="#ssl-340"><span class="linenos">340</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ssl-341"><a href="#ssl-341"><span class="linenos">341</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Number of labels,Accuracy</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ssl-342"><a href="#ssl-342"><span class="linenos">342</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ssl-343"><a href="#ssl-343"><span class="linenos">343</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Number of labels,Accuracy,Accuracy with class priors,Class priors error</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ssl-344"><a href="#ssl-344"><span class="linenos">344</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="ssl-345"><a href="#ssl-345"><span class="linenos">345</span></a>
</span><span id="ssl-346"><a href="#ssl-346"><span class="linenos">346</span></a>        <span class="k">if</span> <span class="n">save_results</span><span class="p">:</span>
</span><span id="ssl-347"><a href="#ssl-347"><span class="linenos">347</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Results File: &#39;</span><span class="o">+</span><span class="n">outfile</span><span class="p">)</span>
</span><span id="ssl-348"><a href="#ssl-348"><span class="linenos">348</span></a>
</span><span id="ssl-349"><a href="#ssl-349"><span class="linenos">349</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ssl-350"><a href="#ssl-350"><span class="linenos">350</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Number of labels,Accuracy&#39;</span><span class="p">)</span>
</span><span id="ssl-351"><a href="#ssl-351"><span class="linenos">351</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ssl-352"><a href="#ssl-352"><span class="linenos">352</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Number of labels,Accuracy,Accuracy with class priors,Class priors error&#39;</span><span class="p">)</span>
</span><span id="ssl-353"><a href="#ssl-353"><span class="linenos">353</span></a>
</span><span id="ssl-354"><a href="#ssl-354"><span class="linenos">354</span></a>        <span class="c1">#Trial run to trigger eigensolvers, when needed</span>
</span><span id="ssl-355"><a href="#ssl-355"><span class="linenos">355</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires_eig</span><span class="p">:</span>
</span><span id="ssl-356"><a href="#ssl-356"><span class="linenos">356</span></a>            <span class="n">pred_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">trainsets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">labels</span><span class="p">[</span><span class="n">trainsets</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="ssl-357"><a href="#ssl-357"><span class="linenos">357</span></a>     
</span><span id="ssl-358"><a href="#ssl-358"><span class="linenos">358</span></a>        <span class="k">def</span> <span class="nf">one_trial</span><span class="p">(</span><span class="n">train_ind</span><span class="p">):</span>
</span><span id="ssl-359"><a href="#ssl-359"><span class="linenos">359</span></a>
</span><span id="ssl-360"><a href="#ssl-360"><span class="linenos">360</span></a>            <span class="c1">#Number of labels</span>
</span><span id="ssl-361"><a href="#ssl-361"><span class="linenos">361</span></a>            <span class="n">num_train</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="ssl-362"><a href="#ssl-362"><span class="linenos">362</span></a>            <span class="n">train_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span>
</span><span id="ssl-363"><a href="#ssl-363"><span class="linenos">363</span></a>
</span><span id="ssl-364"><a href="#ssl-364"><span class="linenos">364</span></a>            <span class="c1">#Run semi-supervised learning</span>
</span><span id="ssl-365"><a href="#ssl-365"><span class="linenos">365</span></a>            <span class="n">pred_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>
</span><span id="ssl-366"><a href="#ssl-366"><span class="linenos">366</span></a>
</span><span id="ssl-367"><a href="#ssl-367"><span class="linenos">367</span></a>            <span class="c1">#Compute accuracy</span>
</span><span id="ssl-368"><a href="#ssl-368"><span class="linenos">368</span></a>            <span class="n">accuracy</span> <span class="o">=</span> <span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">pred_labels</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="ssl-369"><a href="#ssl-369"><span class="linenos">369</span></a>
</span><span id="ssl-370"><a href="#ssl-370"><span class="linenos">370</span></a>            <span class="c1">#If class priors were provided, check accuracy without priors</span>
</span><span id="ssl-371"><a href="#ssl-371"><span class="linenos">371</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ssl-372"><a href="#ssl-372"><span class="linenos">372</span></a>                <span class="n">pred_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">ignore_class_priors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ssl-373"><a href="#ssl-373"><span class="linenos">373</span></a>                <span class="n">accuracy_without_priors</span> <span class="o">=</span> <span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">pred_labels</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="ssl-374"><a href="#ssl-374"><span class="linenos">374</span></a>            
</span><span id="ssl-375"><a href="#ssl-375"><span class="linenos">375</span></a>            <span class="c1">#Print to terminal</span>
</span><span id="ssl-376"><a href="#ssl-376"><span class="linenos">376</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ssl-377"><a href="#ssl-377"><span class="linenos">377</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">num_train</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">accuracy</span><span class="p">)</span>
</span><span id="ssl-378"><a href="#ssl-378"><span class="linenos">378</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ssl-379"><a href="#ssl-379"><span class="linenos">379</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">,</span><span class="si">%.2f</span><span class="s2">,</span><span class="si">%.2f</span><span class="s2">,</span><span class="si">%.5f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_train</span><span class="p">,</span><span class="n">accuracy_without_priors</span><span class="p">,</span><span class="n">accuracy</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">class_priors_error</span><span class="p">))</span>
</span><span id="ssl-380"><a href="#ssl-380"><span class="linenos">380</span></a>
</span><span id="ssl-381"><a href="#ssl-381"><span class="linenos">381</span></a>            <span class="c1">#Write to file</span>
</span><span id="ssl-382"><a href="#ssl-382"><span class="linenos">382</span></a>            <span class="k">if</span> <span class="n">save_results</span><span class="p">:</span>
</span><span id="ssl-383"><a href="#ssl-383"><span class="linenos">383</span></a>                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="s2">&quot;a+&quot;</span><span class="p">)</span>
</span><span id="ssl-384"><a href="#ssl-384"><span class="linenos">384</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ssl-385"><a href="#ssl-385"><span class="linenos">385</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">num_train</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="si">%.2f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">accuracy</span><span class="p">)</span>
</span><span id="ssl-386"><a href="#ssl-386"><span class="linenos">386</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ssl-387"><a href="#ssl-387"><span class="linenos">387</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">,</span><span class="si">%.2f</span><span class="s2">,</span><span class="si">%.2f</span><span class="s2">,</span><span class="si">%.5f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_train</span><span class="p">,</span><span class="n">accuracy_without_priors</span><span class="p">,</span><span class="n">accuracy</span><span class="p">,</span>
</span><span id="ssl-388"><a href="#ssl-388"><span class="linenos">388</span></a>                                                                            <span class="bp">self</span><span class="o">.</span><span class="n">class_priors_error</span><span class="p">))</span>
</span><span id="ssl-389"><a href="#ssl-389"><span class="linenos">389</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="ssl-390"><a href="#ssl-390"><span class="linenos">390</span></a>
</span><span id="ssl-391"><a href="#ssl-391"><span class="linenos">391</span></a>        <span class="n">num_cores</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">(),</span><span class="n">num_cores</span><span class="p">)</span>
</span><span id="ssl-392"><a href="#ssl-392"><span class="linenos">392</span></a>
</span><span id="ssl-393"><a href="#ssl-393"><span class="linenos">393</span></a>        <span class="k">if</span> <span class="n">num_cores</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="ssl-394"><a href="#ssl-394"><span class="linenos">394</span></a>            <span class="k">for</span> <span class="n">train_ind</span> <span class="ow">in</span> <span class="n">trainsets</span><span class="p">:</span>
</span><span id="ssl-395"><a href="#ssl-395"><span class="linenos">395</span></a>                <span class="n">one_trial</span><span class="p">(</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="ssl-396"><a href="#ssl-396"><span class="linenos">396</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ssl-397"><a href="#ssl-397"><span class="linenos">397</span></a>            <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">num_cores</span><span class="p">)(</span><span class="n">delayed</span><span class="p">(</span><span class="n">one_trial</span><span class="p">)(</span><span class="n">train_ind</span><span class="p">)</span> <span class="k">for</span> <span class="n">train_ind</span> <span class="ow">in</span> <span class="n">trainsets</span><span class="p">)</span>
</span><span id="ssl-398"><a href="#ssl-398"><span class="linenos">398</span></a>
</span><span id="ssl-399"><a href="#ssl-399"><span class="linenos">399</span></a>    <span class="k">def</span> <span class="nf">trials_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="ssl-400"><a href="#ssl-400"><span class="linenos">400</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trials statistics</span>
</span><span id="ssl-401"><a href="#ssl-401"><span class="linenos">401</span></a><span class="sd">        ===================</span>
</span><span id="ssl-402"><a href="#ssl-402"><span class="linenos">402</span></a>
</span><span id="ssl-403"><a href="#ssl-403"><span class="linenos">403</span></a><span class="sd">        Loads accuracy scores from each trial from csv files created by `ssl_trials`</span>
</span><span id="ssl-404"><a href="#ssl-404"><span class="linenos">404</span></a><span class="sd">        and returns summary statistics (mean and standard deviation of accuracy).</span>
</span><span id="ssl-405"><a href="#ssl-405"><span class="linenos">405</span></a>
</span><span id="ssl-406"><a href="#ssl-406"><span class="linenos">406</span></a><span class="sd">        Parameters</span>
</span><span id="ssl-407"><a href="#ssl-407"><span class="linenos">407</span></a><span class="sd">        ----------</span>
</span><span id="ssl-408"><a href="#ssl-408"><span class="linenos">408</span></a><span class="sd">        tag : str (optional), default=&#39;&#39;</span>
</span><span id="ssl-409"><a href="#ssl-409"><span class="linenos">409</span></a><span class="sd">            An extra identifying tag to add to the accuracy filename.</span>
</span><span id="ssl-410"><a href="#ssl-410"><span class="linenos">410</span></a>
</span><span id="ssl-411"><a href="#ssl-411"><span class="linenos">411</span></a><span class="sd">        Returns</span>
</span><span id="ssl-412"><a href="#ssl-412"><span class="linenos">412</span></a><span class="sd">        -------</span>
</span><span id="ssl-413"><a href="#ssl-413"><span class="linenos">413</span></a><span class="sd">        num_train : numpy array</span>
</span><span id="ssl-414"><a href="#ssl-414"><span class="linenos">414</span></a><span class="sd">            Number of training examples in each label rate experiment.</span>
</span><span id="ssl-415"><a href="#ssl-415"><span class="linenos">415</span></a><span class="sd">        acc_mean : numpy array</span>
</span><span id="ssl-416"><a href="#ssl-416"><span class="linenos">416</span></a><span class="sd">            Mean accuracy over all trials in each experiment.</span>
</span><span id="ssl-417"><a href="#ssl-417"><span class="linenos">417</span></a><span class="sd">        acc_stddev : numpy array</span>
</span><span id="ssl-418"><a href="#ssl-418"><span class="linenos">418</span></a><span class="sd">            Standard deviation of accuracy over all trials in each experiment.</span>
</span><span id="ssl-419"><a href="#ssl-419"><span class="linenos">419</span></a><span class="sd">        num_trials : int</span>
</span><span id="ssl-420"><a href="#ssl-420"><span class="linenos">420</span></a><span class="sd">            Number of trials for each label rate.</span>
</span><span id="ssl-421"><a href="#ssl-421"><span class="linenos">421</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ssl-422"><a href="#ssl-422"><span class="linenos">422</span></a>
</span><span id="ssl-423"><a href="#ssl-423"><span class="linenos">423</span></a>        <span class="n">accuracy_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="n">tag</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_accuracy_filename</span><span class="p">())</span>
</span><span id="ssl-424"><a href="#ssl-424"><span class="linenos">424</span></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">csvread</span><span class="p">(</span><span class="n">accuracy_filename</span><span class="p">)</span>
</span><span id="ssl-425"><a href="#ssl-425"><span class="linenos">425</span></a>        <span class="n">num_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
</span><span id="ssl-426"><a href="#ssl-426"><span class="linenos">426</span></a>
</span><span id="ssl-427"><a href="#ssl-427"><span class="linenos">427</span></a>        <span class="n">acc_mean</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ssl-428"><a href="#ssl-428"><span class="linenos">428</span></a>        <span class="n">acc_stddev</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ssl-429"><a href="#ssl-429"><span class="linenos">429</span></a>        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">num_train</span><span class="p">:</span>
</span><span id="ssl-430"><a href="#ssl-430"><span class="linenos">430</span></a>            <span class="n">Y</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="ssl-431"><a href="#ssl-431"><span class="linenos">431</span></a>            <span class="n">acc_mean</span> <span class="o">+=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
</span><span id="ssl-432"><a href="#ssl-432"><span class="linenos">432</span></a>            <span class="n">acc_stddev</span> <span class="o">+=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
</span><span id="ssl-433"><a href="#ssl-433"><span class="linenos">433</span></a>
</span><span id="ssl-434"><a href="#ssl-434"><span class="linenos">434</span></a>        <span class="n">num_trials</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">num_train</span><span class="p">))</span>
</span><span id="ssl-435"><a href="#ssl-435"><span class="linenos">435</span></a>        <span class="n">acc_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">acc_mean</span><span class="p">)</span>
</span><span id="ssl-436"><a href="#ssl-436"><span class="linenos">436</span></a>        <span class="n">acc_stddev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">acc_stddev</span><span class="p">)</span>
</span><span id="ssl-437"><a href="#ssl-437"><span class="linenos">437</span></a>        <span class="k">return</span> <span class="n">num_train</span><span class="p">,</span> <span class="n">acc_mean</span><span class="p">,</span> <span class="n">acc_stddev</span><span class="p">,</span> <span class="n">num_trials</span>
</span><span id="ssl-438"><a href="#ssl-438"><span class="linenos">438</span></a>
</span><span id="ssl-439"><a href="#ssl-439"><span class="linenos">439</span></a>   
</span><span id="ssl-440"><a href="#ssl-440"><span class="linenos">440</span></a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="ssl-441"><a href="#ssl-441"><span class="linenos">441</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit</span>
</span><span id="ssl-442"><a href="#ssl-442"><span class="linenos">442</span></a><span class="sd">        ======</span>
</span><span id="ssl-443"><a href="#ssl-443"><span class="linenos">443</span></a>
</span><span id="ssl-444"><a href="#ssl-444"><span class="linenos">444</span></a><span class="sd">        Solves graph-based learning problem, computing the probability </span>
</span><span id="ssl-445"><a href="#ssl-445"><span class="linenos">445</span></a><span class="sd">        that each node belongs to each class. If `all_labels` is provided, </span>
</span><span id="ssl-446"><a href="#ssl-446"><span class="linenos">446</span></a><span class="sd">        then the solver operates in verbose mode, printing out accuracy</span>
</span><span id="ssl-447"><a href="#ssl-447"><span class="linenos">447</span></a><span class="sd">        at each iteration.</span>
</span><span id="ssl-448"><a href="#ssl-448"><span class="linenos">448</span></a>
</span><span id="ssl-449"><a href="#ssl-449"><span class="linenos">449</span></a><span class="sd">        Parameters</span>
</span><span id="ssl-450"><a href="#ssl-450"><span class="linenos">450</span></a><span class="sd">        ----------</span>
</span><span id="ssl-451"><a href="#ssl-451"><span class="linenos">451</span></a><span class="sd">        train_ind : numpy array, int</span>
</span><span id="ssl-452"><a href="#ssl-452"><span class="linenos">452</span></a><span class="sd">            Indicies of training points.</span>
</span><span id="ssl-453"><a href="#ssl-453"><span class="linenos">453</span></a><span class="sd">        train_labels : numpy array, int</span>
</span><span id="ssl-454"><a href="#ssl-454"><span class="linenos">454</span></a><span class="sd">            Training labels as integers \\(0,1,\\dots,k-1\\) for \\(k\\) classes.</span>
</span><span id="ssl-455"><a href="#ssl-455"><span class="linenos">455</span></a><span class="sd">        all_labels : numpy array, int (optional)</span>
</span><span id="ssl-456"><a href="#ssl-456"><span class="linenos">456</span></a><span class="sd">            True labels for all datapoints.</span>
</span><span id="ssl-457"><a href="#ssl-457"><span class="linenos">457</span></a>
</span><span id="ssl-458"><a href="#ssl-458"><span class="linenos">458</span></a><span class="sd">        Returns</span>
</span><span id="ssl-459"><a href="#ssl-459"><span class="linenos">459</span></a><span class="sd">        -------</span>
</span><span id="ssl-460"><a href="#ssl-460"><span class="linenos">460</span></a><span class="sd">        u : (n,k) numpy array, float</span>
</span><span id="ssl-461"><a href="#ssl-461"><span class="linenos">461</span></a><span class="sd">            Probabilities computed by graph-based learning for each node and each class.</span>
</span><span id="ssl-462"><a href="#ssl-462"><span class="linenos">462</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ssl-463"><a href="#ssl-463"><span class="linenos">463</span></a>
</span><span id="ssl-464"><a href="#ssl-464"><span class="linenos">464</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ssl-465"><a href="#ssl-465"><span class="linenos">465</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;SSL object has no graph. Use graph.set_graph() to provide a graph for SSL.&#39;</span><span class="p">)</span>
</span><span id="ssl-466"><a href="#ssl-466"><span class="linenos">466</span></a>
</span><span id="ssl-467"><a href="#ssl-467"><span class="linenos">467</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fitted</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ssl-468"><a href="#ssl-468"><span class="linenos">468</span></a>
</span><span id="ssl-469"><a href="#ssl-469"><span class="linenos">469</span></a>        <span class="c1">#If a one-vs-rest classifier</span>
</span><span id="ssl-470"><a href="#ssl-470"><span class="linenos">470</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">onevsrest</span><span class="p">:</span>
</span><span id="ssl-471"><a href="#ssl-471"><span class="linenos">471</span></a>            <span class="n">unique_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span>
</span><span id="ssl-472"><a href="#ssl-472"><span class="linenos">472</span></a>            <span class="n">num_labels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">)</span>
</span><span id="ssl-473"><a href="#ssl-473"><span class="linenos">473</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span><span class="n">num_labels</span><span class="p">))</span>
</span><span id="ssl-474"><a href="#ssl-474"><span class="linenos">474</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">):</span>
</span><span id="ssl-475"><a href="#ssl-475"><span class="linenos">475</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">prob</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="o">==</span><span class="n">l</span><span class="p">)</span>
</span><span id="ssl-476"><a href="#ssl-476"><span class="linenos">476</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ssl-477"><a href="#ssl-477"><span class="linenos">477</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="n">all_labels</span><span class="p">)</span>
</span><span id="ssl-478"><a href="#ssl-478"><span class="linenos">478</span></a>
</span><span id="ssl-479"><a href="#ssl-479"><span class="linenos">479</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ssl-480"><a href="#ssl-480"><span class="linenos">480</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">volume_label_projection</span><span class="p">()</span>
</span><span id="ssl-481"><a href="#ssl-481"><span class="linenos">481</span></a>
</span><span id="ssl-482"><a href="#ssl-482"><span class="linenos">482</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob</span>
</span><span id="ssl-483"><a href="#ssl-483"><span class="linenos">483</span></a>
</span><span id="ssl-484"><a href="#ssl-484"><span class="linenos">484</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="ssl-485"><a href="#ssl-485"><span class="linenos">485</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="ssl-486"><a href="#ssl-486"><span class="linenos">486</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal Fit Function</span>
</span><span id="ssl-487"><a href="#ssl-487"><span class="linenos">487</span></a><span class="sd">        ======</span>
</span><span id="ssl-488"><a href="#ssl-488"><span class="linenos">488</span></a>
</span><span id="ssl-489"><a href="#ssl-489"><span class="linenos">489</span></a><span class="sd">        Internal fit function that any ssl object must override. If `self.onevsrest=True` then</span>
</span><span id="ssl-490"><a href="#ssl-490"><span class="linenos">490</span></a><span class="sd">        `train_labels` are binary in the one-vs-rest framework, and `_fit` must return</span>
</span><span id="ssl-491"><a href="#ssl-491"><span class="linenos">491</span></a><span class="sd">        a scalar numpy array. Otherwise the labels are integer and `_fit` must return an (n,k)</span>
</span><span id="ssl-492"><a href="#ssl-492"><span class="linenos">492</span></a><span class="sd">        numpy array of probabilities, where `k` is the number of classes.</span>
</span><span id="ssl-493"><a href="#ssl-493"><span class="linenos">493</span></a>
</span><span id="ssl-494"><a href="#ssl-494"><span class="linenos">494</span></a><span class="sd">        Parameters</span>
</span><span id="ssl-495"><a href="#ssl-495"><span class="linenos">495</span></a><span class="sd">        ----------</span>
</span><span id="ssl-496"><a href="#ssl-496"><span class="linenos">496</span></a><span class="sd">        train_ind : numpy array, int</span>
</span><span id="ssl-497"><a href="#ssl-497"><span class="linenos">497</span></a><span class="sd">            Indicies of training points.</span>
</span><span id="ssl-498"><a href="#ssl-498"><span class="linenos">498</span></a><span class="sd">        train_labels : numpy array, int</span>
</span><span id="ssl-499"><a href="#ssl-499"><span class="linenos">499</span></a><span class="sd">            Training labels as integers \\(0,1,\\dots,k-1\\) for \\(k\\) classes, or binary</span>
</span><span id="ssl-500"><a href="#ssl-500"><span class="linenos">500</span></a><span class="sd">            if `self.onevsrest=True`.</span>
</span><span id="ssl-501"><a href="#ssl-501"><span class="linenos">501</span></a><span class="sd">        all_labels : numpy array, int (optional)</span>
</span><span id="ssl-502"><a href="#ssl-502"><span class="linenos">502</span></a><span class="sd">            True labels for all datapoints.</span>
</span><span id="ssl-503"><a href="#ssl-503"><span class="linenos">503</span></a>
</span><span id="ssl-504"><a href="#ssl-504"><span class="linenos">504</span></a><span class="sd">        Returns</span>
</span><span id="ssl-505"><a href="#ssl-505"><span class="linenos">505</span></a><span class="sd">        -------</span>
</span><span id="ssl-506"><a href="#ssl-506"><span class="linenos">506</span></a><span class="sd">        u : numpy array, float</span>
</span><span id="ssl-507"><a href="#ssl-507"><span class="linenos">507</span></a><span class="sd">            (n,k) array of probabilities computed by graph-based learning for each node and each class, unless</span>
</span><span id="ssl-508"><a href="#ssl-508"><span class="linenos">508</span></a><span class="sd">            `self.onevsrest=True`, in which case it is a length n numpy array of probablities for the current </span>
</span><span id="ssl-509"><a href="#ssl-509"><span class="linenos">509</span></a><span class="sd">            class.</span>
</span><span id="ssl-510"><a href="#ssl-510"><span class="linenos">510</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ssl-511"><a href="#ssl-511"><span class="linenos">511</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Must override _fit&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            <div id="ssl.__init__" class="classattr">
                                        <input id="ssl.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ssl</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">W</span>, </span><span class="param"><span class="n">class_priors</span></span>)</span>

                <label class="view-source-button" for="ssl.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ssl.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ssl.__init__-135"><a href="#ssl.__init__-135"><span class="linenos">135</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">):</span>
</span><span id="ssl.__init__-136"><a href="#ssl.__init__-136"><span class="linenos">136</span></a>        <span class="k">if</span> <span class="n">W</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ssl.__init__-137"><a href="#ssl.__init__-137"><span class="linenos">137</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ssl.__init__-138"><a href="#ssl.__init__-138"><span class="linenos">138</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ssl.__init__-139"><a href="#ssl.__init__-139"><span class="linenos">139</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_graph</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</span><span id="ssl.__init__-140"><a href="#ssl.__init__-140"><span class="linenos">140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ssl.__init__-141"><a href="#ssl.__init__-141"><span class="linenos">141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fitted</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ssl.__init__-142"><a href="#ssl.__init__-142"><span class="linenos">142</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="ssl.__init__-143"><a href="#ssl.__init__-143"><span class="linenos">143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="ssl.__init__-144"><a href="#ssl.__init__-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">requires_eig</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ssl.__init__-145"><a href="#ssl.__init__-145"><span class="linenos">145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onevsrest</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ssl.__init__-146"><a href="#ssl.__init__-146"><span class="linenos">146</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">similarity</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ssl.__init__-147"><a href="#ssl.__init__-147"><span class="linenos">147</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="o">=</span> <span class="n">class_priors</span>
</span><span id="ssl.__init__-148"><a href="#ssl.__init__-148"><span class="linenos">148</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ssl.__init__-149"><a href="#ssl.__init__-149"><span class="linenos">149</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span><span class="p">)</span>
</span><span id="ssl.__init__-150"><a href="#ssl.__init__-150"><span class="linenos">150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="ssl.__init__-151"><a href="#ssl.__init__-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">class_priors_error</span> <span class="o">=</span> <span class="mi">1</span>
</span></pre></div>


    

                            </div>
                            <div id="ssl.prob" class="classattr">
                                <div class="attr variable">
            <span class="name">prob</span>

        
    </div>
    <a class="headerlink" href="#ssl.prob"></a>
    
    

                            </div>
                            <div id="ssl.fitted" class="classattr">
                                <div class="attr variable">
            <span class="name">fitted</span>

        
    </div>
    <a class="headerlink" href="#ssl.fitted"></a>
    
    

                            </div>
                            <div id="ssl.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#ssl.name"></a>
    
    

                            </div>
                            <div id="ssl.accuracy_filename" class="classattr">
                                <div class="attr variable">
            <span class="name">accuracy_filename</span>

        
    </div>
    <a class="headerlink" href="#ssl.accuracy_filename"></a>
    
    

                            </div>
                            <div id="ssl.requires_eig" class="classattr">
                                <div class="attr variable">
            <span class="name">requires_eig</span>

        
    </div>
    <a class="headerlink" href="#ssl.requires_eig"></a>
    
    

                            </div>
                            <div id="ssl.onevsrest" class="classattr">
                                <div class="attr variable">
            <span class="name">onevsrest</span>

        
    </div>
    <a class="headerlink" href="#ssl.onevsrest"></a>
    
    

                            </div>
                            <div id="ssl.similarity" class="classattr">
                                <div class="attr variable">
            <span class="name">similarity</span>

        
    </div>
    <a class="headerlink" href="#ssl.similarity"></a>
    
    

                            </div>
                            <div id="ssl.class_priors" class="classattr">
                                <div class="attr variable">
            <span class="name">class_priors</span>

        
    </div>
    <a class="headerlink" href="#ssl.class_priors"></a>
    
    

                            </div>
                            <div id="ssl.weights" class="classattr">
                                <div class="attr variable">
            <span class="name">weights</span>

        
    </div>
    <a class="headerlink" href="#ssl.weights"></a>
    
    

                            </div>
                            <div id="ssl.class_priors_error" class="classattr">
                                <div class="attr variable">
            <span class="name">class_priors_error</span>

        
    </div>
    <a class="headerlink" href="#ssl.class_priors_error"></a>
    
    

                            </div>
                            <div id="ssl.set_graph" class="classattr">
                                        <input id="ssl.set_graph-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_graph</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">W</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ssl.set_graph-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ssl.set_graph"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ssl.set_graph-153"><a href="#ssl.set_graph-153"><span class="linenos">153</span></a>    <span class="k">def</span> <span class="nf">set_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
</span><span id="ssl.set_graph-154"><a href="#ssl.set_graph-154"><span class="linenos">154</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set Graph</span>
</span><span id="ssl.set_graph-155"><a href="#ssl.set_graph-155"><span class="linenos">155</span></a><span class="sd">        ===================</span>
</span><span id="ssl.set_graph-156"><a href="#ssl.set_graph-156"><span class="linenos">156</span></a>
</span><span id="ssl.set_graph-157"><a href="#ssl.set_graph-157"><span class="linenos">157</span></a><span class="sd">        Sets the graph object for semi-supervised learning.</span>
</span><span id="ssl.set_graph-158"><a href="#ssl.set_graph-158"><span class="linenos">158</span></a>
</span><span id="ssl.set_graph-159"><a href="#ssl.set_graph-159"><span class="linenos">159</span></a><span class="sd">        Implements 3 different solvers, spectral, gradient_descent, and conjugate_gradient. </span>
</span><span id="ssl.set_graph-160"><a href="#ssl.set_graph-160"><span class="linenos">160</span></a><span class="sd">        GPU acceleration is available for gradient descent. See [1] for details.</span>
</span><span id="ssl.set_graph-161"><a href="#ssl.set_graph-161"><span class="linenos">161</span></a>
</span><span id="ssl.set_graph-162"><a href="#ssl.set_graph-162"><span class="linenos">162</span></a><span class="sd">        Parameters</span>
</span><span id="ssl.set_graph-163"><a href="#ssl.set_graph-163"><span class="linenos">163</span></a><span class="sd">        ----------</span>
</span><span id="ssl.set_graph-164"><a href="#ssl.set_graph-164"><span class="linenos">164</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="ssl.set_graph-165"><a href="#ssl.set_graph-165"><span class="linenos">165</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="ssl.set_graph-166"><a href="#ssl.set_graph-166"><span class="linenos">166</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ssl.set_graph-167"><a href="#ssl.set_graph-167"><span class="linenos">167</span></a>
</span><span id="ssl.set_graph-168"><a href="#ssl.set_graph-168"><span class="linenos">168</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">==</span> <span class="n">graph</span><span class="o">.</span><span class="n">graph</span><span class="p">:</span>
</span><span id="ssl.set_graph-169"><a href="#ssl.set_graph-169"><span class="linenos">169</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">W</span>
</span><span id="ssl.set_graph-170"><a href="#ssl.set_graph-170"><span class="linenos">170</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ssl.set_graph-171"><a href="#ssl.set_graph-171"><span class="linenos">171</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">graph</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h1 id="set-graph">Set Graph</h1>

<p>Sets the graph object for semi-supervised learning.</p>

<p>Implements 3 different solvers, spectral, gradient_descent, and conjugate_gradient. 
GPU acceleration is available for gradient descent. See [1] for details.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>W</strong> (numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None):
Weight matrix representing the graph.</li>
</ul>
</div>


                            </div>
                            <div id="ssl.volume_label_projection" class="classattr">
                                        <input id="ssl.volume_label_projection-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">volume_label_projection</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ssl.volume_label_projection-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ssl.volume_label_projection"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ssl.volume_label_projection-173"><a href="#ssl.volume_label_projection-173"><span class="linenos">173</span></a>    <span class="k">def</span> <span class="nf">volume_label_projection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ssl.volume_label_projection-174"><a href="#ssl.volume_label_projection-174"><span class="linenos">174</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Volume label projection</span>
</span><span id="ssl.volume_label_projection-175"><a href="#ssl.volume_label_projection-175"><span class="linenos">175</span></a><span class="sd">        ======</span>
</span><span id="ssl.volume_label_projection-176"><a href="#ssl.volume_label_projection-176"><span class="linenos">176</span></a><span class="sd">    </span>
</span><span id="ssl.volume_label_projection-177"><a href="#ssl.volume_label_projection-177"><span class="linenos">177</span></a><span class="sd">        Projects class probabilities to labels while enforcing a constraint on </span>
</span><span id="ssl.volume_label_projection-178"><a href="#ssl.volume_label_projection-178"><span class="linenos">178</span></a><span class="sd">        class priors (i.e., class volumes). Does not return anything, just modifies `self.weights`.</span>
</span><span id="ssl.volume_label_projection-179"><a href="#ssl.volume_label_projection-179"><span class="linenos">179</span></a><span class="sd">        </span>
</span><span id="ssl.volume_label_projection-180"><a href="#ssl.volume_label_projection-180"><span class="linenos">180</span></a><span class="sd">        Returns</span>
</span><span id="ssl.volume_label_projection-181"><a href="#ssl.volume_label_projection-181"><span class="linenos">181</span></a><span class="sd">        -------</span>
</span><span id="ssl.volume_label_projection-182"><a href="#ssl.volume_label_projection-182"><span class="linenos">182</span></a><span class="sd">        labels : numpy array (int)</span>
</span><span id="ssl.volume_label_projection-183"><a href="#ssl.volume_label_projection-183"><span class="linenos">183</span></a><span class="sd">            Predicted labels after volume correction.</span>
</span><span id="ssl.volume_label_projection-184"><a href="#ssl.volume_label_projection-184"><span class="linenos">184</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ssl.volume_label_projection-185"><a href="#ssl.volume_label_projection-185"><span class="linenos">185</span></a>
</span><span id="ssl.volume_label_projection-186"><a href="#ssl.volume_label_projection-186"><span class="linenos">186</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span>
</span><span id="ssl.volume_label_projection-187"><a href="#ssl.volume_label_projection-187"><span class="linenos">187</span></a>        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ssl.volume_label_projection-188"><a href="#ssl.volume_label_projection-188"><span class="linenos">188</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ssl.volume_label_projection-189"><a href="#ssl.volume_label_projection-189"><span class="linenos">189</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">k</span><span class="p">,))</span>
</span><span id="ssl.volume_label_projection-190"><a href="#ssl.volume_label_projection-190"><span class="linenos">190</span></a>
</span><span id="ssl.volume_label_projection-191"><a href="#ssl.volume_label_projection-191"><span class="linenos">191</span></a>        <span class="c1">#Time step</span>
</span><span id="ssl.volume_label_projection-192"><a href="#ssl.volume_label_projection-192"><span class="linenos">192</span></a>        <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span>
</span><span id="ssl.volume_label_projection-193"><a href="#ssl.volume_label_projection-193"><span class="linenos">193</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarity</span><span class="p">:</span>
</span><span id="ssl.volume_label_projection-194"><a href="#ssl.volume_label_projection-194"><span class="linenos">194</span></a>            <span class="n">dt</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="ssl.volume_label_projection-195"><a href="#ssl.volume_label_projection-195"><span class="linenos">195</span></a>
</span><span id="ssl.volume_label_projection-196"><a href="#ssl.volume_label_projection-196"><span class="linenos">196</span></a>        <span class="c1">#np.set_printoptions(formatter={&#39;float&#39;: lambda x: &quot;{0:0.3f}&quot;.format(x)})</span>
</span><span id="ssl.volume_label_projection-197"><a href="#ssl.volume_label_projection-197"><span class="linenos">197</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ssl.volume_label_projection-198"><a href="#ssl.volume_label_projection-198"><span class="linenos">198</span></a>        <span class="n">err</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="ssl.volume_label_projection-199"><a href="#ssl.volume_label_projection-199"><span class="linenos">199</span></a>        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mf">1e4</span> <span class="ow">and</span> <span class="n">err</span> <span class="o">&gt;</span> <span class="mf">1e-3</span><span class="p">:</span>
</span><span id="ssl.volume_label_projection-200"><a href="#ssl.volume_label_projection-200"><span class="linenos">200</span></a>            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ssl.volume_label_projection-201"><a href="#ssl.volume_label_projection-201"><span class="linenos">201</span></a>            <span class="n">class_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="ssl.volume_label_projection-202"><a href="#ssl.volume_label_projection-202"><span class="linenos">202</span></a>            <span class="c1">#print(class_size-self.class_priors)</span>
</span><span id="ssl.volume_label_projection-203"><a href="#ssl.volume_label_projection-203"><span class="linenos">203</span></a>            <span class="n">grad</span> <span class="o">=</span> <span class="n">class_size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span>
</span><span id="ssl.volume_label_projection-204"><a href="#ssl.volume_label_projection-204"><span class="linenos">204</span></a>            <span class="n">err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">grad</span><span class="p">))</span>
</span><span id="ssl.volume_label_projection-205"><a href="#ssl.volume_label_projection-205"><span class="linenos">205</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">+=</span> <span class="n">dt</span><span class="o">*</span><span class="n">grad</span>
</span><span id="ssl.volume_label_projection-206"><a href="#ssl.volume_label_projection-206"><span class="linenos">206</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ssl.volume_label_projection-207"><a href="#ssl.volume_label_projection-207"><span class="linenos">207</span></a>
</span><span id="ssl.volume_label_projection-208"><a href="#ssl.volume_label_projection-208"><span class="linenos">208</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">class_priors_error</span> <span class="o">=</span> <span class="n">err</span>
</span><span id="ssl.volume_label_projection-209"><a href="#ssl.volume_label_projection-209"><span class="linenos">209</span></a>
</span><span id="ssl.volume_label_projection-210"><a href="#ssl.volume_label_projection-210"><span class="linenos">210</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><h1 id="volume-label-projection">Volume label projection</h1>

<p>Projects class probabilities to labels while enforcing a constraint on 
class priors (i.e., class volumes). Does not return anything, just modifies <code>self.weights</code>.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>labels</strong> (numpy array (int)):
Predicted labels after volume correction.</li>
</ul>
</div>


                            </div>
                            <div id="ssl.get_accuracy_filename" class="classattr">
                                        <input id="ssl.get_accuracy_filename-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_accuracy_filename</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ssl.get_accuracy_filename-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ssl.get_accuracy_filename"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ssl.get_accuracy_filename-212"><a href="#ssl.get_accuracy_filename-212"><span class="linenos">212</span></a>    <span class="k">def</span> <span class="nf">get_accuracy_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ssl.get_accuracy_filename-213"><a href="#ssl.get_accuracy_filename-213"><span class="linenos">213</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get accuracy filename</span>
</span><span id="ssl.get_accuracy_filename-214"><a href="#ssl.get_accuracy_filename-214"><span class="linenos">214</span></a><span class="sd">        ========</span>
</span><span id="ssl.get_accuracy_filename-215"><a href="#ssl.get_accuracy_filename-215"><span class="linenos">215</span></a>
</span><span id="ssl.get_accuracy_filename-216"><a href="#ssl.get_accuracy_filename-216"><span class="linenos">216</span></a><span class="sd">        Returns name of the file that will store the accuracy results for `ssl_trials.py`.</span>
</span><span id="ssl.get_accuracy_filename-217"><a href="#ssl.get_accuracy_filename-217"><span class="linenos">217</span></a>
</span><span id="ssl.get_accuracy_filename-218"><a href="#ssl.get_accuracy_filename-218"><span class="linenos">218</span></a><span class="sd">        Returns</span>
</span><span id="ssl.get_accuracy_filename-219"><a href="#ssl.get_accuracy_filename-219"><span class="linenos">219</span></a><span class="sd">        -------</span>
</span><span id="ssl.get_accuracy_filename-220"><a href="#ssl.get_accuracy_filename-220"><span class="linenos">220</span></a><span class="sd">        fname : str</span>
</span><span id="ssl.get_accuracy_filename-221"><a href="#ssl.get_accuracy_filename-221"><span class="linenos">221</span></a><span class="sd">            Accuracy filename.</span>
</span><span id="ssl.get_accuracy_filename-222"><a href="#ssl.get_accuracy_filename-222"><span class="linenos">222</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ssl.get_accuracy_filename-223"><a href="#ssl.get_accuracy_filename-223"><span class="linenos">223</span></a>
</span><span id="ssl.get_accuracy_filename-224"><a href="#ssl.get_accuracy_filename-224"><span class="linenos">224</span></a>        <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span>
</span><span id="ssl.get_accuracy_filename-225"><a href="#ssl.get_accuracy_filename-225"><span class="linenos">225</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ssl.get_accuracy_filename-226"><a href="#ssl.get_accuracy_filename-226"><span class="linenos">226</span></a>            <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_classpriors&#39;</span>
</span><span id="ssl.get_accuracy_filename-227"><a href="#ssl.get_accuracy_filename-227"><span class="linenos">227</span></a>        <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_accuracy.csv&#39;</span>
</span><span id="ssl.get_accuracy_filename-228"><a href="#ssl.get_accuracy_filename-228"><span class="linenos">228</span></a>        <span class="k">return</span> <span class="n">fname</span>
</span></pre></div>


            <div class="docstring"><h1 id="get-accuracy-filename">Get accuracy filename</h1>

<p>Returns name of the file that will store the accuracy results for <code>ssl_trials.py</code>.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>fname</strong> (str):
Accuracy filename.</li>
</ul>
</div>


                            </div>
                            <div id="ssl.predict" class="classattr">
                                        <input id="ssl.predict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">predict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">ignore_class_priors</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ssl.predict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ssl.predict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ssl.predict-231"><a href="#ssl.predict-231"><span class="linenos">231</span></a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignore_class_priors</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="ssl.predict-232"><a href="#ssl.predict-232"><span class="linenos">232</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Predict</span>
</span><span id="ssl.predict-233"><a href="#ssl.predict-233"><span class="linenos">233</span></a><span class="sd">        ========</span>
</span><span id="ssl.predict-234"><a href="#ssl.predict-234"><span class="linenos">234</span></a>
</span><span id="ssl.predict-235"><a href="#ssl.predict-235"><span class="linenos">235</span></a><span class="sd">        Makes label predictions based on the probabilities computed by `fit()`.</span>
</span><span id="ssl.predict-236"><a href="#ssl.predict-236"><span class="linenos">236</span></a><span class="sd">        Will use a volume label projection if `class_priors` were given, to ensure </span>
</span><span id="ssl.predict-237"><a href="#ssl.predict-237"><span class="linenos">237</span></a><span class="sd">        the number of nodes predicted in each class is correct.</span>
</span><span id="ssl.predict-238"><a href="#ssl.predict-238"><span class="linenos">238</span></a><span class="sd">        </span>
</span><span id="ssl.predict-239"><a href="#ssl.predict-239"><span class="linenos">239</span></a><span class="sd">        Parameters</span>
</span><span id="ssl.predict-240"><a href="#ssl.predict-240"><span class="linenos">240</span></a><span class="sd">        ----------</span>
</span><span id="ssl.predict-241"><a href="#ssl.predict-241"><span class="linenos">241</span></a><span class="sd">        ignore_class_priors : bool (optional), default=False</span>
</span><span id="ssl.predict-242"><a href="#ssl.predict-242"><span class="linenos">242</span></a><span class="sd">            Used to disable the volume constrained label decision, when `class_priors` has been provided. </span>
</span><span id="ssl.predict-243"><a href="#ssl.predict-243"><span class="linenos">243</span></a>
</span><span id="ssl.predict-244"><a href="#ssl.predict-244"><span class="linenos">244</span></a><span class="sd">        Returns</span>
</span><span id="ssl.predict-245"><a href="#ssl.predict-245"><span class="linenos">245</span></a><span class="sd">        -------</span>
</span><span id="ssl.predict-246"><a href="#ssl.predict-246"><span class="linenos">246</span></a><span class="sd">        pred_labels : (int) numpy array</span>
</span><span id="ssl.predict-247"><a href="#ssl.predict-247"><span class="linenos">247</span></a><span class="sd">            Predicted labels as integers for all datapoints in the graph.</span>
</span><span id="ssl.predict-248"><a href="#ssl.predict-248"><span class="linenos">248</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ssl.predict-249"><a href="#ssl.predict-249"><span class="linenos">249</span></a>
</span><span id="ssl.predict-250"><a href="#ssl.predict-250"><span class="linenos">250</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitted</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="ssl.predict-251"><a href="#ssl.predict-251"><span class="linenos">251</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Model has not been fitted yet.&#39;</span><span class="p">)</span>
</span><span id="ssl.predict-252"><a href="#ssl.predict-252"><span class="linenos">252</span></a>
</span><span id="ssl.predict-253"><a href="#ssl.predict-253"><span class="linenos">253</span></a>        <span class="k">if</span> <span class="n">ignore_class_priors</span><span class="p">:</span>
</span><span id="ssl.predict-254"><a href="#ssl.predict-254"><span class="linenos">254</span></a>            <span class="n">w</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="ssl.predict-255"><a href="#ssl.predict-255"><span class="linenos">255</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ssl.predict-256"><a href="#ssl.predict-256"><span class="linenos">256</span></a>            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span>
</span><span id="ssl.predict-257"><a href="#ssl.predict-257"><span class="linenos">257</span></a>
</span><span id="ssl.predict-258"><a href="#ssl.predict-258"><span class="linenos">258</span></a>        <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prob</span><span class="p">)</span>
</span><span id="ssl.predict-259"><a href="#ssl.predict-259"><span class="linenos">259</span></a>        <span class="n">scores</span> <span class="o">=</span> <span class="n">scores</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
</span><span id="ssl.predict-260"><a href="#ssl.predict-260"><span class="linenos">260</span></a>
</span><span id="ssl.predict-261"><a href="#ssl.predict-261"><span class="linenos">261</span></a>        <span class="c1">#Check if scores are similarity or distance</span>
</span><span id="ssl.predict-262"><a href="#ssl.predict-262"><span class="linenos">262</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarity</span><span class="p">:</span>
</span><span id="ssl.predict-263"><a href="#ssl.predict-263"><span class="linenos">263</span></a>            <span class="n">pred_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">scores</span><span class="o">*</span><span class="n">w</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ssl.predict-264"><a href="#ssl.predict-264"><span class="linenos">264</span></a>        <span class="k">else</span><span class="p">:</span> <span class="c1">#Then distances</span>
</span><span id="ssl.predict-265"><a href="#ssl.predict-265"><span class="linenos">265</span></a>            <span class="n">pred_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">scores</span><span class="o">*</span><span class="n">w</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ssl.predict-266"><a href="#ssl.predict-266"><span class="linenos">266</span></a>
</span><span id="ssl.predict-267"><a href="#ssl.predict-267"><span class="linenos">267</span></a>        <span class="k">return</span> <span class="n">pred_labels</span> 
</span></pre></div>


            <div class="docstring"><h1 id="predict">Predict</h1>

<p>Makes label predictions based on the probabilities computed by <code><a href="#ssl.fit">fit()</a></code>.
Will use a volume label projection if <code><a href="#ssl.class_priors">class_priors</a></code> were given, to ensure 
the number of nodes predicted in each class is correct.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>ignore_class_priors</strong> (bool (optional), default=False):
Used to disable the volume constrained label decision, when <code><a href="#ssl.class_priors">class_priors</a></code> has been provided.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>pred_labels</strong> ((int) numpy array):
Predicted labels as integers for all datapoints in the graph.</li>
</ul>
</div>


                            </div>
                            <div id="ssl.fit_predict" class="classattr">
                                        <input id="ssl.fit_predict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fit_predict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">train_ind</span>, </span><span class="param"><span class="n">train_labels</span>, </span><span class="param"><span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ssl.fit_predict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ssl.fit_predict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ssl.fit_predict-269"><a href="#ssl.fit_predict-269"><span class="linenos">269</span></a>    <span class="k">def</span> <span class="nf">fit_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="ssl.fit_predict-270"><a href="#ssl.fit_predict-270"><span class="linenos">270</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit and predict</span>
</span><span id="ssl.fit_predict-271"><a href="#ssl.fit_predict-271"><span class="linenos">271</span></a><span class="sd">        ======</span>
</span><span id="ssl.fit_predict-272"><a href="#ssl.fit_predict-272"><span class="linenos">272</span></a>
</span><span id="ssl.fit_predict-273"><a href="#ssl.fit_predict-273"><span class="linenos">273</span></a><span class="sd">        Calls fit() and predict() sequentially.</span>
</span><span id="ssl.fit_predict-274"><a href="#ssl.fit_predict-274"><span class="linenos">274</span></a>
</span><span id="ssl.fit_predict-275"><a href="#ssl.fit_predict-275"><span class="linenos">275</span></a><span class="sd">        Parameters</span>
</span><span id="ssl.fit_predict-276"><a href="#ssl.fit_predict-276"><span class="linenos">276</span></a><span class="sd">        ----------</span>
</span><span id="ssl.fit_predict-277"><a href="#ssl.fit_predict-277"><span class="linenos">277</span></a><span class="sd">        train_ind : numpy array, int</span>
</span><span id="ssl.fit_predict-278"><a href="#ssl.fit_predict-278"><span class="linenos">278</span></a><span class="sd">            Indicies of training points.</span>
</span><span id="ssl.fit_predict-279"><a href="#ssl.fit_predict-279"><span class="linenos">279</span></a><span class="sd">        train_labels : numpy array, int</span>
</span><span id="ssl.fit_predict-280"><a href="#ssl.fit_predict-280"><span class="linenos">280</span></a><span class="sd">            Training labels as integers \\(0,1,\\dots,k-1\\) for \\(k\\) classes.</span>
</span><span id="ssl.fit_predict-281"><a href="#ssl.fit_predict-281"><span class="linenos">281</span></a><span class="sd">        all_labels : numpy array, int (optional)</span>
</span><span id="ssl.fit_predict-282"><a href="#ssl.fit_predict-282"><span class="linenos">282</span></a><span class="sd">            True labels for all datapoints.</span>
</span><span id="ssl.fit_predict-283"><a href="#ssl.fit_predict-283"><span class="linenos">283</span></a>
</span><span id="ssl.fit_predict-284"><a href="#ssl.fit_predict-284"><span class="linenos">284</span></a><span class="sd">        Returns</span>
</span><span id="ssl.fit_predict-285"><a href="#ssl.fit_predict-285"><span class="linenos">285</span></a><span class="sd">        -------</span>
</span><span id="ssl.fit_predict-286"><a href="#ssl.fit_predict-286"><span class="linenos">286</span></a><span class="sd">        pred_labels : (int) numpy array</span>
</span><span id="ssl.fit_predict-287"><a href="#ssl.fit_predict-287"><span class="linenos">287</span></a><span class="sd">            Predicted labels as integers for all datapoints in the graph.</span>
</span><span id="ssl.fit_predict-288"><a href="#ssl.fit_predict-288"><span class="linenos">288</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ssl.fit_predict-289"><a href="#ssl.fit_predict-289"><span class="linenos">289</span></a>
</span><span id="ssl.fit_predict-290"><a href="#ssl.fit_predict-290"><span class="linenos">290</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="n">all_labels</span><span class="p">)</span>
</span><span id="ssl.fit_predict-291"><a href="#ssl.fit_predict-291"><span class="linenos">291</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><h1 id="fit-and-predict">Fit and predict</h1>

<p>Calls fit() and predict() sequentially.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>train_ind</strong> (numpy array, int):
Indicies of training points.</li>
<li><strong>train_labels</strong> (numpy array, int):
Training labels as integers (0,1,\dots,k-1) for (k) classes.</li>
<li><strong>all_labels</strong> (numpy array, int (optional)):
True labels for all datapoints.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>pred_labels</strong> ((int) numpy array):
Predicted labels as integers for all datapoints in the graph.</li>
</ul>
</div>


                            </div>
                            <div id="ssl.ssl_trials" class="classattr">
                                        <input id="ssl.ssl_trials-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ssl_trials</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">trainsets</span>,</span><span class="param">	<span class="n">labels</span>,</span><span class="param">	<span class="n">num_cores</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">tag</span><span class="o">=</span><span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">save_results</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">num_trials</span><span class="o">=-</span><span class="mi">1</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ssl.ssl_trials-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ssl.ssl_trials"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ssl.ssl_trials-293"><a href="#ssl.ssl_trials-293"><span class="linenos">293</span></a>    <span class="k">def</span> <span class="nf">ssl_trials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trainsets</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">num_cores</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">save_results</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_trials</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="ssl.ssl_trials-294"><a href="#ssl.ssl_trials-294"><span class="linenos">294</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Semi-supervised learning trials</span>
</span><span id="ssl.ssl_trials-295"><a href="#ssl.ssl_trials-295"><span class="linenos">295</span></a><span class="sd">        ===================</span>
</span><span id="ssl.ssl_trials-296"><a href="#ssl.ssl_trials-296"><span class="linenos">296</span></a>
</span><span id="ssl.ssl_trials-297"><a href="#ssl.ssl_trials-297"><span class="linenos">297</span></a><span class="sd">        Runs a semi-supervised learning algorithm on a list of training sets,</span>
</span><span id="ssl.ssl_trials-298"><a href="#ssl.ssl_trials-298"><span class="linenos">298</span></a><span class="sd">        recording the label rates and saves the results to a csv file in the</span>
</span><span id="ssl.ssl_trials-299"><a href="#ssl.ssl_trials-299"><span class="linenos">299</span></a><span class="sd">        local folder results/. The filename is controlled by the member function</span>
</span><span id="ssl.ssl_trials-300"><a href="#ssl.ssl_trials-300"><span class="linenos">300</span></a><span class="sd">        model.get_accuracy_filename(). The trial will abort if the accuracy result</span>
</span><span id="ssl.ssl_trials-301"><a href="#ssl.ssl_trials-301"><span class="linenos">301</span></a><span class="sd">        file already exists, unless `overwrite=True`.</span>
</span><span id="ssl.ssl_trials-302"><a href="#ssl.ssl_trials-302"><span class="linenos">302</span></a>
</span><span id="ssl.ssl_trials-303"><a href="#ssl.ssl_trials-303"><span class="linenos">303</span></a><span class="sd">        Parameters</span>
</span><span id="ssl.ssl_trials-304"><a href="#ssl.ssl_trials-304"><span class="linenos">304</span></a><span class="sd">        ----------</span>
</span><span id="ssl.ssl_trials-305"><a href="#ssl.ssl_trials-305"><span class="linenos">305</span></a><span class="sd">        trainsets : list of numpy arrays</span>
</span><span id="ssl.ssl_trials-306"><a href="#ssl.ssl_trials-306"><span class="linenos">306</span></a><span class="sd">            Collection of training sets to run semi-supervised learning on. This is the output</span>
</span><span id="ssl.ssl_trials-307"><a href="#ssl.ssl_trials-307"><span class="linenos">307</span></a><span class="sd">            of `graphlearning.trainsets.generate` or `graphlearning.trainsets.load`.</span>
</span><span id="ssl.ssl_trials-308"><a href="#ssl.ssl_trials-308"><span class="linenos">308</span></a><span class="sd">        labels : numpy array (int)</span>
</span><span id="ssl.ssl_trials-309"><a href="#ssl.ssl_trials-309"><span class="linenos">309</span></a><span class="sd">            Integer array of labels for entire dataset.</span>
</span><span id="ssl.ssl_trials-310"><a href="#ssl.ssl_trials-310"><span class="linenos">310</span></a><span class="sd">        num_cores : int</span>
</span><span id="ssl.ssl_trials-311"><a href="#ssl.ssl_trials-311"><span class="linenos">311</span></a><span class="sd">            Number of cores to use for parallel processing over trials</span>
</span><span id="ssl.ssl_trials-312"><a href="#ssl.ssl_trials-312"><span class="linenos">312</span></a><span class="sd">        tag : str (optional), default=&#39;&#39;</span>
</span><span id="ssl.ssl_trials-313"><a href="#ssl.ssl_trials-313"><span class="linenos">313</span></a><span class="sd">            An extra identifying tag to add to the accuracy filename.</span>
</span><span id="ssl.ssl_trials-314"><a href="#ssl.ssl_trials-314"><span class="linenos">314</span></a><span class="sd">        save_results : bool (optional), default=True</span>
</span><span id="ssl.ssl_trials-315"><a href="#ssl.ssl_trials-315"><span class="linenos">315</span></a><span class="sd">            Whether to save results to csv file or just print to the screen.</span>
</span><span id="ssl.ssl_trials-316"><a href="#ssl.ssl_trials-316"><span class="linenos">316</span></a><span class="sd">        overwrite : bool (optional), default = False</span>
</span><span id="ssl.ssl_trials-317"><a href="#ssl.ssl_trials-317"><span class="linenos">317</span></a><span class="sd">            Whether to overwrite existing results file, if found. If `overwrite=False`, </span>
</span><span id="ssl.ssl_trials-318"><a href="#ssl.ssl_trials-318"><span class="linenos">318</span></a><span class="sd">            `save_results=True`, and the results file is found, the trial is aborted.</span>
</span><span id="ssl.ssl_trials-319"><a href="#ssl.ssl_trials-319"><span class="linenos">319</span></a><span class="sd">        num_trials: int (optional), defualt = -1</span>
</span><span id="ssl.ssl_trials-320"><a href="#ssl.ssl_trials-320"><span class="linenos">320</span></a><span class="sd">            Number of trials. Any negative number runs all trials.</span>
</span><span id="ssl.ssl_trials-321"><a href="#ssl.ssl_trials-321"><span class="linenos">321</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ssl.ssl_trials-322"><a href="#ssl.ssl_trials-322"><span class="linenos">322</span></a>
</span><span id="ssl.ssl_trials-323"><a href="#ssl.ssl_trials-323"><span class="linenos">323</span></a>        <span class="k">if</span> <span class="n">num_trials</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ssl.ssl_trials-324"><a href="#ssl.ssl_trials-324"><span class="linenos">324</span></a>            <span class="n">trainsets</span> <span class="o">=</span> <span class="n">trainsets</span><span class="p">[:</span><span class="n">num_trials</span><span class="p">]</span>
</span><span id="ssl.ssl_trials-325"><a href="#ssl.ssl_trials-325"><span class="linenos">325</span></a>
</span><span id="ssl.ssl_trials-326"><a href="#ssl.ssl_trials-326"><span class="linenos">326</span></a>        <span class="c1">#Print name</span>
</span><span id="ssl.ssl_trials-327"><a href="#ssl.ssl_trials-327"><span class="linenos">327</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Model: &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="ssl.ssl_trials-328"><a href="#ssl.ssl_trials-328"><span class="linenos">328</span></a>
</span><span id="ssl.ssl_trials-329"><a href="#ssl.ssl_trials-329"><span class="linenos">329</span></a>        <span class="k">if</span> <span class="n">save_results</span><span class="p">:</span>
</span><span id="ssl.ssl_trials-330"><a href="#ssl.ssl_trials-330"><span class="linenos">330</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">results_dir</span><span class="p">):</span>
</span><span id="ssl.ssl_trials-331"><a href="#ssl.ssl_trials-331"><span class="linenos">331</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">results_dir</span><span class="p">)</span>
</span><span id="ssl.ssl_trials-332"><a href="#ssl.ssl_trials-332"><span class="linenos">332</span></a>
</span><span id="ssl.ssl_trials-333"><a href="#ssl.ssl_trials-333"><span class="linenos">333</span></a>            <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="n">tag</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_accuracy_filename</span><span class="p">())</span>
</span><span id="ssl.ssl_trials-334"><a href="#ssl.ssl_trials-334"><span class="linenos">334</span></a>            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">overwrite</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outfile</span><span class="p">):</span>
</span><span id="ssl.ssl_trials-335"><a href="#ssl.ssl_trials-335"><span class="linenos">335</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Aborting: SSL trial already completed, and overwrite is False.&#39;</span><span class="p">)</span>
</span><span id="ssl.ssl_trials-336"><a href="#ssl.ssl_trials-336"><span class="linenos">336</span></a>                <span class="k">return</span>
</span><span id="ssl.ssl_trials-337"><a href="#ssl.ssl_trials-337"><span class="linenos">337</span></a>            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="ssl.ssl_trials-338"><a href="#ssl.ssl_trials-338"><span class="linenos">338</span></a>            <span class="c1">#now = datetime.datetime.now()</span>
</span><span id="ssl.ssl_trials-339"><a href="#ssl.ssl_trials-339"><span class="linenos">339</span></a>            <span class="c1">#f.write(&quot;Date/Time, &quot;+now.strftime(&quot;%Y-%m-%d_%H:%M&quot;)+&quot;\n&quot;)</span>
</span><span id="ssl.ssl_trials-340"><a href="#ssl.ssl_trials-340"><span class="linenos">340</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ssl.ssl_trials-341"><a href="#ssl.ssl_trials-341"><span class="linenos">341</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Number of labels,Accuracy</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ssl.ssl_trials-342"><a href="#ssl.ssl_trials-342"><span class="linenos">342</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ssl.ssl_trials-343"><a href="#ssl.ssl_trials-343"><span class="linenos">343</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Number of labels,Accuracy,Accuracy with class priors,Class priors error</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ssl.ssl_trials-344"><a href="#ssl.ssl_trials-344"><span class="linenos">344</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="ssl.ssl_trials-345"><a href="#ssl.ssl_trials-345"><span class="linenos">345</span></a>
</span><span id="ssl.ssl_trials-346"><a href="#ssl.ssl_trials-346"><span class="linenos">346</span></a>        <span class="k">if</span> <span class="n">save_results</span><span class="p">:</span>
</span><span id="ssl.ssl_trials-347"><a href="#ssl.ssl_trials-347"><span class="linenos">347</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Results File: &#39;</span><span class="o">+</span><span class="n">outfile</span><span class="p">)</span>
</span><span id="ssl.ssl_trials-348"><a href="#ssl.ssl_trials-348"><span class="linenos">348</span></a>
</span><span id="ssl.ssl_trials-349"><a href="#ssl.ssl_trials-349"><span class="linenos">349</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ssl.ssl_trials-350"><a href="#ssl.ssl_trials-350"><span class="linenos">350</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Number of labels,Accuracy&#39;</span><span class="p">)</span>
</span><span id="ssl.ssl_trials-351"><a href="#ssl.ssl_trials-351"><span class="linenos">351</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ssl.ssl_trials-352"><a href="#ssl.ssl_trials-352"><span class="linenos">352</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Number of labels,Accuracy,Accuracy with class priors,Class priors error&#39;</span><span class="p">)</span>
</span><span id="ssl.ssl_trials-353"><a href="#ssl.ssl_trials-353"><span class="linenos">353</span></a>
</span><span id="ssl.ssl_trials-354"><a href="#ssl.ssl_trials-354"><span class="linenos">354</span></a>        <span class="c1">#Trial run to trigger eigensolvers, when needed</span>
</span><span id="ssl.ssl_trials-355"><a href="#ssl.ssl_trials-355"><span class="linenos">355</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires_eig</span><span class="p">:</span>
</span><span id="ssl.ssl_trials-356"><a href="#ssl.ssl_trials-356"><span class="linenos">356</span></a>            <span class="n">pred_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">trainsets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">labels</span><span class="p">[</span><span class="n">trainsets</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="ssl.ssl_trials-357"><a href="#ssl.ssl_trials-357"><span class="linenos">357</span></a>     
</span><span id="ssl.ssl_trials-358"><a href="#ssl.ssl_trials-358"><span class="linenos">358</span></a>        <span class="k">def</span> <span class="nf">one_trial</span><span class="p">(</span><span class="n">train_ind</span><span class="p">):</span>
</span><span id="ssl.ssl_trials-359"><a href="#ssl.ssl_trials-359"><span class="linenos">359</span></a>
</span><span id="ssl.ssl_trials-360"><a href="#ssl.ssl_trials-360"><span class="linenos">360</span></a>            <span class="c1">#Number of labels</span>
</span><span id="ssl.ssl_trials-361"><a href="#ssl.ssl_trials-361"><span class="linenos">361</span></a>            <span class="n">num_train</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="ssl.ssl_trials-362"><a href="#ssl.ssl_trials-362"><span class="linenos">362</span></a>            <span class="n">train_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span>
</span><span id="ssl.ssl_trials-363"><a href="#ssl.ssl_trials-363"><span class="linenos">363</span></a>
</span><span id="ssl.ssl_trials-364"><a href="#ssl.ssl_trials-364"><span class="linenos">364</span></a>            <span class="c1">#Run semi-supervised learning</span>
</span><span id="ssl.ssl_trials-365"><a href="#ssl.ssl_trials-365"><span class="linenos">365</span></a>            <span class="n">pred_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>
</span><span id="ssl.ssl_trials-366"><a href="#ssl.ssl_trials-366"><span class="linenos">366</span></a>
</span><span id="ssl.ssl_trials-367"><a href="#ssl.ssl_trials-367"><span class="linenos">367</span></a>            <span class="c1">#Compute accuracy</span>
</span><span id="ssl.ssl_trials-368"><a href="#ssl.ssl_trials-368"><span class="linenos">368</span></a>            <span class="n">accuracy</span> <span class="o">=</span> <span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">pred_labels</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="ssl.ssl_trials-369"><a href="#ssl.ssl_trials-369"><span class="linenos">369</span></a>
</span><span id="ssl.ssl_trials-370"><a href="#ssl.ssl_trials-370"><span class="linenos">370</span></a>            <span class="c1">#If class priors were provided, check accuracy without priors</span>
</span><span id="ssl.ssl_trials-371"><a href="#ssl.ssl_trials-371"><span class="linenos">371</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ssl.ssl_trials-372"><a href="#ssl.ssl_trials-372"><span class="linenos">372</span></a>                <span class="n">pred_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">ignore_class_priors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ssl.ssl_trials-373"><a href="#ssl.ssl_trials-373"><span class="linenos">373</span></a>                <span class="n">accuracy_without_priors</span> <span class="o">=</span> <span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">pred_labels</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="ssl.ssl_trials-374"><a href="#ssl.ssl_trials-374"><span class="linenos">374</span></a>            
</span><span id="ssl.ssl_trials-375"><a href="#ssl.ssl_trials-375"><span class="linenos">375</span></a>            <span class="c1">#Print to terminal</span>
</span><span id="ssl.ssl_trials-376"><a href="#ssl.ssl_trials-376"><span class="linenos">376</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ssl.ssl_trials-377"><a href="#ssl.ssl_trials-377"><span class="linenos">377</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">num_train</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">accuracy</span><span class="p">)</span>
</span><span id="ssl.ssl_trials-378"><a href="#ssl.ssl_trials-378"><span class="linenos">378</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ssl.ssl_trials-379"><a href="#ssl.ssl_trials-379"><span class="linenos">379</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">,</span><span class="si">%.2f</span><span class="s2">,</span><span class="si">%.2f</span><span class="s2">,</span><span class="si">%.5f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_train</span><span class="p">,</span><span class="n">accuracy_without_priors</span><span class="p">,</span><span class="n">accuracy</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">class_priors_error</span><span class="p">))</span>
</span><span id="ssl.ssl_trials-380"><a href="#ssl.ssl_trials-380"><span class="linenos">380</span></a>
</span><span id="ssl.ssl_trials-381"><a href="#ssl.ssl_trials-381"><span class="linenos">381</span></a>            <span class="c1">#Write to file</span>
</span><span id="ssl.ssl_trials-382"><a href="#ssl.ssl_trials-382"><span class="linenos">382</span></a>            <span class="k">if</span> <span class="n">save_results</span><span class="p">:</span>
</span><span id="ssl.ssl_trials-383"><a href="#ssl.ssl_trials-383"><span class="linenos">383</span></a>                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="s2">&quot;a+&quot;</span><span class="p">)</span>
</span><span id="ssl.ssl_trials-384"><a href="#ssl.ssl_trials-384"><span class="linenos">384</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ssl.ssl_trials-385"><a href="#ssl.ssl_trials-385"><span class="linenos">385</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">num_train</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="si">%.2f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">accuracy</span><span class="p">)</span>
</span><span id="ssl.ssl_trials-386"><a href="#ssl.ssl_trials-386"><span class="linenos">386</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ssl.ssl_trials-387"><a href="#ssl.ssl_trials-387"><span class="linenos">387</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">,</span><span class="si">%.2f</span><span class="s2">,</span><span class="si">%.2f</span><span class="s2">,</span><span class="si">%.5f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_train</span><span class="p">,</span><span class="n">accuracy_without_priors</span><span class="p">,</span><span class="n">accuracy</span><span class="p">,</span>
</span><span id="ssl.ssl_trials-388"><a href="#ssl.ssl_trials-388"><span class="linenos">388</span></a>                                                                            <span class="bp">self</span><span class="o">.</span><span class="n">class_priors_error</span><span class="p">))</span>
</span><span id="ssl.ssl_trials-389"><a href="#ssl.ssl_trials-389"><span class="linenos">389</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="ssl.ssl_trials-390"><a href="#ssl.ssl_trials-390"><span class="linenos">390</span></a>
</span><span id="ssl.ssl_trials-391"><a href="#ssl.ssl_trials-391"><span class="linenos">391</span></a>        <span class="n">num_cores</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">(),</span><span class="n">num_cores</span><span class="p">)</span>
</span><span id="ssl.ssl_trials-392"><a href="#ssl.ssl_trials-392"><span class="linenos">392</span></a>
</span><span id="ssl.ssl_trials-393"><a href="#ssl.ssl_trials-393"><span class="linenos">393</span></a>        <span class="k">if</span> <span class="n">num_cores</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="ssl.ssl_trials-394"><a href="#ssl.ssl_trials-394"><span class="linenos">394</span></a>            <span class="k">for</span> <span class="n">train_ind</span> <span class="ow">in</span> <span class="n">trainsets</span><span class="p">:</span>
</span><span id="ssl.ssl_trials-395"><a href="#ssl.ssl_trials-395"><span class="linenos">395</span></a>                <span class="n">one_trial</span><span class="p">(</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="ssl.ssl_trials-396"><a href="#ssl.ssl_trials-396"><span class="linenos">396</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ssl.ssl_trials-397"><a href="#ssl.ssl_trials-397"><span class="linenos">397</span></a>            <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">num_cores</span><span class="p">)(</span><span class="n">delayed</span><span class="p">(</span><span class="n">one_trial</span><span class="p">)(</span><span class="n">train_ind</span><span class="p">)</span> <span class="k">for</span> <span class="n">train_ind</span> <span class="ow">in</span> <span class="n">trainsets</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h1 id="semi-supervised-learning-trials">Semi-supervised learning trials</h1>

<p>Runs a semi-supervised learning algorithm on a list of training sets,
recording the label rates and saves the results to a csv file in the
local folder results/. The filename is controlled by the member function
model.get_accuracy_filename(). The trial will abort if the accuracy result
file already exists, unless <code>overwrite=True</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>trainsets</strong> (list of numpy arrays):
Collection of training sets to run semi-supervised learning on. This is the output
of <code><a href="trainsets.html#generate">graphlearning.trainsets.generate</a></code> or <code><a href="trainsets.html#load">graphlearning.trainsets.load</a></code>.</li>
<li><strong>labels</strong> (numpy array (int)):
Integer array of labels for entire dataset.</li>
<li><strong>num_cores</strong> (int):
Number of cores to use for parallel processing over trials</li>
<li><strong>tag</strong> (str (optional), default=''):
An extra identifying tag to add to the accuracy filename.</li>
<li><strong>save_results</strong> (bool (optional), default=True):
Whether to save results to csv file or just print to the screen.</li>
<li><strong>overwrite</strong> (bool (optional), default = False):
Whether to overwrite existing results file, if found. If <code>overwrite=False</code>, 
<code>save_results=True</code>, and the results file is found, the trial is aborted.</li>
<li><strong>num_trials</strong> (int (optional), defualt = -1):
Number of trials. Any negative number runs all trials.</li>
</ul>
</div>


                            </div>
                            <div id="ssl.trials_statistics" class="classattr">
                                        <input id="ssl.trials_statistics-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">trials_statistics</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ssl.trials_statistics-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ssl.trials_statistics"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ssl.trials_statistics-399"><a href="#ssl.trials_statistics-399"><span class="linenos">399</span></a>    <span class="k">def</span> <span class="nf">trials_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="ssl.trials_statistics-400"><a href="#ssl.trials_statistics-400"><span class="linenos">400</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trials statistics</span>
</span><span id="ssl.trials_statistics-401"><a href="#ssl.trials_statistics-401"><span class="linenos">401</span></a><span class="sd">        ===================</span>
</span><span id="ssl.trials_statistics-402"><a href="#ssl.trials_statistics-402"><span class="linenos">402</span></a>
</span><span id="ssl.trials_statistics-403"><a href="#ssl.trials_statistics-403"><span class="linenos">403</span></a><span class="sd">        Loads accuracy scores from each trial from csv files created by `ssl_trials`</span>
</span><span id="ssl.trials_statistics-404"><a href="#ssl.trials_statistics-404"><span class="linenos">404</span></a><span class="sd">        and returns summary statistics (mean and standard deviation of accuracy).</span>
</span><span id="ssl.trials_statistics-405"><a href="#ssl.trials_statistics-405"><span class="linenos">405</span></a>
</span><span id="ssl.trials_statistics-406"><a href="#ssl.trials_statistics-406"><span class="linenos">406</span></a><span class="sd">        Parameters</span>
</span><span id="ssl.trials_statistics-407"><a href="#ssl.trials_statistics-407"><span class="linenos">407</span></a><span class="sd">        ----------</span>
</span><span id="ssl.trials_statistics-408"><a href="#ssl.trials_statistics-408"><span class="linenos">408</span></a><span class="sd">        tag : str (optional), default=&#39;&#39;</span>
</span><span id="ssl.trials_statistics-409"><a href="#ssl.trials_statistics-409"><span class="linenos">409</span></a><span class="sd">            An extra identifying tag to add to the accuracy filename.</span>
</span><span id="ssl.trials_statistics-410"><a href="#ssl.trials_statistics-410"><span class="linenos">410</span></a>
</span><span id="ssl.trials_statistics-411"><a href="#ssl.trials_statistics-411"><span class="linenos">411</span></a><span class="sd">        Returns</span>
</span><span id="ssl.trials_statistics-412"><a href="#ssl.trials_statistics-412"><span class="linenos">412</span></a><span class="sd">        -------</span>
</span><span id="ssl.trials_statistics-413"><a href="#ssl.trials_statistics-413"><span class="linenos">413</span></a><span class="sd">        num_train : numpy array</span>
</span><span id="ssl.trials_statistics-414"><a href="#ssl.trials_statistics-414"><span class="linenos">414</span></a><span class="sd">            Number of training examples in each label rate experiment.</span>
</span><span id="ssl.trials_statistics-415"><a href="#ssl.trials_statistics-415"><span class="linenos">415</span></a><span class="sd">        acc_mean : numpy array</span>
</span><span id="ssl.trials_statistics-416"><a href="#ssl.trials_statistics-416"><span class="linenos">416</span></a><span class="sd">            Mean accuracy over all trials in each experiment.</span>
</span><span id="ssl.trials_statistics-417"><a href="#ssl.trials_statistics-417"><span class="linenos">417</span></a><span class="sd">        acc_stddev : numpy array</span>
</span><span id="ssl.trials_statistics-418"><a href="#ssl.trials_statistics-418"><span class="linenos">418</span></a><span class="sd">            Standard deviation of accuracy over all trials in each experiment.</span>
</span><span id="ssl.trials_statistics-419"><a href="#ssl.trials_statistics-419"><span class="linenos">419</span></a><span class="sd">        num_trials : int</span>
</span><span id="ssl.trials_statistics-420"><a href="#ssl.trials_statistics-420"><span class="linenos">420</span></a><span class="sd">            Number of trials for each label rate.</span>
</span><span id="ssl.trials_statistics-421"><a href="#ssl.trials_statistics-421"><span class="linenos">421</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ssl.trials_statistics-422"><a href="#ssl.trials_statistics-422"><span class="linenos">422</span></a>
</span><span id="ssl.trials_statistics-423"><a href="#ssl.trials_statistics-423"><span class="linenos">423</span></a>        <span class="n">accuracy_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="n">tag</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_accuracy_filename</span><span class="p">())</span>
</span><span id="ssl.trials_statistics-424"><a href="#ssl.trials_statistics-424"><span class="linenos">424</span></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">csvread</span><span class="p">(</span><span class="n">accuracy_filename</span><span class="p">)</span>
</span><span id="ssl.trials_statistics-425"><a href="#ssl.trials_statistics-425"><span class="linenos">425</span></a>        <span class="n">num_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
</span><span id="ssl.trials_statistics-426"><a href="#ssl.trials_statistics-426"><span class="linenos">426</span></a>
</span><span id="ssl.trials_statistics-427"><a href="#ssl.trials_statistics-427"><span class="linenos">427</span></a>        <span class="n">acc_mean</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ssl.trials_statistics-428"><a href="#ssl.trials_statistics-428"><span class="linenos">428</span></a>        <span class="n">acc_stddev</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ssl.trials_statistics-429"><a href="#ssl.trials_statistics-429"><span class="linenos">429</span></a>        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">num_train</span><span class="p">:</span>
</span><span id="ssl.trials_statistics-430"><a href="#ssl.trials_statistics-430"><span class="linenos">430</span></a>            <span class="n">Y</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="ssl.trials_statistics-431"><a href="#ssl.trials_statistics-431"><span class="linenos">431</span></a>            <span class="n">acc_mean</span> <span class="o">+=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
</span><span id="ssl.trials_statistics-432"><a href="#ssl.trials_statistics-432"><span class="linenos">432</span></a>            <span class="n">acc_stddev</span> <span class="o">+=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
</span><span id="ssl.trials_statistics-433"><a href="#ssl.trials_statistics-433"><span class="linenos">433</span></a>
</span><span id="ssl.trials_statistics-434"><a href="#ssl.trials_statistics-434"><span class="linenos">434</span></a>        <span class="n">num_trials</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">num_train</span><span class="p">))</span>
</span><span id="ssl.trials_statistics-435"><a href="#ssl.trials_statistics-435"><span class="linenos">435</span></a>        <span class="n">acc_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">acc_mean</span><span class="p">)</span>
</span><span id="ssl.trials_statistics-436"><a href="#ssl.trials_statistics-436"><span class="linenos">436</span></a>        <span class="n">acc_stddev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">acc_stddev</span><span class="p">)</span>
</span><span id="ssl.trials_statistics-437"><a href="#ssl.trials_statistics-437"><span class="linenos">437</span></a>        <span class="k">return</span> <span class="n">num_train</span><span class="p">,</span> <span class="n">acc_mean</span><span class="p">,</span> <span class="n">acc_stddev</span><span class="p">,</span> <span class="n">num_trials</span>
</span></pre></div>


            <div class="docstring"><h1 id="trials-statistics">Trials statistics</h1>

<p>Loads accuracy scores from each trial from csv files created by <code><a href="#ssl.ssl_trials">ssl_trials</a></code>
and returns summary statistics (mean and standard deviation of accuracy).</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>tag</strong> (str (optional), default=''):
An extra identifying tag to add to the accuracy filename.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>num_train</strong> (numpy array):
Number of training examples in each label rate experiment.</li>
<li><strong>acc_mean</strong> (numpy array):
Mean accuracy over all trials in each experiment.</li>
<li><strong>acc_stddev</strong> (numpy array):
Standard deviation of accuracy over all trials in each experiment.</li>
<li><strong>num_trials</strong> (int):
Number of trials for each label rate.</li>
</ul>
</div>


                            </div>
                            <div id="ssl.fit" class="classattr">
                                        <input id="ssl.fit-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fit</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">train_ind</span>, </span><span class="param"><span class="n">train_labels</span>, </span><span class="param"><span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ssl.fit-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ssl.fit"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ssl.fit-440"><a href="#ssl.fit-440"><span class="linenos">440</span></a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="ssl.fit-441"><a href="#ssl.fit-441"><span class="linenos">441</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit</span>
</span><span id="ssl.fit-442"><a href="#ssl.fit-442"><span class="linenos">442</span></a><span class="sd">        ======</span>
</span><span id="ssl.fit-443"><a href="#ssl.fit-443"><span class="linenos">443</span></a>
</span><span id="ssl.fit-444"><a href="#ssl.fit-444"><span class="linenos">444</span></a><span class="sd">        Solves graph-based learning problem, computing the probability </span>
</span><span id="ssl.fit-445"><a href="#ssl.fit-445"><span class="linenos">445</span></a><span class="sd">        that each node belongs to each class. If `all_labels` is provided, </span>
</span><span id="ssl.fit-446"><a href="#ssl.fit-446"><span class="linenos">446</span></a><span class="sd">        then the solver operates in verbose mode, printing out accuracy</span>
</span><span id="ssl.fit-447"><a href="#ssl.fit-447"><span class="linenos">447</span></a><span class="sd">        at each iteration.</span>
</span><span id="ssl.fit-448"><a href="#ssl.fit-448"><span class="linenos">448</span></a>
</span><span id="ssl.fit-449"><a href="#ssl.fit-449"><span class="linenos">449</span></a><span class="sd">        Parameters</span>
</span><span id="ssl.fit-450"><a href="#ssl.fit-450"><span class="linenos">450</span></a><span class="sd">        ----------</span>
</span><span id="ssl.fit-451"><a href="#ssl.fit-451"><span class="linenos">451</span></a><span class="sd">        train_ind : numpy array, int</span>
</span><span id="ssl.fit-452"><a href="#ssl.fit-452"><span class="linenos">452</span></a><span class="sd">            Indicies of training points.</span>
</span><span id="ssl.fit-453"><a href="#ssl.fit-453"><span class="linenos">453</span></a><span class="sd">        train_labels : numpy array, int</span>
</span><span id="ssl.fit-454"><a href="#ssl.fit-454"><span class="linenos">454</span></a><span class="sd">            Training labels as integers \\(0,1,\\dots,k-1\\) for \\(k\\) classes.</span>
</span><span id="ssl.fit-455"><a href="#ssl.fit-455"><span class="linenos">455</span></a><span class="sd">        all_labels : numpy array, int (optional)</span>
</span><span id="ssl.fit-456"><a href="#ssl.fit-456"><span class="linenos">456</span></a><span class="sd">            True labels for all datapoints.</span>
</span><span id="ssl.fit-457"><a href="#ssl.fit-457"><span class="linenos">457</span></a>
</span><span id="ssl.fit-458"><a href="#ssl.fit-458"><span class="linenos">458</span></a><span class="sd">        Returns</span>
</span><span id="ssl.fit-459"><a href="#ssl.fit-459"><span class="linenos">459</span></a><span class="sd">        -------</span>
</span><span id="ssl.fit-460"><a href="#ssl.fit-460"><span class="linenos">460</span></a><span class="sd">        u : (n,k) numpy array, float</span>
</span><span id="ssl.fit-461"><a href="#ssl.fit-461"><span class="linenos">461</span></a><span class="sd">            Probabilities computed by graph-based learning for each node and each class.</span>
</span><span id="ssl.fit-462"><a href="#ssl.fit-462"><span class="linenos">462</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ssl.fit-463"><a href="#ssl.fit-463"><span class="linenos">463</span></a>
</span><span id="ssl.fit-464"><a href="#ssl.fit-464"><span class="linenos">464</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ssl.fit-465"><a href="#ssl.fit-465"><span class="linenos">465</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;SSL object has no graph. Use graph.set_graph() to provide a graph for SSL.&#39;</span><span class="p">)</span>
</span><span id="ssl.fit-466"><a href="#ssl.fit-466"><span class="linenos">466</span></a>
</span><span id="ssl.fit-467"><a href="#ssl.fit-467"><span class="linenos">467</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fitted</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ssl.fit-468"><a href="#ssl.fit-468"><span class="linenos">468</span></a>
</span><span id="ssl.fit-469"><a href="#ssl.fit-469"><span class="linenos">469</span></a>        <span class="c1">#If a one-vs-rest classifier</span>
</span><span id="ssl.fit-470"><a href="#ssl.fit-470"><span class="linenos">470</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">onevsrest</span><span class="p">:</span>
</span><span id="ssl.fit-471"><a href="#ssl.fit-471"><span class="linenos">471</span></a>            <span class="n">unique_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span>
</span><span id="ssl.fit-472"><a href="#ssl.fit-472"><span class="linenos">472</span></a>            <span class="n">num_labels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">)</span>
</span><span id="ssl.fit-473"><a href="#ssl.fit-473"><span class="linenos">473</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span><span class="n">num_labels</span><span class="p">))</span>
</span><span id="ssl.fit-474"><a href="#ssl.fit-474"><span class="linenos">474</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">):</span>
</span><span id="ssl.fit-475"><a href="#ssl.fit-475"><span class="linenos">475</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">prob</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="o">==</span><span class="n">l</span><span class="p">)</span>
</span><span id="ssl.fit-476"><a href="#ssl.fit-476"><span class="linenos">476</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ssl.fit-477"><a href="#ssl.fit-477"><span class="linenos">477</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="n">all_labels</span><span class="p">)</span>
</span><span id="ssl.fit-478"><a href="#ssl.fit-478"><span class="linenos">478</span></a>
</span><span id="ssl.fit-479"><a href="#ssl.fit-479"><span class="linenos">479</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_priors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ssl.fit-480"><a href="#ssl.fit-480"><span class="linenos">480</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">volume_label_projection</span><span class="p">()</span>
</span><span id="ssl.fit-481"><a href="#ssl.fit-481"><span class="linenos">481</span></a>
</span><span id="ssl.fit-482"><a href="#ssl.fit-482"><span class="linenos">482</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob</span>
</span></pre></div>


            <div class="docstring"><h1 id="fit">Fit</h1>

<p>Solves graph-based learning problem, computing the probability 
that each node belongs to each class. If <code>all_labels</code> is provided, 
then the solver operates in verbose mode, printing out accuracy
at each iteration.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>train_ind</strong> (numpy array, int):
Indicies of training points.</li>
<li><strong>train_labels</strong> (numpy array, int):
Training labels as integers (0,1,\dots,k-1) for (k) classes.</li>
<li><strong>all_labels</strong> (numpy array, int (optional)):
True labels for all datapoints.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>u</strong> ((n,k) numpy array, float):
Probabilities computed by graph-based learning for each node and each class.</li>
</ul>
</div>


                            </div>
                </section>
                <section id="poisson">
                            <input id="poisson-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">poisson</span><wbr>(<span class="base"><a href="#ssl">ssl</a></span>):

                <label class="view-source-button" for="poisson-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#poisson"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="poisson-514"><a href="#poisson-514"><span class="linenos">514</span></a><span class="k">class</span> <span class="nc">poisson</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="poisson-515"><a href="#poisson-515"><span class="linenos">515</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;conjugate_gradient&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">use_cuda</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">min_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">spectral_cutoff</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
</span><span id="poisson-516"><a href="#poisson-516"><span class="linenos">516</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Poisson Learning</span>
</span><span id="poisson-517"><a href="#poisson-517"><span class="linenos">517</span></a><span class="sd">        ===================</span>
</span><span id="poisson-518"><a href="#poisson-518"><span class="linenos">518</span></a>
</span><span id="poisson-519"><a href="#poisson-519"><span class="linenos">519</span></a><span class="sd">        Semi-supervised learning via the solution of the Poisson equation </span>
</span><span id="poisson-520"><a href="#poisson-520"><span class="linenos">520</span></a><span class="sd">        \\[L^p u = \\sum_{j=1}^m \\delta_j(y_j - \\overline{y})^T,\\]</span>
</span><span id="poisson-521"><a href="#poisson-521"><span class="linenos">521</span></a><span class="sd">        where \\(L=D-W\\) is the combinatorial graph Laplacian, </span>
</span><span id="poisson-522"><a href="#poisson-522"><span class="linenos">522</span></a><span class="sd">        \\(y_j\\) are the label vectors, \\(\\overline{y} = \\frac{1}{m}\\sum_{i=1}^m y_j\\) </span>
</span><span id="poisson-523"><a href="#poisson-523"><span class="linenos">523</span></a><span class="sd">        is the average label vector, \\(m\\) is the number of training points, and </span>
</span><span id="poisson-524"><a href="#poisson-524"><span class="linenos">524</span></a><span class="sd">        \\(\\delta_j\\) are standard basis vectors. See the reference for more details.</span>
</span><span id="poisson-525"><a href="#poisson-525"><span class="linenos">525</span></a>
</span><span id="poisson-526"><a href="#poisson-526"><span class="linenos">526</span></a><span class="sd">        Implements 3 different solvers, spectral, gradient_descent, and conjugate_gradient. </span>
</span><span id="poisson-527"><a href="#poisson-527"><span class="linenos">527</span></a><span class="sd">        GPU acceleration is available for gradient descent. See [1] for details.</span>
</span><span id="poisson-528"><a href="#poisson-528"><span class="linenos">528</span></a>
</span><span id="poisson-529"><a href="#poisson-529"><span class="linenos">529</span></a><span class="sd">        Parameters</span>
</span><span id="poisson-530"><a href="#poisson-530"><span class="linenos">530</span></a><span class="sd">        ----------</span>
</span><span id="poisson-531"><a href="#poisson-531"><span class="linenos">531</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="poisson-532"><a href="#poisson-532"><span class="linenos">532</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="poisson-533"><a href="#poisson-533"><span class="linenos">533</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="poisson-534"><a href="#poisson-534"><span class="linenos">534</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="poisson-535"><a href="#poisson-535"><span class="linenos">535</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="poisson-536"><a href="#poisson-536"><span class="linenos">536</span></a><span class="sd">            nodes in each class.</span>
</span><span id="poisson-537"><a href="#poisson-537"><span class="linenos">537</span></a><span class="sd">        solver : {&#39;spectral&#39;, &#39;conjugate_gradient&#39;, &#39;gradient_descent&#39;} (optional), default=&#39;conjugate_gradient&#39;</span>
</span><span id="poisson-538"><a href="#poisson-538"><span class="linenos">538</span></a><span class="sd">            Choice of solver for Poisson learning.</span>
</span><span id="poisson-539"><a href="#poisson-539"><span class="linenos">539</span></a><span class="sd">        p : int (optional), default=1</span>
</span><span id="poisson-540"><a href="#poisson-540"><span class="linenos">540</span></a><span class="sd">            Power for Laplacian, can be any positive real number. Solver will default to &#39;spectral&#39; if p!=1.</span>
</span><span id="poisson-541"><a href="#poisson-541"><span class="linenos">541</span></a><span class="sd">        use_cuda : bool (optional), default=False</span>
</span><span id="poisson-542"><a href="#poisson-542"><span class="linenos">542</span></a><span class="sd">            Whether to use GPU acceleration for gradient descent solver.</span>
</span><span id="poisson-543"><a href="#poisson-543"><span class="linenos">543</span></a><span class="sd">        min_iter : int (optional), default=50</span>
</span><span id="poisson-544"><a href="#poisson-544"><span class="linenos">544</span></a><span class="sd">            Minimum number of iterations of gradient descent before checking stopping condition.</span>
</span><span id="poisson-545"><a href="#poisson-545"><span class="linenos">545</span></a><span class="sd">        max_iter : int (optional), default=1000</span>
</span><span id="poisson-546"><a href="#poisson-546"><span class="linenos">546</span></a><span class="sd">            Maximum number of iterations of gradient descent.</span>
</span><span id="poisson-547"><a href="#poisson-547"><span class="linenos">547</span></a><span class="sd">        tol : float (optional), default=1e-3</span>
</span><span id="poisson-548"><a href="#poisson-548"><span class="linenos">548</span></a><span class="sd">            Tolerance for conjugate gradient solver.</span>
</span><span id="poisson-549"><a href="#poisson-549"><span class="linenos">549</span></a><span class="sd">        spectral_cutoff : int (optional), default=10</span>
</span><span id="poisson-550"><a href="#poisson-550"><span class="linenos">550</span></a><span class="sd">            Number of eigenvectors to use for spectral solver.</span>
</span><span id="poisson-551"><a href="#poisson-551"><span class="linenos">551</span></a>
</span><span id="poisson-552"><a href="#poisson-552"><span class="linenos">552</span></a><span class="sd">        Examples</span>
</span><span id="poisson-553"><a href="#poisson-553"><span class="linenos">553</span></a><span class="sd">        --------</span>
</span><span id="poisson-554"><a href="#poisson-554"><span class="linenos">554</span></a><span class="sd">        Poisson learning works on directed (i.e., nonsymmetric) graphs with the gradient descent solver: [poisson_directed.py](https://github.com/jwcalder/GraphLearning/blob/master/examples/poisson_directed.py).</span>
</span><span id="poisson-555"><a href="#poisson-555"><span class="linenos">555</span></a><span class="sd">        ```py</span>
</span><span id="poisson-556"><a href="#poisson-556"><span class="linenos">556</span></a><span class="sd">        import numpy as np</span>
</span><span id="poisson-557"><a href="#poisson-557"><span class="linenos">557</span></a><span class="sd">        import graphlearning as gl</span>
</span><span id="poisson-558"><a href="#poisson-558"><span class="linenos">558</span></a><span class="sd">        import matplotlib.pyplot as plt</span>
</span><span id="poisson-559"><a href="#poisson-559"><span class="linenos">559</span></a><span class="sd">        import sklearn.datasets as datasets</span>
</span><span id="poisson-560"><a href="#poisson-560"><span class="linenos">560</span></a>
</span><span id="poisson-561"><a href="#poisson-561"><span class="linenos">561</span></a><span class="sd">        X,labels = datasets.make_moons(n_samples=500,noise=0.1)</span>
</span><span id="poisson-562"><a href="#poisson-562"><span class="linenos">562</span></a><span class="sd">        W = gl.weightmatrix.knn(X,10,symmetrize=False)</span>
</span><span id="poisson-563"><a href="#poisson-563"><span class="linenos">563</span></a>
</span><span id="poisson-564"><a href="#poisson-564"><span class="linenos">564</span></a><span class="sd">        train_ind = gl.trainsets.generate(labels, rate=5)</span>
</span><span id="poisson-565"><a href="#poisson-565"><span class="linenos">565</span></a><span class="sd">        train_labels = labels[train_ind]</span>
</span><span id="poisson-566"><a href="#poisson-566"><span class="linenos">566</span></a>
</span><span id="poisson-567"><a href="#poisson-567"><span class="linenos">567</span></a><span class="sd">        model = gl.ssl.poisson(W, solver=&#39;gradient_descent&#39;)</span>
</span><span id="poisson-568"><a href="#poisson-568"><span class="linenos">568</span></a><span class="sd">        pred_labels = model.fit_predict(train_ind, train_labels)</span>
</span><span id="poisson-569"><a href="#poisson-569"><span class="linenos">569</span></a>
</span><span id="poisson-570"><a href="#poisson-570"><span class="linenos">570</span></a><span class="sd">        accuracy = gl.ssl.ssl_accuracy(pred_labels, labels, train_ind)   </span>
</span><span id="poisson-571"><a href="#poisson-571"><span class="linenos">571</span></a><span class="sd">        print(&quot;Accuracy: %.2f%%&quot;%accuracy)</span>
</span><span id="poisson-572"><a href="#poisson-572"><span class="linenos">572</span></a>
</span><span id="poisson-573"><a href="#poisson-573"><span class="linenos">573</span></a><span class="sd">        plt.scatter(X[:,0],X[:,1], c=pred_labels)</span>
</span><span id="poisson-574"><a href="#poisson-574"><span class="linenos">574</span></a><span class="sd">        plt.scatter(X[train_ind,0],X[train_ind,1], c=&#39;r&#39;)</span>
</span><span id="poisson-575"><a href="#poisson-575"><span class="linenos">575</span></a><span class="sd">        plt.show()</span>
</span><span id="poisson-576"><a href="#poisson-576"><span class="linenos">576</span></a><span class="sd">        ```</span>
</span><span id="poisson-577"><a href="#poisson-577"><span class="linenos">577</span></a>
</span><span id="poisson-578"><a href="#poisson-578"><span class="linenos">578</span></a><span class="sd">        Reference</span>
</span><span id="poisson-579"><a href="#poisson-579"><span class="linenos">579</span></a><span class="sd">        ---------</span>
</span><span id="poisson-580"><a href="#poisson-580"><span class="linenos">580</span></a><span class="sd">        [1] J. Calder, B. Cook, M. Thorpe, D. Slepcev. [Poisson Learning: Graph Based Semi-Supervised</span>
</span><span id="poisson-581"><a href="#poisson-581"><span class="linenos">581</span></a><span class="sd">        Learning at Very Low Label Rates.](http://proceedings.mlr.press/v119/calder20a.html), </span>
</span><span id="poisson-582"><a href="#poisson-582"><span class="linenos">582</span></a><span class="sd">        Proceedings of the 37th International Conference on Machine Learning, PMLR 119:1306-1316, 2020.</span>
</span><span id="poisson-583"><a href="#poisson-583"><span class="linenos">583</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="poisson-584"><a href="#poisson-584"><span class="linenos">584</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="poisson-585"><a href="#poisson-585"><span class="linenos">585</span></a>        <span class="k">if</span> <span class="n">solver</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;conjugate_gradient&#39;</span><span class="p">,</span> <span class="s1">&#39;spectral&#39;</span><span class="p">,</span> <span class="s1">&#39;gradient_descent&#39;</span><span class="p">]:</span>
</span><span id="poisson-586"><a href="#poisson-586"><span class="linenos">586</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Invalid Poisson solver&quot;</span><span class="p">)</span>
</span><span id="poisson-587"><a href="#poisson-587"><span class="linenos">587</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">solver</span> <span class="o">=</span> <span class="n">solver</span>
</span><span id="poisson-588"><a href="#poisson-588"><span class="linenos">588</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="poisson-589"><a href="#poisson-589"><span class="linenos">589</span></a>        <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="poisson-590"><a href="#poisson-590"><span class="linenos">590</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">solver</span> <span class="o">=</span> <span class="s1">&#39;spectral&#39;</span>
</span><span id="poisson-591"><a href="#poisson-591"><span class="linenos">591</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_cuda</span> <span class="o">=</span> <span class="n">use_cuda</span>
</span><span id="poisson-592"><a href="#poisson-592"><span class="linenos">592</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">min_iter</span> <span class="o">=</span> <span class="n">min_iter</span>
</span><span id="poisson-593"><a href="#poisson-593"><span class="linenos">593</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_iter</span> <span class="o">=</span> <span class="n">max_iter</span>
</span><span id="poisson-594"><a href="#poisson-594"><span class="linenos">594</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span>
</span><span id="poisson-595"><a href="#poisson-595"><span class="linenos">595</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">spectral_cutoff</span> <span class="o">=</span> <span class="n">spectral_cutoff</span>
</span><span id="poisson-596"><a href="#poisson-596"><span class="linenos">596</span></a>
</span><span id="poisson-597"><a href="#poisson-597"><span class="linenos">597</span></a>        <span class="c1">#Setup accuracy filename</span>
</span><span id="poisson-598"><a href="#poisson-598"><span class="linenos">598</span></a>        <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;_poisson&#39;</span> 
</span><span id="poisson-599"><a href="#poisson-599"><span class="linenos">599</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="poisson-600"><a href="#poisson-600"><span class="linenos">600</span></a>            <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_p</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">p</span>
</span><span id="poisson-601"><a href="#poisson-601"><span class="linenos">601</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solver</span> <span class="o">==</span> <span class="s1">&#39;spectral&#39;</span><span class="p">:</span>
</span><span id="poisson-602"><a href="#poisson-602"><span class="linenos">602</span></a>            <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_N</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">spectral_cutoff</span>
</span><span id="poisson-603"><a href="#poisson-603"><span class="linenos">603</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">requries_eig</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="poisson-604"><a href="#poisson-604"><span class="linenos">604</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="n">fname</span>
</span><span id="poisson-605"><a href="#poisson-605"><span class="linenos">605</span></a>
</span><span id="poisson-606"><a href="#poisson-606"><span class="linenos">606</span></a>        <span class="c1">#Setup Algorithm name</span>
</span><span id="poisson-607"><a href="#poisson-607"><span class="linenos">607</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Poisson Learning&#39;</span>
</span><span id="poisson-608"><a href="#poisson-608"><span class="linenos">608</span></a>
</span><span id="poisson-609"><a href="#poisson-609"><span class="linenos">609</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="poisson-610"><a href="#poisson-610"><span class="linenos">610</span></a>
</span><span id="poisson-611"><a href="#poisson-611"><span class="linenos">611</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span>
</span><span id="poisson-612"><a href="#poisson-612"><span class="linenos">612</span></a>        <span class="n">unique_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span>
</span><span id="poisson-613"><a href="#poisson-613"><span class="linenos">613</span></a>        <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">)</span>
</span><span id="poisson-614"><a href="#poisson-614"><span class="linenos">614</span></a>        
</span><span id="poisson-615"><a href="#poisson-615"><span class="linenos">615</span></a>        <span class="c1">#Zero out diagonal for faster convergence</span>
</span><span id="poisson-616"><a href="#poisson-616"><span class="linenos">616</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">weight_matrix</span>
</span><span id="poisson-617"><a href="#poisson-617"><span class="linenos">617</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="n">W</span> <span class="o">-</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">diagonal</span><span class="p">(),</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</span><span id="poisson-618"><a href="#poisson-618"><span class="linenos">618</span></a>        <span class="n">G</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">graph</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</span><span id="poisson-619"><a href="#poisson-619"><span class="linenos">619</span></a>
</span><span id="poisson-620"><a href="#poisson-620"><span class="linenos">620</span></a>        <span class="c1">#Poisson source term</span>
</span><span id="poisson-621"><a href="#poisson-621"><span class="linenos">621</span></a>        <span class="n">onehot</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span>
</span><span id="poisson-622"><a href="#poisson-622"><span class="linenos">622</span></a>        <span class="n">source</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">onehot</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="poisson-623"><a href="#poisson-623"><span class="linenos">623</span></a>        <span class="n">source</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">onehot</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">onehot</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="poisson-624"><a href="#poisson-624"><span class="linenos">624</span></a>        
</span><span id="poisson-625"><a href="#poisson-625"><span class="linenos">625</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solver</span> <span class="o">==</span> <span class="s1">&#39;conjugate_gradient&#39;</span><span class="p">:</span>  <span class="c1">#Conjugate gradient solver</span>
</span><span id="poisson-626"><a href="#poisson-626"><span class="linenos">626</span></a>
</span><span id="poisson-627"><a href="#poisson-627"><span class="linenos">627</span></a>            <span class="n">L</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">laplacian</span><span class="p">(</span><span class="n">normalization</span><span class="o">=</span><span class="s1">&#39;normalized&#39;</span><span class="p">)</span>
</span><span id="poisson-628"><a href="#poisson-628"><span class="linenos">628</span></a>            <span class="n">D</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">degree_matrix</span><span class="p">(</span><span class="n">p</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="poisson-629"><a href="#poisson-629"><span class="linenos">629</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">conjgrad</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">D</span><span class="o">*</span><span class="n">source</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tol</span><span class="p">)</span>
</span><span id="poisson-630"><a href="#poisson-630"><span class="linenos">630</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">D</span><span class="o">*</span><span class="n">u</span>
</span><span id="poisson-631"><a href="#poisson-631"><span class="linenos">631</span></a>
</span><span id="poisson-632"><a href="#poisson-632"><span class="linenos">632</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">solver</span> <span class="o">==</span> <span class="s2">&quot;gradient_descent&quot;</span><span class="p">:</span>
</span><span id="poisson-633"><a href="#poisson-633"><span class="linenos">633</span></a>
</span><span id="poisson-634"><a href="#poisson-634"><span class="linenos">634</span></a>            <span class="c1">#Setup matrices</span>
</span><span id="poisson-635"><a href="#poisson-635"><span class="linenos">635</span></a>            <span class="n">D</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">degree_matrix</span><span class="p">(</span><span class="n">p</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="poisson-636"><a href="#poisson-636"><span class="linenos">636</span></a>            <span class="n">P</span> <span class="o">=</span> <span class="n">D</span><span class="o">*</span><span class="n">W</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</span><span id="poisson-637"><a href="#poisson-637"><span class="linenos">637</span></a>            <span class="n">Db</span> <span class="o">=</span> <span class="n">D</span><span class="o">*</span><span class="n">source</span>
</span><span id="poisson-638"><a href="#poisson-638"><span class="linenos">638</span></a>
</span><span id="poisson-639"><a href="#poisson-639"><span class="linenos">639</span></a>            <span class="c1">#Invariant distribution</span>
</span><span id="poisson-640"><a href="#poisson-640"><span class="linenos">640</span></a>            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="poisson-641"><a href="#poisson-641"><span class="linenos">641</span></a>            <span class="n">v</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
</span><span id="poisson-642"><a href="#poisson-642"><span class="linenos">642</span></a>            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="poisson-643"><a href="#poisson-643"><span class="linenos">643</span></a>            <span class="n">deg</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">degree_vector</span><span class="p">()</span>
</span><span id="poisson-644"><a href="#poisson-644"><span class="linenos">644</span></a>            <span class="n">vinf</span> <span class="o">=</span> <span class="n">deg</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">deg</span><span class="p">)</span>
</span><span id="poisson-645"><a href="#poisson-645"><span class="linenos">645</span></a>            <span class="n">RW</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">*</span><span class="n">D</span>
</span><span id="poisson-646"><a href="#poisson-646"><span class="linenos">646</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
</span><span id="poisson-647"><a href="#poisson-647"><span class="linenos">647</span></a>
</span><span id="poisson-648"><a href="#poisson-648"><span class="linenos">648</span></a>            <span class="c1">#Number of iterations</span>
</span><span id="poisson-649"><a href="#poisson-649"><span class="linenos">649</span></a>            <span class="n">T</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="poisson-650"><a href="#poisson-650"><span class="linenos">650</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_cuda</span><span class="p">:</span>
</span><span id="poisson-651"><a href="#poisson-651"><span class="linenos">651</span></a>
</span><span id="poisson-652"><a href="#poisson-652"><span class="linenos">652</span></a>                <span class="kn">import</span> <span class="nn">torch</span> 
</span><span id="poisson-653"><a href="#poisson-653"><span class="linenos">653</span></a>
</span><span id="poisson-654"><a href="#poisson-654"><span class="linenos">654</span></a>                <span class="n">Pt</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">torch_sparse</span><span class="p">(</span><span class="n">P</span><span class="p">)</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
</span><span id="poisson-655"><a href="#poisson-655"><span class="linenos">655</span></a>                <span class="n">ut</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
</span><span id="poisson-656"><a href="#poisson-656"><span class="linenos">656</span></a>                <span class="n">Dbt</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">Db</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
</span><span id="poisson-657"><a href="#poisson-657"><span class="linenos">657</span></a>
</span><span id="poisson-658"><a href="#poisson-658"><span class="linenos">658</span></a>                <span class="k">while</span> <span class="p">(</span><span class="n">T</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_iter</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">v</span><span class="o">-</span><span class="n">vinf</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">/</span><span class="n">n</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">T</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_iter</span><span class="p">):</span>
</span><span id="poisson-659"><a href="#poisson-659"><span class="linenos">659</span></a>                    <span class="n">ut</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">addmm</span><span class="p">(</span><span class="n">Dbt</span><span class="p">,</span><span class="n">Pt</span><span class="p">,</span><span class="n">ut</span><span class="p">)</span>
</span><span id="poisson-660"><a href="#poisson-660"><span class="linenos">660</span></a>                    <span class="n">v</span> <span class="o">=</span> <span class="n">RW</span><span class="o">*</span><span class="n">v</span>
</span><span id="poisson-661"><a href="#poisson-661"><span class="linenos">661</span></a>                    <span class="n">T</span> <span class="o">=</span> <span class="n">T</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="poisson-662"><a href="#poisson-662"><span class="linenos">662</span></a>
</span><span id="poisson-663"><a href="#poisson-663"><span class="linenos">663</span></a>                <span class="c1">#Transfer to CPU and convert to numpy</span>
</span><span id="poisson-664"><a href="#poisson-664"><span class="linenos">664</span></a>                <span class="n">u</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</span><span id="poisson-665"><a href="#poisson-665"><span class="linenos">665</span></a>
</span><span id="poisson-666"><a href="#poisson-666"><span class="linenos">666</span></a>            <span class="k">else</span><span class="p">:</span> <span class="c1">#Use CPU</span>
</span><span id="poisson-667"><a href="#poisson-667"><span class="linenos">667</span></a>
</span><span id="poisson-668"><a href="#poisson-668"><span class="linenos">668</span></a>                <span class="k">while</span> <span class="p">(</span><span class="n">T</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_iter</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">v</span><span class="o">-</span><span class="n">vinf</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">/</span><span class="n">n</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">T</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_iter</span><span class="p">):</span>
</span><span id="poisson-669"><a href="#poisson-669"><span class="linenos">669</span></a>                    <span class="n">u</span> <span class="o">=</span> <span class="n">Db</span> <span class="o">+</span> <span class="n">P</span><span class="o">*</span><span class="n">u</span>
</span><span id="poisson-670"><a href="#poisson-670"><span class="linenos">670</span></a>                    <span class="n">v</span> <span class="o">=</span> <span class="n">RW</span><span class="o">*</span><span class="n">v</span>
</span><span id="poisson-671"><a href="#poisson-671"><span class="linenos">671</span></a>                    <span class="n">T</span> <span class="o">=</span> <span class="n">T</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="poisson-672"><a href="#poisson-672"><span class="linenos">672</span></a>
</span><span id="poisson-673"><a href="#poisson-673"><span class="linenos">673</span></a>                    <span class="c1">#Compute accuracy if all labels are provided</span>
</span><span id="poisson-674"><a href="#poisson-674"><span class="linenos">674</span></a>                    <span class="k">if</span> <span class="n">all_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="poisson-675"><a href="#poisson-675"><span class="linenos">675</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">=</span> <span class="n">u</span>
</span><span id="poisson-676"><a href="#poisson-676"><span class="linenos">676</span></a>                        <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</span><span id="poisson-677"><a href="#poisson-677"><span class="linenos">677</span></a>                        <span class="n">acc</span> <span class="o">=</span> <span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">all_labels</span><span class="p">,</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="poisson-678"><a href="#poisson-678"><span class="linenos">678</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,Accuracy = </span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">acc</span><span class="p">))</span>
</span><span id="poisson-679"><a href="#poisson-679"><span class="linenos">679</span></a>                
</span><span id="poisson-680"><a href="#poisson-680"><span class="linenos">680</span></a>        <span class="c1">#Use spectral solver</span>
</span><span id="poisson-681"><a href="#poisson-681"><span class="linenos">681</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">solver</span> <span class="o">==</span> <span class="s1">&#39;spectral&#39;</span><span class="p">:</span>
</span><span id="poisson-682"><a href="#poisson-682"><span class="linenos">682</span></a>
</span><span id="poisson-683"><a href="#poisson-683"><span class="linenos">683</span></a>            <span class="n">vals</span><span class="p">,</span> <span class="n">vecs</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">eigen_decomp</span><span class="p">(</span><span class="n">normalization</span><span class="o">=</span><span class="s1">&#39;randomwalk&#39;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spectral_cutoff</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span id="poisson-684"><a href="#poisson-684"><span class="linenos">684</span></a>            <span class="n">V</span> <span class="o">=</span> <span class="n">vecs</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="poisson-685"><a href="#poisson-685"><span class="linenos">685</span></a>            <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="poisson-686"><a href="#poisson-686"><span class="linenos">686</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="poisson-687"><a href="#poisson-687"><span class="linenos">687</span></a>                <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span>
</span><span id="poisson-688"><a href="#poisson-688"><span class="linenos">688</span></a>            <span class="n">L</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">vals</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectral_cutoff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectral_cutoff</span><span class="p">)</span>
</span><span id="poisson-689"><a href="#poisson-689"><span class="linenos">689</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">V</span><span class="o">@</span><span class="p">(</span><span class="n">L</span><span class="o">@</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="nd">@source</span><span class="p">))</span>
</span><span id="poisson-690"><a href="#poisson-690"><span class="linenos">690</span></a>
</span><span id="poisson-691"><a href="#poisson-691"><span class="linenos">691</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="poisson-692"><a href="#poisson-692"><span class="linenos">692</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Invalid Poisson solver &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">solver</span><span class="p">)</span>
</span><span id="poisson-693"><a href="#poisson-693"><span class="linenos">693</span></a>
</span><span id="poisson-694"><a href="#poisson-694"><span class="linenos">694</span></a>        <span class="k">return</span> <span class="n">u</span>
</span></pre></div>


    

                            <div id="poisson.__init__" class="classattr">
                                        <input id="poisson.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">poisson</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">W</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">solver</span><span class="o">=</span><span class="s1">&#39;conjugate_gradient&#39;</span>,</span><span class="param">	<span class="n">p</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">use_cuda</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">min_iter</span><span class="o">=</span><span class="mi">50</span>,</span><span class="param">	<span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span>,</span><span class="param">	<span class="n">tol</span><span class="o">=</span><span class="mf">0.001</span>,</span><span class="param">	<span class="n">spectral_cutoff</span><span class="o">=</span><span class="mi">10</span></span>)</span>

                <label class="view-source-button" for="poisson.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#poisson.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="poisson.__init__-515"><a href="#poisson.__init__-515"><span class="linenos">515</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;conjugate_gradient&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">use_cuda</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">min_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">spectral_cutoff</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
</span><span id="poisson.__init__-516"><a href="#poisson.__init__-516"><span class="linenos">516</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Poisson Learning</span>
</span><span id="poisson.__init__-517"><a href="#poisson.__init__-517"><span class="linenos">517</span></a><span class="sd">        ===================</span>
</span><span id="poisson.__init__-518"><a href="#poisson.__init__-518"><span class="linenos">518</span></a>
</span><span id="poisson.__init__-519"><a href="#poisson.__init__-519"><span class="linenos">519</span></a><span class="sd">        Semi-supervised learning via the solution of the Poisson equation </span>
</span><span id="poisson.__init__-520"><a href="#poisson.__init__-520"><span class="linenos">520</span></a><span class="sd">        \\[L^p u = \\sum_{j=1}^m \\delta_j(y_j - \\overline{y})^T,\\]</span>
</span><span id="poisson.__init__-521"><a href="#poisson.__init__-521"><span class="linenos">521</span></a><span class="sd">        where \\(L=D-W\\) is the combinatorial graph Laplacian, </span>
</span><span id="poisson.__init__-522"><a href="#poisson.__init__-522"><span class="linenos">522</span></a><span class="sd">        \\(y_j\\) are the label vectors, \\(\\overline{y} = \\frac{1}{m}\\sum_{i=1}^m y_j\\) </span>
</span><span id="poisson.__init__-523"><a href="#poisson.__init__-523"><span class="linenos">523</span></a><span class="sd">        is the average label vector, \\(m\\) is the number of training points, and </span>
</span><span id="poisson.__init__-524"><a href="#poisson.__init__-524"><span class="linenos">524</span></a><span class="sd">        \\(\\delta_j\\) are standard basis vectors. See the reference for more details.</span>
</span><span id="poisson.__init__-525"><a href="#poisson.__init__-525"><span class="linenos">525</span></a>
</span><span id="poisson.__init__-526"><a href="#poisson.__init__-526"><span class="linenos">526</span></a><span class="sd">        Implements 3 different solvers, spectral, gradient_descent, and conjugate_gradient. </span>
</span><span id="poisson.__init__-527"><a href="#poisson.__init__-527"><span class="linenos">527</span></a><span class="sd">        GPU acceleration is available for gradient descent. See [1] for details.</span>
</span><span id="poisson.__init__-528"><a href="#poisson.__init__-528"><span class="linenos">528</span></a>
</span><span id="poisson.__init__-529"><a href="#poisson.__init__-529"><span class="linenos">529</span></a><span class="sd">        Parameters</span>
</span><span id="poisson.__init__-530"><a href="#poisson.__init__-530"><span class="linenos">530</span></a><span class="sd">        ----------</span>
</span><span id="poisson.__init__-531"><a href="#poisson.__init__-531"><span class="linenos">531</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="poisson.__init__-532"><a href="#poisson.__init__-532"><span class="linenos">532</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="poisson.__init__-533"><a href="#poisson.__init__-533"><span class="linenos">533</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="poisson.__init__-534"><a href="#poisson.__init__-534"><span class="linenos">534</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="poisson.__init__-535"><a href="#poisson.__init__-535"><span class="linenos">535</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="poisson.__init__-536"><a href="#poisson.__init__-536"><span class="linenos">536</span></a><span class="sd">            nodes in each class.</span>
</span><span id="poisson.__init__-537"><a href="#poisson.__init__-537"><span class="linenos">537</span></a><span class="sd">        solver : {&#39;spectral&#39;, &#39;conjugate_gradient&#39;, &#39;gradient_descent&#39;} (optional), default=&#39;conjugate_gradient&#39;</span>
</span><span id="poisson.__init__-538"><a href="#poisson.__init__-538"><span class="linenos">538</span></a><span class="sd">            Choice of solver for Poisson learning.</span>
</span><span id="poisson.__init__-539"><a href="#poisson.__init__-539"><span class="linenos">539</span></a><span class="sd">        p : int (optional), default=1</span>
</span><span id="poisson.__init__-540"><a href="#poisson.__init__-540"><span class="linenos">540</span></a><span class="sd">            Power for Laplacian, can be any positive real number. Solver will default to &#39;spectral&#39; if p!=1.</span>
</span><span id="poisson.__init__-541"><a href="#poisson.__init__-541"><span class="linenos">541</span></a><span class="sd">        use_cuda : bool (optional), default=False</span>
</span><span id="poisson.__init__-542"><a href="#poisson.__init__-542"><span class="linenos">542</span></a><span class="sd">            Whether to use GPU acceleration for gradient descent solver.</span>
</span><span id="poisson.__init__-543"><a href="#poisson.__init__-543"><span class="linenos">543</span></a><span class="sd">        min_iter : int (optional), default=50</span>
</span><span id="poisson.__init__-544"><a href="#poisson.__init__-544"><span class="linenos">544</span></a><span class="sd">            Minimum number of iterations of gradient descent before checking stopping condition.</span>
</span><span id="poisson.__init__-545"><a href="#poisson.__init__-545"><span class="linenos">545</span></a><span class="sd">        max_iter : int (optional), default=1000</span>
</span><span id="poisson.__init__-546"><a href="#poisson.__init__-546"><span class="linenos">546</span></a><span class="sd">            Maximum number of iterations of gradient descent.</span>
</span><span id="poisson.__init__-547"><a href="#poisson.__init__-547"><span class="linenos">547</span></a><span class="sd">        tol : float (optional), default=1e-3</span>
</span><span id="poisson.__init__-548"><a href="#poisson.__init__-548"><span class="linenos">548</span></a><span class="sd">            Tolerance for conjugate gradient solver.</span>
</span><span id="poisson.__init__-549"><a href="#poisson.__init__-549"><span class="linenos">549</span></a><span class="sd">        spectral_cutoff : int (optional), default=10</span>
</span><span id="poisson.__init__-550"><a href="#poisson.__init__-550"><span class="linenos">550</span></a><span class="sd">            Number of eigenvectors to use for spectral solver.</span>
</span><span id="poisson.__init__-551"><a href="#poisson.__init__-551"><span class="linenos">551</span></a>
</span><span id="poisson.__init__-552"><a href="#poisson.__init__-552"><span class="linenos">552</span></a><span class="sd">        Examples</span>
</span><span id="poisson.__init__-553"><a href="#poisson.__init__-553"><span class="linenos">553</span></a><span class="sd">        --------</span>
</span><span id="poisson.__init__-554"><a href="#poisson.__init__-554"><span class="linenos">554</span></a><span class="sd">        Poisson learning works on directed (i.e., nonsymmetric) graphs with the gradient descent solver: [poisson_directed.py](https://github.com/jwcalder/GraphLearning/blob/master/examples/poisson_directed.py).</span>
</span><span id="poisson.__init__-555"><a href="#poisson.__init__-555"><span class="linenos">555</span></a><span class="sd">        ```py</span>
</span><span id="poisson.__init__-556"><a href="#poisson.__init__-556"><span class="linenos">556</span></a><span class="sd">        import numpy as np</span>
</span><span id="poisson.__init__-557"><a href="#poisson.__init__-557"><span class="linenos">557</span></a><span class="sd">        import graphlearning as gl</span>
</span><span id="poisson.__init__-558"><a href="#poisson.__init__-558"><span class="linenos">558</span></a><span class="sd">        import matplotlib.pyplot as plt</span>
</span><span id="poisson.__init__-559"><a href="#poisson.__init__-559"><span class="linenos">559</span></a><span class="sd">        import sklearn.datasets as datasets</span>
</span><span id="poisson.__init__-560"><a href="#poisson.__init__-560"><span class="linenos">560</span></a>
</span><span id="poisson.__init__-561"><a href="#poisson.__init__-561"><span class="linenos">561</span></a><span class="sd">        X,labels = datasets.make_moons(n_samples=500,noise=0.1)</span>
</span><span id="poisson.__init__-562"><a href="#poisson.__init__-562"><span class="linenos">562</span></a><span class="sd">        W = gl.weightmatrix.knn(X,10,symmetrize=False)</span>
</span><span id="poisson.__init__-563"><a href="#poisson.__init__-563"><span class="linenos">563</span></a>
</span><span id="poisson.__init__-564"><a href="#poisson.__init__-564"><span class="linenos">564</span></a><span class="sd">        train_ind = gl.trainsets.generate(labels, rate=5)</span>
</span><span id="poisson.__init__-565"><a href="#poisson.__init__-565"><span class="linenos">565</span></a><span class="sd">        train_labels = labels[train_ind]</span>
</span><span id="poisson.__init__-566"><a href="#poisson.__init__-566"><span class="linenos">566</span></a>
</span><span id="poisson.__init__-567"><a href="#poisson.__init__-567"><span class="linenos">567</span></a><span class="sd">        model = gl.ssl.poisson(W, solver=&#39;gradient_descent&#39;)</span>
</span><span id="poisson.__init__-568"><a href="#poisson.__init__-568"><span class="linenos">568</span></a><span class="sd">        pred_labels = model.fit_predict(train_ind, train_labels)</span>
</span><span id="poisson.__init__-569"><a href="#poisson.__init__-569"><span class="linenos">569</span></a>
</span><span id="poisson.__init__-570"><a href="#poisson.__init__-570"><span class="linenos">570</span></a><span class="sd">        accuracy = gl.ssl.ssl_accuracy(pred_labels, labels, train_ind)   </span>
</span><span id="poisson.__init__-571"><a href="#poisson.__init__-571"><span class="linenos">571</span></a><span class="sd">        print(&quot;Accuracy: %.2f%%&quot;%accuracy)</span>
</span><span id="poisson.__init__-572"><a href="#poisson.__init__-572"><span class="linenos">572</span></a>
</span><span id="poisson.__init__-573"><a href="#poisson.__init__-573"><span class="linenos">573</span></a><span class="sd">        plt.scatter(X[:,0],X[:,1], c=pred_labels)</span>
</span><span id="poisson.__init__-574"><a href="#poisson.__init__-574"><span class="linenos">574</span></a><span class="sd">        plt.scatter(X[train_ind,0],X[train_ind,1], c=&#39;r&#39;)</span>
</span><span id="poisson.__init__-575"><a href="#poisson.__init__-575"><span class="linenos">575</span></a><span class="sd">        plt.show()</span>
</span><span id="poisson.__init__-576"><a href="#poisson.__init__-576"><span class="linenos">576</span></a><span class="sd">        ```</span>
</span><span id="poisson.__init__-577"><a href="#poisson.__init__-577"><span class="linenos">577</span></a>
</span><span id="poisson.__init__-578"><a href="#poisson.__init__-578"><span class="linenos">578</span></a><span class="sd">        Reference</span>
</span><span id="poisson.__init__-579"><a href="#poisson.__init__-579"><span class="linenos">579</span></a><span class="sd">        ---------</span>
</span><span id="poisson.__init__-580"><a href="#poisson.__init__-580"><span class="linenos">580</span></a><span class="sd">        [1] J. Calder, B. Cook, M. Thorpe, D. Slepcev. [Poisson Learning: Graph Based Semi-Supervised</span>
</span><span id="poisson.__init__-581"><a href="#poisson.__init__-581"><span class="linenos">581</span></a><span class="sd">        Learning at Very Low Label Rates.](http://proceedings.mlr.press/v119/calder20a.html), </span>
</span><span id="poisson.__init__-582"><a href="#poisson.__init__-582"><span class="linenos">582</span></a><span class="sd">        Proceedings of the 37th International Conference on Machine Learning, PMLR 119:1306-1316, 2020.</span>
</span><span id="poisson.__init__-583"><a href="#poisson.__init__-583"><span class="linenos">583</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="poisson.__init__-584"><a href="#poisson.__init__-584"><span class="linenos">584</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="poisson.__init__-585"><a href="#poisson.__init__-585"><span class="linenos">585</span></a>        <span class="k">if</span> <span class="n">solver</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;conjugate_gradient&#39;</span><span class="p">,</span> <span class="s1">&#39;spectral&#39;</span><span class="p">,</span> <span class="s1">&#39;gradient_descent&#39;</span><span class="p">]:</span>
</span><span id="poisson.__init__-586"><a href="#poisson.__init__-586"><span class="linenos">586</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Invalid Poisson solver&quot;</span><span class="p">)</span>
</span><span id="poisson.__init__-587"><a href="#poisson.__init__-587"><span class="linenos">587</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">solver</span> <span class="o">=</span> <span class="n">solver</span>
</span><span id="poisson.__init__-588"><a href="#poisson.__init__-588"><span class="linenos">588</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="poisson.__init__-589"><a href="#poisson.__init__-589"><span class="linenos">589</span></a>        <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="poisson.__init__-590"><a href="#poisson.__init__-590"><span class="linenos">590</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">solver</span> <span class="o">=</span> <span class="s1">&#39;spectral&#39;</span>
</span><span id="poisson.__init__-591"><a href="#poisson.__init__-591"><span class="linenos">591</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_cuda</span> <span class="o">=</span> <span class="n">use_cuda</span>
</span><span id="poisson.__init__-592"><a href="#poisson.__init__-592"><span class="linenos">592</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">min_iter</span> <span class="o">=</span> <span class="n">min_iter</span>
</span><span id="poisson.__init__-593"><a href="#poisson.__init__-593"><span class="linenos">593</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_iter</span> <span class="o">=</span> <span class="n">max_iter</span>
</span><span id="poisson.__init__-594"><a href="#poisson.__init__-594"><span class="linenos">594</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span>
</span><span id="poisson.__init__-595"><a href="#poisson.__init__-595"><span class="linenos">595</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">spectral_cutoff</span> <span class="o">=</span> <span class="n">spectral_cutoff</span>
</span><span id="poisson.__init__-596"><a href="#poisson.__init__-596"><span class="linenos">596</span></a>
</span><span id="poisson.__init__-597"><a href="#poisson.__init__-597"><span class="linenos">597</span></a>        <span class="c1">#Setup accuracy filename</span>
</span><span id="poisson.__init__-598"><a href="#poisson.__init__-598"><span class="linenos">598</span></a>        <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;_poisson&#39;</span> 
</span><span id="poisson.__init__-599"><a href="#poisson.__init__-599"><span class="linenos">599</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="poisson.__init__-600"><a href="#poisson.__init__-600"><span class="linenos">600</span></a>            <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_p</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">p</span>
</span><span id="poisson.__init__-601"><a href="#poisson.__init__-601"><span class="linenos">601</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solver</span> <span class="o">==</span> <span class="s1">&#39;spectral&#39;</span><span class="p">:</span>
</span><span id="poisson.__init__-602"><a href="#poisson.__init__-602"><span class="linenos">602</span></a>            <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_N</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">spectral_cutoff</span>
</span><span id="poisson.__init__-603"><a href="#poisson.__init__-603"><span class="linenos">603</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">requries_eig</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="poisson.__init__-604"><a href="#poisson.__init__-604"><span class="linenos">604</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="n">fname</span>
</span><span id="poisson.__init__-605"><a href="#poisson.__init__-605"><span class="linenos">605</span></a>
</span><span id="poisson.__init__-606"><a href="#poisson.__init__-606"><span class="linenos">606</span></a>        <span class="c1">#Setup Algorithm name</span>
</span><span id="poisson.__init__-607"><a href="#poisson.__init__-607"><span class="linenos">607</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Poisson Learning&#39;</span>
</span></pre></div>


            <div class="docstring"><h1 id="poisson-learning">Poisson Learning</h1>

<p>Semi-supervised learning via the solution of the Poisson equation 
[L^p u = \sum_{j=1}^m \delta_j(y_j - \overline{y})^T,]
where (L=D-W) is the combinatorial graph Laplacian, 
(y_j) are the label vectors, (\overline{y} = \frac{1}{m}\sum_{i=1}^m y_j) 
is the average label vector, (m) is the number of training points, and 
(\delta_j) are standard basis vectors. See the reference for more details.</p>

<p>Implements 3 different solvers, spectral, gradient_descent, and conjugate_gradient. 
GPU acceleration is available for gradient descent. See [1] for details.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>W</strong> (numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None):
Weight matrix representing the graph.</li>
<li><strong>class_priors</strong> (numpy array (optional), default=None):
Class priors (fraction of data belonging to each class). If provided, the predict function
will attempt to automatic balance the label predictions to predict the correct number of
nodes in each class.</li>
<li><strong>solver</strong> ({'spectral', 'conjugate_gradient', 'gradient_descent'} (optional), default='conjugate_gradient'):
Choice of solver for Poisson learning.</li>
<li><strong>p</strong> (int (optional), default=1):
Power for Laplacian, can be any positive real number. Solver will default to 'spectral' if p!=1.</li>
<li><strong>use_cuda</strong> (bool (optional), default=False):
Whether to use GPU acceleration for gradient descent solver.</li>
<li><strong>min_iter</strong> (int (optional), default=50):
Minimum number of iterations of gradient descent before checking stopping condition.</li>
<li><strong>max_iter</strong> (int (optional), default=1000):
Maximum number of iterations of gradient descent.</li>
<li><strong>tol</strong> (float (optional), default=1e-3):
Tolerance for conjugate gradient solver.</li>
<li><strong>spectral_cutoff</strong> (int (optional), default=10):
Number of eigenvectors to use for spectral solver.</li>
</ul>

<h6 id="examples">Examples</h6>

<p>Poisson learning works on directed (i.e., nonsymmetric) graphs with the gradient descent solver: <a href="https://github.com/jwcalder/GraphLearning/blob/master/examples/poisson_directed.py">poisson_directed.py</a>.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">graphlearning</span> <span class="k">as</span> <span class="nn">gl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">sklearn.datasets</span> <span class="k">as</span> <span class="nn">datasets</span>

<span class="n">X</span><span class="p">,</span><span class="n">labels</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">make_moons</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">noise</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">W</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">weightmatrix</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">symmetrize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">train_ind</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">trainsets</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">train_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">ssl</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;gradient_descent&#39;</span><span class="p">)</span>
<span class="n">pred_labels</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>

<span class="n">accuracy</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">ssl</span><span class="o">.</span><span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">pred_labels</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">)</span>   
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy: </span><span class="si">%.2f%%</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">accuracy</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">pred_labels</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">X</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre>
</div>

<h6 id="reference">Reference</h6>

<p>[1] J. Calder, B. Cook, M. Thorpe, D. Slepcev. <a href="http://proceedings.mlr.press/v119/calder20a.html">Poisson Learning: Graph Based Semi-Supervised
Learning at Very Low Label Rates.</a>, 
Proceedings of the 37th International Conference on Machine Learning, PMLR 119:1306-1316, 2020.</p>
</div>


                            </div>
                            <div id="poisson.solver" class="classattr">
                                <div class="attr variable">
            <span class="name">solver</span>

        
    </div>
    <a class="headerlink" href="#poisson.solver"></a>
    
    

                            </div>
                            <div id="poisson.p" class="classattr">
                                <div class="attr variable">
            <span class="name">p</span>

        
    </div>
    <a class="headerlink" href="#poisson.p"></a>
    
    

                            </div>
                            <div id="poisson.use_cuda" class="classattr">
                                <div class="attr variable">
            <span class="name">use_cuda</span>

        
    </div>
    <a class="headerlink" href="#poisson.use_cuda"></a>
    
    

                            </div>
                            <div id="poisson.min_iter" class="classattr">
                                <div class="attr variable">
            <span class="name">min_iter</span>

        
    </div>
    <a class="headerlink" href="#poisson.min_iter"></a>
    
    

                            </div>
                            <div id="poisson.max_iter" class="classattr">
                                <div class="attr variable">
            <span class="name">max_iter</span>

        
    </div>
    <a class="headerlink" href="#poisson.max_iter"></a>
    
    

                            </div>
                            <div id="poisson.tol" class="classattr">
                                <div class="attr variable">
            <span class="name">tol</span>

        
    </div>
    <a class="headerlink" href="#poisson.tol"></a>
    
    

                            </div>
                            <div id="poisson.spectral_cutoff" class="classattr">
                                <div class="attr variable">
            <span class="name">spectral_cutoff</span>

        
    </div>
    <a class="headerlink" href="#poisson.spectral_cutoff"></a>
    
    

                            </div>
                            <div id="poisson.accuracy_filename" class="classattr">
                                <div class="attr variable">
            <span class="name">accuracy_filename</span>

        
    </div>
    <a class="headerlink" href="#poisson.accuracy_filename"></a>
    
    

                            </div>
                            <div id="poisson.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#poisson.name"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#ssl">ssl</a></dt>
                                <dd id="poisson.prob" class="variable"><a href="#ssl.prob">prob</a></dd>
                <dd id="poisson.fitted" class="variable"><a href="#ssl.fitted">fitted</a></dd>
                <dd id="poisson.requires_eig" class="variable"><a href="#ssl.requires_eig">requires_eig</a></dd>
                <dd id="poisson.onevsrest" class="variable"><a href="#ssl.onevsrest">onevsrest</a></dd>
                <dd id="poisson.similarity" class="variable"><a href="#ssl.similarity">similarity</a></dd>
                <dd id="poisson.class_priors" class="variable"><a href="#ssl.class_priors">class_priors</a></dd>
                <dd id="poisson.weights" class="variable"><a href="#ssl.weights">weights</a></dd>
                <dd id="poisson.class_priors_error" class="variable"><a href="#ssl.class_priors_error">class_priors_error</a></dd>
                <dd id="poisson.set_graph" class="function"><a href="#ssl.set_graph">set_graph</a></dd>
                <dd id="poisson.volume_label_projection" class="function"><a href="#ssl.volume_label_projection">volume_label_projection</a></dd>
                <dd id="poisson.get_accuracy_filename" class="function"><a href="#ssl.get_accuracy_filename">get_accuracy_filename</a></dd>
                <dd id="poisson.predict" class="function"><a href="#ssl.predict">predict</a></dd>
                <dd id="poisson.fit_predict" class="function"><a href="#ssl.fit_predict">fit_predict</a></dd>
                <dd id="poisson.ssl_trials" class="function"><a href="#ssl.ssl_trials">ssl_trials</a></dd>
                <dd id="poisson.trials_statistics" class="function"><a href="#ssl.trials_statistics">trials_statistics</a></dd>
                <dd id="poisson.fit" class="function"><a href="#ssl.fit">fit</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="poisson_mbo">
                            <input id="poisson_mbo-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">poisson_mbo</span><wbr>(<span class="base"><a href="#ssl">ssl</a></span>):

                <label class="view-source-button" for="poisson_mbo-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#poisson_mbo"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="poisson_mbo-696"><a href="#poisson_mbo-696"><span class="linenos">696</span></a><span class="k">class</span> <span class="nc">poisson_mbo</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="poisson_mbo-697"><a href="#poisson_mbo-697"><span class="linenos">697</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;conjugate_gradient&#39;</span><span class="p">,</span> <span class="n">use_cuda</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">min_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">spectral_cutoff</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">Ns</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
</span><span id="poisson_mbo-698"><a href="#poisson_mbo-698"><span class="linenos">698</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;PoissonMBO </span>
</span><span id="poisson_mbo-699"><a href="#poisson_mbo-699"><span class="linenos">699</span></a><span class="sd">        ===================</span>
</span><span id="poisson_mbo-700"><a href="#poisson_mbo-700"><span class="linenos">700</span></a>
</span><span id="poisson_mbo-701"><a href="#poisson_mbo-701"><span class="linenos">701</span></a><span class="sd">        Semi-supervised learning via Poisson MBO method [1]. class_priors must be provided.</span>
</span><span id="poisson_mbo-702"><a href="#poisson_mbo-702"><span class="linenos">702</span></a>
</span><span id="poisson_mbo-703"><a href="#poisson_mbo-703"><span class="linenos">703</span></a><span class="sd">        Parameters</span>
</span><span id="poisson_mbo-704"><a href="#poisson_mbo-704"><span class="linenos">704</span></a><span class="sd">        ----------</span>
</span><span id="poisson_mbo-705"><a href="#poisson_mbo-705"><span class="linenos">705</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="poisson_mbo-706"><a href="#poisson_mbo-706"><span class="linenos">706</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="poisson_mbo-707"><a href="#poisson_mbo-707"><span class="linenos">707</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="poisson_mbo-708"><a href="#poisson_mbo-708"><span class="linenos">708</span></a><span class="sd">            Class priors (fraction of data belonging to each class). </span>
</span><span id="poisson_mbo-709"><a href="#poisson_mbo-709"><span class="linenos">709</span></a><span class="sd">        solver : {&#39;spectral&#39;, &#39;conjugate_gradient&#39;, &#39;gradient_descent&#39;} (optional), default=&#39;conjugate_gradient&#39;</span>
</span><span id="poisson_mbo-710"><a href="#poisson_mbo-710"><span class="linenos">710</span></a><span class="sd">            Choice of solver for Poisson learning.</span>
</span><span id="poisson_mbo-711"><a href="#poisson_mbo-711"><span class="linenos">711</span></a><span class="sd">        use_cuda : bool (optional), default=False</span>
</span><span id="poisson_mbo-712"><a href="#poisson_mbo-712"><span class="linenos">712</span></a><span class="sd">            Whether to use GPU acceleration for gradient descent solver.</span>
</span><span id="poisson_mbo-713"><a href="#poisson_mbo-713"><span class="linenos">713</span></a><span class="sd">        min_iter : int (optional), default=50</span>
</span><span id="poisson_mbo-714"><a href="#poisson_mbo-714"><span class="linenos">714</span></a><span class="sd">            Minimum number of iterations of gradient descent before checking stopping condition.</span>
</span><span id="poisson_mbo-715"><a href="#poisson_mbo-715"><span class="linenos">715</span></a><span class="sd">        max_iter : int (optional), default=1000</span>
</span><span id="poisson_mbo-716"><a href="#poisson_mbo-716"><span class="linenos">716</span></a><span class="sd">            Maximum number of iterations of gradient descent.</span>
</span><span id="poisson_mbo-717"><a href="#poisson_mbo-717"><span class="linenos">717</span></a><span class="sd">        tol : float (optional), default=1e-3</span>
</span><span id="poisson_mbo-718"><a href="#poisson_mbo-718"><span class="linenos">718</span></a><span class="sd">            Tolerance for conjugate gradient solver.</span>
</span><span id="poisson_mbo-719"><a href="#poisson_mbo-719"><span class="linenos">719</span></a><span class="sd">        spectral_cutoff : int (optional), default=10</span>
</span><span id="poisson_mbo-720"><a href="#poisson_mbo-720"><span class="linenos">720</span></a><span class="sd">            Number of eigenvectors to use for spectral solver.</span>
</span><span id="poisson_mbo-721"><a href="#poisson_mbo-721"><span class="linenos">721</span></a><span class="sd">        Ns : int (optional), default=40</span>
</span><span id="poisson_mbo-722"><a href="#poisson_mbo-722"><span class="linenos">722</span></a><span class="sd">            Number of inner iterations in PoissonMBO.</span>
</span><span id="poisson_mbo-723"><a href="#poisson_mbo-723"><span class="linenos">723</span></a><span class="sd">        mu : float (optional), default=1</span>
</span><span id="poisson_mbo-724"><a href="#poisson_mbo-724"><span class="linenos">724</span></a><span class="sd">            Fidelity parameter.</span>
</span><span id="poisson_mbo-725"><a href="#poisson_mbo-725"><span class="linenos">725</span></a><span class="sd">        T : int (optional), default=20</span>
</span><span id="poisson_mbo-726"><a href="#poisson_mbo-726"><span class="linenos">726</span></a><span class="sd">            Number of MBO iterations.</span>
</span><span id="poisson_mbo-727"><a href="#poisson_mbo-727"><span class="linenos">727</span></a><span class="sd">        </span>
</span><span id="poisson_mbo-728"><a href="#poisson_mbo-728"><span class="linenos">728</span></a><span class="sd">        Example</span>
</span><span id="poisson_mbo-729"><a href="#poisson_mbo-729"><span class="linenos">729</span></a><span class="sd">        -------</span>
</span><span id="poisson_mbo-730"><a href="#poisson_mbo-730"><span class="linenos">730</span></a><span class="sd">        Running PoissonMBO on MNIST at 1 label per class: [poisson_mbo.py](https://github.com/jwcalder/GraphLearning/blob/master/examples/poisson_mbo.py).</span>
</span><span id="poisson_mbo-731"><a href="#poisson_mbo-731"><span class="linenos">731</span></a><span class="sd">        ```py</span>
</span><span id="poisson_mbo-732"><a href="#poisson_mbo-732"><span class="linenos">732</span></a><span class="sd">        import graphlearning as gl</span>
</span><span id="poisson_mbo-733"><a href="#poisson_mbo-733"><span class="linenos">733</span></a>
</span><span id="poisson_mbo-734"><a href="#poisson_mbo-734"><span class="linenos">734</span></a><span class="sd">        labels = gl.datasets.load(&#39;mnist&#39;, labels_only=True)</span>
</span><span id="poisson_mbo-735"><a href="#poisson_mbo-735"><span class="linenos">735</span></a><span class="sd">        W = gl.weightmatrix.knn(&#39;mnist&#39;, 10, metric=&#39;vae&#39;)</span>
</span><span id="poisson_mbo-736"><a href="#poisson_mbo-736"><span class="linenos">736</span></a>
</span><span id="poisson_mbo-737"><a href="#poisson_mbo-737"><span class="linenos">737</span></a><span class="sd">        num_train_per_class = 1</span>
</span><span id="poisson_mbo-738"><a href="#poisson_mbo-738"><span class="linenos">738</span></a><span class="sd">        train_ind = gl.trainsets.generate(labels, rate=num_train_per_class)</span>
</span><span id="poisson_mbo-739"><a href="#poisson_mbo-739"><span class="linenos">739</span></a><span class="sd">        train_labels = labels[train_ind]</span>
</span><span id="poisson_mbo-740"><a href="#poisson_mbo-740"><span class="linenos">740</span></a>
</span><span id="poisson_mbo-741"><a href="#poisson_mbo-741"><span class="linenos">741</span></a><span class="sd">        class_priors = gl.utils.class_priors(labels)</span>
</span><span id="poisson_mbo-742"><a href="#poisson_mbo-742"><span class="linenos">742</span></a><span class="sd">        model = gl.ssl.poisson_mbo(W, class_priors)</span>
</span><span id="poisson_mbo-743"><a href="#poisson_mbo-743"><span class="linenos">743</span></a><span class="sd">        pred_labels = model.fit_predict(train_ind,train_labels,all_labels=labels)</span>
</span><span id="poisson_mbo-744"><a href="#poisson_mbo-744"><span class="linenos">744</span></a>
</span><span id="poisson_mbo-745"><a href="#poisson_mbo-745"><span class="linenos">745</span></a><span class="sd">        accuracy = gl.ssl.ssl_accuracy(labels,pred_labels,train_ind)</span>
</span><span id="poisson_mbo-746"><a href="#poisson_mbo-746"><span class="linenos">746</span></a><span class="sd">        print(model.name + &#39;: %.2f%%&#39;%accuracy)</span>
</span><span id="poisson_mbo-747"><a href="#poisson_mbo-747"><span class="linenos">747</span></a><span class="sd">        ```</span>
</span><span id="poisson_mbo-748"><a href="#poisson_mbo-748"><span class="linenos">748</span></a><span class="sd">        Reference</span>
</span><span id="poisson_mbo-749"><a href="#poisson_mbo-749"><span class="linenos">749</span></a><span class="sd">        ---------</span>
</span><span id="poisson_mbo-750"><a href="#poisson_mbo-750"><span class="linenos">750</span></a><span class="sd">        [1] J. Calder, B. Cook, M. Thorpe, D. Slepcev. [Poisson Learning: Graph Based Semi-Supervised</span>
</span><span id="poisson_mbo-751"><a href="#poisson_mbo-751"><span class="linenos">751</span></a><span class="sd">        Learning at Very Low Label Rates.](http://proceedings.mlr.press/v119/calder20a.html), </span>
</span><span id="poisson_mbo-752"><a href="#poisson_mbo-752"><span class="linenos">752</span></a><span class="sd">        Proceedings of the 37th International Conference on Machine Learning, PMLR 119:1306-1316, 2020.</span>
</span><span id="poisson_mbo-753"><a href="#poisson_mbo-753"><span class="linenos">753</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="poisson_mbo-754"><a href="#poisson_mbo-754"><span class="linenos">754</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="poisson_mbo-755"><a href="#poisson_mbo-755"><span class="linenos">755</span></a>
</span><span id="poisson_mbo-756"><a href="#poisson_mbo-756"><span class="linenos">756</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">poisson_model</span> <span class="o">=</span> <span class="n">poisson</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="n">solver</span><span class="p">,</span> <span class="n">use_cuda</span><span class="o">=</span><span class="n">use_cuda</span><span class="p">,</span> <span class="n">min_iter</span><span class="o">=</span><span class="n">min_iter</span><span class="p">,</span> 
</span><span id="poisson_mbo-757"><a href="#poisson_mbo-757"><span class="linenos">757</span></a>                                     <span class="n">max_iter</span><span class="o">=</span><span class="n">max_iter</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span> <span class="n">spectral_cutoff</span><span class="o">=</span><span class="n">spectral_cutoff</span><span class="p">)</span>
</span><span id="poisson_mbo-758"><a href="#poisson_mbo-758"><span class="linenos">758</span></a>
</span><span id="poisson_mbo-759"><a href="#poisson_mbo-759"><span class="linenos">759</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span> <span class="o">=</span> <span class="n">Ns</span>
</span><span id="poisson_mbo-760"><a href="#poisson_mbo-760"><span class="linenos">760</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span>
</span><span id="poisson_mbo-761"><a href="#poisson_mbo-761"><span class="linenos">761</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
</span><span id="poisson_mbo-762"><a href="#poisson_mbo-762"><span class="linenos">762</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_cuda</span> <span class="o">=</span> <span class="n">use_cuda</span>
</span><span id="poisson_mbo-763"><a href="#poisson_mbo-763"><span class="linenos">763</span></a>
</span><span id="poisson_mbo-764"><a href="#poisson_mbo-764"><span class="linenos">764</span></a>        <span class="c1">#Setup accuracy filename</span>
</span><span id="poisson_mbo-765"><a href="#poisson_mbo-765"><span class="linenos">765</span></a>        <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;_poisson_mbo&#39;</span> 
</span><span id="poisson_mbo-766"><a href="#poisson_mbo-766"><span class="linenos">766</span></a>        <span class="k">if</span> <span class="n">solver</span> <span class="o">==</span> <span class="s1">&#39;spectral&#39;</span><span class="p">:</span>
</span><span id="poisson_mbo-767"><a href="#poisson_mbo-767"><span class="linenos">767</span></a>            <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_N</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">spectral_cutoff</span>
</span><span id="poisson_mbo-768"><a href="#poisson_mbo-768"><span class="linenos">768</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">requries_eig</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="poisson_mbo-769"><a href="#poisson_mbo-769"><span class="linenos">769</span></a>        <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_Ns_</span><span class="si">%d</span><span class="s1">_mu_</span><span class="si">%.2f</span><span class="s1">_T_</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Ns</span><span class="p">,</span><span class="n">mu</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
</span><span id="poisson_mbo-770"><a href="#poisson_mbo-770"><span class="linenos">770</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="n">fname</span>
</span><span id="poisson_mbo-771"><a href="#poisson_mbo-771"><span class="linenos">771</span></a>
</span><span id="poisson_mbo-772"><a href="#poisson_mbo-772"><span class="linenos">772</span></a>        <span class="c1">#Setup Algorithm name</span>
</span><span id="poisson_mbo-773"><a href="#poisson_mbo-773"><span class="linenos">773</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Poisson MBO&#39;</span> 
</span><span id="poisson_mbo-774"><a href="#poisson_mbo-774"><span class="linenos">774</span></a>
</span><span id="poisson_mbo-775"><a href="#poisson_mbo-775"><span class="linenos">775</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="poisson_mbo-776"><a href="#poisson_mbo-776"><span class="linenos">776</span></a>
</span><span id="poisson_mbo-777"><a href="#poisson_mbo-777"><span class="linenos">777</span></a>        <span class="c1">#Short forms</span>
</span><span id="poisson_mbo-778"><a href="#poisson_mbo-778"><span class="linenos">778</span></a>        <span class="n">Ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span>
</span><span id="poisson_mbo-779"><a href="#poisson_mbo-779"><span class="linenos">779</span></a>        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span>
</span><span id="poisson_mbo-780"><a href="#poisson_mbo-780"><span class="linenos">780</span></a>        <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span>
</span><span id="poisson_mbo-781"><a href="#poisson_mbo-781"><span class="linenos">781</span></a>        <span class="n">use_cuda</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_cuda</span>
</span><span id="poisson_mbo-782"><a href="#poisson_mbo-782"><span class="linenos">782</span></a>
</span><span id="poisson_mbo-783"><a href="#poisson_mbo-783"><span class="linenos">783</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span>
</span><span id="poisson_mbo-784"><a href="#poisson_mbo-784"><span class="linenos">784</span></a>        <span class="n">unique_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span>
</span><span id="poisson_mbo-785"><a href="#poisson_mbo-785"><span class="linenos">785</span></a>        <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">)</span>
</span><span id="poisson_mbo-786"><a href="#poisson_mbo-786"><span class="linenos">786</span></a>
</span><span id="poisson_mbo-787"><a href="#poisson_mbo-787"><span class="linenos">787</span></a>        <span class="c1">#Zero out diagonal for faster convergence</span>
</span><span id="poisson_mbo-788"><a href="#poisson_mbo-788"><span class="linenos">788</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">weight_matrix</span>
</span><span id="poisson_mbo-789"><a href="#poisson_mbo-789"><span class="linenos">789</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="n">W</span> <span class="o">-</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">diagonal</span><span class="p">(),</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</span><span id="poisson_mbo-790"><a href="#poisson_mbo-790"><span class="linenos">790</span></a>        <span class="n">G</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">graph</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</span><span id="poisson_mbo-791"><a href="#poisson_mbo-791"><span class="linenos">791</span></a>        
</span><span id="poisson_mbo-792"><a href="#poisson_mbo-792"><span class="linenos">792</span></a>        <span class="c1">#Poisson source term</span>
</span><span id="poisson_mbo-793"><a href="#poisson_mbo-793"><span class="linenos">793</span></a>        <span class="n">onehot</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span>
</span><span id="poisson_mbo-794"><a href="#poisson_mbo-794"><span class="linenos">794</span></a>        <span class="n">source</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">onehot</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="poisson_mbo-795"><a href="#poisson_mbo-795"><span class="linenos">795</span></a>        <span class="n">source</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">onehot</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">onehot</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="poisson_mbo-796"><a href="#poisson_mbo-796"><span class="linenos">796</span></a>
</span><span id="poisson_mbo-797"><a href="#poisson_mbo-797"><span class="linenos">797</span></a>        <span class="c1">#Initialize via Poisson learning</span>
</span><span id="poisson_mbo-798"><a href="#poisson_mbo-798"><span class="linenos">798</span></a>        <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poisson_model</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="n">all_labels</span><span class="p">)</span>
</span><span id="poisson_mbo-799"><a href="#poisson_mbo-799"><span class="linenos">799</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</span><span id="poisson_mbo-800"><a href="#poisson_mbo-800"><span class="linenos">800</span></a>
</span><span id="poisson_mbo-801"><a href="#poisson_mbo-801"><span class="linenos">801</span></a>        <span class="c1">#Time step for stability</span>
</span><span id="poisson_mbo-802"><a href="#poisson_mbo-802"><span class="linenos">802</span></a>        <span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">degree_vector</span><span class="p">())</span>
</span><span id="poisson_mbo-803"><a href="#poisson_mbo-803"><span class="linenos">803</span></a>
</span><span id="poisson_mbo-804"><a href="#poisson_mbo-804"><span class="linenos">804</span></a>        <span class="c1">#Precompute some things</span>
</span><span id="poisson_mbo-805"><a href="#poisson_mbo-805"><span class="linenos">805</span></a>        <span class="n">P</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">dt</span><span class="o">*</span><span class="n">G</span><span class="o">.</span><span class="n">laplacian</span><span class="p">()</span>
</span><span id="poisson_mbo-806"><a href="#poisson_mbo-806"><span class="linenos">806</span></a>        <span class="n">Db</span> <span class="o">=</span> <span class="n">mu</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">source</span>
</span><span id="poisson_mbo-807"><a href="#poisson_mbo-807"><span class="linenos">807</span></a>
</span><span id="poisson_mbo-808"><a href="#poisson_mbo-808"><span class="linenos">808</span></a>        <span class="k">if</span> <span class="n">use_cuda</span><span class="p">:</span>
</span><span id="poisson_mbo-809"><a href="#poisson_mbo-809"><span class="linenos">809</span></a>            <span class="kn">import</span> <span class="nn">torch</span>
</span><span id="poisson_mbo-810"><a href="#poisson_mbo-810"><span class="linenos">810</span></a>            <span class="n">Pt</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">torch_sparse</span><span class="p">(</span><span class="n">P</span><span class="p">)</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
</span><span id="poisson_mbo-811"><a href="#poisson_mbo-811"><span class="linenos">811</span></a>            <span class="n">Dbt</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">Db</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
</span><span id="poisson_mbo-812"><a href="#poisson_mbo-812"><span class="linenos">812</span></a>
</span><span id="poisson_mbo-813"><a href="#poisson_mbo-813"><span class="linenos">813</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
</span><span id="poisson_mbo-814"><a href="#poisson_mbo-814"><span class="linenos">814</span></a>
</span><span id="poisson_mbo-815"><a href="#poisson_mbo-815"><span class="linenos">815</span></a>            <span class="c1">#Heat equation step</span>
</span><span id="poisson_mbo-816"><a href="#poisson_mbo-816"><span class="linenos">816</span></a>            <span class="k">if</span> <span class="n">use_cuda</span><span class="p">:</span>
</span><span id="poisson_mbo-817"><a href="#poisson_mbo-817"><span class="linenos">817</span></a>
</span><span id="poisson_mbo-818"><a href="#poisson_mbo-818"><span class="linenos">818</span></a>                <span class="c1">#Put on GPU and run heat equation</span>
</span><span id="poisson_mbo-819"><a href="#poisson_mbo-819"><span class="linenos">819</span></a>                <span class="n">ut</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
</span><span id="poisson_mbo-820"><a href="#poisson_mbo-820"><span class="linenos">820</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
</span><span id="poisson_mbo-821"><a href="#poisson_mbo-821"><span class="linenos">821</span></a>                    <span class="n">ut</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">addmm</span><span class="p">(</span><span class="n">Dbt</span><span class="p">,</span><span class="n">Pt</span><span class="p">,</span><span class="n">ut</span><span class="p">)</span>
</span><span id="poisson_mbo-822"><a href="#poisson_mbo-822"><span class="linenos">822</span></a>
</span><span id="poisson_mbo-823"><a href="#poisson_mbo-823"><span class="linenos">823</span></a>                <span class="c1">#Put back on CPU</span>
</span><span id="poisson_mbo-824"><a href="#poisson_mbo-824"><span class="linenos">824</span></a>                <span class="n">u</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</span><span id="poisson_mbo-825"><a href="#poisson_mbo-825"><span class="linenos">825</span></a>             
</span><span id="poisson_mbo-826"><a href="#poisson_mbo-826"><span class="linenos">826</span></a>            <span class="k">else</span><span class="p">:</span> <span class="c1">#Use CPU </span>
</span><span id="poisson_mbo-827"><a href="#poisson_mbo-827"><span class="linenos">827</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
</span><span id="poisson_mbo-828"><a href="#poisson_mbo-828"><span class="linenos">828</span></a>                    <span class="n">u</span> <span class="o">=</span> <span class="n">P</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span> <span class="n">Db</span>
</span><span id="poisson_mbo-829"><a href="#poisson_mbo-829"><span class="linenos">829</span></a>
</span><span id="poisson_mbo-830"><a href="#poisson_mbo-830"><span class="linenos">830</span></a>            <span class="c1">#Projection step</span>
</span><span id="poisson_mbo-831"><a href="#poisson_mbo-831"><span class="linenos">831</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">=</span> <span class="n">u</span>
</span><span id="poisson_mbo-832"><a href="#poisson_mbo-832"><span class="linenos">832</span></a>            <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">volume_label_projection</span><span class="p">()</span>
</span><span id="poisson_mbo-833"><a href="#poisson_mbo-833"><span class="linenos">833</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</span><span id="poisson_mbo-834"><a href="#poisson_mbo-834"><span class="linenos">834</span></a>
</span><span id="poisson_mbo-835"><a href="#poisson_mbo-835"><span class="linenos">835</span></a>            <span class="c1">#Compute accuracy if all labels are provided</span>
</span><span id="poisson_mbo-836"><a href="#poisson_mbo-836"><span class="linenos">836</span></a>            <span class="k">if</span> <span class="n">all_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="poisson_mbo-837"><a href="#poisson_mbo-837"><span class="linenos">837</span></a>                <span class="n">acc</span> <span class="o">=</span> <span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">all_labels</span><span class="p">,</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="poisson_mbo-838"><a href="#poisson_mbo-838"><span class="linenos">838</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">, Accuracy = </span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">acc</span><span class="p">))</span>
</span><span id="poisson_mbo-839"><a href="#poisson_mbo-839"><span class="linenos">839</span></a>
</span><span id="poisson_mbo-840"><a href="#poisson_mbo-840"><span class="linenos">840</span></a>        <span class="k">return</span> <span class="n">u</span>
</span></pre></div>


    

                            <div id="poisson_mbo.__init__" class="classattr">
                                        <input id="poisson_mbo.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">poisson_mbo</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">W</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">solver</span><span class="o">=</span><span class="s1">&#39;conjugate_gradient&#39;</span>,</span><span class="param">	<span class="n">use_cuda</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">min_iter</span><span class="o">=</span><span class="mi">50</span>,</span><span class="param">	<span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span>,</span><span class="param">	<span class="n">tol</span><span class="o">=</span><span class="mf">0.001</span>,</span><span class="param">	<span class="n">spectral_cutoff</span><span class="o">=</span><span class="mi">10</span>,</span><span class="param">	<span class="n">Ns</span><span class="o">=</span><span class="mi">40</span>,</span><span class="param">	<span class="n">mu</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">T</span><span class="o">=</span><span class="mi">20</span></span>)</span>

                <label class="view-source-button" for="poisson_mbo.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#poisson_mbo.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="poisson_mbo.__init__-697"><a href="#poisson_mbo.__init__-697"><span class="linenos">697</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;conjugate_gradient&#39;</span><span class="p">,</span> <span class="n">use_cuda</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">min_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">spectral_cutoff</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">Ns</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
</span><span id="poisson_mbo.__init__-698"><a href="#poisson_mbo.__init__-698"><span class="linenos">698</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;PoissonMBO </span>
</span><span id="poisson_mbo.__init__-699"><a href="#poisson_mbo.__init__-699"><span class="linenos">699</span></a><span class="sd">        ===================</span>
</span><span id="poisson_mbo.__init__-700"><a href="#poisson_mbo.__init__-700"><span class="linenos">700</span></a>
</span><span id="poisson_mbo.__init__-701"><a href="#poisson_mbo.__init__-701"><span class="linenos">701</span></a><span class="sd">        Semi-supervised learning via Poisson MBO method [1]. class_priors must be provided.</span>
</span><span id="poisson_mbo.__init__-702"><a href="#poisson_mbo.__init__-702"><span class="linenos">702</span></a>
</span><span id="poisson_mbo.__init__-703"><a href="#poisson_mbo.__init__-703"><span class="linenos">703</span></a><span class="sd">        Parameters</span>
</span><span id="poisson_mbo.__init__-704"><a href="#poisson_mbo.__init__-704"><span class="linenos">704</span></a><span class="sd">        ----------</span>
</span><span id="poisson_mbo.__init__-705"><a href="#poisson_mbo.__init__-705"><span class="linenos">705</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="poisson_mbo.__init__-706"><a href="#poisson_mbo.__init__-706"><span class="linenos">706</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="poisson_mbo.__init__-707"><a href="#poisson_mbo.__init__-707"><span class="linenos">707</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="poisson_mbo.__init__-708"><a href="#poisson_mbo.__init__-708"><span class="linenos">708</span></a><span class="sd">            Class priors (fraction of data belonging to each class). </span>
</span><span id="poisson_mbo.__init__-709"><a href="#poisson_mbo.__init__-709"><span class="linenos">709</span></a><span class="sd">        solver : {&#39;spectral&#39;, &#39;conjugate_gradient&#39;, &#39;gradient_descent&#39;} (optional), default=&#39;conjugate_gradient&#39;</span>
</span><span id="poisson_mbo.__init__-710"><a href="#poisson_mbo.__init__-710"><span class="linenos">710</span></a><span class="sd">            Choice of solver for Poisson learning.</span>
</span><span id="poisson_mbo.__init__-711"><a href="#poisson_mbo.__init__-711"><span class="linenos">711</span></a><span class="sd">        use_cuda : bool (optional), default=False</span>
</span><span id="poisson_mbo.__init__-712"><a href="#poisson_mbo.__init__-712"><span class="linenos">712</span></a><span class="sd">            Whether to use GPU acceleration for gradient descent solver.</span>
</span><span id="poisson_mbo.__init__-713"><a href="#poisson_mbo.__init__-713"><span class="linenos">713</span></a><span class="sd">        min_iter : int (optional), default=50</span>
</span><span id="poisson_mbo.__init__-714"><a href="#poisson_mbo.__init__-714"><span class="linenos">714</span></a><span class="sd">            Minimum number of iterations of gradient descent before checking stopping condition.</span>
</span><span id="poisson_mbo.__init__-715"><a href="#poisson_mbo.__init__-715"><span class="linenos">715</span></a><span class="sd">        max_iter : int (optional), default=1000</span>
</span><span id="poisson_mbo.__init__-716"><a href="#poisson_mbo.__init__-716"><span class="linenos">716</span></a><span class="sd">            Maximum number of iterations of gradient descent.</span>
</span><span id="poisson_mbo.__init__-717"><a href="#poisson_mbo.__init__-717"><span class="linenos">717</span></a><span class="sd">        tol : float (optional), default=1e-3</span>
</span><span id="poisson_mbo.__init__-718"><a href="#poisson_mbo.__init__-718"><span class="linenos">718</span></a><span class="sd">            Tolerance for conjugate gradient solver.</span>
</span><span id="poisson_mbo.__init__-719"><a href="#poisson_mbo.__init__-719"><span class="linenos">719</span></a><span class="sd">        spectral_cutoff : int (optional), default=10</span>
</span><span id="poisson_mbo.__init__-720"><a href="#poisson_mbo.__init__-720"><span class="linenos">720</span></a><span class="sd">            Number of eigenvectors to use for spectral solver.</span>
</span><span id="poisson_mbo.__init__-721"><a href="#poisson_mbo.__init__-721"><span class="linenos">721</span></a><span class="sd">        Ns : int (optional), default=40</span>
</span><span id="poisson_mbo.__init__-722"><a href="#poisson_mbo.__init__-722"><span class="linenos">722</span></a><span class="sd">            Number of inner iterations in PoissonMBO.</span>
</span><span id="poisson_mbo.__init__-723"><a href="#poisson_mbo.__init__-723"><span class="linenos">723</span></a><span class="sd">        mu : float (optional), default=1</span>
</span><span id="poisson_mbo.__init__-724"><a href="#poisson_mbo.__init__-724"><span class="linenos">724</span></a><span class="sd">            Fidelity parameter.</span>
</span><span id="poisson_mbo.__init__-725"><a href="#poisson_mbo.__init__-725"><span class="linenos">725</span></a><span class="sd">        T : int (optional), default=20</span>
</span><span id="poisson_mbo.__init__-726"><a href="#poisson_mbo.__init__-726"><span class="linenos">726</span></a><span class="sd">            Number of MBO iterations.</span>
</span><span id="poisson_mbo.__init__-727"><a href="#poisson_mbo.__init__-727"><span class="linenos">727</span></a><span class="sd">        </span>
</span><span id="poisson_mbo.__init__-728"><a href="#poisson_mbo.__init__-728"><span class="linenos">728</span></a><span class="sd">        Example</span>
</span><span id="poisson_mbo.__init__-729"><a href="#poisson_mbo.__init__-729"><span class="linenos">729</span></a><span class="sd">        -------</span>
</span><span id="poisson_mbo.__init__-730"><a href="#poisson_mbo.__init__-730"><span class="linenos">730</span></a><span class="sd">        Running PoissonMBO on MNIST at 1 label per class: [poisson_mbo.py](https://github.com/jwcalder/GraphLearning/blob/master/examples/poisson_mbo.py).</span>
</span><span id="poisson_mbo.__init__-731"><a href="#poisson_mbo.__init__-731"><span class="linenos">731</span></a><span class="sd">        ```py</span>
</span><span id="poisson_mbo.__init__-732"><a href="#poisson_mbo.__init__-732"><span class="linenos">732</span></a><span class="sd">        import graphlearning as gl</span>
</span><span id="poisson_mbo.__init__-733"><a href="#poisson_mbo.__init__-733"><span class="linenos">733</span></a>
</span><span id="poisson_mbo.__init__-734"><a href="#poisson_mbo.__init__-734"><span class="linenos">734</span></a><span class="sd">        labels = gl.datasets.load(&#39;mnist&#39;, labels_only=True)</span>
</span><span id="poisson_mbo.__init__-735"><a href="#poisson_mbo.__init__-735"><span class="linenos">735</span></a><span class="sd">        W = gl.weightmatrix.knn(&#39;mnist&#39;, 10, metric=&#39;vae&#39;)</span>
</span><span id="poisson_mbo.__init__-736"><a href="#poisson_mbo.__init__-736"><span class="linenos">736</span></a>
</span><span id="poisson_mbo.__init__-737"><a href="#poisson_mbo.__init__-737"><span class="linenos">737</span></a><span class="sd">        num_train_per_class = 1</span>
</span><span id="poisson_mbo.__init__-738"><a href="#poisson_mbo.__init__-738"><span class="linenos">738</span></a><span class="sd">        train_ind = gl.trainsets.generate(labels, rate=num_train_per_class)</span>
</span><span id="poisson_mbo.__init__-739"><a href="#poisson_mbo.__init__-739"><span class="linenos">739</span></a><span class="sd">        train_labels = labels[train_ind]</span>
</span><span id="poisson_mbo.__init__-740"><a href="#poisson_mbo.__init__-740"><span class="linenos">740</span></a>
</span><span id="poisson_mbo.__init__-741"><a href="#poisson_mbo.__init__-741"><span class="linenos">741</span></a><span class="sd">        class_priors = gl.utils.class_priors(labels)</span>
</span><span id="poisson_mbo.__init__-742"><a href="#poisson_mbo.__init__-742"><span class="linenos">742</span></a><span class="sd">        model = gl.ssl.poisson_mbo(W, class_priors)</span>
</span><span id="poisson_mbo.__init__-743"><a href="#poisson_mbo.__init__-743"><span class="linenos">743</span></a><span class="sd">        pred_labels = model.fit_predict(train_ind,train_labels,all_labels=labels)</span>
</span><span id="poisson_mbo.__init__-744"><a href="#poisson_mbo.__init__-744"><span class="linenos">744</span></a>
</span><span id="poisson_mbo.__init__-745"><a href="#poisson_mbo.__init__-745"><span class="linenos">745</span></a><span class="sd">        accuracy = gl.ssl.ssl_accuracy(labels,pred_labels,train_ind)</span>
</span><span id="poisson_mbo.__init__-746"><a href="#poisson_mbo.__init__-746"><span class="linenos">746</span></a><span class="sd">        print(model.name + &#39;: %.2f%%&#39;%accuracy)</span>
</span><span id="poisson_mbo.__init__-747"><a href="#poisson_mbo.__init__-747"><span class="linenos">747</span></a><span class="sd">        ```</span>
</span><span id="poisson_mbo.__init__-748"><a href="#poisson_mbo.__init__-748"><span class="linenos">748</span></a><span class="sd">        Reference</span>
</span><span id="poisson_mbo.__init__-749"><a href="#poisson_mbo.__init__-749"><span class="linenos">749</span></a><span class="sd">        ---------</span>
</span><span id="poisson_mbo.__init__-750"><a href="#poisson_mbo.__init__-750"><span class="linenos">750</span></a><span class="sd">        [1] J. Calder, B. Cook, M. Thorpe, D. Slepcev. [Poisson Learning: Graph Based Semi-Supervised</span>
</span><span id="poisson_mbo.__init__-751"><a href="#poisson_mbo.__init__-751"><span class="linenos">751</span></a><span class="sd">        Learning at Very Low Label Rates.](http://proceedings.mlr.press/v119/calder20a.html), </span>
</span><span id="poisson_mbo.__init__-752"><a href="#poisson_mbo.__init__-752"><span class="linenos">752</span></a><span class="sd">        Proceedings of the 37th International Conference on Machine Learning, PMLR 119:1306-1316, 2020.</span>
</span><span id="poisson_mbo.__init__-753"><a href="#poisson_mbo.__init__-753"><span class="linenos">753</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="poisson_mbo.__init__-754"><a href="#poisson_mbo.__init__-754"><span class="linenos">754</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="poisson_mbo.__init__-755"><a href="#poisson_mbo.__init__-755"><span class="linenos">755</span></a>
</span><span id="poisson_mbo.__init__-756"><a href="#poisson_mbo.__init__-756"><span class="linenos">756</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">poisson_model</span> <span class="o">=</span> <span class="n">poisson</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="n">solver</span><span class="p">,</span> <span class="n">use_cuda</span><span class="o">=</span><span class="n">use_cuda</span><span class="p">,</span> <span class="n">min_iter</span><span class="o">=</span><span class="n">min_iter</span><span class="p">,</span> 
</span><span id="poisson_mbo.__init__-757"><a href="#poisson_mbo.__init__-757"><span class="linenos">757</span></a>                                     <span class="n">max_iter</span><span class="o">=</span><span class="n">max_iter</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span> <span class="n">spectral_cutoff</span><span class="o">=</span><span class="n">spectral_cutoff</span><span class="p">)</span>
</span><span id="poisson_mbo.__init__-758"><a href="#poisson_mbo.__init__-758"><span class="linenos">758</span></a>
</span><span id="poisson_mbo.__init__-759"><a href="#poisson_mbo.__init__-759"><span class="linenos">759</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span> <span class="o">=</span> <span class="n">Ns</span>
</span><span id="poisson_mbo.__init__-760"><a href="#poisson_mbo.__init__-760"><span class="linenos">760</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span>
</span><span id="poisson_mbo.__init__-761"><a href="#poisson_mbo.__init__-761"><span class="linenos">761</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
</span><span id="poisson_mbo.__init__-762"><a href="#poisson_mbo.__init__-762"><span class="linenos">762</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_cuda</span> <span class="o">=</span> <span class="n">use_cuda</span>
</span><span id="poisson_mbo.__init__-763"><a href="#poisson_mbo.__init__-763"><span class="linenos">763</span></a>
</span><span id="poisson_mbo.__init__-764"><a href="#poisson_mbo.__init__-764"><span class="linenos">764</span></a>        <span class="c1">#Setup accuracy filename</span>
</span><span id="poisson_mbo.__init__-765"><a href="#poisson_mbo.__init__-765"><span class="linenos">765</span></a>        <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;_poisson_mbo&#39;</span> 
</span><span id="poisson_mbo.__init__-766"><a href="#poisson_mbo.__init__-766"><span class="linenos">766</span></a>        <span class="k">if</span> <span class="n">solver</span> <span class="o">==</span> <span class="s1">&#39;spectral&#39;</span><span class="p">:</span>
</span><span id="poisson_mbo.__init__-767"><a href="#poisson_mbo.__init__-767"><span class="linenos">767</span></a>            <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_N</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">spectral_cutoff</span>
</span><span id="poisson_mbo.__init__-768"><a href="#poisson_mbo.__init__-768"><span class="linenos">768</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">requries_eig</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="poisson_mbo.__init__-769"><a href="#poisson_mbo.__init__-769"><span class="linenos">769</span></a>        <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_Ns_</span><span class="si">%d</span><span class="s1">_mu_</span><span class="si">%.2f</span><span class="s1">_T_</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Ns</span><span class="p">,</span><span class="n">mu</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
</span><span id="poisson_mbo.__init__-770"><a href="#poisson_mbo.__init__-770"><span class="linenos">770</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="n">fname</span>
</span><span id="poisson_mbo.__init__-771"><a href="#poisson_mbo.__init__-771"><span class="linenos">771</span></a>
</span><span id="poisson_mbo.__init__-772"><a href="#poisson_mbo.__init__-772"><span class="linenos">772</span></a>        <span class="c1">#Setup Algorithm name</span>
</span><span id="poisson_mbo.__init__-773"><a href="#poisson_mbo.__init__-773"><span class="linenos">773</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Poisson MBO&#39;</span> 
</span></pre></div>


            <div class="docstring"><h1 id="poissonmbo">PoissonMBO </h1>

<p>Semi-supervised learning via Poisson MBO method [1]. class_priors must be provided.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>W</strong> (numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None):
Weight matrix representing the graph.</li>
<li><strong>class_priors</strong> (numpy array (optional), default=None):
Class priors (fraction of data belonging to each class).</li>
<li><strong>solver</strong> ({'spectral', 'conjugate_gradient', 'gradient_descent'} (optional), default='conjugate_gradient'):
Choice of solver for Poisson learning.</li>
<li><strong>use_cuda</strong> (bool (optional), default=False):
Whether to use GPU acceleration for gradient descent solver.</li>
<li><strong>min_iter</strong> (int (optional), default=50):
Minimum number of iterations of gradient descent before checking stopping condition.</li>
<li><strong>max_iter</strong> (int (optional), default=1000):
Maximum number of iterations of gradient descent.</li>
<li><strong>tol</strong> (float (optional), default=1e-3):
Tolerance for conjugate gradient solver.</li>
<li><strong>spectral_cutoff</strong> (int (optional), default=10):
Number of eigenvectors to use for spectral solver.</li>
<li><strong>Ns</strong> (int (optional), default=40):
Number of inner iterations in PoissonMBO.</li>
<li><strong>mu</strong> (float (optional), default=1):
Fidelity parameter.</li>
<li><strong>T</strong> (int (optional), default=20):
Number of MBO iterations.</li>
</ul>

<h6 id="example">Example</h6>

<p>Running PoissonMBO on MNIST at 1 label per class: <a href="https://github.com/jwcalder/GraphLearning/blob/master/examples/poisson_mbo.py">poisson_mbo.py</a>.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">import</span> <span class="nn">graphlearning</span> <span class="k">as</span> <span class="nn">gl</span>

<span class="n">labels</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;mnist&#39;</span><span class="p">,</span> <span class="n">labels_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">W</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">weightmatrix</span><span class="o">.</span><span class="n">knn</span><span class="p">(</span><span class="s1">&#39;mnist&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;vae&#39;</span><span class="p">)</span>

<span class="n">num_train_per_class</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">train_ind</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">trainsets</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="n">num_train_per_class</span><span class="p">)</span>
<span class="n">train_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span>

<span class="n">class_priors</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">class_priors</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">ssl</span><span class="o">.</span><span class="n">poisson_mbo</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
<span class="n">pred_labels</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span><span class="n">train_labels</span><span class="p">,</span><span class="n">all_labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>

<span class="n">accuracy</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">ssl</span><span class="o">.</span><span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">pred_labels</span><span class="p">,</span><span class="n">train_ind</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;: </span><span class="si">%.2f%%</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">accuracy</span><span class="p">)</span>
</code></pre>
</div>

<h6 id="reference">Reference</h6>

<p>[1] J. Calder, B. Cook, M. Thorpe, D. Slepcev. <a href="http://proceedings.mlr.press/v119/calder20a.html">Poisson Learning: Graph Based Semi-Supervised
Learning at Very Low Label Rates.</a>, 
Proceedings of the 37th International Conference on Machine Learning, PMLR 119:1306-1316, 2020.</p>
</div>


                            </div>
                            <div id="poisson_mbo.poisson_model" class="classattr">
                                <div class="attr variable">
            <span class="name">poisson_model</span>

        
    </div>
    <a class="headerlink" href="#poisson_mbo.poisson_model"></a>
    
    

                            </div>
                            <div id="poisson_mbo.Ns" class="classattr">
                                <div class="attr variable">
            <span class="name">Ns</span>

        
    </div>
    <a class="headerlink" href="#poisson_mbo.Ns"></a>
    
    

                            </div>
                            <div id="poisson_mbo.mu" class="classattr">
                                <div class="attr variable">
            <span class="name">mu</span>

        
    </div>
    <a class="headerlink" href="#poisson_mbo.mu"></a>
    
    

                            </div>
                            <div id="poisson_mbo.T" class="classattr">
                                <div class="attr variable">
            <span class="name">T</span>

        
    </div>
    <a class="headerlink" href="#poisson_mbo.T"></a>
    
    

                            </div>
                            <div id="poisson_mbo.use_cuda" class="classattr">
                                <div class="attr variable">
            <span class="name">use_cuda</span>

        
    </div>
    <a class="headerlink" href="#poisson_mbo.use_cuda"></a>
    
    

                            </div>
                            <div id="poisson_mbo.accuracy_filename" class="classattr">
                                <div class="attr variable">
            <span class="name">accuracy_filename</span>

        
    </div>
    <a class="headerlink" href="#poisson_mbo.accuracy_filename"></a>
    
    

                            </div>
                            <div id="poisson_mbo.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#poisson_mbo.name"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#ssl">ssl</a></dt>
                                <dd id="poisson_mbo.prob" class="variable"><a href="#ssl.prob">prob</a></dd>
                <dd id="poisson_mbo.fitted" class="variable"><a href="#ssl.fitted">fitted</a></dd>
                <dd id="poisson_mbo.requires_eig" class="variable"><a href="#ssl.requires_eig">requires_eig</a></dd>
                <dd id="poisson_mbo.onevsrest" class="variable"><a href="#ssl.onevsrest">onevsrest</a></dd>
                <dd id="poisson_mbo.similarity" class="variable"><a href="#ssl.similarity">similarity</a></dd>
                <dd id="poisson_mbo.class_priors" class="variable"><a href="#ssl.class_priors">class_priors</a></dd>
                <dd id="poisson_mbo.weights" class="variable"><a href="#ssl.weights">weights</a></dd>
                <dd id="poisson_mbo.class_priors_error" class="variable"><a href="#ssl.class_priors_error">class_priors_error</a></dd>
                <dd id="poisson_mbo.set_graph" class="function"><a href="#ssl.set_graph">set_graph</a></dd>
                <dd id="poisson_mbo.volume_label_projection" class="function"><a href="#ssl.volume_label_projection">volume_label_projection</a></dd>
                <dd id="poisson_mbo.get_accuracy_filename" class="function"><a href="#ssl.get_accuracy_filename">get_accuracy_filename</a></dd>
                <dd id="poisson_mbo.predict" class="function"><a href="#ssl.predict">predict</a></dd>
                <dd id="poisson_mbo.fit_predict" class="function"><a href="#ssl.fit_predict">fit_predict</a></dd>
                <dd id="poisson_mbo.ssl_trials" class="function"><a href="#ssl.ssl_trials">ssl_trials</a></dd>
                <dd id="poisson_mbo.trials_statistics" class="function"><a href="#ssl.trials_statistics">trials_statistics</a></dd>
                <dd id="poisson_mbo.fit" class="function"><a href="#ssl.fit">fit</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="volume_mbo">
                            <input id="volume_mbo-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">volume_mbo</span><wbr>(<span class="base"><a href="#ssl">ssl</a></span>):

                <label class="view-source-button" for="volume_mbo-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#volume_mbo"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="volume_mbo-842"><a href="#volume_mbo-842"><span class="linenos">842</span></a><span class="k">class</span> <span class="nc">volume_mbo</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="volume_mbo-843"><a href="#volume_mbo-843"><span class="linenos">843</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">volume_constraint</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
</span><span id="volume_mbo-844"><a href="#volume_mbo-844"><span class="linenos">844</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Volume MBO</span>
</span><span id="volume_mbo-845"><a href="#volume_mbo-845"><span class="linenos">845</span></a><span class="sd">        ===================</span>
</span><span id="volume_mbo-846"><a href="#volume_mbo-846"><span class="linenos">846</span></a>
</span><span id="volume_mbo-847"><a href="#volume_mbo-847"><span class="linenos">847</span></a><span class="sd">        Semi-supervised learning with the VolumeMBO method [1]. class_priors must be provided.</span>
</span><span id="volume_mbo-848"><a href="#volume_mbo-848"><span class="linenos">848</span></a>
</span><span id="volume_mbo-849"><a href="#volume_mbo-849"><span class="linenos">849</span></a><span class="sd">        Parameters</span>
</span><span id="volume_mbo-850"><a href="#volume_mbo-850"><span class="linenos">850</span></a><span class="sd">        ----------</span>
</span><span id="volume_mbo-851"><a href="#volume_mbo-851"><span class="linenos">851</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="volume_mbo-852"><a href="#volume_mbo-852"><span class="linenos">852</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="volume_mbo-853"><a href="#volume_mbo-853"><span class="linenos">853</span></a><span class="sd">        class_priors : numpy array</span>
</span><span id="volume_mbo-854"><a href="#volume_mbo-854"><span class="linenos">854</span></a><span class="sd">            Class priors (fraction of data belonging to each class). </span>
</span><span id="volume_mbo-855"><a href="#volume_mbo-855"><span class="linenos">855</span></a><span class="sd">        temperature : float (optional), default=0.1</span>
</span><span id="volume_mbo-856"><a href="#volume_mbo-856"><span class="linenos">856</span></a><span class="sd">            Temperature for volume constrained MBO.</span>
</span><span id="volume_mbo-857"><a href="#volume_mbo-857"><span class="linenos">857</span></a><span class="sd">        volume_constraint : float (optional), default=0.5</span>
</span><span id="volume_mbo-858"><a href="#volume_mbo-858"><span class="linenos">858</span></a><span class="sd">            The number of points in each class is constrained to be a mulitple \\(\\lambda\\) of the true</span>
</span><span id="volume_mbo-859"><a href="#volume_mbo-859"><span class="linenos">859</span></a><span class="sd">            class size, where </span>
</span><span id="volume_mbo-860"><a href="#volume_mbo-860"><span class="linenos">860</span></a><span class="sd">            \\[ \\text{volume_constraint} \\leq \\lambda \\leq 2-\\text{volume_constraint}.\\]</span>
</span><span id="volume_mbo-861"><a href="#volume_mbo-861"><span class="linenos">861</span></a><span class="sd">            Setting `volume_constraint=1` yields the tightest constraint.</span>
</span><span id="volume_mbo-862"><a href="#volume_mbo-862"><span class="linenos">862</span></a>
</span><span id="volume_mbo-863"><a href="#volume_mbo-863"><span class="linenos">863</span></a><span class="sd">        References</span>
</span><span id="volume_mbo-864"><a href="#volume_mbo-864"><span class="linenos">864</span></a><span class="sd">        ----------</span>
</span><span id="volume_mbo-865"><a href="#volume_mbo-865"><span class="linenos">865</span></a><span class="sd">        [1] M. Jacobs, E. Merkurjev, and S. Esedolu. [Auction dynamics: A volume constrained MBO scheme.](https://www.sciencedirect.com/science/article/pii/S0021999117308033?casa_token=kNahPd2vu50AAAAA:uJQYQVnmMBV_oL0CG1UcOIulY4vhclMGTztm-jjAzy9Lns7rtoOnKs4iyvLOjKXaHU-D6qrQJT4) Journal of Computational Physics 354:288-310, 2018. </span>
</span><span id="volume_mbo-866"><a href="#volume_mbo-866"><span class="linenos">866</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="volume_mbo-867"><a href="#volume_mbo-867"><span class="linenos">867</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="volume_mbo-868"><a href="#volume_mbo-868"><span class="linenos">868</span></a>
</span><span id="volume_mbo-869"><a href="#volume_mbo-869"><span class="linenos">869</span></a>        <span class="k">if</span> <span class="n">class_priors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="volume_mbo-870"><a href="#volume_mbo-870"><span class="linenos">870</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Class priors must be provided for Volume MBO.&quot;</span><span class="p">)</span>
</span><span id="volume_mbo-871"><a href="#volume_mbo-871"><span class="linenos">871</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">class_counts</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span><span class="o">*</span><span class="n">class_priors</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="volume_mbo-872"><a href="#volume_mbo-872"><span class="linenos">872</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span> <span class="o">=</span> <span class="n">temperature</span>
</span><span id="volume_mbo-873"><a href="#volume_mbo-873"><span class="linenos">873</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">volume_constraint</span> <span class="o">=</span> <span class="n">volume_constraint</span>
</span><span id="volume_mbo-874"><a href="#volume_mbo-874"><span class="linenos">874</span></a>
</span><span id="volume_mbo-875"><a href="#volume_mbo-875"><span class="linenos">875</span></a>        <span class="c1">#Setup accuracy filename and model name</span>
</span><span id="volume_mbo-876"><a href="#volume_mbo-876"><span class="linenos">876</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_volume_mbo_temp_</span><span class="si">%.2f</span><span class="s1">_vol_</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span><span class="n">volume_constraint</span><span class="p">)</span>
</span><span id="volume_mbo-877"><a href="#volume_mbo-877"><span class="linenos">877</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Volume MBO (T=</span><span class="si">%.2f</span><span class="s1">, V=</span><span class="si">%.2f</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span><span class="n">volume_constraint</span><span class="p">)</span>
</span><span id="volume_mbo-878"><a href="#volume_mbo-878"><span class="linenos">878</span></a>
</span><span id="volume_mbo-879"><a href="#volume_mbo-879"><span class="linenos">879</span></a>
</span><span id="volume_mbo-880"><a href="#volume_mbo-880"><span class="linenos">880</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="volume_mbo-881"><a href="#volume_mbo-881"><span class="linenos">881</span></a>
</span><span id="volume_mbo-882"><a href="#volume_mbo-882"><span class="linenos">882</span></a>        <span class="c1">#Import c extensions</span>
</span><span id="volume_mbo-883"><a href="#volume_mbo-883"><span class="linenos">883</span></a>        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">cextensions</span>
</span><span id="volume_mbo-884"><a href="#volume_mbo-884"><span class="linenos">884</span></a>
</span><span id="volume_mbo-885"><a href="#volume_mbo-885"><span class="linenos">885</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span>
</span><span id="volume_mbo-886"><a href="#volume_mbo-886"><span class="linenos">886</span></a>
</span><span id="volume_mbo-887"><a href="#volume_mbo-887"><span class="linenos">887</span></a>        <span class="c1">#Set diagonal entries to zero</span>
</span><span id="volume_mbo-888"><a href="#volume_mbo-888"><span class="linenos">888</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">weight_matrix</span>
</span><span id="volume_mbo-889"><a href="#volume_mbo-889"><span class="linenos">889</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="n">W</span> <span class="o">-</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">diagonal</span><span class="p">(),</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</span><span id="volume_mbo-890"><a href="#volume_mbo-890"><span class="linenos">890</span></a>        <span class="n">G</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">graph</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</span><span id="volume_mbo-891"><a href="#volume_mbo-891"><span class="linenos">891</span></a>
</span><span id="volume_mbo-892"><a href="#volume_mbo-892"><span class="linenos">892</span></a>        <span class="c1">#Set up graph for C-code</span>
</span><span id="volume_mbo-893"><a href="#volume_mbo-893"><span class="linenos">893</span></a>        <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_labels</span><span class="p">))</span>
</span><span id="volume_mbo-894"><a href="#volume_mbo-894"><span class="linenos">894</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,))</span>
</span><span id="volume_mbo-895"><a href="#volume_mbo-895"><span class="linenos">895</span></a>        <span class="n">WI</span><span class="p">,</span><span class="n">WJ</span><span class="p">,</span><span class="n">WV</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</span><span id="volume_mbo-896"><a href="#volume_mbo-896"><span class="linenos">896</span></a>
</span><span id="volume_mbo-897"><a href="#volume_mbo-897"><span class="linenos">897</span></a>        <span class="c1">#Type casting and memory blocking</span>
</span><span id="volume_mbo-898"><a href="#volume_mbo-898"><span class="linenos">898</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="volume_mbo-899"><a href="#volume_mbo-899"><span class="linenos">899</span></a>        <span class="n">WI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">WI</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="volume_mbo-900"><a href="#volume_mbo-900"><span class="linenos">900</span></a>        <span class="n">WJ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">WJ</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="volume_mbo-901"><a href="#volume_mbo-901"><span class="linenos">901</span></a>        <span class="n">WV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">WV</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="volume_mbo-902"><a href="#volume_mbo-902"><span class="linenos">902</span></a>        <span class="n">train_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="volume_mbo-903"><a href="#volume_mbo-903"><span class="linenos">903</span></a>        <span class="n">train_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">train_labels</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="volume_mbo-904"><a href="#volume_mbo-904"><span class="linenos">904</span></a>        <span class="n">ClassCounts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">class_counts</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="volume_mbo-905"><a href="#volume_mbo-905"><span class="linenos">905</span></a>
</span><span id="volume_mbo-906"><a href="#volume_mbo-906"><span class="linenos">906</span></a>        <span class="n">cextensions</span><span class="o">.</span><span class="n">volume_mbo</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">WI</span><span class="p">,</span><span class="n">WJ</span><span class="p">,</span><span class="n">WV</span><span class="p">,</span><span class="n">train_ind</span><span class="p">,</span><span class="n">train_labels</span><span class="p">,</span><span class="n">ClassCounts</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">volume_constraint</span><span class="p">)</span>
</span><span id="volume_mbo-907"><a href="#volume_mbo-907"><span class="linenos">907</span></a>
</span><span id="volume_mbo-908"><a href="#volume_mbo-908"><span class="linenos">908</span></a>        <span class="c1">#Set given labels and convert to vector format</span>
</span><span id="volume_mbo-909"><a href="#volume_mbo-909"><span class="linenos">909</span></a>        <span class="n">u</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_labels</span>
</span><span id="volume_mbo-910"><a href="#volume_mbo-910"><span class="linenos">910</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</span><span id="volume_mbo-911"><a href="#volume_mbo-911"><span class="linenos">911</span></a>        <span class="k">return</span> <span class="n">u</span>
</span></pre></div>


    

                            <div id="volume_mbo.__init__" class="classattr">
                                        <input id="volume_mbo.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">volume_mbo</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">W</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">temperature</span><span class="o">=</span><span class="mf">0.1</span>, </span><span class="param"><span class="n">volume_constraint</span><span class="o">=</span><span class="mf">0.5</span></span>)</span>

                <label class="view-source-button" for="volume_mbo.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#volume_mbo.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="volume_mbo.__init__-843"><a href="#volume_mbo.__init__-843"><span class="linenos">843</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">volume_constraint</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
</span><span id="volume_mbo.__init__-844"><a href="#volume_mbo.__init__-844"><span class="linenos">844</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Volume MBO</span>
</span><span id="volume_mbo.__init__-845"><a href="#volume_mbo.__init__-845"><span class="linenos">845</span></a><span class="sd">        ===================</span>
</span><span id="volume_mbo.__init__-846"><a href="#volume_mbo.__init__-846"><span class="linenos">846</span></a>
</span><span id="volume_mbo.__init__-847"><a href="#volume_mbo.__init__-847"><span class="linenos">847</span></a><span class="sd">        Semi-supervised learning with the VolumeMBO method [1]. class_priors must be provided.</span>
</span><span id="volume_mbo.__init__-848"><a href="#volume_mbo.__init__-848"><span class="linenos">848</span></a>
</span><span id="volume_mbo.__init__-849"><a href="#volume_mbo.__init__-849"><span class="linenos">849</span></a><span class="sd">        Parameters</span>
</span><span id="volume_mbo.__init__-850"><a href="#volume_mbo.__init__-850"><span class="linenos">850</span></a><span class="sd">        ----------</span>
</span><span id="volume_mbo.__init__-851"><a href="#volume_mbo.__init__-851"><span class="linenos">851</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="volume_mbo.__init__-852"><a href="#volume_mbo.__init__-852"><span class="linenos">852</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="volume_mbo.__init__-853"><a href="#volume_mbo.__init__-853"><span class="linenos">853</span></a><span class="sd">        class_priors : numpy array</span>
</span><span id="volume_mbo.__init__-854"><a href="#volume_mbo.__init__-854"><span class="linenos">854</span></a><span class="sd">            Class priors (fraction of data belonging to each class). </span>
</span><span id="volume_mbo.__init__-855"><a href="#volume_mbo.__init__-855"><span class="linenos">855</span></a><span class="sd">        temperature : float (optional), default=0.1</span>
</span><span id="volume_mbo.__init__-856"><a href="#volume_mbo.__init__-856"><span class="linenos">856</span></a><span class="sd">            Temperature for volume constrained MBO.</span>
</span><span id="volume_mbo.__init__-857"><a href="#volume_mbo.__init__-857"><span class="linenos">857</span></a><span class="sd">        volume_constraint : float (optional), default=0.5</span>
</span><span id="volume_mbo.__init__-858"><a href="#volume_mbo.__init__-858"><span class="linenos">858</span></a><span class="sd">            The number of points in each class is constrained to be a mulitple \\(\\lambda\\) of the true</span>
</span><span id="volume_mbo.__init__-859"><a href="#volume_mbo.__init__-859"><span class="linenos">859</span></a><span class="sd">            class size, where </span>
</span><span id="volume_mbo.__init__-860"><a href="#volume_mbo.__init__-860"><span class="linenos">860</span></a><span class="sd">            \\[ \\text{volume_constraint} \\leq \\lambda \\leq 2-\\text{volume_constraint}.\\]</span>
</span><span id="volume_mbo.__init__-861"><a href="#volume_mbo.__init__-861"><span class="linenos">861</span></a><span class="sd">            Setting `volume_constraint=1` yields the tightest constraint.</span>
</span><span id="volume_mbo.__init__-862"><a href="#volume_mbo.__init__-862"><span class="linenos">862</span></a>
</span><span id="volume_mbo.__init__-863"><a href="#volume_mbo.__init__-863"><span class="linenos">863</span></a><span class="sd">        References</span>
</span><span id="volume_mbo.__init__-864"><a href="#volume_mbo.__init__-864"><span class="linenos">864</span></a><span class="sd">        ----------</span>
</span><span id="volume_mbo.__init__-865"><a href="#volume_mbo.__init__-865"><span class="linenos">865</span></a><span class="sd">        [1] M. Jacobs, E. Merkurjev, and S. Esedolu. [Auction dynamics: A volume constrained MBO scheme.](https://www.sciencedirect.com/science/article/pii/S0021999117308033?casa_token=kNahPd2vu50AAAAA:uJQYQVnmMBV_oL0CG1UcOIulY4vhclMGTztm-jjAzy9Lns7rtoOnKs4iyvLOjKXaHU-D6qrQJT4) Journal of Computational Physics 354:288-310, 2018. </span>
</span><span id="volume_mbo.__init__-866"><a href="#volume_mbo.__init__-866"><span class="linenos">866</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="volume_mbo.__init__-867"><a href="#volume_mbo.__init__-867"><span class="linenos">867</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="volume_mbo.__init__-868"><a href="#volume_mbo.__init__-868"><span class="linenos">868</span></a>
</span><span id="volume_mbo.__init__-869"><a href="#volume_mbo.__init__-869"><span class="linenos">869</span></a>        <span class="k">if</span> <span class="n">class_priors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="volume_mbo.__init__-870"><a href="#volume_mbo.__init__-870"><span class="linenos">870</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Class priors must be provided for Volume MBO.&quot;</span><span class="p">)</span>
</span><span id="volume_mbo.__init__-871"><a href="#volume_mbo.__init__-871"><span class="linenos">871</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">class_counts</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span><span class="o">*</span><span class="n">class_priors</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="volume_mbo.__init__-872"><a href="#volume_mbo.__init__-872"><span class="linenos">872</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span> <span class="o">=</span> <span class="n">temperature</span>
</span><span id="volume_mbo.__init__-873"><a href="#volume_mbo.__init__-873"><span class="linenos">873</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">volume_constraint</span> <span class="o">=</span> <span class="n">volume_constraint</span>
</span><span id="volume_mbo.__init__-874"><a href="#volume_mbo.__init__-874"><span class="linenos">874</span></a>
</span><span id="volume_mbo.__init__-875"><a href="#volume_mbo.__init__-875"><span class="linenos">875</span></a>        <span class="c1">#Setup accuracy filename and model name</span>
</span><span id="volume_mbo.__init__-876"><a href="#volume_mbo.__init__-876"><span class="linenos">876</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_volume_mbo_temp_</span><span class="si">%.2f</span><span class="s1">_vol_</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span><span class="n">volume_constraint</span><span class="p">)</span>
</span><span id="volume_mbo.__init__-877"><a href="#volume_mbo.__init__-877"><span class="linenos">877</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Volume MBO (T=</span><span class="si">%.2f</span><span class="s1">, V=</span><span class="si">%.2f</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span><span class="n">volume_constraint</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h1 id="volume-mbo">Volume MBO</h1>

<p>Semi-supervised learning with the VolumeMBO method [1]. class_priors must be provided.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>W</strong> (numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None):
Weight matrix representing the graph.</li>
<li><strong>class_priors</strong> (numpy array):
Class priors (fraction of data belonging to each class).</li>
<li><strong>temperature</strong> (float (optional), default=0.1):
Temperature for volume constrained MBO.</li>
<li><strong>volume_constraint</strong> (float (optional), default=0.5):
The number of points in each class is constrained to be a mulitple (\lambda) of the true
class size, where 
[ \text{volume_constraint} \leq \lambda \leq 2-\text{volume_constraint}.]
Setting <code>volume_constraint=1</code> yields the tightest constraint.</li>
</ul>

<h6 id="references">References</h6>

<p>[1] M. Jacobs, E. Merkurjev, and S. Esedolu. <a href="https://www.sciencedirect.com/science/article/pii/S0021999117308033?casa_token=kNahPd2vu50AAAAA:uJQYQVnmMBV_oL0CG1UcOIulY4vhclMGTztm-jjAzy9Lns7rtoOnKs4iyvLOjKXaHU-D6qrQJT4">Auction dynamics: A volume constrained MBO scheme.</a> Journal of Computational Physics 354:288-310, 2018.</p>
</div>


                            </div>
                            <div id="volume_mbo.class_counts" class="classattr">
                                <div class="attr variable">
            <span class="name">class_counts</span>

        
    </div>
    <a class="headerlink" href="#volume_mbo.class_counts"></a>
    
    

                            </div>
                            <div id="volume_mbo.temperature" class="classattr">
                                <div class="attr variable">
            <span class="name">temperature</span>

        
    </div>
    <a class="headerlink" href="#volume_mbo.temperature"></a>
    
    

                            </div>
                            <div id="volume_mbo.volume_constraint" class="classattr">
                                <div class="attr variable">
            <span class="name">volume_constraint</span>

        
    </div>
    <a class="headerlink" href="#volume_mbo.volume_constraint"></a>
    
    

                            </div>
                            <div id="volume_mbo.accuracy_filename" class="classattr">
                                <div class="attr variable">
            <span class="name">accuracy_filename</span>

        
    </div>
    <a class="headerlink" href="#volume_mbo.accuracy_filename"></a>
    
    

                            </div>
                            <div id="volume_mbo.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#volume_mbo.name"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#ssl">ssl</a></dt>
                                <dd id="volume_mbo.prob" class="variable"><a href="#ssl.prob">prob</a></dd>
                <dd id="volume_mbo.fitted" class="variable"><a href="#ssl.fitted">fitted</a></dd>
                <dd id="volume_mbo.requires_eig" class="variable"><a href="#ssl.requires_eig">requires_eig</a></dd>
                <dd id="volume_mbo.onevsrest" class="variable"><a href="#ssl.onevsrest">onevsrest</a></dd>
                <dd id="volume_mbo.similarity" class="variable"><a href="#ssl.similarity">similarity</a></dd>
                <dd id="volume_mbo.class_priors" class="variable"><a href="#ssl.class_priors">class_priors</a></dd>
                <dd id="volume_mbo.weights" class="variable"><a href="#ssl.weights">weights</a></dd>
                <dd id="volume_mbo.class_priors_error" class="variable"><a href="#ssl.class_priors_error">class_priors_error</a></dd>
                <dd id="volume_mbo.set_graph" class="function"><a href="#ssl.set_graph">set_graph</a></dd>
                <dd id="volume_mbo.volume_label_projection" class="function"><a href="#ssl.volume_label_projection">volume_label_projection</a></dd>
                <dd id="volume_mbo.get_accuracy_filename" class="function"><a href="#ssl.get_accuracy_filename">get_accuracy_filename</a></dd>
                <dd id="volume_mbo.predict" class="function"><a href="#ssl.predict">predict</a></dd>
                <dd id="volume_mbo.fit_predict" class="function"><a href="#ssl.fit_predict">fit_predict</a></dd>
                <dd id="volume_mbo.ssl_trials" class="function"><a href="#ssl.ssl_trials">ssl_trials</a></dd>
                <dd id="volume_mbo.trials_statistics" class="function"><a href="#ssl.trials_statistics">trials_statistics</a></dd>
                <dd id="volume_mbo.fit" class="function"><a href="#ssl.fit">fit</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="multiclass_mbo">
                            <input id="multiclass_mbo-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">multiclass_mbo</span><wbr>(<span class="base"><a href="#ssl">ssl</a></span>):

                <label class="view-source-button" for="multiclass_mbo-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#multiclass_mbo"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="multiclass_mbo-913"><a href="#multiclass_mbo-913"><span class="linenos"> 913</span></a><span class="k">class</span> <span class="nc">multiclass_mbo</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="multiclass_mbo-914"><a href="#multiclass_mbo-914"><span class="linenos"> 914</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Ns</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">num_eig</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
</span><span id="multiclass_mbo-915"><a href="#multiclass_mbo-915"><span class="linenos"> 915</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Multiclass MBO</span>
</span><span id="multiclass_mbo-916"><a href="#multiclass_mbo-916"><span class="linenos"> 916</span></a><span class="sd">        ===================</span>
</span><span id="multiclass_mbo-917"><a href="#multiclass_mbo-917"><span class="linenos"> 917</span></a>
</span><span id="multiclass_mbo-918"><a href="#multiclass_mbo-918"><span class="linenos"> 918</span></a><span class="sd">        Semi-supervised learning via the Multiclass MBO method [1].</span>
</span><span id="multiclass_mbo-919"><a href="#multiclass_mbo-919"><span class="linenos"> 919</span></a>
</span><span id="multiclass_mbo-920"><a href="#multiclass_mbo-920"><span class="linenos"> 920</span></a><span class="sd">        Parameters</span>
</span><span id="multiclass_mbo-921"><a href="#multiclass_mbo-921"><span class="linenos"> 921</span></a><span class="sd">        ----------</span>
</span><span id="multiclass_mbo-922"><a href="#multiclass_mbo-922"><span class="linenos"> 922</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="multiclass_mbo-923"><a href="#multiclass_mbo-923"><span class="linenos"> 923</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="multiclass_mbo-924"><a href="#multiclass_mbo-924"><span class="linenos"> 924</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="multiclass_mbo-925"><a href="#multiclass_mbo-925"><span class="linenos"> 925</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="multiclass_mbo-926"><a href="#multiclass_mbo-926"><span class="linenos"> 926</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="multiclass_mbo-927"><a href="#multiclass_mbo-927"><span class="linenos"> 927</span></a><span class="sd">            nodes in each class.</span>
</span><span id="multiclass_mbo-928"><a href="#multiclass_mbo-928"><span class="linenos"> 928</span></a><span class="sd">        Ns : int (optional), default=6</span>
</span><span id="multiclass_mbo-929"><a href="#multiclass_mbo-929"><span class="linenos"> 929</span></a><span class="sd">            Number of inner iterations.</span>
</span><span id="multiclass_mbo-930"><a href="#multiclass_mbo-930"><span class="linenos"> 930</span></a><span class="sd">        T : int (optional), default=10</span>
</span><span id="multiclass_mbo-931"><a href="#multiclass_mbo-931"><span class="linenos"> 931</span></a><span class="sd">            Number of outer iterations.</span>
</span><span id="multiclass_mbo-932"><a href="#multiclass_mbo-932"><span class="linenos"> 932</span></a><span class="sd">        dt : float (optional), default=0.15</span>
</span><span id="multiclass_mbo-933"><a href="#multiclass_mbo-933"><span class="linenos"> 933</span></a><span class="sd">            Time step.</span>
</span><span id="multiclass_mbo-934"><a href="#multiclass_mbo-934"><span class="linenos"> 934</span></a><span class="sd">        mu : float (optional), default=50</span>
</span><span id="multiclass_mbo-935"><a href="#multiclass_mbo-935"><span class="linenos"> 935</span></a><span class="sd">            Fidelity penalty.</span>
</span><span id="multiclass_mbo-936"><a href="#multiclass_mbo-936"><span class="linenos"> 936</span></a><span class="sd">        num_eig : int (optional), default=300</span>
</span><span id="multiclass_mbo-937"><a href="#multiclass_mbo-937"><span class="linenos"> 937</span></a><span class="sd">            Number of eigenvectors.</span>
</span><span id="multiclass_mbo-938"><a href="#multiclass_mbo-938"><span class="linenos"> 938</span></a><span class="sd">        </span>
</span><span id="multiclass_mbo-939"><a href="#multiclass_mbo-939"><span class="linenos"> 939</span></a><span class="sd">        References</span>
</span><span id="multiclass_mbo-940"><a href="#multiclass_mbo-940"><span class="linenos"> 940</span></a><span class="sd">        ---------</span>
</span><span id="multiclass_mbo-941"><a href="#multiclass_mbo-941"><span class="linenos"> 941</span></a><span class="sd">        [1] C. Garcia-Cardona, E. Merkurjev, A.L. Bertozzi, A. Flenner, and A.G. Percus. [Multiclass data segmentation using diffuse interface methods on graphs.](http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.743.9516&amp;rep=rep1&amp;type=pdf) IEEE transactions on pattern analysis and machine intelligence, 36(8), 1600-1613, 2014.</span>
</span><span id="multiclass_mbo-942"><a href="#multiclass_mbo-942"><span class="linenos"> 942</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="multiclass_mbo-943"><a href="#multiclass_mbo-943"><span class="linenos"> 943</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="multiclass_mbo-944"><a href="#multiclass_mbo-944"><span class="linenos"> 944</span></a>
</span><span id="multiclass_mbo-945"><a href="#multiclass_mbo-945"><span class="linenos"> 945</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span> <span class="o">=</span> <span class="n">Ns</span>
</span><span id="multiclass_mbo-946"><a href="#multiclass_mbo-946"><span class="linenos"> 946</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
</span><span id="multiclass_mbo-947"><a href="#multiclass_mbo-947"><span class="linenos"> 947</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span>
</span><span id="multiclass_mbo-948"><a href="#multiclass_mbo-948"><span class="linenos"> 948</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span>
</span><span id="multiclass_mbo-949"><a href="#multiclass_mbo-949"><span class="linenos"> 949</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_eig</span> <span class="o">=</span> <span class="n">num_eig</span>
</span><span id="multiclass_mbo-950"><a href="#multiclass_mbo-950"><span class="linenos"> 950</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">requires_eig</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="multiclass_mbo-951"><a href="#multiclass_mbo-951"><span class="linenos"> 951</span></a>
</span><span id="multiclass_mbo-952"><a href="#multiclass_mbo-952"><span class="linenos"> 952</span></a>        <span class="c1">#Setup accuracy filename</span>
</span><span id="multiclass_mbo-953"><a href="#multiclass_mbo-953"><span class="linenos"> 953</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_multiclass_mbo_Ns_</span><span class="si">%d</span><span class="s1">_T_</span><span class="si">%d</span><span class="s1">_dt_</span><span class="si">%.3f</span><span class="s1">_mu_</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Ns</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">mu</span><span class="p">)</span>
</span><span id="multiclass_mbo-954"><a href="#multiclass_mbo-954"><span class="linenos"> 954</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Multiclass MBO&#39;</span>
</span><span id="multiclass_mbo-955"><a href="#multiclass_mbo-955"><span class="linenos"> 955</span></a>
</span><span id="multiclass_mbo-956"><a href="#multiclass_mbo-956"><span class="linenos"> 956</span></a>
</span><span id="multiclass_mbo-957"><a href="#multiclass_mbo-957"><span class="linenos"> 957</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="multiclass_mbo-958"><a href="#multiclass_mbo-958"><span class="linenos"> 958</span></a>
</span><span id="multiclass_mbo-959"><a href="#multiclass_mbo-959"><span class="linenos"> 959</span></a>        <span class="c1">#Shorten names</span>
</span><span id="multiclass_mbo-960"><a href="#multiclass_mbo-960"><span class="linenos"> 960</span></a>        <span class="n">Ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span>
</span><span id="multiclass_mbo-961"><a href="#multiclass_mbo-961"><span class="linenos"> 961</span></a>        <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span>
</span><span id="multiclass_mbo-962"><a href="#multiclass_mbo-962"><span class="linenos"> 962</span></a>        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span>
</span><span id="multiclass_mbo-963"><a href="#multiclass_mbo-963"><span class="linenos"> 963</span></a>        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span>
</span><span id="multiclass_mbo-964"><a href="#multiclass_mbo-964"><span class="linenos"> 964</span></a>        <span class="n">num_eig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_eig</span>
</span><span id="multiclass_mbo-965"><a href="#multiclass_mbo-965"><span class="linenos"> 965</span></a>
</span><span id="multiclass_mbo-966"><a href="#multiclass_mbo-966"><span class="linenos"> 966</span></a>        <span class="c1">#Basic parameters</span>
</span><span id="multiclass_mbo-967"><a href="#multiclass_mbo-967"><span class="linenos"> 967</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span>
</span><span id="multiclass_mbo-968"><a href="#multiclass_mbo-968"><span class="linenos"> 968</span></a>        <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_labels</span><span class="p">))</span>
</span><span id="multiclass_mbo-969"><a href="#multiclass_mbo-969"><span class="linenos"> 969</span></a>
</span><span id="multiclass_mbo-970"><a href="#multiclass_mbo-970"><span class="linenos"> 970</span></a>        <span class="c1">#Spectral decomposition</span>
</span><span id="multiclass_mbo-971"><a href="#multiclass_mbo-971"><span class="linenos"> 971</span></a>        <span class="n">eigvals</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">eigen_decomp</span><span class="p">(</span><span class="n">normalization</span><span class="o">=</span><span class="s1">&#39;normalized&#39;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_eig</span><span class="p">)</span>
</span><span id="multiclass_mbo-972"><a href="#multiclass_mbo-972"><span class="linenos"> 972</span></a>
</span><span id="multiclass_mbo-973"><a href="#multiclass_mbo-973"><span class="linenos"> 973</span></a>        <span class="c1">#Form matrices</span>
</span><span id="multiclass_mbo-974"><a href="#multiclass_mbo-974"><span class="linenos"> 974</span></a>        <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dt</span><span class="o">/</span><span class="n">Ns</span><span class="p">)</span><span class="o">*</span><span class="n">eigvals</span><span class="p">))</span> 
</span><span id="multiclass_mbo-975"><a href="#multiclass_mbo-975"><span class="linenos"> 975</span></a>        <span class="n">Y</span> <span class="o">=</span> <span class="n">X</span><span class="nd">@V</span>
</span><span id="multiclass_mbo-976"><a href="#multiclass_mbo-976"><span class="linenos"> 976</span></a>        <span class="n">Xt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span><span id="multiclass_mbo-977"><a href="#multiclass_mbo-977"><span class="linenos"> 977</span></a>
</span><span id="multiclass_mbo-978"><a href="#multiclass_mbo-978"><span class="linenos"> 978</span></a>        <span class="c1">#Random initial labeling</span>
</span><span id="multiclass_mbo-979"><a href="#multiclass_mbo-979"><span class="linenos"> 979</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</span><span id="multiclass_mbo-980"><a href="#multiclass_mbo-980"><span class="linenos"> 980</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
</span><span id="multiclass_mbo-981"><a href="#multiclass_mbo-981"><span class="linenos"> 981</span></a>        <span class="n">u</span><span class="p">[:,</span><span class="n">train_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="multiclass_mbo-982"><a href="#multiclass_mbo-982"><span class="linenos"> 982</span></a>
</span><span id="multiclass_mbo-983"><a href="#multiclass_mbo-983"><span class="linenos"> 983</span></a>        <span class="c1">#Indicator of train_ind</span>
</span><span id="multiclass_mbo-984"><a href="#multiclass_mbo-984"><span class="linenos"> 984</span></a>        <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,)</span>
</span><span id="multiclass_mbo-985"><a href="#multiclass_mbo-985"><span class="linenos"> 985</span></a>        <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,)</span>
</span><span id="multiclass_mbo-986"><a href="#multiclass_mbo-986"><span class="linenos"> 986</span></a>        <span class="n">J</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="multiclass_mbo-987"><a href="#multiclass_mbo-987"><span class="linenos"> 987</span></a>        <span class="n">K</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_labels</span>
</span><span id="multiclass_mbo-988"><a href="#multiclass_mbo-988"><span class="linenos"> 988</span></a>        <span class="n">K</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">K</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="multiclass_mbo-989"><a href="#multiclass_mbo-989"><span class="linenos"> 989</span></a>
</span><span id="multiclass_mbo-990"><a href="#multiclass_mbo-990"><span class="linenos"> 990</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
</span><span id="multiclass_mbo-991"><a href="#multiclass_mbo-991"><span class="linenos"> 991</span></a>            <span class="c1">#Diffusion step</span>
</span><span id="multiclass_mbo-992"><a href="#multiclass_mbo-992"><span class="linenos"> 992</span></a>            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
</span><span id="multiclass_mbo-993"><a href="#multiclass_mbo-993"><span class="linenos"> 993</span></a>                <span class="n">Z</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="p">(</span><span class="n">dt</span><span class="o">/</span><span class="n">Ns</span><span class="p">)</span><span class="o">*</span><span class="n">mu</span><span class="o">*</span><span class="n">J</span><span class="o">*</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">K</span><span class="p">))</span><span class="nd">@Y</span>
</span><span id="multiclass_mbo-994"><a href="#multiclass_mbo-994"><span class="linenos"> 994</span></a>                <span class="n">u</span> <span class="o">=</span> <span class="n">Z</span><span class="nd">@Xt</span>
</span><span id="multiclass_mbo-995"><a href="#multiclass_mbo-995"><span class="linenos"> 995</span></a>                
</span><span id="multiclass_mbo-996"><a href="#multiclass_mbo-996"><span class="linenos"> 996</span></a>            <span class="c1">#Projection step</span>
</span><span id="multiclass_mbo-997"><a href="#multiclass_mbo-997"><span class="linenos"> 997</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
</span><span id="multiclass_mbo-998"><a href="#multiclass_mbo-998"><span class="linenos"> 998</span></a>
</span><span id="multiclass_mbo-999"><a href="#multiclass_mbo-999"><span class="linenos"> 999</span></a>            <span class="c1">#Compute accuracy if all labels are provided</span>
</span><span id="multiclass_mbo-1000"><a href="#multiclass_mbo-1000"><span class="linenos">1000</span></a>            <span class="k">if</span> <span class="n">all_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="multiclass_mbo-1001"><a href="#multiclass_mbo-1001"><span class="linenos">1001</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">T</span>
</span><span id="multiclass_mbo-1002"><a href="#multiclass_mbo-1002"><span class="linenos">1002</span></a>                <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</span><span id="multiclass_mbo-1003"><a href="#multiclass_mbo-1003"><span class="linenos">1003</span></a>                <span class="n">acc</span> <span class="o">=</span> <span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">all_labels</span><span class="p">,</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="multiclass_mbo-1004"><a href="#multiclass_mbo-1004"><span class="linenos">1004</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accuracy = </span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">acc</span><span class="p">)</span>
</span><span id="multiclass_mbo-1005"><a href="#multiclass_mbo-1005"><span class="linenos">1005</span></a>
</span><span id="multiclass_mbo-1006"><a href="#multiclass_mbo-1006"><span class="linenos">1006</span></a>        <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">T</span>
</span></pre></div>


    

                            <div id="multiclass_mbo.__init__" class="classattr">
                                        <input id="multiclass_mbo.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">multiclass_mbo</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">W</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">Ns</span><span class="o">=</span><span class="mi">6</span>, </span><span class="param"><span class="n">T</span><span class="o">=</span><span class="mi">10</span>, </span><span class="param"><span class="n">dt</span><span class="o">=</span><span class="mf">0.15</span>, </span><span class="param"><span class="n">mu</span><span class="o">=</span><span class="mi">50</span>, </span><span class="param"><span class="n">num_eig</span><span class="o">=</span><span class="mi">50</span></span>)</span>

                <label class="view-source-button" for="multiclass_mbo.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#multiclass_mbo.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="multiclass_mbo.__init__-914"><a href="#multiclass_mbo.__init__-914"><span class="linenos">914</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Ns</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">num_eig</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
</span><span id="multiclass_mbo.__init__-915"><a href="#multiclass_mbo.__init__-915"><span class="linenos">915</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Multiclass MBO</span>
</span><span id="multiclass_mbo.__init__-916"><a href="#multiclass_mbo.__init__-916"><span class="linenos">916</span></a><span class="sd">        ===================</span>
</span><span id="multiclass_mbo.__init__-917"><a href="#multiclass_mbo.__init__-917"><span class="linenos">917</span></a>
</span><span id="multiclass_mbo.__init__-918"><a href="#multiclass_mbo.__init__-918"><span class="linenos">918</span></a><span class="sd">        Semi-supervised learning via the Multiclass MBO method [1].</span>
</span><span id="multiclass_mbo.__init__-919"><a href="#multiclass_mbo.__init__-919"><span class="linenos">919</span></a>
</span><span id="multiclass_mbo.__init__-920"><a href="#multiclass_mbo.__init__-920"><span class="linenos">920</span></a><span class="sd">        Parameters</span>
</span><span id="multiclass_mbo.__init__-921"><a href="#multiclass_mbo.__init__-921"><span class="linenos">921</span></a><span class="sd">        ----------</span>
</span><span id="multiclass_mbo.__init__-922"><a href="#multiclass_mbo.__init__-922"><span class="linenos">922</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="multiclass_mbo.__init__-923"><a href="#multiclass_mbo.__init__-923"><span class="linenos">923</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="multiclass_mbo.__init__-924"><a href="#multiclass_mbo.__init__-924"><span class="linenos">924</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="multiclass_mbo.__init__-925"><a href="#multiclass_mbo.__init__-925"><span class="linenos">925</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="multiclass_mbo.__init__-926"><a href="#multiclass_mbo.__init__-926"><span class="linenos">926</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="multiclass_mbo.__init__-927"><a href="#multiclass_mbo.__init__-927"><span class="linenos">927</span></a><span class="sd">            nodes in each class.</span>
</span><span id="multiclass_mbo.__init__-928"><a href="#multiclass_mbo.__init__-928"><span class="linenos">928</span></a><span class="sd">        Ns : int (optional), default=6</span>
</span><span id="multiclass_mbo.__init__-929"><a href="#multiclass_mbo.__init__-929"><span class="linenos">929</span></a><span class="sd">            Number of inner iterations.</span>
</span><span id="multiclass_mbo.__init__-930"><a href="#multiclass_mbo.__init__-930"><span class="linenos">930</span></a><span class="sd">        T : int (optional), default=10</span>
</span><span id="multiclass_mbo.__init__-931"><a href="#multiclass_mbo.__init__-931"><span class="linenos">931</span></a><span class="sd">            Number of outer iterations.</span>
</span><span id="multiclass_mbo.__init__-932"><a href="#multiclass_mbo.__init__-932"><span class="linenos">932</span></a><span class="sd">        dt : float (optional), default=0.15</span>
</span><span id="multiclass_mbo.__init__-933"><a href="#multiclass_mbo.__init__-933"><span class="linenos">933</span></a><span class="sd">            Time step.</span>
</span><span id="multiclass_mbo.__init__-934"><a href="#multiclass_mbo.__init__-934"><span class="linenos">934</span></a><span class="sd">        mu : float (optional), default=50</span>
</span><span id="multiclass_mbo.__init__-935"><a href="#multiclass_mbo.__init__-935"><span class="linenos">935</span></a><span class="sd">            Fidelity penalty.</span>
</span><span id="multiclass_mbo.__init__-936"><a href="#multiclass_mbo.__init__-936"><span class="linenos">936</span></a><span class="sd">        num_eig : int (optional), default=300</span>
</span><span id="multiclass_mbo.__init__-937"><a href="#multiclass_mbo.__init__-937"><span class="linenos">937</span></a><span class="sd">            Number of eigenvectors.</span>
</span><span id="multiclass_mbo.__init__-938"><a href="#multiclass_mbo.__init__-938"><span class="linenos">938</span></a><span class="sd">        </span>
</span><span id="multiclass_mbo.__init__-939"><a href="#multiclass_mbo.__init__-939"><span class="linenos">939</span></a><span class="sd">        References</span>
</span><span id="multiclass_mbo.__init__-940"><a href="#multiclass_mbo.__init__-940"><span class="linenos">940</span></a><span class="sd">        ---------</span>
</span><span id="multiclass_mbo.__init__-941"><a href="#multiclass_mbo.__init__-941"><span class="linenos">941</span></a><span class="sd">        [1] C. Garcia-Cardona, E. Merkurjev, A.L. Bertozzi, A. Flenner, and A.G. Percus. [Multiclass data segmentation using diffuse interface methods on graphs.](http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.743.9516&amp;rep=rep1&amp;type=pdf) IEEE transactions on pattern analysis and machine intelligence, 36(8), 1600-1613, 2014.</span>
</span><span id="multiclass_mbo.__init__-942"><a href="#multiclass_mbo.__init__-942"><span class="linenos">942</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="multiclass_mbo.__init__-943"><a href="#multiclass_mbo.__init__-943"><span class="linenos">943</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="multiclass_mbo.__init__-944"><a href="#multiclass_mbo.__init__-944"><span class="linenos">944</span></a>
</span><span id="multiclass_mbo.__init__-945"><a href="#multiclass_mbo.__init__-945"><span class="linenos">945</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span> <span class="o">=</span> <span class="n">Ns</span>
</span><span id="multiclass_mbo.__init__-946"><a href="#multiclass_mbo.__init__-946"><span class="linenos">946</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
</span><span id="multiclass_mbo.__init__-947"><a href="#multiclass_mbo.__init__-947"><span class="linenos">947</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span>
</span><span id="multiclass_mbo.__init__-948"><a href="#multiclass_mbo.__init__-948"><span class="linenos">948</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span>
</span><span id="multiclass_mbo.__init__-949"><a href="#multiclass_mbo.__init__-949"><span class="linenos">949</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_eig</span> <span class="o">=</span> <span class="n">num_eig</span>
</span><span id="multiclass_mbo.__init__-950"><a href="#multiclass_mbo.__init__-950"><span class="linenos">950</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">requires_eig</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="multiclass_mbo.__init__-951"><a href="#multiclass_mbo.__init__-951"><span class="linenos">951</span></a>
</span><span id="multiclass_mbo.__init__-952"><a href="#multiclass_mbo.__init__-952"><span class="linenos">952</span></a>        <span class="c1">#Setup accuracy filename</span>
</span><span id="multiclass_mbo.__init__-953"><a href="#multiclass_mbo.__init__-953"><span class="linenos">953</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_multiclass_mbo_Ns_</span><span class="si">%d</span><span class="s1">_T_</span><span class="si">%d</span><span class="s1">_dt_</span><span class="si">%.3f</span><span class="s1">_mu_</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Ns</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">mu</span><span class="p">)</span>
</span><span id="multiclass_mbo.__init__-954"><a href="#multiclass_mbo.__init__-954"><span class="linenos">954</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Multiclass MBO&#39;</span>
</span></pre></div>


            <div class="docstring"><h1 id="multiclass-mbo">Multiclass MBO</h1>

<p>Semi-supervised learning via the Multiclass MBO method [1].</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>W</strong> (numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None):
Weight matrix representing the graph.</li>
<li><strong>class_priors</strong> (numpy array (optional), default=None):
Class priors (fraction of data belonging to each class). If provided, the predict function
will attempt to automatic balance the label predictions to predict the correct number of
nodes in each class.</li>
<li><strong>Ns</strong> (int (optional), default=6):
Number of inner iterations.</li>
<li><strong>T</strong> (int (optional), default=10):
Number of outer iterations.</li>
<li><strong>dt</strong> (float (optional), default=0.15):
Time step.</li>
<li><strong>mu</strong> (float (optional), default=50):
Fidelity penalty.</li>
<li><strong>num_eig</strong> (int (optional), default=300):
Number of eigenvectors.</li>
</ul>

<h6 id="references">References</h6>

<p>[1] C. Garcia-Cardona, E. Merkurjev, A.L. Bertozzi, A. Flenner, and A.G. Percus. <a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.743.9516&rep=rep1&type=pdf">Multiclass data segmentation using diffuse interface methods on graphs.</a> IEEE transactions on pattern analysis and machine intelligence, 36(8), 1600-1613, 2014.</p>
</div>


                            </div>
                            <div id="multiclass_mbo.Ns" class="classattr">
                                <div class="attr variable">
            <span class="name">Ns</span>

        
    </div>
    <a class="headerlink" href="#multiclass_mbo.Ns"></a>
    
    

                            </div>
                            <div id="multiclass_mbo.T" class="classattr">
                                <div class="attr variable">
            <span class="name">T</span>

        
    </div>
    <a class="headerlink" href="#multiclass_mbo.T"></a>
    
    

                            </div>
                            <div id="multiclass_mbo.dt" class="classattr">
                                <div class="attr variable">
            <span class="name">dt</span>

        
    </div>
    <a class="headerlink" href="#multiclass_mbo.dt"></a>
    
    

                            </div>
                            <div id="multiclass_mbo.mu" class="classattr">
                                <div class="attr variable">
            <span class="name">mu</span>

        
    </div>
    <a class="headerlink" href="#multiclass_mbo.mu"></a>
    
    

                            </div>
                            <div id="multiclass_mbo.num_eig" class="classattr">
                                <div class="attr variable">
            <span class="name">num_eig</span>

        
    </div>
    <a class="headerlink" href="#multiclass_mbo.num_eig"></a>
    
    

                            </div>
                            <div id="multiclass_mbo.requires_eig" class="classattr">
                                <div class="attr variable">
            <span class="name">requires_eig</span>

        
    </div>
    <a class="headerlink" href="#multiclass_mbo.requires_eig"></a>
    
    

                            </div>
                            <div id="multiclass_mbo.accuracy_filename" class="classattr">
                                <div class="attr variable">
            <span class="name">accuracy_filename</span>

        
    </div>
    <a class="headerlink" href="#multiclass_mbo.accuracy_filename"></a>
    
    

                            </div>
                            <div id="multiclass_mbo.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#multiclass_mbo.name"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#ssl">ssl</a></dt>
                                <dd id="multiclass_mbo.prob" class="variable"><a href="#ssl.prob">prob</a></dd>
                <dd id="multiclass_mbo.fitted" class="variable"><a href="#ssl.fitted">fitted</a></dd>
                <dd id="multiclass_mbo.onevsrest" class="variable"><a href="#ssl.onevsrest">onevsrest</a></dd>
                <dd id="multiclass_mbo.similarity" class="variable"><a href="#ssl.similarity">similarity</a></dd>
                <dd id="multiclass_mbo.class_priors" class="variable"><a href="#ssl.class_priors">class_priors</a></dd>
                <dd id="multiclass_mbo.weights" class="variable"><a href="#ssl.weights">weights</a></dd>
                <dd id="multiclass_mbo.class_priors_error" class="variable"><a href="#ssl.class_priors_error">class_priors_error</a></dd>
                <dd id="multiclass_mbo.set_graph" class="function"><a href="#ssl.set_graph">set_graph</a></dd>
                <dd id="multiclass_mbo.volume_label_projection" class="function"><a href="#ssl.volume_label_projection">volume_label_projection</a></dd>
                <dd id="multiclass_mbo.get_accuracy_filename" class="function"><a href="#ssl.get_accuracy_filename">get_accuracy_filename</a></dd>
                <dd id="multiclass_mbo.predict" class="function"><a href="#ssl.predict">predict</a></dd>
                <dd id="multiclass_mbo.fit_predict" class="function"><a href="#ssl.fit_predict">fit_predict</a></dd>
                <dd id="multiclass_mbo.ssl_trials" class="function"><a href="#ssl.ssl_trials">ssl_trials</a></dd>
                <dd id="multiclass_mbo.trials_statistics" class="function"><a href="#ssl.trials_statistics">trials_statistics</a></dd>
                <dd id="multiclass_mbo.fit" class="function"><a href="#ssl.fit">fit</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="modularity_mbo">
                            <input id="modularity_mbo-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">modularity_mbo</span><wbr>(<span class="base"><a href="#ssl">ssl</a></span>):

                <label class="view-source-button" for="modularity_mbo-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#modularity_mbo"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="modularity_mbo-1008"><a href="#modularity_mbo-1008"><span class="linenos">1008</span></a><span class="k">class</span> <span class="nc">modularity_mbo</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="modularity_mbo-1009"><a href="#modularity_mbo-1009"><span class="linenos">1009</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">lamb</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">Ns</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
</span><span id="modularity_mbo-1010"><a href="#modularity_mbo-1010"><span class="linenos">1010</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Modularity MBO</span>
</span><span id="modularity_mbo-1011"><a href="#modularity_mbo-1011"><span class="linenos">1011</span></a><span class="sd">        ===================</span>
</span><span id="modularity_mbo-1012"><a href="#modularity_mbo-1012"><span class="linenos">1012</span></a>
</span><span id="modularity_mbo-1013"><a href="#modularity_mbo-1013"><span class="linenos">1013</span></a><span class="sd">        Semi-supervised learning via the Modularity MBO method [1].</span>
</span><span id="modularity_mbo-1014"><a href="#modularity_mbo-1014"><span class="linenos">1014</span></a>
</span><span id="modularity_mbo-1015"><a href="#modularity_mbo-1015"><span class="linenos">1015</span></a><span class="sd">        Parameters</span>
</span><span id="modularity_mbo-1016"><a href="#modularity_mbo-1016"><span class="linenos">1016</span></a><span class="sd">        ----------</span>
</span><span id="modularity_mbo-1017"><a href="#modularity_mbo-1017"><span class="linenos">1017</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="modularity_mbo-1018"><a href="#modularity_mbo-1018"><span class="linenos">1018</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="modularity_mbo-1019"><a href="#modularity_mbo-1019"><span class="linenos">1019</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="modularity_mbo-1020"><a href="#modularity_mbo-1020"><span class="linenos">1020</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="modularity_mbo-1021"><a href="#modularity_mbo-1021"><span class="linenos">1021</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="modularity_mbo-1022"><a href="#modularity_mbo-1022"><span class="linenos">1022</span></a><span class="sd">            nodes in each class.</span>
</span><span id="modularity_mbo-1023"><a href="#modularity_mbo-1023"><span class="linenos">1023</span></a><span class="sd">        gamma : float (optional), default=0.5</span>
</span><span id="modularity_mbo-1024"><a href="#modularity_mbo-1024"><span class="linenos">1024</span></a><span class="sd">            Parameter in algorithm.</span>
</span><span id="modularity_mbo-1025"><a href="#modularity_mbo-1025"><span class="linenos">1025</span></a><span class="sd">        epsilon : float (optional), default=1</span>
</span><span id="modularity_mbo-1026"><a href="#modularity_mbo-1026"><span class="linenos">1026</span></a><span class="sd">            Parameter in algorithm.</span>
</span><span id="modularity_mbo-1027"><a href="#modularity_mbo-1027"><span class="linenos">1027</span></a><span class="sd">        lamb : float (optional), default=1</span>
</span><span id="modularity_mbo-1028"><a href="#modularity_mbo-1028"><span class="linenos">1028</span></a><span class="sd">            Parameter in algorithm.</span>
</span><span id="modularity_mbo-1029"><a href="#modularity_mbo-1029"><span class="linenos">1029</span></a><span class="sd">        T : int (optional), default=20</span>
</span><span id="modularity_mbo-1030"><a href="#modularity_mbo-1030"><span class="linenos">1030</span></a><span class="sd">            Number of outer iterations.</span>
</span><span id="modularity_mbo-1031"><a href="#modularity_mbo-1031"><span class="linenos">1031</span></a><span class="sd">        Ns : int (optional), default=5</span>
</span><span id="modularity_mbo-1032"><a href="#modularity_mbo-1032"><span class="linenos">1032</span></a><span class="sd">            Number of inner iterations.</span>
</span><span id="modularity_mbo-1033"><a href="#modularity_mbo-1033"><span class="linenos">1033</span></a><span class="sd">        </span>
</span><span id="modularity_mbo-1034"><a href="#modularity_mbo-1034"><span class="linenos">1034</span></a><span class="sd">        References</span>
</span><span id="modularity_mbo-1035"><a href="#modularity_mbo-1035"><span class="linenos">1035</span></a><span class="sd">        ---------</span>
</span><span id="modularity_mbo-1036"><a href="#modularity_mbo-1036"><span class="linenos">1036</span></a><span class="sd">        [1] Z.M. Boyd, E. Bae, X.C. Tai, and A.L. Bertozzi. [Simplified energy landscape for modularity using total variation.](https://publications.ffi.no/nb/item/asset/dspace:4288/1619750.pdf) SIAM Journal on Applied Mathematics, 78(5), 2439-2464, 2018.</span>
</span><span id="modularity_mbo-1037"><a href="#modularity_mbo-1037"><span class="linenos">1037</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="modularity_mbo-1038"><a href="#modularity_mbo-1038"><span class="linenos">1038</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="modularity_mbo-1039"><a href="#modularity_mbo-1039"><span class="linenos">1039</span></a>
</span><span id="modularity_mbo-1040"><a href="#modularity_mbo-1040"><span class="linenos">1040</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
</span><span id="modularity_mbo-1041"><a href="#modularity_mbo-1041"><span class="linenos">1041</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">epsilon</span>
</span><span id="modularity_mbo-1042"><a href="#modularity_mbo-1042"><span class="linenos">1042</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lamb</span> <span class="o">=</span> <span class="n">lamb</span>
</span><span id="modularity_mbo-1043"><a href="#modularity_mbo-1043"><span class="linenos">1043</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">requires_eig</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="modularity_mbo-1044"><a href="#modularity_mbo-1044"><span class="linenos">1044</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
</span><span id="modularity_mbo-1045"><a href="#modularity_mbo-1045"><span class="linenos">1045</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span> <span class="o">=</span> <span class="n">Ns</span>
</span><span id="modularity_mbo-1046"><a href="#modularity_mbo-1046"><span class="linenos">1046</span></a>
</span><span id="modularity_mbo-1047"><a href="#modularity_mbo-1047"><span class="linenos">1047</span></a>        <span class="c1">#Setup accuracy filename</span>
</span><span id="modularity_mbo-1048"><a href="#modularity_mbo-1048"><span class="linenos">1048</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_modularity_mbo_gamma_</span><span class="si">%.2f</span><span class="s1">_epsilon_</span><span class="si">%.2f</span><span class="s1">_lamb_</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span><span class="n">epsilon</span><span class="p">,</span><span class="n">lamb</span><span class="p">)</span>
</span><span id="modularity_mbo-1049"><a href="#modularity_mbo-1049"><span class="linenos">1049</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Modularity MBO&#39;</span>
</span><span id="modularity_mbo-1050"><a href="#modularity_mbo-1050"><span class="linenos">1050</span></a>
</span><span id="modularity_mbo-1051"><a href="#modularity_mbo-1051"><span class="linenos">1051</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="modularity_mbo-1052"><a href="#modularity_mbo-1052"><span class="linenos">1052</span></a>
</span><span id="modularity_mbo-1053"><a href="#modularity_mbo-1053"><span class="linenos">1053</span></a>        <span class="c1">#Short form</span>
</span><span id="modularity_mbo-1054"><a href="#modularity_mbo-1054"><span class="linenos">1054</span></a>        <span class="n">gamma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span>
</span><span id="modularity_mbo-1055"><a href="#modularity_mbo-1055"><span class="linenos">1055</span></a>        <span class="n">eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span>
</span><span id="modularity_mbo-1056"><a href="#modularity_mbo-1056"><span class="linenos">1056</span></a>        <span class="n">lamb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lamb</span>
</span><span id="modularity_mbo-1057"><a href="#modularity_mbo-1057"><span class="linenos">1057</span></a>        <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span>
</span><span id="modularity_mbo-1058"><a href="#modularity_mbo-1058"><span class="linenos">1058</span></a>        <span class="n">Ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span>
</span><span id="modularity_mbo-1059"><a href="#modularity_mbo-1059"><span class="linenos">1059</span></a>
</span><span id="modularity_mbo-1060"><a href="#modularity_mbo-1060"><span class="linenos">1060</span></a>        <span class="c1">#One-hot initialization</span>
</span><span id="modularity_mbo-1061"><a href="#modularity_mbo-1061"><span class="linenos">1061</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span>
</span><span id="modularity_mbo-1062"><a href="#modularity_mbo-1062"><span class="linenos">1062</span></a>        <span class="n">num_classes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_labels</span><span class="p">))</span>
</span><span id="modularity_mbo-1063"><a href="#modularity_mbo-1063"><span class="linenos">1063</span></a>        <span class="n">train_onehot</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span>
</span><span id="modularity_mbo-1064"><a href="#modularity_mbo-1064"><span class="linenos">1064</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">num_classes</span><span class="p">))</span>
</span><span id="modularity_mbo-1065"><a href="#modularity_mbo-1065"><span class="linenos">1065</span></a>        <span class="n">u</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">train_onehot</span>
</span><span id="modularity_mbo-1066"><a href="#modularity_mbo-1066"><span class="linenos">1066</span></a>
</span><span id="modularity_mbo-1067"><a href="#modularity_mbo-1067"><span class="linenos">1067</span></a>        <span class="c1">#Spectral decomposition</span>
</span><span id="modularity_mbo-1068"><a href="#modularity_mbo-1068"><span class="linenos">1068</span></a>        <span class="n">num_eig</span> <span class="o">=</span> <span class="mi">5</span><span class="o">*</span><span class="n">num_classes</span>
</span><span id="modularity_mbo-1069"><a href="#modularity_mbo-1069"><span class="linenos">1069</span></a>        <span class="n">D</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">eigen_decomp</span><span class="p">(</span><span class="n">normalization</span><span class="o">=</span><span class="s1">&#39;combinatorial&#39;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">num_eig</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">)</span>
</span><span id="modularity_mbo-1070"><a href="#modularity_mbo-1070"><span class="linenos">1070</span></a>
</span><span id="modularity_mbo-1071"><a href="#modularity_mbo-1071"><span class="linenos">1071</span></a>        <span class="c1">#Time step selection</span>
</span><span id="modularity_mbo-1072"><a href="#modularity_mbo-1072"><span class="linenos">1072</span></a>        <span class="n">deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">degree_vector</span><span class="p">()</span>
</span><span id="modularity_mbo-1073"><a href="#modularity_mbo-1073"><span class="linenos">1073</span></a>        <span class="n">dtlow</span> <span class="o">=</span> <span class="mf">0.15</span><span class="o">/</span><span class="p">((</span><span class="n">gamma</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">deg</span><span class="p">))</span>
</span><span id="modularity_mbo-1074"><a href="#modularity_mbo-1074"><span class="linenos">1074</span></a>        <span class="n">dthigh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">/</span><span class="n">eps</span><span class="p">)</span><span class="o">/</span><span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="modularity_mbo-1075"><a href="#modularity_mbo-1075"><span class="linenos">1075</span></a>        <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dtlow</span><span class="o">*</span><span class="n">dthigh</span><span class="p">)</span>
</span><span id="modularity_mbo-1076"><a href="#modularity_mbo-1076"><span class="linenos">1076</span></a>
</span><span id="modularity_mbo-1077"><a href="#modularity_mbo-1077"><span class="linenos">1077</span></a>        <span class="c1">#Diffusion matrix</span>
</span><span id="modularity_mbo-1078"><a href="#modularity_mbo-1078"><span class="linenos">1078</span></a>        <span class="n">P</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">D</span><span class="o">*</span><span class="n">dt</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">num_eig</span><span class="p">,</span><span class="n">num_eig</span><span class="p">)</span><span class="nd">@V</span><span class="o">.</span><span class="n">T</span>
</span><span id="modularity_mbo-1079"><a href="#modularity_mbo-1079"><span class="linenos">1079</span></a>
</span><span id="modularity_mbo-1080"><a href="#modularity_mbo-1080"><span class="linenos">1080</span></a>        <span class="c1">#Main MBO iterations</span>
</span><span id="modularity_mbo-1081"><a href="#modularity_mbo-1081"><span class="linenos">1081</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
</span><span id="modularity_mbo-1082"><a href="#modularity_mbo-1082"><span class="linenos">1082</span></a>
</span><span id="modularity_mbo-1083"><a href="#modularity_mbo-1083"><span class="linenos">1083</span></a>            <span class="c1">#Diffusion </span>
</span><span id="modularity_mbo-1084"><a href="#modularity_mbo-1084"><span class="linenos">1084</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">V</span><span class="o">@</span><span class="p">(</span><span class="n">P</span><span class="nd">@u</span><span class="p">)</span>
</span><span id="modularity_mbo-1085"><a href="#modularity_mbo-1085"><span class="linenos">1085</span></a>
</span><span id="modularity_mbo-1086"><a href="#modularity_mbo-1086"><span class="linenos">1086</span></a>            <span class="c1">#Training labels</span>
</span><span id="modularity_mbo-1087"><a href="#modularity_mbo-1087"><span class="linenos">1087</span></a>            <span class="k">if</span> <span class="n">lamb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="modularity_mbo-1088"><a href="#modularity_mbo-1088"><span class="linenos">1088</span></a>                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
</span><span id="modularity_mbo-1089"><a href="#modularity_mbo-1089"><span class="linenos">1089</span></a>                    <span class="n">u</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,:]</span> <span class="o">-=</span> <span class="p">(</span><span class="n">dt</span><span class="o">/</span><span class="n">Ns</span><span class="p">)</span><span class="o">*</span><span class="n">lamb</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">train_onehot</span><span class="p">)</span>
</span><span id="modularity_mbo-1090"><a href="#modularity_mbo-1090"><span class="linenos">1090</span></a>
</span><span id="modularity_mbo-1091"><a href="#modularity_mbo-1091"><span class="linenos">1091</span></a>            <span class="c1">#Threshold to labels</span>
</span><span id="modularity_mbo-1092"><a href="#modularity_mbo-1092"><span class="linenos">1092</span></a>            <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="modularity_mbo-1093"><a href="#modularity_mbo-1093"><span class="linenos">1093</span></a>            
</span><span id="modularity_mbo-1094"><a href="#modularity_mbo-1094"><span class="linenos">1094</span></a>            <span class="c1">#Convert to 1-hot vectors</span>
</span><span id="modularity_mbo-1095"><a href="#modularity_mbo-1095"><span class="linenos">1095</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</span><span id="modularity_mbo-1096"><a href="#modularity_mbo-1096"><span class="linenos">1096</span></a>
</span><span id="modularity_mbo-1097"><a href="#modularity_mbo-1097"><span class="linenos">1097</span></a>            <span class="c1">#Compute accuracy if all labels are provided</span>
</span><span id="modularity_mbo-1098"><a href="#modularity_mbo-1098"><span class="linenos">1098</span></a>            <span class="k">if</span> <span class="n">all_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="modularity_mbo-1099"><a href="#modularity_mbo-1099"><span class="linenos">1099</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">=</span> <span class="n">u</span>
</span><span id="modularity_mbo-1100"><a href="#modularity_mbo-1100"><span class="linenos">1100</span></a>                <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</span><span id="modularity_mbo-1101"><a href="#modularity_mbo-1101"><span class="linenos">1101</span></a>                <span class="n">acc</span> <span class="o">=</span> <span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">all_labels</span><span class="p">,</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="modularity_mbo-1102"><a href="#modularity_mbo-1102"><span class="linenos">1102</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accuracy = </span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">acc</span><span class="p">)</span>
</span><span id="modularity_mbo-1103"><a href="#modularity_mbo-1103"><span class="linenos">1103</span></a>
</span><span id="modularity_mbo-1104"><a href="#modularity_mbo-1104"><span class="linenos">1104</span></a>        <span class="k">return</span> <span class="n">u</span>
</span></pre></div>


    

                            <div id="modularity_mbo.__init__" class="classattr">
                                        <input id="modularity_mbo.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">modularity_mbo</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">W</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">gamma</span><span class="o">=</span><span class="mf">0.5</span>, </span><span class="param"><span class="n">epsilon</span><span class="o">=</span><span class="mi">1</span>, </span><span class="param"><span class="n">lamb</span><span class="o">=</span><span class="mi">1</span>, </span><span class="param"><span class="n">T</span><span class="o">=</span><span class="mi">20</span>, </span><span class="param"><span class="n">Ns</span><span class="o">=</span><span class="mi">5</span></span>)</span>

                <label class="view-source-button" for="modularity_mbo.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#modularity_mbo.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="modularity_mbo.__init__-1009"><a href="#modularity_mbo.__init__-1009"><span class="linenos">1009</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">lamb</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">Ns</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
</span><span id="modularity_mbo.__init__-1010"><a href="#modularity_mbo.__init__-1010"><span class="linenos">1010</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Modularity MBO</span>
</span><span id="modularity_mbo.__init__-1011"><a href="#modularity_mbo.__init__-1011"><span class="linenos">1011</span></a><span class="sd">        ===================</span>
</span><span id="modularity_mbo.__init__-1012"><a href="#modularity_mbo.__init__-1012"><span class="linenos">1012</span></a>
</span><span id="modularity_mbo.__init__-1013"><a href="#modularity_mbo.__init__-1013"><span class="linenos">1013</span></a><span class="sd">        Semi-supervised learning via the Modularity MBO method [1].</span>
</span><span id="modularity_mbo.__init__-1014"><a href="#modularity_mbo.__init__-1014"><span class="linenos">1014</span></a>
</span><span id="modularity_mbo.__init__-1015"><a href="#modularity_mbo.__init__-1015"><span class="linenos">1015</span></a><span class="sd">        Parameters</span>
</span><span id="modularity_mbo.__init__-1016"><a href="#modularity_mbo.__init__-1016"><span class="linenos">1016</span></a><span class="sd">        ----------</span>
</span><span id="modularity_mbo.__init__-1017"><a href="#modularity_mbo.__init__-1017"><span class="linenos">1017</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="modularity_mbo.__init__-1018"><a href="#modularity_mbo.__init__-1018"><span class="linenos">1018</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="modularity_mbo.__init__-1019"><a href="#modularity_mbo.__init__-1019"><span class="linenos">1019</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="modularity_mbo.__init__-1020"><a href="#modularity_mbo.__init__-1020"><span class="linenos">1020</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="modularity_mbo.__init__-1021"><a href="#modularity_mbo.__init__-1021"><span class="linenos">1021</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="modularity_mbo.__init__-1022"><a href="#modularity_mbo.__init__-1022"><span class="linenos">1022</span></a><span class="sd">            nodes in each class.</span>
</span><span id="modularity_mbo.__init__-1023"><a href="#modularity_mbo.__init__-1023"><span class="linenos">1023</span></a><span class="sd">        gamma : float (optional), default=0.5</span>
</span><span id="modularity_mbo.__init__-1024"><a href="#modularity_mbo.__init__-1024"><span class="linenos">1024</span></a><span class="sd">            Parameter in algorithm.</span>
</span><span id="modularity_mbo.__init__-1025"><a href="#modularity_mbo.__init__-1025"><span class="linenos">1025</span></a><span class="sd">        epsilon : float (optional), default=1</span>
</span><span id="modularity_mbo.__init__-1026"><a href="#modularity_mbo.__init__-1026"><span class="linenos">1026</span></a><span class="sd">            Parameter in algorithm.</span>
</span><span id="modularity_mbo.__init__-1027"><a href="#modularity_mbo.__init__-1027"><span class="linenos">1027</span></a><span class="sd">        lamb : float (optional), default=1</span>
</span><span id="modularity_mbo.__init__-1028"><a href="#modularity_mbo.__init__-1028"><span class="linenos">1028</span></a><span class="sd">            Parameter in algorithm.</span>
</span><span id="modularity_mbo.__init__-1029"><a href="#modularity_mbo.__init__-1029"><span class="linenos">1029</span></a><span class="sd">        T : int (optional), default=20</span>
</span><span id="modularity_mbo.__init__-1030"><a href="#modularity_mbo.__init__-1030"><span class="linenos">1030</span></a><span class="sd">            Number of outer iterations.</span>
</span><span id="modularity_mbo.__init__-1031"><a href="#modularity_mbo.__init__-1031"><span class="linenos">1031</span></a><span class="sd">        Ns : int (optional), default=5</span>
</span><span id="modularity_mbo.__init__-1032"><a href="#modularity_mbo.__init__-1032"><span class="linenos">1032</span></a><span class="sd">            Number of inner iterations.</span>
</span><span id="modularity_mbo.__init__-1033"><a href="#modularity_mbo.__init__-1033"><span class="linenos">1033</span></a><span class="sd">        </span>
</span><span id="modularity_mbo.__init__-1034"><a href="#modularity_mbo.__init__-1034"><span class="linenos">1034</span></a><span class="sd">        References</span>
</span><span id="modularity_mbo.__init__-1035"><a href="#modularity_mbo.__init__-1035"><span class="linenos">1035</span></a><span class="sd">        ---------</span>
</span><span id="modularity_mbo.__init__-1036"><a href="#modularity_mbo.__init__-1036"><span class="linenos">1036</span></a><span class="sd">        [1] Z.M. Boyd, E. Bae, X.C. Tai, and A.L. Bertozzi. [Simplified energy landscape for modularity using total variation.](https://publications.ffi.no/nb/item/asset/dspace:4288/1619750.pdf) SIAM Journal on Applied Mathematics, 78(5), 2439-2464, 2018.</span>
</span><span id="modularity_mbo.__init__-1037"><a href="#modularity_mbo.__init__-1037"><span class="linenos">1037</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="modularity_mbo.__init__-1038"><a href="#modularity_mbo.__init__-1038"><span class="linenos">1038</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="modularity_mbo.__init__-1039"><a href="#modularity_mbo.__init__-1039"><span class="linenos">1039</span></a>
</span><span id="modularity_mbo.__init__-1040"><a href="#modularity_mbo.__init__-1040"><span class="linenos">1040</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
</span><span id="modularity_mbo.__init__-1041"><a href="#modularity_mbo.__init__-1041"><span class="linenos">1041</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">epsilon</span>
</span><span id="modularity_mbo.__init__-1042"><a href="#modularity_mbo.__init__-1042"><span class="linenos">1042</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lamb</span> <span class="o">=</span> <span class="n">lamb</span>
</span><span id="modularity_mbo.__init__-1043"><a href="#modularity_mbo.__init__-1043"><span class="linenos">1043</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">requires_eig</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="modularity_mbo.__init__-1044"><a href="#modularity_mbo.__init__-1044"><span class="linenos">1044</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
</span><span id="modularity_mbo.__init__-1045"><a href="#modularity_mbo.__init__-1045"><span class="linenos">1045</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span> <span class="o">=</span> <span class="n">Ns</span>
</span><span id="modularity_mbo.__init__-1046"><a href="#modularity_mbo.__init__-1046"><span class="linenos">1046</span></a>
</span><span id="modularity_mbo.__init__-1047"><a href="#modularity_mbo.__init__-1047"><span class="linenos">1047</span></a>        <span class="c1">#Setup accuracy filename</span>
</span><span id="modularity_mbo.__init__-1048"><a href="#modularity_mbo.__init__-1048"><span class="linenos">1048</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_modularity_mbo_gamma_</span><span class="si">%.2f</span><span class="s1">_epsilon_</span><span class="si">%.2f</span><span class="s1">_lamb_</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span><span class="n">epsilon</span><span class="p">,</span><span class="n">lamb</span><span class="p">)</span>
</span><span id="modularity_mbo.__init__-1049"><a href="#modularity_mbo.__init__-1049"><span class="linenos">1049</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Modularity MBO&#39;</span>
</span></pre></div>


            <div class="docstring"><h1 id="modularity-mbo">Modularity MBO</h1>

<p>Semi-supervised learning via the Modularity MBO method [1].</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>W</strong> (numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None):
Weight matrix representing the graph.</li>
<li><strong>class_priors</strong> (numpy array (optional), default=None):
Class priors (fraction of data belonging to each class). If provided, the predict function
will attempt to automatic balance the label predictions to predict the correct number of
nodes in each class.</li>
<li><strong>gamma</strong> (float (optional), default=0.5):
Parameter in algorithm.</li>
<li><strong>epsilon</strong> (float (optional), default=1):
Parameter in algorithm.</li>
<li><strong>lamb</strong> (float (optional), default=1):
Parameter in algorithm.</li>
<li><strong>T</strong> (int (optional), default=20):
Number of outer iterations.</li>
<li><strong>Ns</strong> (int (optional), default=5):
Number of inner iterations.</li>
</ul>

<h6 id="references">References</h6>

<p>[1] Z.M. Boyd, E. Bae, X.C. Tai, and A.L. Bertozzi. <a href="https://publications.ffi.no/nb/item/asset/dspace:4288/1619750.pdf">Simplified energy landscape for modularity using total variation.</a> SIAM Journal on Applied Mathematics, 78(5), 2439-2464, 2018.</p>
</div>


                            </div>
                            <div id="modularity_mbo.gamma" class="classattr">
                                <div class="attr variable">
            <span class="name">gamma</span>

        
    </div>
    <a class="headerlink" href="#modularity_mbo.gamma"></a>
    
    

                            </div>
                            <div id="modularity_mbo.epsilon" class="classattr">
                                <div class="attr variable">
            <span class="name">epsilon</span>

        
    </div>
    <a class="headerlink" href="#modularity_mbo.epsilon"></a>
    
    

                            </div>
                            <div id="modularity_mbo.lamb" class="classattr">
                                <div class="attr variable">
            <span class="name">lamb</span>

        
    </div>
    <a class="headerlink" href="#modularity_mbo.lamb"></a>
    
    

                            </div>
                            <div id="modularity_mbo.requires_eig" class="classattr">
                                <div class="attr variable">
            <span class="name">requires_eig</span>

        
    </div>
    <a class="headerlink" href="#modularity_mbo.requires_eig"></a>
    
    

                            </div>
                            <div id="modularity_mbo.T" class="classattr">
                                <div class="attr variable">
            <span class="name">T</span>

        
    </div>
    <a class="headerlink" href="#modularity_mbo.T"></a>
    
    

                            </div>
                            <div id="modularity_mbo.Ns" class="classattr">
                                <div class="attr variable">
            <span class="name">Ns</span>

        
    </div>
    <a class="headerlink" href="#modularity_mbo.Ns"></a>
    
    

                            </div>
                            <div id="modularity_mbo.accuracy_filename" class="classattr">
                                <div class="attr variable">
            <span class="name">accuracy_filename</span>

        
    </div>
    <a class="headerlink" href="#modularity_mbo.accuracy_filename"></a>
    
    

                            </div>
                            <div id="modularity_mbo.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#modularity_mbo.name"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#ssl">ssl</a></dt>
                                <dd id="modularity_mbo.prob" class="variable"><a href="#ssl.prob">prob</a></dd>
                <dd id="modularity_mbo.fitted" class="variable"><a href="#ssl.fitted">fitted</a></dd>
                <dd id="modularity_mbo.onevsrest" class="variable"><a href="#ssl.onevsrest">onevsrest</a></dd>
                <dd id="modularity_mbo.similarity" class="variable"><a href="#ssl.similarity">similarity</a></dd>
                <dd id="modularity_mbo.class_priors" class="variable"><a href="#ssl.class_priors">class_priors</a></dd>
                <dd id="modularity_mbo.weights" class="variable"><a href="#ssl.weights">weights</a></dd>
                <dd id="modularity_mbo.class_priors_error" class="variable"><a href="#ssl.class_priors_error">class_priors_error</a></dd>
                <dd id="modularity_mbo.set_graph" class="function"><a href="#ssl.set_graph">set_graph</a></dd>
                <dd id="modularity_mbo.volume_label_projection" class="function"><a href="#ssl.volume_label_projection">volume_label_projection</a></dd>
                <dd id="modularity_mbo.get_accuracy_filename" class="function"><a href="#ssl.get_accuracy_filename">get_accuracy_filename</a></dd>
                <dd id="modularity_mbo.predict" class="function"><a href="#ssl.predict">predict</a></dd>
                <dd id="modularity_mbo.fit_predict" class="function"><a href="#ssl.fit_predict">fit_predict</a></dd>
                <dd id="modularity_mbo.ssl_trials" class="function"><a href="#ssl.ssl_trials">ssl_trials</a></dd>
                <dd id="modularity_mbo.trials_statistics" class="function"><a href="#ssl.trials_statistics">trials_statistics</a></dd>
                <dd id="modularity_mbo.fit" class="function"><a href="#ssl.fit">fit</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="laplace">
                            <input id="laplace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">laplace</span><wbr>(<span class="base"><a href="#ssl">ssl</a></span>):

                <label class="view-source-button" for="laplace-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#laplace"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="laplace-1107"><a href="#laplace-1107"><span class="linenos">1107</span></a><span class="k">class</span> <span class="nc">laplace</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="laplace-1108"><a href="#laplace-1108"><span class="linenos">1108</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reweighting</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">normalization</span><span class="o">=</span><span class="s1">&#39;combinatorial&#39;</span><span class="p">,</span> 
</span><span id="laplace-1109"><a href="#laplace-1109"><span class="linenos">1109</span></a>                 <span class="n">tau</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mean_shift</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">zeta</span><span class="o">=</span><span class="mf">1e7</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
</span><span id="laplace-1110"><a href="#laplace-1110"><span class="linenos">1110</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Laplace Learning</span>
</span><span id="laplace-1111"><a href="#laplace-1111"><span class="linenos">1111</span></a><span class="sd">        ===================</span>
</span><span id="laplace-1112"><a href="#laplace-1112"><span class="linenos">1112</span></a>
</span><span id="laplace-1113"><a href="#laplace-1113"><span class="linenos">1113</span></a><span class="sd">        Semi-supervised learning via the solution of the Laplace equation</span>
</span><span id="laplace-1114"><a href="#laplace-1114"><span class="linenos">1114</span></a><span class="sd">        \\[\\tau u_j + L^m u_j = 0, \\ \\ j \\geq m+1,\\]</span>
</span><span id="laplace-1115"><a href="#laplace-1115"><span class="linenos">1115</span></a><span class="sd">        subject to \\(u_j = y_j\\) for \\(j=1,\\dots,m\\), where \\(L=D-W\\) is the </span>
</span><span id="laplace-1116"><a href="#laplace-1116"><span class="linenos">1116</span></a><span class="sd">        combinatorial graph Laplacian and \\(y_j\\) for \\(j=1,\\dots,m\\) are the </span>
</span><span id="laplace-1117"><a href="#laplace-1117"><span class="linenos">1117</span></a><span class="sd">        label vectors. Default order is m=1, and m &gt; 1 corresponds to higher order Laplace Learning.</span>
</span><span id="laplace-1118"><a href="#laplace-1118"><span class="linenos">1118</span></a>
</span><span id="laplace-1119"><a href="#laplace-1119"><span class="linenos">1119</span></a><span class="sd">        The original method was introduced in [1]. This class also implements reweighting </span>
</span><span id="laplace-1120"><a href="#laplace-1120"><span class="linenos">1120</span></a><span class="sd">        schemes `poisson` proposed in [2], `wnll` proposed in [3], and `properly`, proposed in [4].</span>
</span><span id="laplace-1121"><a href="#laplace-1121"><span class="linenos">1121</span></a><span class="sd">        If `properly` is selected, the user must additionally provide the data features `X`.</span>
</span><span id="laplace-1122"><a href="#laplace-1122"><span class="linenos">1122</span></a>
</span><span id="laplace-1123"><a href="#laplace-1123"><span class="linenos">1123</span></a><span class="sd">        Parameters</span>
</span><span id="laplace-1124"><a href="#laplace-1124"><span class="linenos">1124</span></a><span class="sd">        ----------</span>
</span><span id="laplace-1125"><a href="#laplace-1125"><span class="linenos">1125</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="laplace-1126"><a href="#laplace-1126"><span class="linenos">1126</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="laplace-1127"><a href="#laplace-1127"><span class="linenos">1127</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="laplace-1128"><a href="#laplace-1128"><span class="linenos">1128</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="laplace-1129"><a href="#laplace-1129"><span class="linenos">1129</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="laplace-1130"><a href="#laplace-1130"><span class="linenos">1130</span></a><span class="sd">            nodes in each class.</span>
</span><span id="laplace-1131"><a href="#laplace-1131"><span class="linenos">1131</span></a><span class="sd">        X : numpy array (optional)</span>
</span><span id="laplace-1132"><a href="#laplace-1132"><span class="linenos">1132</span></a><span class="sd">            Data features, used to construct the graph. This is required for the `properly` weighted </span>
</span><span id="laplace-1133"><a href="#laplace-1133"><span class="linenos">1133</span></a><span class="sd">            graph Laplacian method.</span>
</span><span id="laplace-1134"><a href="#laplace-1134"><span class="linenos">1134</span></a><span class="sd">        normalization : {&#39;combinatorial&#39;,&#39;randomwalk&#39;,&#39;normalized&#39;} (optional), defualt=&#39;combinatorial&#39;</span>
</span><span id="laplace-1135"><a href="#laplace-1135"><span class="linenos">1135</span></a><span class="sd">            Normalization for the graph Laplacian.</span>
</span><span id="laplace-1136"><a href="#laplace-1136"><span class="linenos">1136</span></a><span class="sd">        reweighting : {&#39;none&#39;, &#39;wnll&#39;, &#39;poisson&#39;, &#39;properly&#39;} (optional), default=&#39;none&#39;</span>
</span><span id="laplace-1137"><a href="#laplace-1137"><span class="linenos">1137</span></a><span class="sd">            Reweighting scheme for low label rate problems. If &#39;properly&#39; is selected, the user</span>
</span><span id="laplace-1138"><a href="#laplace-1138"><span class="linenos">1138</span></a><span class="sd">            must supply the data features `X`.</span>
</span><span id="laplace-1139"><a href="#laplace-1139"><span class="linenos">1139</span></a><span class="sd">        tau : float or numpy array (optional), default=0</span>
</span><span id="laplace-1140"><a href="#laplace-1140"><span class="linenos">1140</span></a><span class="sd">            Zeroth order term in Laplace equation. Can be a scalar or vector.</span>
</span><span id="laplace-1141"><a href="#laplace-1141"><span class="linenos">1141</span></a><span class="sd">        order : integer (optional), default=1</span>
</span><span id="laplace-1142"><a href="#laplace-1142"><span class="linenos">1142</span></a><span class="sd">            Power m for higher order Laplace learning. Currently only integers are allowed. </span>
</span><span id="laplace-1143"><a href="#laplace-1143"><span class="linenos">1143</span></a><span class="sd">        mean_shift : bool (optional), default=False</span>
</span><span id="laplace-1144"><a href="#laplace-1144"><span class="linenos">1144</span></a><span class="sd">            Whether to shift output to mean zero.</span>
</span><span id="laplace-1145"><a href="#laplace-1145"><span class="linenos">1145</span></a><span class="sd">        tol : float (optional), default=1e-5</span>
</span><span id="laplace-1146"><a href="#laplace-1146"><span class="linenos">1146</span></a><span class="sd">            Tolerance for conjugate gradient solver.</span>
</span><span id="laplace-1147"><a href="#laplace-1147"><span class="linenos">1147</span></a><span class="sd">        alpha : float (optional), default=2</span>
</span><span id="laplace-1148"><a href="#laplace-1148"><span class="linenos">1148</span></a><span class="sd">            Parameter for `properly` reweighting.</span>
</span><span id="laplace-1149"><a href="#laplace-1149"><span class="linenos">1149</span></a><span class="sd">        zeta : float (optional), default=1e7</span>
</span><span id="laplace-1150"><a href="#laplace-1150"><span class="linenos">1150</span></a><span class="sd">            Parameter for `properly` reweighting.</span>
</span><span id="laplace-1151"><a href="#laplace-1151"><span class="linenos">1151</span></a><span class="sd">        r : float (optional), default=0.1</span>
</span><span id="laplace-1152"><a href="#laplace-1152"><span class="linenos">1152</span></a><span class="sd">            Radius for `properly` reweighting.</span>
</span><span id="laplace-1153"><a href="#laplace-1153"><span class="linenos">1153</span></a>
</span><span id="laplace-1154"><a href="#laplace-1154"><span class="linenos">1154</span></a><span class="sd">        References</span>
</span><span id="laplace-1155"><a href="#laplace-1155"><span class="linenos">1155</span></a><span class="sd">        ---------</span>
</span><span id="laplace-1156"><a href="#laplace-1156"><span class="linenos">1156</span></a><span class="sd">        [1] X. Zhu, Z. Ghahramani, and J. D. Lafferty. [Semi-supervised learning using gaussian fields </span>
</span><span id="laplace-1157"><a href="#laplace-1157"><span class="linenos">1157</span></a><span class="sd">        and harmonic functions.](https://www.aaai.org/Papers/ICML/2003/ICML03-118.pdf) Proceedings </span>
</span><span id="laplace-1158"><a href="#laplace-1158"><span class="linenos">1158</span></a><span class="sd">        of the 20th International Conference on Machine Learning (ICML-03), 2003.</span>
</span><span id="laplace-1159"><a href="#laplace-1159"><span class="linenos">1159</span></a>
</span><span id="laplace-1160"><a href="#laplace-1160"><span class="linenos">1160</span></a><span class="sd">        [2] J. Calder, B. Cook, M. Thorpe, D. Slepcev. [Poisson Learning: Graph Based Semi-Supervised</span>
</span><span id="laplace-1161"><a href="#laplace-1161"><span class="linenos">1161</span></a><span class="sd">        Learning at Very Low Label Rates.](http://proceedings.mlr.press/v119/calder20a.html), </span>
</span><span id="laplace-1162"><a href="#laplace-1162"><span class="linenos">1162</span></a><span class="sd">        Proceedings of the 37th International Conference on Machine Learning, PMLR 119:1306-1316, 2020.</span>
</span><span id="laplace-1163"><a href="#laplace-1163"><span class="linenos">1163</span></a>
</span><span id="laplace-1164"><a href="#laplace-1164"><span class="linenos">1164</span></a><span class="sd">        [3] Z. Shi, S. Osher, and W. Zhu. [Weighted nonlocal laplacian on interpolation from sparse data.](https://idp.springer.com/authorize/casa?redirect_uri=https://link.springer.com/article/10.1007/s10915-017-0421-z&amp;casa_token=33Z7gqJy3mMAAAAA:iMO0pGmpn_qf5PioVIGocSRq_p4CDm-KNOQhgIC1uvqG9pWlZ6t7I-IZtSJfocFDEHCdMpK8j7Fx1XbzDQ)</span>
</span><span id="laplace-1165"><a href="#laplace-1165"><span class="linenos">1165</span></a><span class="sd">        Journal of Scientific Computing 73.2 (2017): 1164-1177.</span>
</span><span id="laplace-1166"><a href="#laplace-1166"><span class="linenos">1166</span></a>
</span><span id="laplace-1167"><a href="#laplace-1167"><span class="linenos">1167</span></a><span class="sd">        [4] J. Calder, D. Slepev. [Properly-weighted graph Laplacian for semi-supervised learning.](https://link.springer.com/article/10.1007/s00245-019-09637-3) Applied mathematics &amp; optimization (2019): 1-49.</span>
</span><span id="laplace-1168"><a href="#laplace-1168"><span class="linenos">1168</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="laplace-1169"><a href="#laplace-1169"><span class="linenos">1169</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="laplace-1170"><a href="#laplace-1170"><span class="linenos">1170</span></a>
</span><span id="laplace-1171"><a href="#laplace-1171"><span class="linenos">1171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reweighting</span> <span class="o">=</span> <span class="n">reweighting</span>
</span><span id="laplace-1172"><a href="#laplace-1172"><span class="linenos">1172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">normalization</span> <span class="o">=</span> <span class="n">normalization</span>
</span><span id="laplace-1173"><a href="#laplace-1173"><span class="linenos">1173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mean_shift</span> <span class="o">=</span> <span class="n">mean_shift</span>
</span><span id="laplace-1174"><a href="#laplace-1174"><span class="linenos">1174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span>
</span><span id="laplace-1175"><a href="#laplace-1175"><span class="linenos">1175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">order</span>
</span><span id="laplace-1176"><a href="#laplace-1176"><span class="linenos">1176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>
</span><span id="laplace-1177"><a href="#laplace-1177"><span class="linenos">1177</span></a>
</span><span id="laplace-1178"><a href="#laplace-1178"><span class="linenos">1178</span></a>        <span class="c1">#Set up tau</span>
</span><span id="laplace-1179"><a href="#laplace-1179"><span class="linenos">1179</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="laplace-1180"><a href="#laplace-1180"><span class="linenos">1180</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">)</span><span class="o">*</span><span class="n">tau</span>
</span><span id="laplace-1181"><a href="#laplace-1181"><span class="linenos">1181</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="laplace-1182"><a href="#laplace-1182"><span class="linenos">1182</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="n">tau</span>
</span><span id="laplace-1183"><a href="#laplace-1183"><span class="linenos">1183</span></a>
</span><span id="laplace-1184"><a href="#laplace-1184"><span class="linenos">1184</span></a>        <span class="c1">#Setup accuracy filename</span>
</span><span id="laplace-1185"><a href="#laplace-1185"><span class="linenos">1185</span></a>        <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;_laplace&#39;</span> 
</span><span id="laplace-1186"><a href="#laplace-1186"><span class="linenos">1186</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Laplace Learning&#39;</span>
</span><span id="laplace-1187"><a href="#laplace-1187"><span class="linenos">1187</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reweighting</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
</span><span id="laplace-1188"><a href="#laplace-1188"><span class="linenos">1188</span></a>            <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">reweighting</span>
</span><span id="laplace-1189"><a href="#laplace-1189"><span class="linenos">1189</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">reweighting</span> <span class="o">+</span> <span class="s1">&#39; reweighted&#39;</span>
</span><span id="laplace-1190"><a href="#laplace-1190"><span class="linenos">1190</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalization</span> <span class="o">!=</span> <span class="s1">&#39;combinatorial&#39;</span><span class="p">:</span>
</span><span id="laplace-1191"><a href="#laplace-1191"><span class="linenos">1191</span></a>            <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalization</span>
</span><span id="laplace-1192"><a href="#laplace-1192"><span class="linenos">1192</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalization</span>
</span><span id="laplace-1193"><a href="#laplace-1193"><span class="linenos">1193</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_shift</span><span class="p">:</span>
</span><span id="laplace-1194"><a href="#laplace-1194"><span class="linenos">1194</span></a>            <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_meanshift&#39;</span>
</span><span id="laplace-1195"><a href="#laplace-1195"><span class="linenos">1195</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39; with meanshift&#39;</span>
</span><span id="laplace-1196"><a href="#laplace-1196"><span class="linenos">1196</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="laplace-1197"><a href="#laplace-1197"><span class="linenos">1197</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39; order </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
</span><span id="laplace-1198"><a href="#laplace-1198"><span class="linenos">1198</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="laplace-1199"><a href="#laplace-1199"><span class="linenos">1199</span></a>            <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_tau_</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">)</span>
</span><span id="laplace-1200"><a href="#laplace-1200"><span class="linenos">1200</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39; tau=</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">)</span>
</span><span id="laplace-1201"><a href="#laplace-1201"><span class="linenos">1201</span></a>
</span><span id="laplace-1202"><a href="#laplace-1202"><span class="linenos">1202</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="n">fname</span>
</span><span id="laplace-1203"><a href="#laplace-1203"><span class="linenos">1203</span></a>
</span><span id="laplace-1204"><a href="#laplace-1204"><span class="linenos">1204</span></a>
</span><span id="laplace-1205"><a href="#laplace-1205"><span class="linenos">1205</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="laplace-1206"><a href="#laplace-1206"><span class="linenos">1206</span></a>
</span><span id="laplace-1207"><a href="#laplace-1207"><span class="linenos">1207</span></a>        <span class="c1">#Reweighting</span>
</span><span id="laplace-1208"><a href="#laplace-1208"><span class="linenos">1208</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reweighting</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
</span><span id="laplace-1209"><a href="#laplace-1209"><span class="linenos">1209</span></a>            <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span>
</span><span id="laplace-1210"><a href="#laplace-1210"><span class="linenos">1210</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="laplace-1211"><a href="#laplace-1211"><span class="linenos">1211</span></a>            <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">reweight</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reweighting</span><span class="p">,</span> <span class="n">normalization</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">normalization</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
</span><span id="laplace-1212"><a href="#laplace-1212"><span class="linenos">1212</span></a>            <span class="c1">#W = self.graph.reweight(train_ind, method=self.reweighting, X=self.X)</span>
</span><span id="laplace-1213"><a href="#laplace-1213"><span class="linenos">1213</span></a>            <span class="n">G</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">graph</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</span><span id="laplace-1214"><a href="#laplace-1214"><span class="linenos">1214</span></a>
</span><span id="laplace-1215"><a href="#laplace-1215"><span class="linenos">1215</span></a>        <span class="c1">#Get some attributes</span>
</span><span id="laplace-1216"><a href="#laplace-1216"><span class="linenos">1216</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">num_nodes</span>
</span><span id="laplace-1217"><a href="#laplace-1217"><span class="linenos">1217</span></a>        <span class="n">unique_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span>
</span><span id="laplace-1218"><a href="#laplace-1218"><span class="linenos">1218</span></a>        <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">)</span>
</span><span id="laplace-1219"><a href="#laplace-1219"><span class="linenos">1219</span></a>        
</span><span id="laplace-1220"><a href="#laplace-1220"><span class="linenos">1220</span></a>        <span class="c1">#tau + Graph Laplacian and one-hot labels</span>
</span><span id="laplace-1221"><a href="#laplace-1221"><span class="linenos">1221</span></a>        <span class="n">L</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">)</span> <span class="o">+</span> <span class="n">G</span><span class="o">.</span><span class="n">laplacian</span><span class="p">(</span><span class="n">normalization</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">normalization</span><span class="p">)</span>
</span><span id="laplace-1222"><a href="#laplace-1222"><span class="linenos">1222</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="laplace-1223"><a href="#laplace-1223"><span class="linenos">1223</span></a>            <span class="n">Lpow</span> <span class="o">=</span> <span class="n">L</span><span class="o">*</span><span class="n">L</span>
</span><span id="laplace-1224"><a href="#laplace-1224"><span class="linenos">1224</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="laplace-1225"><a href="#laplace-1225"><span class="linenos">1225</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">):</span>
</span><span id="laplace-1226"><a href="#laplace-1226"><span class="linenos">1226</span></a>                    <span class="n">Lpow</span> <span class="o">=</span> <span class="n">L</span><span class="o">*</span><span class="n">Lpow</span>
</span><span id="laplace-1227"><a href="#laplace-1227"><span class="linenos">1227</span></a>            <span class="n">L</span> <span class="o">=</span> <span class="n">Lpow</span>
</span><span id="laplace-1228"><a href="#laplace-1228"><span class="linenos">1228</span></a>        <span class="n">F</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span>
</span><span id="laplace-1229"><a href="#laplace-1229"><span class="linenos">1229</span></a>
</span><span id="laplace-1230"><a href="#laplace-1230"><span class="linenos">1230</span></a>        <span class="c1">#Locations of unlabeled points</span>
</span><span id="laplace-1231"><a href="#laplace-1231"><span class="linenos">1231</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">n</span><span class="p">,),</span> <span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
</span><span id="laplace-1232"><a href="#laplace-1232"><span class="linenos">1232</span></a>        <span class="n">idx</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="laplace-1233"><a href="#laplace-1233"><span class="linenos">1233</span></a>
</span><span id="laplace-1234"><a href="#laplace-1234"><span class="linenos">1234</span></a>        <span class="c1">#Right hand side</span>
</span><span id="laplace-1235"><a href="#laplace-1235"><span class="linenos">1235</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="n">L</span><span class="p">[:,</span><span class="n">train_ind</span><span class="p">]</span><span class="o">*</span><span class="n">F</span>
</span><span id="laplace-1236"><a href="#laplace-1236"><span class="linenos">1236</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">idx</span><span class="p">,:]</span>
</span><span id="laplace-1237"><a href="#laplace-1237"><span class="linenos">1237</span></a>
</span><span id="laplace-1238"><a href="#laplace-1238"><span class="linenos">1238</span></a>        <span class="c1">#Left hand side matrix</span>
</span><span id="laplace-1239"><a href="#laplace-1239"><span class="linenos">1239</span></a>        <span class="n">A</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">idx</span><span class="p">,:]</span>
</span><span id="laplace-1240"><a href="#laplace-1240"><span class="linenos">1240</span></a>        <span class="n">A</span> <span class="o">=</span> <span class="n">A</span><span class="p">[:,</span><span class="n">idx</span><span class="p">]</span>
</span><span id="laplace-1241"><a href="#laplace-1241"><span class="linenos">1241</span></a>
</span><span id="laplace-1242"><a href="#laplace-1242"><span class="linenos">1242</span></a>        <span class="c1">#Preconditioner</span>
</span><span id="laplace-1243"><a href="#laplace-1243"><span class="linenos">1243</span></a>        <span class="n">m</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="laplace-1244"><a href="#laplace-1244"><span class="linenos">1244</span></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span>
</span><span id="laplace-1245"><a href="#laplace-1245"><span class="linenos">1245</span></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">M</span><span class="o">+</span><span class="mf">1e-10</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">tocsr</span><span class="p">()</span>
</span><span id="laplace-1246"><a href="#laplace-1246"><span class="linenos">1246</span></a>       
</span><span id="laplace-1247"><a href="#laplace-1247"><span class="linenos">1247</span></a>        <span class="c1">#Conjugate gradient solver</span>
</span><span id="laplace-1248"><a href="#laplace-1248"><span class="linenos">1248</span></a>        <span class="n">v</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">conjgrad</span><span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">M</span><span class="p">,</span> <span class="n">M</span><span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tol</span><span class="p">)</span>
</span><span id="laplace-1249"><a href="#laplace-1249"><span class="linenos">1249</span></a>        <span class="n">v</span> <span class="o">=</span> <span class="n">M</span><span class="o">*</span><span class="n">v</span>
</span><span id="laplace-1250"><a href="#laplace-1250"><span class="linenos">1250</span></a>
</span><span id="laplace-1251"><a href="#laplace-1251"><span class="linenos">1251</span></a>        <span class="c1">#Add labels back into array</span>
</span><span id="laplace-1252"><a href="#laplace-1252"><span class="linenos">1252</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
</span><span id="laplace-1253"><a href="#laplace-1253"><span class="linenos">1253</span></a>        <span class="n">u</span><span class="p">[</span><span class="n">idx</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="laplace-1254"><a href="#laplace-1254"><span class="linenos">1254</span></a>        <span class="n">u</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">F</span>
</span><span id="laplace-1255"><a href="#laplace-1255"><span class="linenos">1255</span></a>
</span><span id="laplace-1256"><a href="#laplace-1256"><span class="linenos">1256</span></a>        <span class="c1">#Mean shift</span>
</span><span id="laplace-1257"><a href="#laplace-1257"><span class="linenos">1257</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_shift</span><span class="p">:</span>
</span><span id="laplace-1258"><a href="#laplace-1258"><span class="linenos">1258</span></a>            <span class="n">u</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="laplace-1259"><a href="#laplace-1259"><span class="linenos">1259</span></a>
</span><span id="laplace-1260"><a href="#laplace-1260"><span class="linenos">1260</span></a>        <span class="k">return</span> <span class="n">u</span>
</span></pre></div>


    

                            <div id="laplace.__init__" class="classattr">
                                        <input id="laplace.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">laplace</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">W</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">X</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">reweighting</span><span class="o">=</span><span class="s1">&#39;none&#39;</span>,</span><span class="param">	<span class="n">normalization</span><span class="o">=</span><span class="s1">&#39;combinatorial&#39;</span>,</span><span class="param">	<span class="n">tau</span><span class="o">=</span><span class="mi">0</span>,</span><span class="param">	<span class="n">order</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">mean_shift</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">tol</span><span class="o">=</span><span class="mf">1e-05</span>,</span><span class="param">	<span class="n">alpha</span><span class="o">=</span><span class="mi">2</span>,</span><span class="param">	<span class="n">zeta</span><span class="o">=</span><span class="mf">10000000.0</span>,</span><span class="param">	<span class="n">r</span><span class="o">=</span><span class="mf">0.1</span></span>)</span>

                <label class="view-source-button" for="laplace.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#laplace.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="laplace.__init__-1108"><a href="#laplace.__init__-1108"><span class="linenos">1108</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reweighting</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">normalization</span><span class="o">=</span><span class="s1">&#39;combinatorial&#39;</span><span class="p">,</span> 
</span><span id="laplace.__init__-1109"><a href="#laplace.__init__-1109"><span class="linenos">1109</span></a>                 <span class="n">tau</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mean_shift</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">zeta</span><span class="o">=</span><span class="mf">1e7</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
</span><span id="laplace.__init__-1110"><a href="#laplace.__init__-1110"><span class="linenos">1110</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Laplace Learning</span>
</span><span id="laplace.__init__-1111"><a href="#laplace.__init__-1111"><span class="linenos">1111</span></a><span class="sd">        ===================</span>
</span><span id="laplace.__init__-1112"><a href="#laplace.__init__-1112"><span class="linenos">1112</span></a>
</span><span id="laplace.__init__-1113"><a href="#laplace.__init__-1113"><span class="linenos">1113</span></a><span class="sd">        Semi-supervised learning via the solution of the Laplace equation</span>
</span><span id="laplace.__init__-1114"><a href="#laplace.__init__-1114"><span class="linenos">1114</span></a><span class="sd">        \\[\\tau u_j + L^m u_j = 0, \\ \\ j \\geq m+1,\\]</span>
</span><span id="laplace.__init__-1115"><a href="#laplace.__init__-1115"><span class="linenos">1115</span></a><span class="sd">        subject to \\(u_j = y_j\\) for \\(j=1,\\dots,m\\), where \\(L=D-W\\) is the </span>
</span><span id="laplace.__init__-1116"><a href="#laplace.__init__-1116"><span class="linenos">1116</span></a><span class="sd">        combinatorial graph Laplacian and \\(y_j\\) for \\(j=1,\\dots,m\\) are the </span>
</span><span id="laplace.__init__-1117"><a href="#laplace.__init__-1117"><span class="linenos">1117</span></a><span class="sd">        label vectors. Default order is m=1, and m &gt; 1 corresponds to higher order Laplace Learning.</span>
</span><span id="laplace.__init__-1118"><a href="#laplace.__init__-1118"><span class="linenos">1118</span></a>
</span><span id="laplace.__init__-1119"><a href="#laplace.__init__-1119"><span class="linenos">1119</span></a><span class="sd">        The original method was introduced in [1]. This class also implements reweighting </span>
</span><span id="laplace.__init__-1120"><a href="#laplace.__init__-1120"><span class="linenos">1120</span></a><span class="sd">        schemes `poisson` proposed in [2], `wnll` proposed in [3], and `properly`, proposed in [4].</span>
</span><span id="laplace.__init__-1121"><a href="#laplace.__init__-1121"><span class="linenos">1121</span></a><span class="sd">        If `properly` is selected, the user must additionally provide the data features `X`.</span>
</span><span id="laplace.__init__-1122"><a href="#laplace.__init__-1122"><span class="linenos">1122</span></a>
</span><span id="laplace.__init__-1123"><a href="#laplace.__init__-1123"><span class="linenos">1123</span></a><span class="sd">        Parameters</span>
</span><span id="laplace.__init__-1124"><a href="#laplace.__init__-1124"><span class="linenos">1124</span></a><span class="sd">        ----------</span>
</span><span id="laplace.__init__-1125"><a href="#laplace.__init__-1125"><span class="linenos">1125</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="laplace.__init__-1126"><a href="#laplace.__init__-1126"><span class="linenos">1126</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="laplace.__init__-1127"><a href="#laplace.__init__-1127"><span class="linenos">1127</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="laplace.__init__-1128"><a href="#laplace.__init__-1128"><span class="linenos">1128</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="laplace.__init__-1129"><a href="#laplace.__init__-1129"><span class="linenos">1129</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="laplace.__init__-1130"><a href="#laplace.__init__-1130"><span class="linenos">1130</span></a><span class="sd">            nodes in each class.</span>
</span><span id="laplace.__init__-1131"><a href="#laplace.__init__-1131"><span class="linenos">1131</span></a><span class="sd">        X : numpy array (optional)</span>
</span><span id="laplace.__init__-1132"><a href="#laplace.__init__-1132"><span class="linenos">1132</span></a><span class="sd">            Data features, used to construct the graph. This is required for the `properly` weighted </span>
</span><span id="laplace.__init__-1133"><a href="#laplace.__init__-1133"><span class="linenos">1133</span></a><span class="sd">            graph Laplacian method.</span>
</span><span id="laplace.__init__-1134"><a href="#laplace.__init__-1134"><span class="linenos">1134</span></a><span class="sd">        normalization : {&#39;combinatorial&#39;,&#39;randomwalk&#39;,&#39;normalized&#39;} (optional), defualt=&#39;combinatorial&#39;</span>
</span><span id="laplace.__init__-1135"><a href="#laplace.__init__-1135"><span class="linenos">1135</span></a><span class="sd">            Normalization for the graph Laplacian.</span>
</span><span id="laplace.__init__-1136"><a href="#laplace.__init__-1136"><span class="linenos">1136</span></a><span class="sd">        reweighting : {&#39;none&#39;, &#39;wnll&#39;, &#39;poisson&#39;, &#39;properly&#39;} (optional), default=&#39;none&#39;</span>
</span><span id="laplace.__init__-1137"><a href="#laplace.__init__-1137"><span class="linenos">1137</span></a><span class="sd">            Reweighting scheme for low label rate problems. If &#39;properly&#39; is selected, the user</span>
</span><span id="laplace.__init__-1138"><a href="#laplace.__init__-1138"><span class="linenos">1138</span></a><span class="sd">            must supply the data features `X`.</span>
</span><span id="laplace.__init__-1139"><a href="#laplace.__init__-1139"><span class="linenos">1139</span></a><span class="sd">        tau : float or numpy array (optional), default=0</span>
</span><span id="laplace.__init__-1140"><a href="#laplace.__init__-1140"><span class="linenos">1140</span></a><span class="sd">            Zeroth order term in Laplace equation. Can be a scalar or vector.</span>
</span><span id="laplace.__init__-1141"><a href="#laplace.__init__-1141"><span class="linenos">1141</span></a><span class="sd">        order : integer (optional), default=1</span>
</span><span id="laplace.__init__-1142"><a href="#laplace.__init__-1142"><span class="linenos">1142</span></a><span class="sd">            Power m for higher order Laplace learning. Currently only integers are allowed. </span>
</span><span id="laplace.__init__-1143"><a href="#laplace.__init__-1143"><span class="linenos">1143</span></a><span class="sd">        mean_shift : bool (optional), default=False</span>
</span><span id="laplace.__init__-1144"><a href="#laplace.__init__-1144"><span class="linenos">1144</span></a><span class="sd">            Whether to shift output to mean zero.</span>
</span><span id="laplace.__init__-1145"><a href="#laplace.__init__-1145"><span class="linenos">1145</span></a><span class="sd">        tol : float (optional), default=1e-5</span>
</span><span id="laplace.__init__-1146"><a href="#laplace.__init__-1146"><span class="linenos">1146</span></a><span class="sd">            Tolerance for conjugate gradient solver.</span>
</span><span id="laplace.__init__-1147"><a href="#laplace.__init__-1147"><span class="linenos">1147</span></a><span class="sd">        alpha : float (optional), default=2</span>
</span><span id="laplace.__init__-1148"><a href="#laplace.__init__-1148"><span class="linenos">1148</span></a><span class="sd">            Parameter for `properly` reweighting.</span>
</span><span id="laplace.__init__-1149"><a href="#laplace.__init__-1149"><span class="linenos">1149</span></a><span class="sd">        zeta : float (optional), default=1e7</span>
</span><span id="laplace.__init__-1150"><a href="#laplace.__init__-1150"><span class="linenos">1150</span></a><span class="sd">            Parameter for `properly` reweighting.</span>
</span><span id="laplace.__init__-1151"><a href="#laplace.__init__-1151"><span class="linenos">1151</span></a><span class="sd">        r : float (optional), default=0.1</span>
</span><span id="laplace.__init__-1152"><a href="#laplace.__init__-1152"><span class="linenos">1152</span></a><span class="sd">            Radius for `properly` reweighting.</span>
</span><span id="laplace.__init__-1153"><a href="#laplace.__init__-1153"><span class="linenos">1153</span></a>
</span><span id="laplace.__init__-1154"><a href="#laplace.__init__-1154"><span class="linenos">1154</span></a><span class="sd">        References</span>
</span><span id="laplace.__init__-1155"><a href="#laplace.__init__-1155"><span class="linenos">1155</span></a><span class="sd">        ---------</span>
</span><span id="laplace.__init__-1156"><a href="#laplace.__init__-1156"><span class="linenos">1156</span></a><span class="sd">        [1] X. Zhu, Z. Ghahramani, and J. D. Lafferty. [Semi-supervised learning using gaussian fields </span>
</span><span id="laplace.__init__-1157"><a href="#laplace.__init__-1157"><span class="linenos">1157</span></a><span class="sd">        and harmonic functions.](https://www.aaai.org/Papers/ICML/2003/ICML03-118.pdf) Proceedings </span>
</span><span id="laplace.__init__-1158"><a href="#laplace.__init__-1158"><span class="linenos">1158</span></a><span class="sd">        of the 20th International Conference on Machine Learning (ICML-03), 2003.</span>
</span><span id="laplace.__init__-1159"><a href="#laplace.__init__-1159"><span class="linenos">1159</span></a>
</span><span id="laplace.__init__-1160"><a href="#laplace.__init__-1160"><span class="linenos">1160</span></a><span class="sd">        [2] J. Calder, B. Cook, M. Thorpe, D. Slepcev. [Poisson Learning: Graph Based Semi-Supervised</span>
</span><span id="laplace.__init__-1161"><a href="#laplace.__init__-1161"><span class="linenos">1161</span></a><span class="sd">        Learning at Very Low Label Rates.](http://proceedings.mlr.press/v119/calder20a.html), </span>
</span><span id="laplace.__init__-1162"><a href="#laplace.__init__-1162"><span class="linenos">1162</span></a><span class="sd">        Proceedings of the 37th International Conference on Machine Learning, PMLR 119:1306-1316, 2020.</span>
</span><span id="laplace.__init__-1163"><a href="#laplace.__init__-1163"><span class="linenos">1163</span></a>
</span><span id="laplace.__init__-1164"><a href="#laplace.__init__-1164"><span class="linenos">1164</span></a><span class="sd">        [3] Z. Shi, S. Osher, and W. Zhu. [Weighted nonlocal laplacian on interpolation from sparse data.](https://idp.springer.com/authorize/casa?redirect_uri=https://link.springer.com/article/10.1007/s10915-017-0421-z&amp;casa_token=33Z7gqJy3mMAAAAA:iMO0pGmpn_qf5PioVIGocSRq_p4CDm-KNOQhgIC1uvqG9pWlZ6t7I-IZtSJfocFDEHCdMpK8j7Fx1XbzDQ)</span>
</span><span id="laplace.__init__-1165"><a href="#laplace.__init__-1165"><span class="linenos">1165</span></a><span class="sd">        Journal of Scientific Computing 73.2 (2017): 1164-1177.</span>
</span><span id="laplace.__init__-1166"><a href="#laplace.__init__-1166"><span class="linenos">1166</span></a>
</span><span id="laplace.__init__-1167"><a href="#laplace.__init__-1167"><span class="linenos">1167</span></a><span class="sd">        [4] J. Calder, D. Slepev. [Properly-weighted graph Laplacian for semi-supervised learning.](https://link.springer.com/article/10.1007/s00245-019-09637-3) Applied mathematics &amp; optimization (2019): 1-49.</span>
</span><span id="laplace.__init__-1168"><a href="#laplace.__init__-1168"><span class="linenos">1168</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="laplace.__init__-1169"><a href="#laplace.__init__-1169"><span class="linenos">1169</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="laplace.__init__-1170"><a href="#laplace.__init__-1170"><span class="linenos">1170</span></a>
</span><span id="laplace.__init__-1171"><a href="#laplace.__init__-1171"><span class="linenos">1171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reweighting</span> <span class="o">=</span> <span class="n">reweighting</span>
</span><span id="laplace.__init__-1172"><a href="#laplace.__init__-1172"><span class="linenos">1172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">normalization</span> <span class="o">=</span> <span class="n">normalization</span>
</span><span id="laplace.__init__-1173"><a href="#laplace.__init__-1173"><span class="linenos">1173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mean_shift</span> <span class="o">=</span> <span class="n">mean_shift</span>
</span><span id="laplace.__init__-1174"><a href="#laplace.__init__-1174"><span class="linenos">1174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span>
</span><span id="laplace.__init__-1175"><a href="#laplace.__init__-1175"><span class="linenos">1175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">order</span>
</span><span id="laplace.__init__-1176"><a href="#laplace.__init__-1176"><span class="linenos">1176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>
</span><span id="laplace.__init__-1177"><a href="#laplace.__init__-1177"><span class="linenos">1177</span></a>
</span><span id="laplace.__init__-1178"><a href="#laplace.__init__-1178"><span class="linenos">1178</span></a>        <span class="c1">#Set up tau</span>
</span><span id="laplace.__init__-1179"><a href="#laplace.__init__-1179"><span class="linenos">1179</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="laplace.__init__-1180"><a href="#laplace.__init__-1180"><span class="linenos">1180</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">)</span><span class="o">*</span><span class="n">tau</span>
</span><span id="laplace.__init__-1181"><a href="#laplace.__init__-1181"><span class="linenos">1181</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="laplace.__init__-1182"><a href="#laplace.__init__-1182"><span class="linenos">1182</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="n">tau</span>
</span><span id="laplace.__init__-1183"><a href="#laplace.__init__-1183"><span class="linenos">1183</span></a>
</span><span id="laplace.__init__-1184"><a href="#laplace.__init__-1184"><span class="linenos">1184</span></a>        <span class="c1">#Setup accuracy filename</span>
</span><span id="laplace.__init__-1185"><a href="#laplace.__init__-1185"><span class="linenos">1185</span></a>        <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;_laplace&#39;</span> 
</span><span id="laplace.__init__-1186"><a href="#laplace.__init__-1186"><span class="linenos">1186</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Laplace Learning&#39;</span>
</span><span id="laplace.__init__-1187"><a href="#laplace.__init__-1187"><span class="linenos">1187</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reweighting</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
</span><span id="laplace.__init__-1188"><a href="#laplace.__init__-1188"><span class="linenos">1188</span></a>            <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">reweighting</span>
</span><span id="laplace.__init__-1189"><a href="#laplace.__init__-1189"><span class="linenos">1189</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">reweighting</span> <span class="o">+</span> <span class="s1">&#39; reweighted&#39;</span>
</span><span id="laplace.__init__-1190"><a href="#laplace.__init__-1190"><span class="linenos">1190</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalization</span> <span class="o">!=</span> <span class="s1">&#39;combinatorial&#39;</span><span class="p">:</span>
</span><span id="laplace.__init__-1191"><a href="#laplace.__init__-1191"><span class="linenos">1191</span></a>            <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalization</span>
</span><span id="laplace.__init__-1192"><a href="#laplace.__init__-1192"><span class="linenos">1192</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalization</span>
</span><span id="laplace.__init__-1193"><a href="#laplace.__init__-1193"><span class="linenos">1193</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_shift</span><span class="p">:</span>
</span><span id="laplace.__init__-1194"><a href="#laplace.__init__-1194"><span class="linenos">1194</span></a>            <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_meanshift&#39;</span>
</span><span id="laplace.__init__-1195"><a href="#laplace.__init__-1195"><span class="linenos">1195</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39; with meanshift&#39;</span>
</span><span id="laplace.__init__-1196"><a href="#laplace.__init__-1196"><span class="linenos">1196</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="laplace.__init__-1197"><a href="#laplace.__init__-1197"><span class="linenos">1197</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39; order </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
</span><span id="laplace.__init__-1198"><a href="#laplace.__init__-1198"><span class="linenos">1198</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="laplace.__init__-1199"><a href="#laplace.__init__-1199"><span class="linenos">1199</span></a>            <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_tau_</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">)</span>
</span><span id="laplace.__init__-1200"><a href="#laplace.__init__-1200"><span class="linenos">1200</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39; tau=</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">)</span>
</span><span id="laplace.__init__-1201"><a href="#laplace.__init__-1201"><span class="linenos">1201</span></a>
</span><span id="laplace.__init__-1202"><a href="#laplace.__init__-1202"><span class="linenos">1202</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="n">fname</span>
</span></pre></div>


            <div class="docstring"><h1 id="laplace-learning">Laplace Learning</h1>

<p>Semi-supervised learning via the solution of the Laplace equation
[\tau u_j + L^m u_j = 0, \ \ j \geq m+1,]
subject to (u_j = y_j) for (j=1,\dots,m), where (L=D-W) is the 
combinatorial graph Laplacian and (y_j) for (j=1,\dots,m) are the 
label vectors. Default order is m=1, and m &gt; 1 corresponds to higher order Laplace Learning.</p>

<p>The original method was introduced in [1]. This class also implements reweighting 
schemes <code><a href="#poisson">poisson</a></code> proposed in [2], <code>wnll</code> proposed in [3], and <code>properly</code>, proposed in [4].
If <code>properly</code> is selected, the user must additionally provide the data features <code><a href="#laplace.X">X</a></code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>W</strong> (numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None):
Weight matrix representing the graph.</li>
<li><strong>class_priors</strong> (numpy array (optional), default=None):
Class priors (fraction of data belonging to each class). If provided, the predict function
will attempt to automatic balance the label predictions to predict the correct number of
nodes in each class.</li>
<li><strong>X</strong> (numpy array (optional)):
Data features, used to construct the graph. This is required for the <code>properly</code> weighted 
graph Laplacian method.</li>
<li><strong>normalization</strong> ({'combinatorial','randomwalk','normalized'} (optional), defualt='combinatorial'):
Normalization for the graph Laplacian.</li>
<li><strong>reweighting</strong> ({'none', 'wnll', 'poisson', 'properly'} (optional), default='none'):
Reweighting scheme for low label rate problems. If 'properly' is selected, the user
must supply the data features <code><a href="#laplace.X">X</a></code>.</li>
<li><strong>tau</strong> (float or numpy array (optional), default=0):
Zeroth order term in Laplace equation. Can be a scalar or vector.</li>
<li><strong>order</strong> (integer (optional), default=1):
Power m for higher order Laplace learning. Currently only integers are allowed.</li>
<li><strong>mean_shift</strong> (bool (optional), default=False):
Whether to shift output to mean zero.</li>
<li><strong>tol</strong> (float (optional), default=1e-5):
Tolerance for conjugate gradient solver.</li>
<li><strong>alpha</strong> (float (optional), default=2):
Parameter for <code>properly</code> reweighting.</li>
<li><strong>zeta</strong> (float (optional), default=1e7):
Parameter for <code>properly</code> reweighting.</li>
<li><strong>r</strong> (float (optional), default=0.1):
Radius for <code>properly</code> reweighting.</li>
</ul>

<h6 id="references">References</h6>

<p>[1] X. Zhu, Z. Ghahramani, and J. D. Lafferty. <a href="https://www.aaai.org/Papers/ICML/2003/ICML03-118.pdf">Semi-supervised learning using gaussian fields 
and harmonic functions.</a> Proceedings 
of the 20th International Conference on Machine Learning (ICML-03), 2003.</p>

<p>[2] J. Calder, B. Cook, M. Thorpe, D. Slepcev. <a href="http://proceedings.mlr.press/v119/calder20a.html">Poisson Learning: Graph Based Semi-Supervised
Learning at Very Low Label Rates.</a>, 
Proceedings of the 37th International Conference on Machine Learning, PMLR 119:1306-1316, 2020.</p>

<p>[3] Z. Shi, S. Osher, and W. Zhu. <a href="https://idp.springer.com/authorize/casa?redirect_uri=https://link.springer.com/article/10.1007/s10915-017-0421-z&casa_token=33Z7gqJy3mMAAAAA:iMO0pGmpn_qf5PioVIGocSRq_p4CDm-KNOQhgIC1uvqG9pWlZ6t7I-IZtSJfocFDEHCdMpK8j7Fx1XbzDQ">Weighted nonlocal laplacian on interpolation from sparse data.</a>
Journal of Scientific Computing 73.2 (2017): 1164-1177.</p>

<p>[4] J. Calder, D. Slepev. <a href="https://link.springer.com/article/10.1007/s00245-019-09637-3">Properly-weighted graph Laplacian for semi-supervised learning.</a> Applied mathematics &amp; optimization (2019): 1-49.</p>
</div>


                            </div>
                            <div id="laplace.reweighting" class="classattr">
                                <div class="attr variable">
            <span class="name">reweighting</span>

        
    </div>
    <a class="headerlink" href="#laplace.reweighting"></a>
    
    

                            </div>
                            <div id="laplace.normalization" class="classattr">
                                <div class="attr variable">
            <span class="name">normalization</span>

        
    </div>
    <a class="headerlink" href="#laplace.normalization"></a>
    
    

                            </div>
                            <div id="laplace.mean_shift" class="classattr">
                                <div class="attr variable">
            <span class="name">mean_shift</span>

        
    </div>
    <a class="headerlink" href="#laplace.mean_shift"></a>
    
    

                            </div>
                            <div id="laplace.tol" class="classattr">
                                <div class="attr variable">
            <span class="name">tol</span>

        
    </div>
    <a class="headerlink" href="#laplace.tol"></a>
    
    

                            </div>
                            <div id="laplace.order" class="classattr">
                                <div class="attr variable">
            <span class="name">order</span>

        
    </div>
    <a class="headerlink" href="#laplace.order"></a>
    
    

                            </div>
                            <div id="laplace.X" class="classattr">
                                <div class="attr variable">
            <span class="name">X</span>

        
    </div>
    <a class="headerlink" href="#laplace.X"></a>
    
    

                            </div>
                            <div id="laplace.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#laplace.name"></a>
    
    

                            </div>
                            <div id="laplace.accuracy_filename" class="classattr">
                                <div class="attr variable">
            <span class="name">accuracy_filename</span>

        
    </div>
    <a class="headerlink" href="#laplace.accuracy_filename"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#ssl">ssl</a></dt>
                                <dd id="laplace.prob" class="variable"><a href="#ssl.prob">prob</a></dd>
                <dd id="laplace.fitted" class="variable"><a href="#ssl.fitted">fitted</a></dd>
                <dd id="laplace.requires_eig" class="variable"><a href="#ssl.requires_eig">requires_eig</a></dd>
                <dd id="laplace.onevsrest" class="variable"><a href="#ssl.onevsrest">onevsrest</a></dd>
                <dd id="laplace.similarity" class="variable"><a href="#ssl.similarity">similarity</a></dd>
                <dd id="laplace.class_priors" class="variable"><a href="#ssl.class_priors">class_priors</a></dd>
                <dd id="laplace.weights" class="variable"><a href="#ssl.weights">weights</a></dd>
                <dd id="laplace.class_priors_error" class="variable"><a href="#ssl.class_priors_error">class_priors_error</a></dd>
                <dd id="laplace.set_graph" class="function"><a href="#ssl.set_graph">set_graph</a></dd>
                <dd id="laplace.volume_label_projection" class="function"><a href="#ssl.volume_label_projection">volume_label_projection</a></dd>
                <dd id="laplace.get_accuracy_filename" class="function"><a href="#ssl.get_accuracy_filename">get_accuracy_filename</a></dd>
                <dd id="laplace.predict" class="function"><a href="#ssl.predict">predict</a></dd>
                <dd id="laplace.fit_predict" class="function"><a href="#ssl.fit_predict">fit_predict</a></dd>
                <dd id="laplace.ssl_trials" class="function"><a href="#ssl.ssl_trials">ssl_trials</a></dd>
                <dd id="laplace.trials_statistics" class="function"><a href="#ssl.trials_statistics">trials_statistics</a></dd>
                <dd id="laplace.fit" class="function"><a href="#ssl.fit">fit</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="dynamic_label_propagation">
                            <input id="dynamic_label_propagation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">dynamic_label_propagation</span><wbr>(<span class="base"><a href="#ssl">ssl</a></span>):

                <label class="view-source-button" for="dynamic_label_propagation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#dynamic_label_propagation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="dynamic_label_propagation-1262"><a href="#dynamic_label_propagation-1262"><span class="linenos">1262</span></a><span class="k">class</span> <span class="nc">dynamic_label_propagation</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="dynamic_label_propagation-1263"><a href="#dynamic_label_propagation-1263"><span class="linenos">1263</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">lam</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
</span><span id="dynamic_label_propagation-1264"><a href="#dynamic_label_propagation-1264"><span class="linenos">1264</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dynamic Label Propagation</span>
</span><span id="dynamic_label_propagation-1265"><a href="#dynamic_label_propagation-1265"><span class="linenos">1265</span></a><span class="sd">        ===================</span>
</span><span id="dynamic_label_propagation-1266"><a href="#dynamic_label_propagation-1266"><span class="linenos">1266</span></a>
</span><span id="dynamic_label_propagation-1267"><a href="#dynamic_label_propagation-1267"><span class="linenos">1267</span></a><span class="sd">        Semi-supervised learning via dynamic label propagation [1].</span>
</span><span id="dynamic_label_propagation-1268"><a href="#dynamic_label_propagation-1268"><span class="linenos">1268</span></a>
</span><span id="dynamic_label_propagation-1269"><a href="#dynamic_label_propagation-1269"><span class="linenos">1269</span></a><span class="sd">        Parameters</span>
</span><span id="dynamic_label_propagation-1270"><a href="#dynamic_label_propagation-1270"><span class="linenos">1270</span></a><span class="sd">        ----------</span>
</span><span id="dynamic_label_propagation-1271"><a href="#dynamic_label_propagation-1271"><span class="linenos">1271</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="dynamic_label_propagation-1272"><a href="#dynamic_label_propagation-1272"><span class="linenos">1272</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="dynamic_label_propagation-1273"><a href="#dynamic_label_propagation-1273"><span class="linenos">1273</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="dynamic_label_propagation-1274"><a href="#dynamic_label_propagation-1274"><span class="linenos">1274</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="dynamic_label_propagation-1275"><a href="#dynamic_label_propagation-1275"><span class="linenos">1275</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="dynamic_label_propagation-1276"><a href="#dynamic_label_propagation-1276"><span class="linenos">1276</span></a><span class="sd">            nodes in each class.</span>
</span><span id="dynamic_label_propagation-1277"><a href="#dynamic_label_propagation-1277"><span class="linenos">1277</span></a><span class="sd">        alpha : float (optional), default=0.05</span>
</span><span id="dynamic_label_propagation-1278"><a href="#dynamic_label_propagation-1278"><span class="linenos">1278</span></a><span class="sd">            Value of parameter \\(\\alpha\\).</span>
</span><span id="dynamic_label_propagation-1279"><a href="#dynamic_label_propagation-1279"><span class="linenos">1279</span></a><span class="sd">        lam : float (optional), default=0.1</span>
</span><span id="dynamic_label_propagation-1280"><a href="#dynamic_label_propagation-1280"><span class="linenos">1280</span></a><span class="sd">            Value of parameter \\(\\lambda\\).</span>
</span><span id="dynamic_label_propagation-1281"><a href="#dynamic_label_propagation-1281"><span class="linenos">1281</span></a><span class="sd">        T : int (optional), default=2</span>
</span><span id="dynamic_label_propagation-1282"><a href="#dynamic_label_propagation-1282"><span class="linenos">1282</span></a><span class="sd">            Number of iterations.</span>
</span><span id="dynamic_label_propagation-1283"><a href="#dynamic_label_propagation-1283"><span class="linenos">1283</span></a>
</span><span id="dynamic_label_propagation-1284"><a href="#dynamic_label_propagation-1284"><span class="linenos">1284</span></a><span class="sd">        References</span>
</span><span id="dynamic_label_propagation-1285"><a href="#dynamic_label_propagation-1285"><span class="linenos">1285</span></a><span class="sd">        ---------</span>
</span><span id="dynamic_label_propagation-1286"><a href="#dynamic_label_propagation-1286"><span class="linenos">1286</span></a><span class="sd">        [1] B. Wang, Z. Tu, and J.K. Tsotsos. [Dynamic label propagation for semi-supervised multi-class multi-label classification.](https://openaccess.thecvf.com/content_iccv_2013/html/Wang_Dynamic_Label_Propagation_2013_ICCV_paper.html) Proceedings of the IEEE international conference on computer vision. 2013.</span>
</span><span id="dynamic_label_propagation-1287"><a href="#dynamic_label_propagation-1287"><span class="linenos">1287</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="dynamic_label_propagation-1288"><a href="#dynamic_label_propagation-1288"><span class="linenos">1288</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="dynamic_label_propagation-1289"><a href="#dynamic_label_propagation-1289"><span class="linenos">1289</span></a>
</span><span id="dynamic_label_propagation-1290"><a href="#dynamic_label_propagation-1290"><span class="linenos">1290</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="dynamic_label_propagation-1291"><a href="#dynamic_label_propagation-1291"><span class="linenos">1291</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lam</span> <span class="o">=</span> <span class="n">lam</span>
</span><span id="dynamic_label_propagation-1292"><a href="#dynamic_label_propagation-1292"><span class="linenos">1292</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
</span><span id="dynamic_label_propagation-1293"><a href="#dynamic_label_propagation-1293"><span class="linenos">1293</span></a>
</span><span id="dynamic_label_propagation-1294"><a href="#dynamic_label_propagation-1294"><span class="linenos">1294</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_dynamic_label_propagation&#39;</span>
</span><span id="dynamic_label_propagation-1295"><a href="#dynamic_label_propagation-1295"><span class="linenos">1295</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Dynamic Label Propagation&#39;</span>
</span><span id="dynamic_label_propagation-1296"><a href="#dynamic_label_propagation-1296"><span class="linenos">1296</span></a> 
</span><span id="dynamic_label_propagation-1297"><a href="#dynamic_label_propagation-1297"><span class="linenos">1297</span></a>
</span><span id="dynamic_label_propagation-1298"><a href="#dynamic_label_propagation-1298"><span class="linenos">1298</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="dynamic_label_propagation-1299"><a href="#dynamic_label_propagation-1299"><span class="linenos">1299</span></a>
</span><span id="dynamic_label_propagation-1300"><a href="#dynamic_label_propagation-1300"><span class="linenos">1300</span></a>        <span class="c1">#Short forms</span>
</span><span id="dynamic_label_propagation-1301"><a href="#dynamic_label_propagation-1301"><span class="linenos">1301</span></a>        <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>
</span><span id="dynamic_label_propagation-1302"><a href="#dynamic_label_propagation-1302"><span class="linenos">1302</span></a>        <span class="n">lam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lam</span>
</span><span id="dynamic_label_propagation-1303"><a href="#dynamic_label_propagation-1303"><span class="linenos">1303</span></a>        <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span>
</span><span id="dynamic_label_propagation-1304"><a href="#dynamic_label_propagation-1304"><span class="linenos">1304</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span>
</span><span id="dynamic_label_propagation-1305"><a href="#dynamic_label_propagation-1305"><span class="linenos">1305</span></a>        <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_labels</span><span class="p">))</span>
</span><span id="dynamic_label_propagation-1306"><a href="#dynamic_label_propagation-1306"><span class="linenos">1306</span></a>
</span><span id="dynamic_label_propagation-1307"><a href="#dynamic_label_propagation-1307"><span class="linenos">1307</span></a>        <span class="c1">#Zero out diagonal </span>
</span><span id="dynamic_label_propagation-1308"><a href="#dynamic_label_propagation-1308"><span class="linenos">1308</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">weight_matrix</span>
</span><span id="dynamic_label_propagation-1309"><a href="#dynamic_label_propagation-1309"><span class="linenos">1309</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="n">W</span> <span class="o">-</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">diagonal</span><span class="p">(),</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</span><span id="dynamic_label_propagation-1310"><a href="#dynamic_label_propagation-1310"><span class="linenos">1310</span></a>        <span class="n">G</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">graph</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</span><span id="dynamic_label_propagation-1311"><a href="#dynamic_label_propagation-1311"><span class="linenos">1311</span></a>        
</span><span id="dynamic_label_propagation-1312"><a href="#dynamic_label_propagation-1312"><span class="linenos">1312</span></a>        <span class="c1">#Labels to vector and correct position</span>
</span><span id="dynamic_label_propagation-1313"><a href="#dynamic_label_propagation-1313"><span class="linenos">1313</span></a>        <span class="n">K</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span>
</span><span id="dynamic_label_propagation-1314"><a href="#dynamic_label_propagation-1314"><span class="linenos">1314</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
</span><span id="dynamic_label_propagation-1315"><a href="#dynamic_label_propagation-1315"><span class="linenos">1315</span></a>        <span class="n">u</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">K</span> 
</span><span id="dynamic_label_propagation-1316"><a href="#dynamic_label_propagation-1316"><span class="linenos">1316</span></a>      
</span><span id="dynamic_label_propagation-1317"><a href="#dynamic_label_propagation-1317"><span class="linenos">1317</span></a>        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">5000</span><span class="p">:</span>
</span><span id="dynamic_label_propagation-1318"><a href="#dynamic_label_propagation-1318"><span class="linenos">1318</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot use Dynamic Label Propagation on large datasets.&quot;</span><span class="p">)</span>
</span><span id="dynamic_label_propagation-1319"><a href="#dynamic_label_propagation-1319"><span class="linenos">1319</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="dynamic_label_propagation-1320"><a href="#dynamic_label_propagation-1320"><span class="linenos">1320</span></a>            <span class="c1">#Setup matrices</span>
</span><span id="dynamic_label_propagation-1321"><a href="#dynamic_label_propagation-1321"><span class="linenos">1321</span></a>            <span class="n">Id</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> 
</span><span id="dynamic_label_propagation-1322"><a href="#dynamic_label_propagation-1322"><span class="linenos">1322</span></a>            <span class="n">D</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">degree_matrix</span><span class="p">(</span><span class="n">p</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="dynamic_label_propagation-1323"><a href="#dynamic_label_propagation-1323"><span class="linenos">1323</span></a>            <span class="n">P</span> <span class="o">=</span> <span class="n">D</span><span class="o">*</span><span class="n">W</span>
</span><span id="dynamic_label_propagation-1324"><a href="#dynamic_label_propagation-1324"><span class="linenos">1324</span></a>            <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">todense</span><span class="p">())</span>
</span><span id="dynamic_label_propagation-1325"><a href="#dynamic_label_propagation-1325"><span class="linenos">1325</span></a>            <span class="n">Pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
</span><span id="dynamic_label_propagation-1326"><a href="#dynamic_label_propagation-1326"><span class="linenos">1326</span></a>
</span><span id="dynamic_label_propagation-1327"><a href="#dynamic_label_propagation-1327"><span class="linenos">1327</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
</span><span id="dynamic_label_propagation-1328"><a href="#dynamic_label_propagation-1328"><span class="linenos">1328</span></a>                <span class="n">v</span> <span class="o">=</span> <span class="n">P</span><span class="nd">@u</span>
</span><span id="dynamic_label_propagation-1329"><a href="#dynamic_label_propagation-1329"><span class="linenos">1329</span></a>                <span class="n">u</span> <span class="o">=</span> <span class="n">Pt</span><span class="nd">@u</span>
</span><span id="dynamic_label_propagation-1330"><a href="#dynamic_label_propagation-1330"><span class="linenos">1330</span></a>                <span class="n">u</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">K</span>
</span><span id="dynamic_label_propagation-1331"><a href="#dynamic_label_propagation-1331"><span class="linenos">1331</span></a>                <span class="n">Pt</span> <span class="o">=</span> <span class="n">P</span><span class="nd">@Pt@np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="n">v</span><span class="nd">@np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="n">lam</span><span class="o">*</span><span class="n">Id</span>
</span><span id="dynamic_label_propagation-1332"><a href="#dynamic_label_propagation-1332"><span class="linenos">1332</span></a>
</span><span id="dynamic_label_propagation-1333"><a href="#dynamic_label_propagation-1333"><span class="linenos">1333</span></a>                <span class="c1">#Compute accuracy if all labels are provided</span>
</span><span id="dynamic_label_propagation-1334"><a href="#dynamic_label_propagation-1334"><span class="linenos">1334</span></a>                <span class="k">if</span> <span class="n">all_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="dynamic_label_propagation-1335"><a href="#dynamic_label_propagation-1335"><span class="linenos">1335</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</span><span id="dynamic_label_propagation-1336"><a href="#dynamic_label_propagation-1336"><span class="linenos">1336</span></a>                    <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</span><span id="dynamic_label_propagation-1337"><a href="#dynamic_label_propagation-1337"><span class="linenos">1337</span></a>                    <span class="n">acc</span> <span class="o">=</span> <span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">all_labels</span><span class="p">,</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="dynamic_label_propagation-1338"><a href="#dynamic_label_propagation-1338"><span class="linenos">1338</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accuracy = </span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">acc</span><span class="p">)</span>
</span><span id="dynamic_label_propagation-1339"><a href="#dynamic_label_propagation-1339"><span class="linenos">1339</span></a>
</span><span id="dynamic_label_propagation-1340"><a href="#dynamic_label_propagation-1340"><span class="linenos">1340</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</span><span id="dynamic_label_propagation-1341"><a href="#dynamic_label_propagation-1341"><span class="linenos">1341</span></a>
</span><span id="dynamic_label_propagation-1342"><a href="#dynamic_label_propagation-1342"><span class="linenos">1342</span></a>        <span class="k">return</span> <span class="n">u</span>
</span></pre></div>


    

                            <div id="dynamic_label_propagation.__init__" class="classattr">
                                        <input id="dynamic_label_propagation.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">dynamic_label_propagation</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">W</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span>, </span><span class="param"><span class="n">lam</span><span class="o">=</span><span class="mf">0.1</span>, </span><span class="param"><span class="n">T</span><span class="o">=</span><span class="mi">2</span></span>)</span>

                <label class="view-source-button" for="dynamic_label_propagation.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#dynamic_label_propagation.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="dynamic_label_propagation.__init__-1263"><a href="#dynamic_label_propagation.__init__-1263"><span class="linenos">1263</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">lam</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
</span><span id="dynamic_label_propagation.__init__-1264"><a href="#dynamic_label_propagation.__init__-1264"><span class="linenos">1264</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dynamic Label Propagation</span>
</span><span id="dynamic_label_propagation.__init__-1265"><a href="#dynamic_label_propagation.__init__-1265"><span class="linenos">1265</span></a><span class="sd">        ===================</span>
</span><span id="dynamic_label_propagation.__init__-1266"><a href="#dynamic_label_propagation.__init__-1266"><span class="linenos">1266</span></a>
</span><span id="dynamic_label_propagation.__init__-1267"><a href="#dynamic_label_propagation.__init__-1267"><span class="linenos">1267</span></a><span class="sd">        Semi-supervised learning via dynamic label propagation [1].</span>
</span><span id="dynamic_label_propagation.__init__-1268"><a href="#dynamic_label_propagation.__init__-1268"><span class="linenos">1268</span></a>
</span><span id="dynamic_label_propagation.__init__-1269"><a href="#dynamic_label_propagation.__init__-1269"><span class="linenos">1269</span></a><span class="sd">        Parameters</span>
</span><span id="dynamic_label_propagation.__init__-1270"><a href="#dynamic_label_propagation.__init__-1270"><span class="linenos">1270</span></a><span class="sd">        ----------</span>
</span><span id="dynamic_label_propagation.__init__-1271"><a href="#dynamic_label_propagation.__init__-1271"><span class="linenos">1271</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="dynamic_label_propagation.__init__-1272"><a href="#dynamic_label_propagation.__init__-1272"><span class="linenos">1272</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="dynamic_label_propagation.__init__-1273"><a href="#dynamic_label_propagation.__init__-1273"><span class="linenos">1273</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="dynamic_label_propagation.__init__-1274"><a href="#dynamic_label_propagation.__init__-1274"><span class="linenos">1274</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="dynamic_label_propagation.__init__-1275"><a href="#dynamic_label_propagation.__init__-1275"><span class="linenos">1275</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="dynamic_label_propagation.__init__-1276"><a href="#dynamic_label_propagation.__init__-1276"><span class="linenos">1276</span></a><span class="sd">            nodes in each class.</span>
</span><span id="dynamic_label_propagation.__init__-1277"><a href="#dynamic_label_propagation.__init__-1277"><span class="linenos">1277</span></a><span class="sd">        alpha : float (optional), default=0.05</span>
</span><span id="dynamic_label_propagation.__init__-1278"><a href="#dynamic_label_propagation.__init__-1278"><span class="linenos">1278</span></a><span class="sd">            Value of parameter \\(\\alpha\\).</span>
</span><span id="dynamic_label_propagation.__init__-1279"><a href="#dynamic_label_propagation.__init__-1279"><span class="linenos">1279</span></a><span class="sd">        lam : float (optional), default=0.1</span>
</span><span id="dynamic_label_propagation.__init__-1280"><a href="#dynamic_label_propagation.__init__-1280"><span class="linenos">1280</span></a><span class="sd">            Value of parameter \\(\\lambda\\).</span>
</span><span id="dynamic_label_propagation.__init__-1281"><a href="#dynamic_label_propagation.__init__-1281"><span class="linenos">1281</span></a><span class="sd">        T : int (optional), default=2</span>
</span><span id="dynamic_label_propagation.__init__-1282"><a href="#dynamic_label_propagation.__init__-1282"><span class="linenos">1282</span></a><span class="sd">            Number of iterations.</span>
</span><span id="dynamic_label_propagation.__init__-1283"><a href="#dynamic_label_propagation.__init__-1283"><span class="linenos">1283</span></a>
</span><span id="dynamic_label_propagation.__init__-1284"><a href="#dynamic_label_propagation.__init__-1284"><span class="linenos">1284</span></a><span class="sd">        References</span>
</span><span id="dynamic_label_propagation.__init__-1285"><a href="#dynamic_label_propagation.__init__-1285"><span class="linenos">1285</span></a><span class="sd">        ---------</span>
</span><span id="dynamic_label_propagation.__init__-1286"><a href="#dynamic_label_propagation.__init__-1286"><span class="linenos">1286</span></a><span class="sd">        [1] B. Wang, Z. Tu, and J.K. Tsotsos. [Dynamic label propagation for semi-supervised multi-class multi-label classification.](https://openaccess.thecvf.com/content_iccv_2013/html/Wang_Dynamic_Label_Propagation_2013_ICCV_paper.html) Proceedings of the IEEE international conference on computer vision. 2013.</span>
</span><span id="dynamic_label_propagation.__init__-1287"><a href="#dynamic_label_propagation.__init__-1287"><span class="linenos">1287</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="dynamic_label_propagation.__init__-1288"><a href="#dynamic_label_propagation.__init__-1288"><span class="linenos">1288</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="dynamic_label_propagation.__init__-1289"><a href="#dynamic_label_propagation.__init__-1289"><span class="linenos">1289</span></a>
</span><span id="dynamic_label_propagation.__init__-1290"><a href="#dynamic_label_propagation.__init__-1290"><span class="linenos">1290</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="dynamic_label_propagation.__init__-1291"><a href="#dynamic_label_propagation.__init__-1291"><span class="linenos">1291</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lam</span> <span class="o">=</span> <span class="n">lam</span>
</span><span id="dynamic_label_propagation.__init__-1292"><a href="#dynamic_label_propagation.__init__-1292"><span class="linenos">1292</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
</span><span id="dynamic_label_propagation.__init__-1293"><a href="#dynamic_label_propagation.__init__-1293"><span class="linenos">1293</span></a>
</span><span id="dynamic_label_propagation.__init__-1294"><a href="#dynamic_label_propagation.__init__-1294"><span class="linenos">1294</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_dynamic_label_propagation&#39;</span>
</span><span id="dynamic_label_propagation.__init__-1295"><a href="#dynamic_label_propagation.__init__-1295"><span class="linenos">1295</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Dynamic Label Propagation&#39;</span>
</span></pre></div>


            <div class="docstring"><h1 id="dynamic-label-propagation">Dynamic Label Propagation</h1>

<p>Semi-supervised learning via dynamic label propagation [1].</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>W</strong> (numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None):
Weight matrix representing the graph.</li>
<li><strong>class_priors</strong> (numpy array (optional), default=None):
Class priors (fraction of data belonging to each class). If provided, the predict function
will attempt to automatic balance the label predictions to predict the correct number of
nodes in each class.</li>
<li><strong>alpha</strong> (float (optional), default=0.05):
Value of parameter (\alpha).</li>
<li><strong>lam</strong> (float (optional), default=0.1):
Value of parameter (\lambda).</li>
<li><strong>T</strong> (int (optional), default=2):
Number of iterations.</li>
</ul>

<h6 id="references">References</h6>

<p>[1] B. Wang, Z. Tu, and J.K. Tsotsos. <a href="https://openaccess.thecvf.com/content_iccv_2013/html/Wang_Dynamic_Label_Propagation_2013_ICCV_paper.html">Dynamic label propagation for semi-supervised multi-class multi-label classification.</a> Proceedings of the IEEE international conference on computer vision. 2013.</p>
</div>


                            </div>
                            <div id="dynamic_label_propagation.alpha" class="classattr">
                                <div class="attr variable">
            <span class="name">alpha</span>

        
    </div>
    <a class="headerlink" href="#dynamic_label_propagation.alpha"></a>
    
    

                            </div>
                            <div id="dynamic_label_propagation.lam" class="classattr">
                                <div class="attr variable">
            <span class="name">lam</span>

        
    </div>
    <a class="headerlink" href="#dynamic_label_propagation.lam"></a>
    
    

                            </div>
                            <div id="dynamic_label_propagation.T" class="classattr">
                                <div class="attr variable">
            <span class="name">T</span>

        
    </div>
    <a class="headerlink" href="#dynamic_label_propagation.T"></a>
    
    

                            </div>
                            <div id="dynamic_label_propagation.accuracy_filename" class="classattr">
                                <div class="attr variable">
            <span class="name">accuracy_filename</span>

        
    </div>
    <a class="headerlink" href="#dynamic_label_propagation.accuracy_filename"></a>
    
    

                            </div>
                            <div id="dynamic_label_propagation.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#dynamic_label_propagation.name"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#ssl">ssl</a></dt>
                                <dd id="dynamic_label_propagation.prob" class="variable"><a href="#ssl.prob">prob</a></dd>
                <dd id="dynamic_label_propagation.fitted" class="variable"><a href="#ssl.fitted">fitted</a></dd>
                <dd id="dynamic_label_propagation.requires_eig" class="variable"><a href="#ssl.requires_eig">requires_eig</a></dd>
                <dd id="dynamic_label_propagation.onevsrest" class="variable"><a href="#ssl.onevsrest">onevsrest</a></dd>
                <dd id="dynamic_label_propagation.similarity" class="variable"><a href="#ssl.similarity">similarity</a></dd>
                <dd id="dynamic_label_propagation.class_priors" class="variable"><a href="#ssl.class_priors">class_priors</a></dd>
                <dd id="dynamic_label_propagation.weights" class="variable"><a href="#ssl.weights">weights</a></dd>
                <dd id="dynamic_label_propagation.class_priors_error" class="variable"><a href="#ssl.class_priors_error">class_priors_error</a></dd>
                <dd id="dynamic_label_propagation.set_graph" class="function"><a href="#ssl.set_graph">set_graph</a></dd>
                <dd id="dynamic_label_propagation.volume_label_projection" class="function"><a href="#ssl.volume_label_projection">volume_label_projection</a></dd>
                <dd id="dynamic_label_propagation.get_accuracy_filename" class="function"><a href="#ssl.get_accuracy_filename">get_accuracy_filename</a></dd>
                <dd id="dynamic_label_propagation.predict" class="function"><a href="#ssl.predict">predict</a></dd>
                <dd id="dynamic_label_propagation.fit_predict" class="function"><a href="#ssl.fit_predict">fit_predict</a></dd>
                <dd id="dynamic_label_propagation.ssl_trials" class="function"><a href="#ssl.ssl_trials">ssl_trials</a></dd>
                <dd id="dynamic_label_propagation.trials_statistics" class="function"><a href="#ssl.trials_statistics">trials_statistics</a></dd>
                <dd id="dynamic_label_propagation.fit" class="function"><a href="#ssl.fit">fit</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="centered_kernel">
                            <input id="centered_kernel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">centered_kernel</span><wbr>(<span class="base"><a href="#ssl">ssl</a></span>):

                <label class="view-source-button" for="centered_kernel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#centered_kernel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="centered_kernel-1345"><a href="#centered_kernel-1345"><span class="linenos">1345</span></a><span class="k">class</span> <span class="nc">centered_kernel</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="centered_kernel-1346"><a href="#centered_kernel-1346"><span class="linenos">1346</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span> <span class="n">power_it</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.05</span><span class="p">):</span>
</span><span id="centered_kernel-1347"><a href="#centered_kernel-1347"><span class="linenos">1347</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Centered Kernel Method</span>
</span><span id="centered_kernel-1348"><a href="#centered_kernel-1348"><span class="linenos">1348</span></a><span class="sd">        ===================</span>
</span><span id="centered_kernel-1349"><a href="#centered_kernel-1349"><span class="linenos">1349</span></a>
</span><span id="centered_kernel-1350"><a href="#centered_kernel-1350"><span class="linenos">1350</span></a><span class="sd">        Semi-supervised learning via the centered kernel method of [1].</span>
</span><span id="centered_kernel-1351"><a href="#centered_kernel-1351"><span class="linenos">1351</span></a>
</span><span id="centered_kernel-1352"><a href="#centered_kernel-1352"><span class="linenos">1352</span></a><span class="sd">        Parameters</span>
</span><span id="centered_kernel-1353"><a href="#centered_kernel-1353"><span class="linenos">1353</span></a><span class="sd">        ----------</span>
</span><span id="centered_kernel-1354"><a href="#centered_kernel-1354"><span class="linenos">1354</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="centered_kernel-1355"><a href="#centered_kernel-1355"><span class="linenos">1355</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="centered_kernel-1356"><a href="#centered_kernel-1356"><span class="linenos">1356</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="centered_kernel-1357"><a href="#centered_kernel-1357"><span class="linenos">1357</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="centered_kernel-1358"><a href="#centered_kernel-1358"><span class="linenos">1358</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="centered_kernel-1359"><a href="#centered_kernel-1359"><span class="linenos">1359</span></a><span class="sd">            nodes in each class.</span>
</span><span id="centered_kernel-1360"><a href="#centered_kernel-1360"><span class="linenos">1360</span></a><span class="sd">        tol : float (optional), default=1e-10</span>
</span><span id="centered_kernel-1361"><a href="#centered_kernel-1361"><span class="linenos">1361</span></a><span class="sd">            Tolerance to solve equation.</span>
</span><span id="centered_kernel-1362"><a href="#centered_kernel-1362"><span class="linenos">1362</span></a><span class="sd">        power_it : int (optional), default=100</span>
</span><span id="centered_kernel-1363"><a href="#centered_kernel-1363"><span class="linenos">1363</span></a><span class="sd">            Number of power iterations to find largest eigenvalue.</span>
</span><span id="centered_kernel-1364"><a href="#centered_kernel-1364"><span class="linenos">1364</span></a><span class="sd">        alpha : float (optional), default = 1.05</span>
</span><span id="centered_kernel-1365"><a href="#centered_kernel-1365"><span class="linenos">1365</span></a><span class="sd">            Value of \\(\\alpha\\) as a fraction of largest eigenvalue.</span>
</span><span id="centered_kernel-1366"><a href="#centered_kernel-1366"><span class="linenos">1366</span></a>
</span><span id="centered_kernel-1367"><a href="#centered_kernel-1367"><span class="linenos">1367</span></a><span class="sd">        References</span>
</span><span id="centered_kernel-1368"><a href="#centered_kernel-1368"><span class="linenos">1368</span></a><span class="sd">        ---------</span>
</span><span id="centered_kernel-1369"><a href="#centered_kernel-1369"><span class="linenos">1369</span></a><span class="sd">        [1] X. Mai and R. Couillet. [Random matrix-inspired improved semi-supervised learning on graphs.](https://romaincouillet.hebfree.org/docs/conf/SSL_ICML18.pdf) International Conference on Machine Learning. 2018.</span>
</span><span id="centered_kernel-1370"><a href="#centered_kernel-1370"><span class="linenos">1370</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="centered_kernel-1371"><a href="#centered_kernel-1371"><span class="linenos">1371</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="centered_kernel-1372"><a href="#centered_kernel-1372"><span class="linenos">1372</span></a>
</span><span id="centered_kernel-1373"><a href="#centered_kernel-1373"><span class="linenos">1373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span>
</span><span id="centered_kernel-1374"><a href="#centered_kernel-1374"><span class="linenos">1374</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">power_it</span> <span class="o">=</span> <span class="n">power_it</span>
</span><span id="centered_kernel-1375"><a href="#centered_kernel-1375"><span class="linenos">1375</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="centered_kernel-1376"><a href="#centered_kernel-1376"><span class="linenos">1376</span></a>
</span><span id="centered_kernel-1377"><a href="#centered_kernel-1377"><span class="linenos">1377</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_centered_kernel&#39;</span>
</span><span id="centered_kernel-1378"><a href="#centered_kernel-1378"><span class="linenos">1378</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Centered Kernel&#39;</span>
</span><span id="centered_kernel-1379"><a href="#centered_kernel-1379"><span class="linenos">1379</span></a>        
</span><span id="centered_kernel-1380"><a href="#centered_kernel-1380"><span class="linenos">1380</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="centered_kernel-1381"><a href="#centered_kernel-1381"><span class="linenos">1381</span></a>
</span><span id="centered_kernel-1382"><a href="#centered_kernel-1382"><span class="linenos">1382</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span>
</span><span id="centered_kernel-1383"><a href="#centered_kernel-1383"><span class="linenos">1383</span></a>        <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_labels</span><span class="p">))</span>
</span><span id="centered_kernel-1384"><a href="#centered_kernel-1384"><span class="linenos">1384</span></a>
</span><span id="centered_kernel-1385"><a href="#centered_kernel-1385"><span class="linenos">1385</span></a>        <span class="c1">#Zero diagonal</span>
</span><span id="centered_kernel-1386"><a href="#centered_kernel-1386"><span class="linenos">1386</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">weight_matrix</span>
</span><span id="centered_kernel-1387"><a href="#centered_kernel-1387"><span class="linenos">1387</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="n">W</span> <span class="o">-</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">diagonal</span><span class="p">(),</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</span><span id="centered_kernel-1388"><a href="#centered_kernel-1388"><span class="linenos">1388</span></a>
</span><span id="centered_kernel-1389"><a href="#centered_kernel-1389"><span class="linenos">1389</span></a>        <span class="c1">#Indicator of train_ind</span>
</span><span id="centered_kernel-1390"><a href="#centered_kernel-1390"><span class="linenos">1390</span></a>        <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
</span><span id="centered_kernel-1391"><a href="#centered_kernel-1391"><span class="linenos">1391</span></a>        <span class="n">K</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span>
</span><span id="centered_kernel-1392"><a href="#centered_kernel-1392"><span class="linenos">1392</span></a>        
</span><span id="centered_kernel-1393"><a href="#centered_kernel-1393"><span class="linenos">1393</span></a>        <span class="c1">#Center labels</span>
</span><span id="centered_kernel-1394"><a href="#centered_kernel-1394"><span class="linenos">1394</span></a>        <span class="n">K</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,:]</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="centered_kernel-1395"><a href="#centered_kernel-1395"><span class="linenos">1395</span></a>
</span><span id="centered_kernel-1396"><a href="#centered_kernel-1396"><span class="linenos">1396</span></a>        <span class="c1">#Initialization</span>
</span><span id="centered_kernel-1397"><a href="#centered_kernel-1397"><span class="linenos">1397</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
</span><span id="centered_kernel-1398"><a href="#centered_kernel-1398"><span class="linenos">1398</span></a>        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</span><span id="centered_kernel-1399"><a href="#centered_kernel-1399"><span class="linenos">1399</span></a>        <span class="n">vt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
</span><span id="centered_kernel-1400"><a href="#centered_kernel-1400"><span class="linenos">1400</span></a>
</span><span id="centered_kernel-1401"><a href="#centered_kernel-1401"><span class="linenos">1401</span></a>        <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="centered_kernel-1402"><a href="#centered_kernel-1402"><span class="linenos">1402</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">power_it</span><span class="p">):</span>
</span><span id="centered_kernel-1403"><a href="#centered_kernel-1403"><span class="linenos">1403</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">W</span><span class="o">*</span><span class="p">(</span><span class="n">e</span> <span class="o">-</span>  <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">v</span><span class="o">@</span><span class="p">(</span><span class="n">vt</span><span class="nd">@e</span><span class="p">))</span>
</span><span id="centered_kernel-1404"><a href="#centered_kernel-1404"><span class="linenos">1404</span></a>            <span class="n">w</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">v</span><span class="o">@</span><span class="p">(</span><span class="n">vt</span><span class="nd">@y</span><span class="p">)</span> <span class="c1">#=Ae</span>
</span><span id="centered_kernel-1405"><a href="#centered_kernel-1405"><span class="linenos">1405</span></a>            <span class="n">l</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="nd">@w</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="nd">@e</span><span class="p">))</span>
</span><span id="centered_kernel-1406"><a href="#centered_kernel-1406"><span class="linenos">1406</span></a>            <span class="n">e</span> <span class="o">=</span> <span class="n">w</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
</span><span id="centered_kernel-1407"><a href="#centered_kernel-1407"><span class="linenos">1407</span></a>
</span><span id="centered_kernel-1408"><a href="#centered_kernel-1408"><span class="linenos">1408</span></a>        <span class="c1">#Number of iterations</span>
</span><span id="centered_kernel-1409"><a href="#centered_kernel-1409"><span class="linenos">1409</span></a>        <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">l</span>
</span><span id="centered_kernel-1410"><a href="#centered_kernel-1410"><span class="linenos">1410</span></a>        <span class="n">err</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="centered_kernel-1411"><a href="#centered_kernel-1411"><span class="linenos">1411</span></a>        <span class="k">while</span> <span class="n">err</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tol</span><span class="p">:</span>
</span><span id="centered_kernel-1412"><a href="#centered_kernel-1412"><span class="linenos">1412</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">W</span><span class="o">*</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span>  <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">v</span><span class="o">@</span><span class="p">(</span><span class="n">vt</span><span class="nd">@u</span><span class="p">))</span>
</span><span id="centered_kernel-1413"><a href="#centered_kernel-1413"><span class="linenos">1413</span></a>            <span class="n">w</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">v</span><span class="o">@</span><span class="p">(</span><span class="n">vt</span><span class="nd">@y</span><span class="p">))</span> <span class="o">-</span> <span class="n">u</span> <span class="c1">#Laplacian</span>
</span><span id="centered_kernel-1414"><a href="#centered_kernel-1414"><span class="linenos">1414</span></a>            <span class="n">w</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,:]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="centered_kernel-1415"><a href="#centered_kernel-1415"><span class="linenos">1415</span></a>            <span class="n">err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
</span><span id="centered_kernel-1416"><a href="#centered_kernel-1416"><span class="linenos">1416</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">u</span> <span class="o">+</span> <span class="n">w</span>
</span><span id="centered_kernel-1417"><a href="#centered_kernel-1417"><span class="linenos">1417</span></a>
</span><span id="centered_kernel-1418"><a href="#centered_kernel-1418"><span class="linenos">1418</span></a>            <span class="c1">#Compute accuracy if all labels are provided</span>
</span><span id="centered_kernel-1419"><a href="#centered_kernel-1419"><span class="linenos">1419</span></a>            <span class="k">if</span> <span class="n">all_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="centered_kernel-1420"><a href="#centered_kernel-1420"><span class="linenos">1420</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">=</span> <span class="n">u</span>
</span><span id="centered_kernel-1421"><a href="#centered_kernel-1421"><span class="linenos">1421</span></a>                <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</span><span id="centered_kernel-1422"><a href="#centered_kernel-1422"><span class="linenos">1422</span></a>                <span class="n">acc</span> <span class="o">=</span> <span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">all_labels</span><span class="p">,</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="centered_kernel-1423"><a href="#centered_kernel-1423"><span class="linenos">1423</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accuracy = </span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">acc</span><span class="p">)</span>
</span><span id="centered_kernel-1424"><a href="#centered_kernel-1424"><span class="linenos">1424</span></a>            
</span><span id="centered_kernel-1425"><a href="#centered_kernel-1425"><span class="linenos">1425</span></a>        <span class="k">return</span> <span class="n">u</span>
</span></pre></div>


    

                            <div id="centered_kernel.__init__" class="classattr">
                                        <input id="centered_kernel.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">centered_kernel</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">W</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">tol</span><span class="o">=</span><span class="mf">1e-10</span>, </span><span class="param"><span class="n">power_it</span><span class="o">=</span><span class="mi">100</span>, </span><span class="param"><span class="n">alpha</span><span class="o">=</span><span class="mf">1.05</span></span>)</span>

                <label class="view-source-button" for="centered_kernel.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#centered_kernel.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="centered_kernel.__init__-1346"><a href="#centered_kernel.__init__-1346"><span class="linenos">1346</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span> <span class="n">power_it</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.05</span><span class="p">):</span>
</span><span id="centered_kernel.__init__-1347"><a href="#centered_kernel.__init__-1347"><span class="linenos">1347</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Centered Kernel Method</span>
</span><span id="centered_kernel.__init__-1348"><a href="#centered_kernel.__init__-1348"><span class="linenos">1348</span></a><span class="sd">        ===================</span>
</span><span id="centered_kernel.__init__-1349"><a href="#centered_kernel.__init__-1349"><span class="linenos">1349</span></a>
</span><span id="centered_kernel.__init__-1350"><a href="#centered_kernel.__init__-1350"><span class="linenos">1350</span></a><span class="sd">        Semi-supervised learning via the centered kernel method of [1].</span>
</span><span id="centered_kernel.__init__-1351"><a href="#centered_kernel.__init__-1351"><span class="linenos">1351</span></a>
</span><span id="centered_kernel.__init__-1352"><a href="#centered_kernel.__init__-1352"><span class="linenos">1352</span></a><span class="sd">        Parameters</span>
</span><span id="centered_kernel.__init__-1353"><a href="#centered_kernel.__init__-1353"><span class="linenos">1353</span></a><span class="sd">        ----------</span>
</span><span id="centered_kernel.__init__-1354"><a href="#centered_kernel.__init__-1354"><span class="linenos">1354</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="centered_kernel.__init__-1355"><a href="#centered_kernel.__init__-1355"><span class="linenos">1355</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="centered_kernel.__init__-1356"><a href="#centered_kernel.__init__-1356"><span class="linenos">1356</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="centered_kernel.__init__-1357"><a href="#centered_kernel.__init__-1357"><span class="linenos">1357</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="centered_kernel.__init__-1358"><a href="#centered_kernel.__init__-1358"><span class="linenos">1358</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="centered_kernel.__init__-1359"><a href="#centered_kernel.__init__-1359"><span class="linenos">1359</span></a><span class="sd">            nodes in each class.</span>
</span><span id="centered_kernel.__init__-1360"><a href="#centered_kernel.__init__-1360"><span class="linenos">1360</span></a><span class="sd">        tol : float (optional), default=1e-10</span>
</span><span id="centered_kernel.__init__-1361"><a href="#centered_kernel.__init__-1361"><span class="linenos">1361</span></a><span class="sd">            Tolerance to solve equation.</span>
</span><span id="centered_kernel.__init__-1362"><a href="#centered_kernel.__init__-1362"><span class="linenos">1362</span></a><span class="sd">        power_it : int (optional), default=100</span>
</span><span id="centered_kernel.__init__-1363"><a href="#centered_kernel.__init__-1363"><span class="linenos">1363</span></a><span class="sd">            Number of power iterations to find largest eigenvalue.</span>
</span><span id="centered_kernel.__init__-1364"><a href="#centered_kernel.__init__-1364"><span class="linenos">1364</span></a><span class="sd">        alpha : float (optional), default = 1.05</span>
</span><span id="centered_kernel.__init__-1365"><a href="#centered_kernel.__init__-1365"><span class="linenos">1365</span></a><span class="sd">            Value of \\(\\alpha\\) as a fraction of largest eigenvalue.</span>
</span><span id="centered_kernel.__init__-1366"><a href="#centered_kernel.__init__-1366"><span class="linenos">1366</span></a>
</span><span id="centered_kernel.__init__-1367"><a href="#centered_kernel.__init__-1367"><span class="linenos">1367</span></a><span class="sd">        References</span>
</span><span id="centered_kernel.__init__-1368"><a href="#centered_kernel.__init__-1368"><span class="linenos">1368</span></a><span class="sd">        ---------</span>
</span><span id="centered_kernel.__init__-1369"><a href="#centered_kernel.__init__-1369"><span class="linenos">1369</span></a><span class="sd">        [1] X. Mai and R. Couillet. [Random matrix-inspired improved semi-supervised learning on graphs.](https://romaincouillet.hebfree.org/docs/conf/SSL_ICML18.pdf) International Conference on Machine Learning. 2018.</span>
</span><span id="centered_kernel.__init__-1370"><a href="#centered_kernel.__init__-1370"><span class="linenos">1370</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="centered_kernel.__init__-1371"><a href="#centered_kernel.__init__-1371"><span class="linenos">1371</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="centered_kernel.__init__-1372"><a href="#centered_kernel.__init__-1372"><span class="linenos">1372</span></a>
</span><span id="centered_kernel.__init__-1373"><a href="#centered_kernel.__init__-1373"><span class="linenos">1373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span>
</span><span id="centered_kernel.__init__-1374"><a href="#centered_kernel.__init__-1374"><span class="linenos">1374</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">power_it</span> <span class="o">=</span> <span class="n">power_it</span>
</span><span id="centered_kernel.__init__-1375"><a href="#centered_kernel.__init__-1375"><span class="linenos">1375</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="centered_kernel.__init__-1376"><a href="#centered_kernel.__init__-1376"><span class="linenos">1376</span></a>
</span><span id="centered_kernel.__init__-1377"><a href="#centered_kernel.__init__-1377"><span class="linenos">1377</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_centered_kernel&#39;</span>
</span><span id="centered_kernel.__init__-1378"><a href="#centered_kernel.__init__-1378"><span class="linenos">1378</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Centered Kernel&#39;</span>
</span></pre></div>


            <div class="docstring"><h1 id="centered-kernel-method">Centered Kernel Method</h1>

<p>Semi-supervised learning via the centered kernel method of [1].</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>W</strong> (numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None):
Weight matrix representing the graph.</li>
<li><strong>class_priors</strong> (numpy array (optional), default=None):
Class priors (fraction of data belonging to each class). If provided, the predict function
will attempt to automatic balance the label predictions to predict the correct number of
nodes in each class.</li>
<li><strong>tol</strong> (float (optional), default=1e-10):
Tolerance to solve equation.</li>
<li><strong>power_it</strong> (int (optional), default=100):
Number of power iterations to find largest eigenvalue.</li>
<li><strong>alpha</strong> (float (optional), default = 1.05):
Value of (\alpha) as a fraction of largest eigenvalue.</li>
</ul>

<h6 id="references">References</h6>

<p>[1] X. Mai and R. Couillet. <a href="https://romaincouillet.hebfree.org/docs/conf/SSL_ICML18.pdf">Random matrix-inspired improved semi-supervised learning on graphs.</a> International Conference on Machine Learning. 2018.</p>
</div>


                            </div>
                            <div id="centered_kernel.tol" class="classattr">
                                <div class="attr variable">
            <span class="name">tol</span>

        
    </div>
    <a class="headerlink" href="#centered_kernel.tol"></a>
    
    

                            </div>
                            <div id="centered_kernel.power_it" class="classattr">
                                <div class="attr variable">
            <span class="name">power_it</span>

        
    </div>
    <a class="headerlink" href="#centered_kernel.power_it"></a>
    
    

                            </div>
                            <div id="centered_kernel.alpha" class="classattr">
                                <div class="attr variable">
            <span class="name">alpha</span>

        
    </div>
    <a class="headerlink" href="#centered_kernel.alpha"></a>
    
    

                            </div>
                            <div id="centered_kernel.accuracy_filename" class="classattr">
                                <div class="attr variable">
            <span class="name">accuracy_filename</span>

        
    </div>
    <a class="headerlink" href="#centered_kernel.accuracy_filename"></a>
    
    

                            </div>
                            <div id="centered_kernel.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#centered_kernel.name"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#ssl">ssl</a></dt>
                                <dd id="centered_kernel.prob" class="variable"><a href="#ssl.prob">prob</a></dd>
                <dd id="centered_kernel.fitted" class="variable"><a href="#ssl.fitted">fitted</a></dd>
                <dd id="centered_kernel.requires_eig" class="variable"><a href="#ssl.requires_eig">requires_eig</a></dd>
                <dd id="centered_kernel.onevsrest" class="variable"><a href="#ssl.onevsrest">onevsrest</a></dd>
                <dd id="centered_kernel.similarity" class="variable"><a href="#ssl.similarity">similarity</a></dd>
                <dd id="centered_kernel.class_priors" class="variable"><a href="#ssl.class_priors">class_priors</a></dd>
                <dd id="centered_kernel.weights" class="variable"><a href="#ssl.weights">weights</a></dd>
                <dd id="centered_kernel.class_priors_error" class="variable"><a href="#ssl.class_priors_error">class_priors_error</a></dd>
                <dd id="centered_kernel.set_graph" class="function"><a href="#ssl.set_graph">set_graph</a></dd>
                <dd id="centered_kernel.volume_label_projection" class="function"><a href="#ssl.volume_label_projection">volume_label_projection</a></dd>
                <dd id="centered_kernel.get_accuracy_filename" class="function"><a href="#ssl.get_accuracy_filename">get_accuracy_filename</a></dd>
                <dd id="centered_kernel.predict" class="function"><a href="#ssl.predict">predict</a></dd>
                <dd id="centered_kernel.fit_predict" class="function"><a href="#ssl.fit_predict">fit_predict</a></dd>
                <dd id="centered_kernel.ssl_trials" class="function"><a href="#ssl.ssl_trials">ssl_trials</a></dd>
                <dd id="centered_kernel.trials_statistics" class="function"><a href="#ssl.trials_statistics">trials_statistics</a></dd>
                <dd id="centered_kernel.fit" class="function"><a href="#ssl.fit">fit</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="sparse_label_propagation">
                            <input id="sparse_label_propagation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">sparse_label_propagation</span><wbr>(<span class="base"><a href="#ssl">ssl</a></span>):

                <label class="view-source-button" for="sparse_label_propagation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#sparse_label_propagation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="sparse_label_propagation-1428"><a href="#sparse_label_propagation-1428"><span class="linenos">1428</span></a><span class="k">class</span> <span class="nc">sparse_label_propagation</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="sparse_label_propagation-1429"><a href="#sparse_label_propagation-1429"><span class="linenos">1429</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
</span><span id="sparse_label_propagation-1430"><a href="#sparse_label_propagation-1430"><span class="linenos">1430</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sparse Label Propagation</span>
</span><span id="sparse_label_propagation-1431"><a href="#sparse_label_propagation-1431"><span class="linenos">1431</span></a><span class="sd">        ===================</span>
</span><span id="sparse_label_propagation-1432"><a href="#sparse_label_propagation-1432"><span class="linenos">1432</span></a>
</span><span id="sparse_label_propagation-1433"><a href="#sparse_label_propagation-1433"><span class="linenos">1433</span></a><span class="sd">        Semi-supervised learning via the sparse label propagation method of [1].</span>
</span><span id="sparse_label_propagation-1434"><a href="#sparse_label_propagation-1434"><span class="linenos">1434</span></a>
</span><span id="sparse_label_propagation-1435"><a href="#sparse_label_propagation-1435"><span class="linenos">1435</span></a><span class="sd">        Parameters</span>
</span><span id="sparse_label_propagation-1436"><a href="#sparse_label_propagation-1436"><span class="linenos">1436</span></a><span class="sd">        ----------</span>
</span><span id="sparse_label_propagation-1437"><a href="#sparse_label_propagation-1437"><span class="linenos">1437</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="sparse_label_propagation-1438"><a href="#sparse_label_propagation-1438"><span class="linenos">1438</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="sparse_label_propagation-1439"><a href="#sparse_label_propagation-1439"><span class="linenos">1439</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="sparse_label_propagation-1440"><a href="#sparse_label_propagation-1440"><span class="linenos">1440</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="sparse_label_propagation-1441"><a href="#sparse_label_propagation-1441"><span class="linenos">1441</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="sparse_label_propagation-1442"><a href="#sparse_label_propagation-1442"><span class="linenos">1442</span></a><span class="sd">            nodes in each class.</span>
</span><span id="sparse_label_propagation-1443"><a href="#sparse_label_propagation-1443"><span class="linenos">1443</span></a><span class="sd">        T : int (optional), default=100</span>
</span><span id="sparse_label_propagation-1444"><a href="#sparse_label_propagation-1444"><span class="linenos">1444</span></a><span class="sd">            Number of iterations</span>
</span><span id="sparse_label_propagation-1445"><a href="#sparse_label_propagation-1445"><span class="linenos">1445</span></a>
</span><span id="sparse_label_propagation-1446"><a href="#sparse_label_propagation-1446"><span class="linenos">1446</span></a><span class="sd">        References</span>
</span><span id="sparse_label_propagation-1447"><a href="#sparse_label_propagation-1447"><span class="linenos">1447</span></a><span class="sd">        ---------</span>
</span><span id="sparse_label_propagation-1448"><a href="#sparse_label_propagation-1448"><span class="linenos">1448</span></a><span class="sd">        [1] A. Jung, A.O. Hero III, A. Mara, and S. Jahromi. [Semi-supervised learning via sparse label propagation.](https://arxiv.org/abs/1612.01414) arXiv:1612.01414, 2016.</span>
</span><span id="sparse_label_propagation-1449"><a href="#sparse_label_propagation-1449"><span class="linenos">1449</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="sparse_label_propagation-1450"><a href="#sparse_label_propagation-1450"><span class="linenos">1450</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="sparse_label_propagation-1451"><a href="#sparse_label_propagation-1451"><span class="linenos">1451</span></a>
</span><span id="sparse_label_propagation-1452"><a href="#sparse_label_propagation-1452"><span class="linenos">1452</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
</span><span id="sparse_label_propagation-1453"><a href="#sparse_label_propagation-1453"><span class="linenos">1453</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_sparse_label_propagation&#39;</span>
</span><span id="sparse_label_propagation-1454"><a href="#sparse_label_propagation-1454"><span class="linenos">1454</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Sparse LP&#39;</span>
</span><span id="sparse_label_propagation-1455"><a href="#sparse_label_propagation-1455"><span class="linenos">1455</span></a>        
</span><span id="sparse_label_propagation-1456"><a href="#sparse_label_propagation-1456"><span class="linenos">1456</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="sparse_label_propagation-1457"><a href="#sparse_label_propagation-1457"><span class="linenos">1457</span></a>
</span><span id="sparse_label_propagation-1458"><a href="#sparse_label_propagation-1458"><span class="linenos">1458</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span>
</span><span id="sparse_label_propagation-1459"><a href="#sparse_label_propagation-1459"><span class="linenos">1459</span></a>        <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_labels</span><span class="p">))</span>
</span><span id="sparse_label_propagation-1460"><a href="#sparse_label_propagation-1460"><span class="linenos">1460</span></a>
</span><span id="sparse_label_propagation-1461"><a href="#sparse_label_propagation-1461"><span class="linenos">1461</span></a>        <span class="c1">#Sparse matrix with ones in all entries</span>
</span><span id="sparse_label_propagation-1462"><a href="#sparse_label_propagation-1462"><span class="linenos">1462</span></a>        <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">adjacency</span><span class="p">()</span>
</span><span id="sparse_label_propagation-1463"><a href="#sparse_label_propagation-1463"><span class="linenos">1463</span></a>
</span><span id="sparse_label_propagation-1464"><a href="#sparse_label_propagation-1464"><span class="linenos">1464</span></a>        <span class="c1">#Construct matrix 1/2W and 1/deg</span>
</span><span id="sparse_label_propagation-1465"><a href="#sparse_label_propagation-1465"><span class="linenos">1465</span></a>        <span class="n">lam</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">weight_matrix</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">1e-10</span><span class="p">)</span><span class="o">*</span><span class="n">B</span>
</span><span id="sparse_label_propagation-1466"><a href="#sparse_label_propagation-1466"><span class="linenos">1466</span></a>        <span class="n">lam</span> <span class="o">=</span> <span class="o">-</span><span class="n">lam</span><span class="o">.</span><span class="n">log1p</span><span class="p">()</span>
</span><span id="sparse_label_propagation-1467"><a href="#sparse_label_propagation-1467"><span class="linenos">1467</span></a>        <span class="n">lam</span> <span class="o">=</span> <span class="n">lam</span><span class="o">.</span><span class="n">expm1</span><span class="p">()</span> <span class="o">+</span> <span class="n">B</span>
</span><span id="sparse_label_propagation-1468"><a href="#sparse_label_propagation-1468"><span class="linenos">1468</span></a>        <span class="n">Id</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> 
</span><span id="sparse_label_propagation-1469"><a href="#sparse_label_propagation-1469"><span class="linenos">1469</span></a>        <span class="n">gamma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">degree_matrix</span><span class="p">(</span><span class="n">p</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="sparse_label_propagation-1470"><a href="#sparse_label_propagation-1470"><span class="linenos">1470</span></a>
</span><span id="sparse_label_propagation-1471"><a href="#sparse_label_propagation-1471"><span class="linenos">1471</span></a>        <span class="c1">#Random initial labeling</span>
</span><span id="sparse_label_propagation-1472"><a href="#sparse_label_propagation-1472"><span class="linenos">1472</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
</span><span id="sparse_label_propagation-1473"><a href="#sparse_label_propagation-1473"><span class="linenos">1473</span></a>
</span><span id="sparse_label_propagation-1474"><a href="#sparse_label_propagation-1474"><span class="linenos">1474</span></a>        <span class="c1">#Indicator of train_ind</span>
</span><span id="sparse_label_propagation-1475"><a href="#sparse_label_propagation-1475"><span class="linenos">1475</span></a>        <span class="n">one_hot_labels</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="sparse_label_propagation-1476"><a href="#sparse_label_propagation-1476"><span class="linenos">1476</span></a>
</span><span id="sparse_label_propagation-1477"><a href="#sparse_label_propagation-1477"><span class="linenos">1477</span></a>        <span class="c1">#Initialization</span>
</span><span id="sparse_label_propagation-1478"><a href="#sparse_label_propagation-1478"><span class="linenos">1478</span></a>        <span class="n">Y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="sparse_label_propagation-1479"><a href="#sparse_label_propagation-1479"><span class="linenos">1479</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
</span><span id="sparse_label_propagation-1480"><a href="#sparse_label_propagation-1480"><span class="linenos">1480</span></a>            <span class="n">Gu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,:],</span> <span class="n">weighted</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="sparse_label_propagation-1481"><a href="#sparse_label_propagation-1481"><span class="linenos">1481</span></a>            <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gu</span><span class="p">)</span>
</span><span id="sparse_label_propagation-1482"><a href="#sparse_label_propagation-1482"><span class="linenos">1482</span></a>
</span><span id="sparse_label_propagation-1483"><a href="#sparse_label_propagation-1483"><span class="linenos">1483</span></a>        <span class="c1">#Main loop for sparse label propagation</span>
</span><span id="sparse_label_propagation-1484"><a href="#sparse_label_propagation-1484"><span class="linenos">1484</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="sparse_label_propagation-1485"><a href="#sparse_label_propagation-1485"><span class="linenos">1485</span></a>
</span><span id="sparse_label_propagation-1486"><a href="#sparse_label_propagation-1486"><span class="linenos">1486</span></a>            <span class="n">u_prev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</span><span id="sparse_label_propagation-1487"><a href="#sparse_label_propagation-1487"><span class="linenos">1487</span></a>            <span class="c1">#Compute div</span>
</span><span id="sparse_label_propagation-1488"><a href="#sparse_label_propagation-1488"><span class="linenos">1488</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
</span><span id="sparse_label_propagation-1489"><a href="#sparse_label_propagation-1489"><span class="linenos">1489</span></a>                <span class="n">div</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">divergence</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="sparse_label_propagation-1490"><a href="#sparse_label_propagation-1490"><span class="linenos">1490</span></a>                <span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">u_prev</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">gamma</span><span class="o">*</span><span class="n">div</span>
</span><span id="sparse_label_propagation-1491"><a href="#sparse_label_propagation-1491"><span class="linenos">1491</span></a>                <span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">train_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">one_hot_labels</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span>  <span class="c1">#Set labels</span>
</span><span id="sparse_label_propagation-1492"><a href="#sparse_label_propagation-1492"><span class="linenos">1492</span></a>                <span class="n">u_tilde</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">u_prev</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span>
</span><span id="sparse_label_propagation-1493"><a href="#sparse_label_propagation-1493"><span class="linenos">1493</span></a>
</span><span id="sparse_label_propagation-1494"><a href="#sparse_label_propagation-1494"><span class="linenos">1494</span></a>                <span class="n">Gu</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">u_tilde</span><span class="p">,</span> <span class="n">weighted</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="sparse_label_propagation-1495"><a href="#sparse_label_propagation-1495"><span class="linenos">1495</span></a>                <span class="n">Y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">Gu</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">lam</span><span class="p">)</span>
</span><span id="sparse_label_propagation-1496"><a href="#sparse_label_propagation-1496"><span class="linenos">1496</span></a>                <span class="n">ind1</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span>
</span><span id="sparse_label_propagation-1497"><a href="#sparse_label_propagation-1497"><span class="linenos">1497</span></a>                <span class="n">ind2</span> <span class="o">=</span> <span class="n">B</span> <span class="o">-</span> <span class="n">ind1</span>
</span><span id="sparse_label_propagation-1498"><a href="#sparse_label_propagation-1498"><span class="linenos">1498</span></a>                <span class="n">Y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">ind1</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">sign</span><span class="p">())</span> <span class="o">+</span> <span class="n">ind2</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="sparse_label_propagation-1499"><a href="#sparse_label_propagation-1499"><span class="linenos">1499</span></a>
</span><span id="sparse_label_propagation-1500"><a href="#sparse_label_propagation-1500"><span class="linenos">1500</span></a>            <span class="c1">#Compute accuracy if all labels are provided</span>
</span><span id="sparse_label_propagation-1501"><a href="#sparse_label_propagation-1501"><span class="linenos">1501</span></a>            <span class="k">if</span> <span class="n">all_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="sparse_label_propagation-1502"><a href="#sparse_label_propagation-1502"><span class="linenos">1502</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">T</span>
</span><span id="sparse_label_propagation-1503"><a href="#sparse_label_propagation-1503"><span class="linenos">1503</span></a>                <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</span><span id="sparse_label_propagation-1504"><a href="#sparse_label_propagation-1504"><span class="linenos">1504</span></a>                <span class="n">acc</span> <span class="o">=</span> <span class="n">ssl_accuracy</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">all_labels</span><span class="p">,</span><span class="n">train_ind</span><span class="p">)</span>
</span><span id="sparse_label_propagation-1505"><a href="#sparse_label_propagation-1505"><span class="linenos">1505</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,Accuracy = </span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">acc</span><span class="p">))</span>
</span><span id="sparse_label_propagation-1506"><a href="#sparse_label_propagation-1506"><span class="linenos">1506</span></a> 
</span><span id="sparse_label_propagation-1507"><a href="#sparse_label_propagation-1507"><span class="linenos">1507</span></a>        <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">T</span>
</span></pre></div>


    

                            <div id="sparse_label_propagation.__init__" class="classattr">
                                        <input id="sparse_label_propagation.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">sparse_label_propagation</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">W</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">T</span><span class="o">=</span><span class="mi">100</span></span>)</span>

                <label class="view-source-button" for="sparse_label_propagation.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#sparse_label_propagation.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="sparse_label_propagation.__init__-1429"><a href="#sparse_label_propagation.__init__-1429"><span class="linenos">1429</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
</span><span id="sparse_label_propagation.__init__-1430"><a href="#sparse_label_propagation.__init__-1430"><span class="linenos">1430</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sparse Label Propagation</span>
</span><span id="sparse_label_propagation.__init__-1431"><a href="#sparse_label_propagation.__init__-1431"><span class="linenos">1431</span></a><span class="sd">        ===================</span>
</span><span id="sparse_label_propagation.__init__-1432"><a href="#sparse_label_propagation.__init__-1432"><span class="linenos">1432</span></a>
</span><span id="sparse_label_propagation.__init__-1433"><a href="#sparse_label_propagation.__init__-1433"><span class="linenos">1433</span></a><span class="sd">        Semi-supervised learning via the sparse label propagation method of [1].</span>
</span><span id="sparse_label_propagation.__init__-1434"><a href="#sparse_label_propagation.__init__-1434"><span class="linenos">1434</span></a>
</span><span id="sparse_label_propagation.__init__-1435"><a href="#sparse_label_propagation.__init__-1435"><span class="linenos">1435</span></a><span class="sd">        Parameters</span>
</span><span id="sparse_label_propagation.__init__-1436"><a href="#sparse_label_propagation.__init__-1436"><span class="linenos">1436</span></a><span class="sd">        ----------</span>
</span><span id="sparse_label_propagation.__init__-1437"><a href="#sparse_label_propagation.__init__-1437"><span class="linenos">1437</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="sparse_label_propagation.__init__-1438"><a href="#sparse_label_propagation.__init__-1438"><span class="linenos">1438</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="sparse_label_propagation.__init__-1439"><a href="#sparse_label_propagation.__init__-1439"><span class="linenos">1439</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="sparse_label_propagation.__init__-1440"><a href="#sparse_label_propagation.__init__-1440"><span class="linenos">1440</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="sparse_label_propagation.__init__-1441"><a href="#sparse_label_propagation.__init__-1441"><span class="linenos">1441</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="sparse_label_propagation.__init__-1442"><a href="#sparse_label_propagation.__init__-1442"><span class="linenos">1442</span></a><span class="sd">            nodes in each class.</span>
</span><span id="sparse_label_propagation.__init__-1443"><a href="#sparse_label_propagation.__init__-1443"><span class="linenos">1443</span></a><span class="sd">        T : int (optional), default=100</span>
</span><span id="sparse_label_propagation.__init__-1444"><a href="#sparse_label_propagation.__init__-1444"><span class="linenos">1444</span></a><span class="sd">            Number of iterations</span>
</span><span id="sparse_label_propagation.__init__-1445"><a href="#sparse_label_propagation.__init__-1445"><span class="linenos">1445</span></a>
</span><span id="sparse_label_propagation.__init__-1446"><a href="#sparse_label_propagation.__init__-1446"><span class="linenos">1446</span></a><span class="sd">        References</span>
</span><span id="sparse_label_propagation.__init__-1447"><a href="#sparse_label_propagation.__init__-1447"><span class="linenos">1447</span></a><span class="sd">        ---------</span>
</span><span id="sparse_label_propagation.__init__-1448"><a href="#sparse_label_propagation.__init__-1448"><span class="linenos">1448</span></a><span class="sd">        [1] A. Jung, A.O. Hero III, A. Mara, and S. Jahromi. [Semi-supervised learning via sparse label propagation.](https://arxiv.org/abs/1612.01414) arXiv:1612.01414, 2016.</span>
</span><span id="sparse_label_propagation.__init__-1449"><a href="#sparse_label_propagation.__init__-1449"><span class="linenos">1449</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="sparse_label_propagation.__init__-1450"><a href="#sparse_label_propagation.__init__-1450"><span class="linenos">1450</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="sparse_label_propagation.__init__-1451"><a href="#sparse_label_propagation.__init__-1451"><span class="linenos">1451</span></a>
</span><span id="sparse_label_propagation.__init__-1452"><a href="#sparse_label_propagation.__init__-1452"><span class="linenos">1452</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
</span><span id="sparse_label_propagation.__init__-1453"><a href="#sparse_label_propagation.__init__-1453"><span class="linenos">1453</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_sparse_label_propagation&#39;</span>
</span><span id="sparse_label_propagation.__init__-1454"><a href="#sparse_label_propagation.__init__-1454"><span class="linenos">1454</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Sparse LP&#39;</span>
</span></pre></div>


            <div class="docstring"><h1 id="sparse-label-propagation">Sparse Label Propagation</h1>

<p>Semi-supervised learning via the sparse label propagation method of [1].</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>W</strong> (numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None):
Weight matrix representing the graph.</li>
<li><strong>class_priors</strong> (numpy array (optional), default=None):
Class priors (fraction of data belonging to each class). If provided, the predict function
will attempt to automatic balance the label predictions to predict the correct number of
nodes in each class.</li>
<li><strong>T</strong> (int (optional), default=100):
Number of iterations</li>
</ul>

<h6 id="references">References</h6>

<p>[1] A. Jung, A.O. Hero III, A. Mara, and S. Jahromi. <a href="https://arxiv.org/abs/1612.01414">Semi-supervised learning via sparse label propagation.</a> arXiv:1612.01414, 2016.</p>
</div>


                            </div>
                            <div id="sparse_label_propagation.T" class="classattr">
                                <div class="attr variable">
            <span class="name">T</span>

        
    </div>
    <a class="headerlink" href="#sparse_label_propagation.T"></a>
    
    

                            </div>
                            <div id="sparse_label_propagation.accuracy_filename" class="classattr">
                                <div class="attr variable">
            <span class="name">accuracy_filename</span>

        
    </div>
    <a class="headerlink" href="#sparse_label_propagation.accuracy_filename"></a>
    
    

                            </div>
                            <div id="sparse_label_propagation.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#sparse_label_propagation.name"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#ssl">ssl</a></dt>
                                <dd id="sparse_label_propagation.prob" class="variable"><a href="#ssl.prob">prob</a></dd>
                <dd id="sparse_label_propagation.fitted" class="variable"><a href="#ssl.fitted">fitted</a></dd>
                <dd id="sparse_label_propagation.requires_eig" class="variable"><a href="#ssl.requires_eig">requires_eig</a></dd>
                <dd id="sparse_label_propagation.onevsrest" class="variable"><a href="#ssl.onevsrest">onevsrest</a></dd>
                <dd id="sparse_label_propagation.similarity" class="variable"><a href="#ssl.similarity">similarity</a></dd>
                <dd id="sparse_label_propagation.class_priors" class="variable"><a href="#ssl.class_priors">class_priors</a></dd>
                <dd id="sparse_label_propagation.weights" class="variable"><a href="#ssl.weights">weights</a></dd>
                <dd id="sparse_label_propagation.class_priors_error" class="variable"><a href="#ssl.class_priors_error">class_priors_error</a></dd>
                <dd id="sparse_label_propagation.set_graph" class="function"><a href="#ssl.set_graph">set_graph</a></dd>
                <dd id="sparse_label_propagation.volume_label_projection" class="function"><a href="#ssl.volume_label_projection">volume_label_projection</a></dd>
                <dd id="sparse_label_propagation.get_accuracy_filename" class="function"><a href="#ssl.get_accuracy_filename">get_accuracy_filename</a></dd>
                <dd id="sparse_label_propagation.predict" class="function"><a href="#ssl.predict">predict</a></dd>
                <dd id="sparse_label_propagation.fit_predict" class="function"><a href="#ssl.fit_predict">fit_predict</a></dd>
                <dd id="sparse_label_propagation.ssl_trials" class="function"><a href="#ssl.ssl_trials">ssl_trials</a></dd>
                <dd id="sparse_label_propagation.trials_statistics" class="function"><a href="#ssl.trials_statistics">trials_statistics</a></dd>
                <dd id="sparse_label_propagation.fit" class="function"><a href="#ssl.fit">fit</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="graph_nearest_neighbor">
                            <input id="graph_nearest_neighbor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">graph_nearest_neighbor</span><wbr>(<span class="base"><a href="#ssl">ssl</a></span>):

                <label class="view-source-button" for="graph_nearest_neighbor-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#graph_nearest_neighbor"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="graph_nearest_neighbor-1510"><a href="#graph_nearest_neighbor-1510"><span class="linenos">1510</span></a><span class="k">class</span> <span class="nc">graph_nearest_neighbor</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="graph_nearest_neighbor-1511"><a href="#graph_nearest_neighbor-1511"><span class="linenos">1511</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="graph_nearest_neighbor-1512"><a href="#graph_nearest_neighbor-1512"><span class="linenos">1512</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Graph nearest neighbor classifier</span>
</span><span id="graph_nearest_neighbor-1513"><a href="#graph_nearest_neighbor-1513"><span class="linenos">1513</span></a><span class="sd">        ===================</span>
</span><span id="graph_nearest_neighbor-1514"><a href="#graph_nearest_neighbor-1514"><span class="linenos">1514</span></a>
</span><span id="graph_nearest_neighbor-1515"><a href="#graph_nearest_neighbor-1515"><span class="linenos">1515</span></a><span class="sd">        Semi-supervised learning by graph (geodesic) nearest neighbor classifier. The </span>
</span><span id="graph_nearest_neighbor-1516"><a href="#graph_nearest_neighbor-1516"><span class="linenos">1516</span></a><span class="sd">        graph geodesic distance is defined by</span>
</span><span id="graph_nearest_neighbor-1517"><a href="#graph_nearest_neighbor-1517"><span class="linenos">1517</span></a><span class="sd">        \\[ d_{ij} = \\min_p \\sum_{k=1}^M w_{p_k,p_{k+1}},\\]</span>
</span><span id="graph_nearest_neighbor-1518"><a href="#graph_nearest_neighbor-1518"><span class="linenos">1518</span></a><span class="sd">        where the minimum is over paths \\(p\\) connecting nodes \\(i\\) and \\(j\\). The label</span>
</span><span id="graph_nearest_neighbor-1519"><a href="#graph_nearest_neighbor-1519"><span class="linenos">1519</span></a><span class="sd">        returned for each testing point is the label of the closest labeled point.</span>
</span><span id="graph_nearest_neighbor-1520"><a href="#graph_nearest_neighbor-1520"><span class="linenos">1520</span></a>
</span><span id="graph_nearest_neighbor-1521"><a href="#graph_nearest_neighbor-1521"><span class="linenos">1521</span></a><span class="sd">        Parameters</span>
</span><span id="graph_nearest_neighbor-1522"><a href="#graph_nearest_neighbor-1522"><span class="linenos">1522</span></a><span class="sd">        ----------</span>
</span><span id="graph_nearest_neighbor-1523"><a href="#graph_nearest_neighbor-1523"><span class="linenos">1523</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="graph_nearest_neighbor-1524"><a href="#graph_nearest_neighbor-1524"><span class="linenos">1524</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="graph_nearest_neighbor-1525"><a href="#graph_nearest_neighbor-1525"><span class="linenos">1525</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="graph_nearest_neighbor-1526"><a href="#graph_nearest_neighbor-1526"><span class="linenos">1526</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="graph_nearest_neighbor-1527"><a href="#graph_nearest_neighbor-1527"><span class="linenos">1527</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="graph_nearest_neighbor-1528"><a href="#graph_nearest_neighbor-1528"><span class="linenos">1528</span></a><span class="sd">            nodes in each class.</span>
</span><span id="graph_nearest_neighbor-1529"><a href="#graph_nearest_neighbor-1529"><span class="linenos">1529</span></a><span class="sd">        D : numpy array or scipy sparse matrix (optional)</span>
</span><span id="graph_nearest_neighbor-1530"><a href="#graph_nearest_neighbor-1530"><span class="linenos">1530</span></a><span class="sd">            (n,n) Distance matrix, giving distances between neighbors. If provided,</span>
</span><span id="graph_nearest_neighbor-1531"><a href="#graph_nearest_neighbor-1531"><span class="linenos">1531</span></a><span class="sd">            this is used to construct a knn density estimator for reweighting the eikonal equation.</span>
</span><span id="graph_nearest_neighbor-1532"><a href="#graph_nearest_neighbor-1532"><span class="linenos">1532</span></a><span class="sd">        alpha : float (optional), default=1</span>
</span><span id="graph_nearest_neighbor-1533"><a href="#graph_nearest_neighbor-1533"><span class="linenos">1533</span></a><span class="sd">            Reweighting exponent.</span>
</span><span id="graph_nearest_neighbor-1534"><a href="#graph_nearest_neighbor-1534"><span class="linenos">1534</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="graph_nearest_neighbor-1535"><a href="#graph_nearest_neighbor-1535"><span class="linenos">1535</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="graph_nearest_neighbor-1536"><a href="#graph_nearest_neighbor-1536"><span class="linenos">1536</span></a>
</span><span id="graph_nearest_neighbor-1537"><a href="#graph_nearest_neighbor-1537"><span class="linenos">1537</span></a>
</span><span id="graph_nearest_neighbor-1538"><a href="#graph_nearest_neighbor-1538"><span class="linenos">1538</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="graph_nearest_neighbor-1539"><a href="#graph_nearest_neighbor-1539"><span class="linenos">1539</span></a>
</span><span id="graph_nearest_neighbor-1540"><a href="#graph_nearest_neighbor-1540"><span class="linenos">1540</span></a>        <span class="k">if</span> <span class="n">class_priors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="graph_nearest_neighbor-1541"><a href="#graph_nearest_neighbor-1541"><span class="linenos">1541</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">onevsrest</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="graph_nearest_neighbor-1542"><a href="#graph_nearest_neighbor-1542"><span class="linenos">1542</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">similarity</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="graph_nearest_neighbor-1543"><a href="#graph_nearest_neighbor-1543"><span class="linenos">1543</span></a>
</span><span id="graph_nearest_neighbor-1544"><a href="#graph_nearest_neighbor-1544"><span class="linenos">1544</span></a>        <span class="c1">#Cannot reweight if distance matrix not provided</span>
</span><span id="graph_nearest_neighbor-1545"><a href="#graph_nearest_neighbor-1545"><span class="linenos">1545</span></a>        <span class="k">if</span> <span class="n">D</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="graph_nearest_neighbor-1546"><a href="#graph_nearest_neighbor-1546"><span class="linenos">1546</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="graph_nearest_neighbor-1547"><a href="#graph_nearest_neighbor-1547"><span class="linenos">1547</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="graph_nearest_neighbor-1548"><a href="#graph_nearest_neighbor-1548"><span class="linenos">1548</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="c1">#distance to furtherest neighbor</span>
</span><span id="graph_nearest_neighbor-1549"><a href="#graph_nearest_neighbor-1549"><span class="linenos">1549</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="o">**</span><span class="n">alpha</span>
</span><span id="graph_nearest_neighbor-1550"><a href="#graph_nearest_neighbor-1550"><span class="linenos">1550</span></a>
</span><span id="graph_nearest_neighbor-1551"><a href="#graph_nearest_neighbor-1551"><span class="linenos">1551</span></a>        <span class="c1">#Setup accuracy filename and model name</span>
</span><span id="graph_nearest_neighbor-1552"><a href="#graph_nearest_neighbor-1552"><span class="linenos">1552</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_graph_nearest_neighbor_alpha</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span> 
</span><span id="graph_nearest_neighbor-1553"><a href="#graph_nearest_neighbor-1553"><span class="linenos">1553</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Graph NN (alpha=</span><span class="si">%.2f</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
</span><span id="graph_nearest_neighbor-1554"><a href="#graph_nearest_neighbor-1554"><span class="linenos">1554</span></a>
</span><span id="graph_nearest_neighbor-1555"><a href="#graph_nearest_neighbor-1555"><span class="linenos">1555</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="graph_nearest_neighbor-1556"><a href="#graph_nearest_neighbor-1556"><span class="linenos">1556</span></a>
</span><span id="graph_nearest_neighbor-1557"><a href="#graph_nearest_neighbor-1557"><span class="linenos">1557</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">onevsrest</span><span class="p">:</span>
</span><span id="graph_nearest_neighbor-1558"><a href="#graph_nearest_neighbor-1558"><span class="linenos">1558</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">dijkstra</span><span class="p">(</span><span class="n">train_ind</span><span class="p">[</span><span class="n">train_labels</span><span class="p">],</span> <span class="n">bdy_val</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
</span><span id="graph_nearest_neighbor-1559"><a href="#graph_nearest_neighbor-1559"><span class="linenos">1559</span></a>        <span class="k">else</span><span class="p">:</span> 
</span><span id="graph_nearest_neighbor-1560"><a href="#graph_nearest_neighbor-1560"><span class="linenos">1560</span></a>            <span class="n">_</span><span class="p">,</span><span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">dijkstra</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">bdy_val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">train_ind</span><span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">return_cp</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="graph_nearest_neighbor-1561"><a href="#graph_nearest_neighbor-1561"><span class="linenos">1561</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="graph_nearest_neighbor-1562"><a href="#graph_nearest_neighbor-1562"><span class="linenos">1562</span></a>            <span class="n">u</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_labels</span>
</span><span id="graph_nearest_neighbor-1563"><a href="#graph_nearest_neighbor-1563"><span class="linenos">1563</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">l</span><span class="p">])</span>
</span><span id="graph_nearest_neighbor-1564"><a href="#graph_nearest_neighbor-1564"><span class="linenos">1564</span></a>
</span><span id="graph_nearest_neighbor-1565"><a href="#graph_nearest_neighbor-1565"><span class="linenos">1565</span></a>        <span class="k">return</span> <span class="n">u</span>
</span></pre></div>


    

                            <div id="graph_nearest_neighbor.__init__" class="classattr">
                                        <input id="graph_nearest_neighbor.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">graph_nearest_neighbor</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">W</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">D</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span></span>)</span>

                <label class="view-source-button" for="graph_nearest_neighbor.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#graph_nearest_neighbor.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="graph_nearest_neighbor.__init__-1511"><a href="#graph_nearest_neighbor.__init__-1511"><span class="linenos">1511</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="graph_nearest_neighbor.__init__-1512"><a href="#graph_nearest_neighbor.__init__-1512"><span class="linenos">1512</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Graph nearest neighbor classifier</span>
</span><span id="graph_nearest_neighbor.__init__-1513"><a href="#graph_nearest_neighbor.__init__-1513"><span class="linenos">1513</span></a><span class="sd">        ===================</span>
</span><span id="graph_nearest_neighbor.__init__-1514"><a href="#graph_nearest_neighbor.__init__-1514"><span class="linenos">1514</span></a>
</span><span id="graph_nearest_neighbor.__init__-1515"><a href="#graph_nearest_neighbor.__init__-1515"><span class="linenos">1515</span></a><span class="sd">        Semi-supervised learning by graph (geodesic) nearest neighbor classifier. The </span>
</span><span id="graph_nearest_neighbor.__init__-1516"><a href="#graph_nearest_neighbor.__init__-1516"><span class="linenos">1516</span></a><span class="sd">        graph geodesic distance is defined by</span>
</span><span id="graph_nearest_neighbor.__init__-1517"><a href="#graph_nearest_neighbor.__init__-1517"><span class="linenos">1517</span></a><span class="sd">        \\[ d_{ij} = \\min_p \\sum_{k=1}^M w_{p_k,p_{k+1}},\\]</span>
</span><span id="graph_nearest_neighbor.__init__-1518"><a href="#graph_nearest_neighbor.__init__-1518"><span class="linenos">1518</span></a><span class="sd">        where the minimum is over paths \\(p\\) connecting nodes \\(i\\) and \\(j\\). The label</span>
</span><span id="graph_nearest_neighbor.__init__-1519"><a href="#graph_nearest_neighbor.__init__-1519"><span class="linenos">1519</span></a><span class="sd">        returned for each testing point is the label of the closest labeled point.</span>
</span><span id="graph_nearest_neighbor.__init__-1520"><a href="#graph_nearest_neighbor.__init__-1520"><span class="linenos">1520</span></a>
</span><span id="graph_nearest_neighbor.__init__-1521"><a href="#graph_nearest_neighbor.__init__-1521"><span class="linenos">1521</span></a><span class="sd">        Parameters</span>
</span><span id="graph_nearest_neighbor.__init__-1522"><a href="#graph_nearest_neighbor.__init__-1522"><span class="linenos">1522</span></a><span class="sd">        ----------</span>
</span><span id="graph_nearest_neighbor.__init__-1523"><a href="#graph_nearest_neighbor.__init__-1523"><span class="linenos">1523</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="graph_nearest_neighbor.__init__-1524"><a href="#graph_nearest_neighbor.__init__-1524"><span class="linenos">1524</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="graph_nearest_neighbor.__init__-1525"><a href="#graph_nearest_neighbor.__init__-1525"><span class="linenos">1525</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="graph_nearest_neighbor.__init__-1526"><a href="#graph_nearest_neighbor.__init__-1526"><span class="linenos">1526</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="graph_nearest_neighbor.__init__-1527"><a href="#graph_nearest_neighbor.__init__-1527"><span class="linenos">1527</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="graph_nearest_neighbor.__init__-1528"><a href="#graph_nearest_neighbor.__init__-1528"><span class="linenos">1528</span></a><span class="sd">            nodes in each class.</span>
</span><span id="graph_nearest_neighbor.__init__-1529"><a href="#graph_nearest_neighbor.__init__-1529"><span class="linenos">1529</span></a><span class="sd">        D : numpy array or scipy sparse matrix (optional)</span>
</span><span id="graph_nearest_neighbor.__init__-1530"><a href="#graph_nearest_neighbor.__init__-1530"><span class="linenos">1530</span></a><span class="sd">            (n,n) Distance matrix, giving distances between neighbors. If provided,</span>
</span><span id="graph_nearest_neighbor.__init__-1531"><a href="#graph_nearest_neighbor.__init__-1531"><span class="linenos">1531</span></a><span class="sd">            this is used to construct a knn density estimator for reweighting the eikonal equation.</span>
</span><span id="graph_nearest_neighbor.__init__-1532"><a href="#graph_nearest_neighbor.__init__-1532"><span class="linenos">1532</span></a><span class="sd">        alpha : float (optional), default=1</span>
</span><span id="graph_nearest_neighbor.__init__-1533"><a href="#graph_nearest_neighbor.__init__-1533"><span class="linenos">1533</span></a><span class="sd">            Reweighting exponent.</span>
</span><span id="graph_nearest_neighbor.__init__-1534"><a href="#graph_nearest_neighbor.__init__-1534"><span class="linenos">1534</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="graph_nearest_neighbor.__init__-1535"><a href="#graph_nearest_neighbor.__init__-1535"><span class="linenos">1535</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="graph_nearest_neighbor.__init__-1536"><a href="#graph_nearest_neighbor.__init__-1536"><span class="linenos">1536</span></a>
</span><span id="graph_nearest_neighbor.__init__-1537"><a href="#graph_nearest_neighbor.__init__-1537"><span class="linenos">1537</span></a>
</span><span id="graph_nearest_neighbor.__init__-1538"><a href="#graph_nearest_neighbor.__init__-1538"><span class="linenos">1538</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="graph_nearest_neighbor.__init__-1539"><a href="#graph_nearest_neighbor.__init__-1539"><span class="linenos">1539</span></a>
</span><span id="graph_nearest_neighbor.__init__-1540"><a href="#graph_nearest_neighbor.__init__-1540"><span class="linenos">1540</span></a>        <span class="k">if</span> <span class="n">class_priors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="graph_nearest_neighbor.__init__-1541"><a href="#graph_nearest_neighbor.__init__-1541"><span class="linenos">1541</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">onevsrest</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="graph_nearest_neighbor.__init__-1542"><a href="#graph_nearest_neighbor.__init__-1542"><span class="linenos">1542</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">similarity</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="graph_nearest_neighbor.__init__-1543"><a href="#graph_nearest_neighbor.__init__-1543"><span class="linenos">1543</span></a>
</span><span id="graph_nearest_neighbor.__init__-1544"><a href="#graph_nearest_neighbor.__init__-1544"><span class="linenos">1544</span></a>        <span class="c1">#Cannot reweight if distance matrix not provided</span>
</span><span id="graph_nearest_neighbor.__init__-1545"><a href="#graph_nearest_neighbor.__init__-1545"><span class="linenos">1545</span></a>        <span class="k">if</span> <span class="n">D</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="graph_nearest_neighbor.__init__-1546"><a href="#graph_nearest_neighbor.__init__-1546"><span class="linenos">1546</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="graph_nearest_neighbor.__init__-1547"><a href="#graph_nearest_neighbor.__init__-1547"><span class="linenos">1547</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="graph_nearest_neighbor.__init__-1548"><a href="#graph_nearest_neighbor.__init__-1548"><span class="linenos">1548</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="c1">#distance to furtherest neighbor</span>
</span><span id="graph_nearest_neighbor.__init__-1549"><a href="#graph_nearest_neighbor.__init__-1549"><span class="linenos">1549</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="o">**</span><span class="n">alpha</span>
</span><span id="graph_nearest_neighbor.__init__-1550"><a href="#graph_nearest_neighbor.__init__-1550"><span class="linenos">1550</span></a>
</span><span id="graph_nearest_neighbor.__init__-1551"><a href="#graph_nearest_neighbor.__init__-1551"><span class="linenos">1551</span></a>        <span class="c1">#Setup accuracy filename and model name</span>
</span><span id="graph_nearest_neighbor.__init__-1552"><a href="#graph_nearest_neighbor.__init__-1552"><span class="linenos">1552</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_graph_nearest_neighbor_alpha</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span> 
</span><span id="graph_nearest_neighbor.__init__-1553"><a href="#graph_nearest_neighbor.__init__-1553"><span class="linenos">1553</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Graph NN (alpha=</span><span class="si">%.2f</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h1 id="graph-nearest-neighbor-classifier">Graph nearest neighbor classifier</h1>

<p>Semi-supervised learning by graph (geodesic) nearest neighbor classifier. The 
graph geodesic distance is defined by
[ d_{ij} = \min_p \sum_{k=1}^M w_{p_k,p_{k+1}},]
where the minimum is over paths (p) connecting nodes (i) and (j). The label
returned for each testing point is the label of the closest labeled point.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>W</strong> (numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None):
Weight matrix representing the graph.</li>
<li><strong>class_priors</strong> (numpy array (optional), default=None):
Class priors (fraction of data belonging to each class). If provided, the predict function
will attempt to automatic balance the label predictions to predict the correct number of
nodes in each class.</li>
<li><strong>D</strong> (numpy array or scipy sparse matrix (optional)):
(n,n) Distance matrix, giving distances between neighbors. If provided,
this is used to construct a knn density estimator for reweighting the eikonal equation.</li>
<li><strong>alpha</strong> (float (optional), default=1):
Reweighting exponent.</li>
</ul>
</div>


                            </div>
                            <div id="graph_nearest_neighbor.alpha" class="classattr">
                                <div class="attr variable">
            <span class="name">alpha</span>

        
    </div>
    <a class="headerlink" href="#graph_nearest_neighbor.alpha"></a>
    
    

                            </div>
                            <div id="graph_nearest_neighbor.accuracy_filename" class="classattr">
                                <div class="attr variable">
            <span class="name">accuracy_filename</span>

        
    </div>
    <a class="headerlink" href="#graph_nearest_neighbor.accuracy_filename"></a>
    
    

                            </div>
                            <div id="graph_nearest_neighbor.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#graph_nearest_neighbor.name"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#ssl">ssl</a></dt>
                                <dd id="graph_nearest_neighbor.prob" class="variable"><a href="#ssl.prob">prob</a></dd>
                <dd id="graph_nearest_neighbor.fitted" class="variable"><a href="#ssl.fitted">fitted</a></dd>
                <dd id="graph_nearest_neighbor.requires_eig" class="variable"><a href="#ssl.requires_eig">requires_eig</a></dd>
                <dd id="graph_nearest_neighbor.onevsrest" class="variable"><a href="#ssl.onevsrest">onevsrest</a></dd>
                <dd id="graph_nearest_neighbor.similarity" class="variable"><a href="#ssl.similarity">similarity</a></dd>
                <dd id="graph_nearest_neighbor.class_priors" class="variable"><a href="#ssl.class_priors">class_priors</a></dd>
                <dd id="graph_nearest_neighbor.weights" class="variable"><a href="#ssl.weights">weights</a></dd>
                <dd id="graph_nearest_neighbor.class_priors_error" class="variable"><a href="#ssl.class_priors_error">class_priors_error</a></dd>
                <dd id="graph_nearest_neighbor.set_graph" class="function"><a href="#ssl.set_graph">set_graph</a></dd>
                <dd id="graph_nearest_neighbor.volume_label_projection" class="function"><a href="#ssl.volume_label_projection">volume_label_projection</a></dd>
                <dd id="graph_nearest_neighbor.get_accuracy_filename" class="function"><a href="#ssl.get_accuracy_filename">get_accuracy_filename</a></dd>
                <dd id="graph_nearest_neighbor.predict" class="function"><a href="#ssl.predict">predict</a></dd>
                <dd id="graph_nearest_neighbor.fit_predict" class="function"><a href="#ssl.fit_predict">fit_predict</a></dd>
                <dd id="graph_nearest_neighbor.ssl_trials" class="function"><a href="#ssl.ssl_trials">ssl_trials</a></dd>
                <dd id="graph_nearest_neighbor.trials_statistics" class="function"><a href="#ssl.trials_statistics">trials_statistics</a></dd>
                <dd id="graph_nearest_neighbor.fit" class="function"><a href="#ssl.fit">fit</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="amle">
                            <input id="amle-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">amle</span><wbr>(<span class="base"><a href="#ssl">ssl</a></span>):

                <label class="view-source-button" for="amle-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#amle"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="amle-1567"><a href="#amle-1567"><span class="linenos">1567</span></a><span class="k">class</span> <span class="nc">amle</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="amle-1568"><a href="#amle-1568"><span class="linenos">1568</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">max_num_it</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span> <span class="n">weighted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prog</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="amle-1569"><a href="#amle-1569"><span class="linenos">1569</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;AMLE learning</span>
</span><span id="amle-1570"><a href="#amle-1570"><span class="linenos">1570</span></a><span class="sd">        ===================</span>
</span><span id="amle-1571"><a href="#amle-1571"><span class="linenos">1571</span></a>
</span><span id="amle-1572"><a href="#amle-1572"><span class="linenos">1572</span></a><span class="sd">        Semi-supervised learning by the Absolutely Minimal Lipschitz Extension (AMLE). This is the same as</span>
</span><span id="amle-1573"><a href="#amle-1573"><span class="linenos">1573</span></a><span class="sd">        p-Laplace with \\(p=\\infty\\), except that AMLE has an option `weighted=False` that significantly </span>
</span><span id="amle-1574"><a href="#amle-1574"><span class="linenos">1574</span></a><span class="sd">        accelerates the solver.</span>
</span><span id="amle-1575"><a href="#amle-1575"><span class="linenos">1575</span></a>
</span><span id="amle-1576"><a href="#amle-1576"><span class="linenos">1576</span></a><span class="sd">        Parameters</span>
</span><span id="amle-1577"><a href="#amle-1577"><span class="linenos">1577</span></a><span class="sd">        ----------</span>
</span><span id="amle-1578"><a href="#amle-1578"><span class="linenos">1578</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="amle-1579"><a href="#amle-1579"><span class="linenos">1579</span></a><span class="sd">            (n,n) Weight matrix representing the graph.</span>
</span><span id="amle-1580"><a href="#amle-1580"><span class="linenos">1580</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="amle-1581"><a href="#amle-1581"><span class="linenos">1581</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="amle-1582"><a href="#amle-1582"><span class="linenos">1582</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="amle-1583"><a href="#amle-1583"><span class="linenos">1583</span></a><span class="sd">            nodes in each class.</span>
</span><span id="amle-1584"><a href="#amle-1584"><span class="linenos">1584</span></a><span class="sd">        tol : float (optional), default=1e-3</span>
</span><span id="amle-1585"><a href="#amle-1585"><span class="linenos">1585</span></a><span class="sd">            Tolerance with which to solve the equation.</span>
</span><span id="amle-1586"><a href="#amle-1586"><span class="linenos">1586</span></a><span class="sd">        max_num_it : int (optional), default=1e5</span>
</span><span id="amle-1587"><a href="#amle-1587"><span class="linenos">1587</span></a><span class="sd">            Maximum number of iterations</span>
</span><span id="amle-1588"><a href="#amle-1588"><span class="linenos">1588</span></a><span class="sd">        weighted : bool (optional), default=False</span>
</span><span id="amle-1589"><a href="#amle-1589"><span class="linenos">1589</span></a><span class="sd">            When False, the graph is converted to a 0/1 adjacency matrix, which affords a much faster solver.</span>
</span><span id="amle-1590"><a href="#amle-1590"><span class="linenos">1590</span></a><span class="sd">        prog : bool (optional), default=False</span>
</span><span id="amle-1591"><a href="#amle-1591"><span class="linenos">1591</span></a><span class="sd">            Whether to print progress information.</span>
</span><span id="amle-1592"><a href="#amle-1592"><span class="linenos">1592</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="amle-1593"><a href="#amle-1593"><span class="linenos">1593</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="amle-1594"><a href="#amle-1594"><span class="linenos">1594</span></a>
</span><span id="amle-1595"><a href="#amle-1595"><span class="linenos">1595</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span>
</span><span id="amle-1596"><a href="#amle-1596"><span class="linenos">1596</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_num_it</span> <span class="o">=</span> <span class="n">max_num_it</span>
</span><span id="amle-1597"><a href="#amle-1597"><span class="linenos">1597</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">weighted</span> <span class="o">=</span> <span class="n">weighted</span>
</span><span id="amle-1598"><a href="#amle-1598"><span class="linenos">1598</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prog</span> <span class="o">=</span> <span class="n">prog</span>
</span><span id="amle-1599"><a href="#amle-1599"><span class="linenos">1599</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onevsrest</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="amle-1600"><a href="#amle-1600"><span class="linenos">1600</span></a>
</span><span id="amle-1601"><a href="#amle-1601"><span class="linenos">1601</span></a>        <span class="c1">#Setup accuracy filename and model name</span>
</span><span id="amle-1602"><a href="#amle-1602"><span class="linenos">1602</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_amle&#39;</span>
</span><span id="amle-1603"><a href="#amle-1603"><span class="linenos">1603</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">weighted</span><span class="p">:</span>
</span><span id="amle-1604"><a href="#amle-1604"><span class="linenos">1604</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">+=</span> <span class="s1">&#39;_unweighted&#39;</span>
</span><span id="amle-1605"><a href="#amle-1605"><span class="linenos">1605</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;AMLE&#39;</span>
</span><span id="amle-1606"><a href="#amle-1606"><span class="linenos">1606</span></a>
</span><span id="amle-1607"><a href="#amle-1607"><span class="linenos">1607</span></a>
</span><span id="amle-1608"><a href="#amle-1608"><span class="linenos">1608</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="amle-1609"><a href="#amle-1609"><span class="linenos">1609</span></a>
</span><span id="amle-1610"><a href="#amle-1610"><span class="linenos">1610</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">amle</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tol</span><span class="p">,</span> <span class="n">max_num_it</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_num_it</span><span class="p">,</span> 
</span><span id="amle-1611"><a href="#amle-1611"><span class="linenos">1611</span></a>                                                     <span class="n">weighted</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weighted</span><span class="p">,</span> <span class="n">prog</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="p">)</span>
</span><span id="amle-1612"><a href="#amle-1612"><span class="linenos">1612</span></a>        <span class="k">return</span> <span class="n">u</span>
</span></pre></div>


    

                            <div id="amle.__init__" class="classattr">
                                        <input id="amle.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">amle</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">W</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">tol</span><span class="o">=</span><span class="mf">0.001</span>,</span><span class="param">	<span class="n">max_num_it</span><span class="o">=</span><span class="mf">100000.0</span>,</span><span class="param">	<span class="n">weighted</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">prog</span><span class="o">=</span><span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="amle.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#amle.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="amle.__init__-1568"><a href="#amle.__init__-1568"><span class="linenos">1568</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">max_num_it</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span> <span class="n">weighted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prog</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="amle.__init__-1569"><a href="#amle.__init__-1569"><span class="linenos">1569</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;AMLE learning</span>
</span><span id="amle.__init__-1570"><a href="#amle.__init__-1570"><span class="linenos">1570</span></a><span class="sd">        ===================</span>
</span><span id="amle.__init__-1571"><a href="#amle.__init__-1571"><span class="linenos">1571</span></a>
</span><span id="amle.__init__-1572"><a href="#amle.__init__-1572"><span class="linenos">1572</span></a><span class="sd">        Semi-supervised learning by the Absolutely Minimal Lipschitz Extension (AMLE). This is the same as</span>
</span><span id="amle.__init__-1573"><a href="#amle.__init__-1573"><span class="linenos">1573</span></a><span class="sd">        p-Laplace with \\(p=\\infty\\), except that AMLE has an option `weighted=False` that significantly </span>
</span><span id="amle.__init__-1574"><a href="#amle.__init__-1574"><span class="linenos">1574</span></a><span class="sd">        accelerates the solver.</span>
</span><span id="amle.__init__-1575"><a href="#amle.__init__-1575"><span class="linenos">1575</span></a>
</span><span id="amle.__init__-1576"><a href="#amle.__init__-1576"><span class="linenos">1576</span></a><span class="sd">        Parameters</span>
</span><span id="amle.__init__-1577"><a href="#amle.__init__-1577"><span class="linenos">1577</span></a><span class="sd">        ----------</span>
</span><span id="amle.__init__-1578"><a href="#amle.__init__-1578"><span class="linenos">1578</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="amle.__init__-1579"><a href="#amle.__init__-1579"><span class="linenos">1579</span></a><span class="sd">            (n,n) Weight matrix representing the graph.</span>
</span><span id="amle.__init__-1580"><a href="#amle.__init__-1580"><span class="linenos">1580</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="amle.__init__-1581"><a href="#amle.__init__-1581"><span class="linenos">1581</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="amle.__init__-1582"><a href="#amle.__init__-1582"><span class="linenos">1582</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="amle.__init__-1583"><a href="#amle.__init__-1583"><span class="linenos">1583</span></a><span class="sd">            nodes in each class.</span>
</span><span id="amle.__init__-1584"><a href="#amle.__init__-1584"><span class="linenos">1584</span></a><span class="sd">        tol : float (optional), default=1e-3</span>
</span><span id="amle.__init__-1585"><a href="#amle.__init__-1585"><span class="linenos">1585</span></a><span class="sd">            Tolerance with which to solve the equation.</span>
</span><span id="amle.__init__-1586"><a href="#amle.__init__-1586"><span class="linenos">1586</span></a><span class="sd">        max_num_it : int (optional), default=1e5</span>
</span><span id="amle.__init__-1587"><a href="#amle.__init__-1587"><span class="linenos">1587</span></a><span class="sd">            Maximum number of iterations</span>
</span><span id="amle.__init__-1588"><a href="#amle.__init__-1588"><span class="linenos">1588</span></a><span class="sd">        weighted : bool (optional), default=False</span>
</span><span id="amle.__init__-1589"><a href="#amle.__init__-1589"><span class="linenos">1589</span></a><span class="sd">            When False, the graph is converted to a 0/1 adjacency matrix, which affords a much faster solver.</span>
</span><span id="amle.__init__-1590"><a href="#amle.__init__-1590"><span class="linenos">1590</span></a><span class="sd">        prog : bool (optional), default=False</span>
</span><span id="amle.__init__-1591"><a href="#amle.__init__-1591"><span class="linenos">1591</span></a><span class="sd">            Whether to print progress information.</span>
</span><span id="amle.__init__-1592"><a href="#amle.__init__-1592"><span class="linenos">1592</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="amle.__init__-1593"><a href="#amle.__init__-1593"><span class="linenos">1593</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="amle.__init__-1594"><a href="#amle.__init__-1594"><span class="linenos">1594</span></a>
</span><span id="amle.__init__-1595"><a href="#amle.__init__-1595"><span class="linenos">1595</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span>
</span><span id="amle.__init__-1596"><a href="#amle.__init__-1596"><span class="linenos">1596</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_num_it</span> <span class="o">=</span> <span class="n">max_num_it</span>
</span><span id="amle.__init__-1597"><a href="#amle.__init__-1597"><span class="linenos">1597</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">weighted</span> <span class="o">=</span> <span class="n">weighted</span>
</span><span id="amle.__init__-1598"><a href="#amle.__init__-1598"><span class="linenos">1598</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prog</span> <span class="o">=</span> <span class="n">prog</span>
</span><span id="amle.__init__-1599"><a href="#amle.__init__-1599"><span class="linenos">1599</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onevsrest</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="amle.__init__-1600"><a href="#amle.__init__-1600"><span class="linenos">1600</span></a>
</span><span id="amle.__init__-1601"><a href="#amle.__init__-1601"><span class="linenos">1601</span></a>        <span class="c1">#Setup accuracy filename and model name</span>
</span><span id="amle.__init__-1602"><a href="#amle.__init__-1602"><span class="linenos">1602</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_amle&#39;</span>
</span><span id="amle.__init__-1603"><a href="#amle.__init__-1603"><span class="linenos">1603</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">weighted</span><span class="p">:</span>
</span><span id="amle.__init__-1604"><a href="#amle.__init__-1604"><span class="linenos">1604</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">+=</span> <span class="s1">&#39;_unweighted&#39;</span>
</span><span id="amle.__init__-1605"><a href="#amle.__init__-1605"><span class="linenos">1605</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;AMLE&#39;</span>
</span></pre></div>


            <div class="docstring"><h1 id="amle-learning">AMLE learning</h1>

<p>Semi-supervised learning by the Absolutely Minimal Lipschitz Extension (AMLE). This is the same as
p-Laplace with (p=\infty), except that AMLE has an option <code>weighted=False</code> that significantly 
accelerates the solver.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>W</strong> (numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None):
(n,n) Weight matrix representing the graph.</li>
<li><strong>class_priors</strong> (numpy array (optional), default=None):
Class priors (fraction of data belonging to each class). If provided, the predict function
will attempt to automatic balance the label predictions to predict the correct number of
nodes in each class.</li>
<li><strong>tol</strong> (float (optional), default=1e-3):
Tolerance with which to solve the equation.</li>
<li><strong>max_num_it</strong> (int (optional), default=1e5):
Maximum number of iterations</li>
<li><strong>weighted</strong> (bool (optional), default=False):
When False, the graph is converted to a 0/1 adjacency matrix, which affords a much faster solver.</li>
<li><strong>prog</strong> (bool (optional), default=False):
Whether to print progress information.</li>
</ul>
</div>


                            </div>
                            <div id="amle.tol" class="classattr">
                                <div class="attr variable">
            <span class="name">tol</span>

        
    </div>
    <a class="headerlink" href="#amle.tol"></a>
    
    

                            </div>
                            <div id="amle.max_num_it" class="classattr">
                                <div class="attr variable">
            <span class="name">max_num_it</span>

        
    </div>
    <a class="headerlink" href="#amle.max_num_it"></a>
    
    

                            </div>
                            <div id="amle.weighted" class="classattr">
                                <div class="attr variable">
            <span class="name">weighted</span>

        
    </div>
    <a class="headerlink" href="#amle.weighted"></a>
    
    

                            </div>
                            <div id="amle.prog" class="classattr">
                                <div class="attr variable">
            <span class="name">prog</span>

        
    </div>
    <a class="headerlink" href="#amle.prog"></a>
    
    

                            </div>
                            <div id="amle.onevsrest" class="classattr">
                                <div class="attr variable">
            <span class="name">onevsrest</span>

        
    </div>
    <a class="headerlink" href="#amle.onevsrest"></a>
    
    

                            </div>
                            <div id="amle.accuracy_filename" class="classattr">
                                <div class="attr variable">
            <span class="name">accuracy_filename</span>

        
    </div>
    <a class="headerlink" href="#amle.accuracy_filename"></a>
    
    

                            </div>
                            <div id="amle.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#amle.name"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#ssl">ssl</a></dt>
                                <dd id="amle.prob" class="variable"><a href="#ssl.prob">prob</a></dd>
                <dd id="amle.fitted" class="variable"><a href="#ssl.fitted">fitted</a></dd>
                <dd id="amle.requires_eig" class="variable"><a href="#ssl.requires_eig">requires_eig</a></dd>
                <dd id="amle.similarity" class="variable"><a href="#ssl.similarity">similarity</a></dd>
                <dd id="amle.class_priors" class="variable"><a href="#ssl.class_priors">class_priors</a></dd>
                <dd id="amle.weights" class="variable"><a href="#ssl.weights">weights</a></dd>
                <dd id="amle.class_priors_error" class="variable"><a href="#ssl.class_priors_error">class_priors_error</a></dd>
                <dd id="amle.set_graph" class="function"><a href="#ssl.set_graph">set_graph</a></dd>
                <dd id="amle.volume_label_projection" class="function"><a href="#ssl.volume_label_projection">volume_label_projection</a></dd>
                <dd id="amle.get_accuracy_filename" class="function"><a href="#ssl.get_accuracy_filename">get_accuracy_filename</a></dd>
                <dd id="amle.predict" class="function"><a href="#ssl.predict">predict</a></dd>
                <dd id="amle.fit_predict" class="function"><a href="#ssl.fit_predict">fit_predict</a></dd>
                <dd id="amle.ssl_trials" class="function"><a href="#ssl.ssl_trials">ssl_trials</a></dd>
                <dd id="amle.trials_statistics" class="function"><a href="#ssl.trials_statistics">trials_statistics</a></dd>
                <dd id="amle.fit" class="function"><a href="#ssl.fit">fit</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="peikonal">
                            <input id="peikonal-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">peikonal</span><wbr>(<span class="base"><a href="#ssl">ssl</a></span>):

                <label class="view-source-button" for="peikonal-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#peikonal"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="peikonal-1614"><a href="#peikonal-1614"><span class="linenos">1614</span></a><span class="k">class</span> <span class="nc">peikonal</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="peikonal-1615"><a href="#peikonal-1615"><span class="linenos">1615</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_num_it</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">num_bisection_it</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">eps_ball_graph</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="peikonal-1616"><a href="#peikonal-1616"><span class="linenos">1616</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Graph p-eikonal classifier</span>
</span><span id="peikonal-1617"><a href="#peikonal-1617"><span class="linenos">1617</span></a><span class="sd">        ===================</span>
</span><span id="peikonal-1618"><a href="#peikonal-1618"><span class="linenos">1618</span></a>
</span><span id="peikonal-1619"><a href="#peikonal-1619"><span class="linenos">1619</span></a><span class="sd">        Semi-supervised learning by via the solution of the graph `graph.peikonal` equation.</span>
</span><span id="peikonal-1620"><a href="#peikonal-1620"><span class="linenos">1620</span></a>
</span><span id="peikonal-1621"><a href="#peikonal-1621"><span class="linenos">1621</span></a><span class="sd">        Parameters</span>
</span><span id="peikonal-1622"><a href="#peikonal-1622"><span class="linenos">1622</span></a><span class="sd">        ----------</span>
</span><span id="peikonal-1623"><a href="#peikonal-1623"><span class="linenos">1623</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="peikonal-1624"><a href="#peikonal-1624"><span class="linenos">1624</span></a><span class="sd">            (n,n) Weight matrix representing the graph.</span>
</span><span id="peikonal-1625"><a href="#peikonal-1625"><span class="linenos">1625</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="peikonal-1626"><a href="#peikonal-1626"><span class="linenos">1626</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="peikonal-1627"><a href="#peikonal-1627"><span class="linenos">1627</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="peikonal-1628"><a href="#peikonal-1628"><span class="linenos">1628</span></a><span class="sd">            nodes in each class.</span>
</span><span id="peikonal-1629"><a href="#peikonal-1629"><span class="linenos">1629</span></a><span class="sd">        D : numpy array or scipy sparse matrix (optional)</span>
</span><span id="peikonal-1630"><a href="#peikonal-1630"><span class="linenos">1630</span></a><span class="sd">            (n,n) Distance matrix, giving distances between neighbors. If provided,</span>
</span><span id="peikonal-1631"><a href="#peikonal-1631"><span class="linenos">1631</span></a><span class="sd">            this is used to construct a knn density estimator for reweighting the p-eikonal equation.</span>
</span><span id="peikonal-1632"><a href="#peikonal-1632"><span class="linenos">1632</span></a><span class="sd">        p : float (optional), default=1</span>
</span><span id="peikonal-1633"><a href="#peikonal-1633"><span class="linenos">1633</span></a><span class="sd">            Value of exponent p in the p-eikonal equation</span>
</span><span id="peikonal-1634"><a href="#peikonal-1634"><span class="linenos">1634</span></a><span class="sd">        alpha : float (optional), default=1</span>
</span><span id="peikonal-1635"><a href="#peikonal-1635"><span class="linenos">1635</span></a><span class="sd">            Reweighting exponent.</span>
</span><span id="peikonal-1636"><a href="#peikonal-1636"><span class="linenos">1636</span></a><span class="sd">        max_num_it : int (optional), default=1e5</span>
</span><span id="peikonal-1637"><a href="#peikonal-1637"><span class="linenos">1637</span></a><span class="sd">            Maximum number of iterations.</span>
</span><span id="peikonal-1638"><a href="#peikonal-1638"><span class="linenos">1638</span></a><span class="sd">        tol : float (optional), default=1e-3</span>
</span><span id="peikonal-1639"><a href="#peikonal-1639"><span class="linenos">1639</span></a><span class="sd">            Tolerance with which to solve the equation.</span>
</span><span id="peikonal-1640"><a href="#peikonal-1640"><span class="linenos">1640</span></a><span class="sd">        num_bisection_it : int (optional), default=30</span>
</span><span id="peikonal-1641"><a href="#peikonal-1641"><span class="linenos">1641</span></a><span class="sd">            Number of bisection iterations for solver.</span>
</span><span id="peikonal-1642"><a href="#peikonal-1642"><span class="linenos">1642</span></a><span class="sd">        eps_ball_graph : bool (optional), default=False</span>
</span><span id="peikonal-1643"><a href="#peikonal-1643"><span class="linenos">1643</span></a><span class="sd">            Whether the graph is an epsilon-ball graph or not. If it is, then the density reweighting</span>
</span><span id="peikonal-1644"><a href="#peikonal-1644"><span class="linenos">1644</span></a><span class="sd">            will be done with the degree vector, which is a kernel density estimator in this case</span>
</span><span id="peikonal-1645"><a href="#peikonal-1645"><span class="linenos">1645</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="peikonal-1646"><a href="#peikonal-1646"><span class="linenos">1646</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="peikonal-1647"><a href="#peikonal-1647"><span class="linenos">1647</span></a>
</span><span id="peikonal-1648"><a href="#peikonal-1648"><span class="linenos">1648</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="peikonal-1649"><a href="#peikonal-1649"><span class="linenos">1649</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="peikonal-1650"><a href="#peikonal-1650"><span class="linenos">1650</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_num_it</span> <span class="o">=</span> <span class="n">max_num_it</span>
</span><span id="peikonal-1651"><a href="#peikonal-1651"><span class="linenos">1651</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span>
</span><span id="peikonal-1652"><a href="#peikonal-1652"><span class="linenos">1652</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_bisection_it</span> <span class="o">=</span> <span class="n">num_bisection_it</span>
</span><span id="peikonal-1653"><a href="#peikonal-1653"><span class="linenos">1653</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onevsrest</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="peikonal-1654"><a href="#peikonal-1654"><span class="linenos">1654</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">similarity</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="peikonal-1655"><a href="#peikonal-1655"><span class="linenos">1655</span></a>
</span><span id="peikonal-1656"><a href="#peikonal-1656"><span class="linenos">1656</span></a>        <span class="c1">#Cannot reweight if distance matrix not provided</span>
</span><span id="peikonal-1657"><a href="#peikonal-1657"><span class="linenos">1657</span></a>        <span class="k">if</span> <span class="n">D</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="peikonal-1658"><a href="#peikonal-1658"><span class="linenos">1658</span></a>            <span class="k">if</span> <span class="n">eps_ball_graph</span><span class="p">:</span>
</span><span id="peikonal-1659"><a href="#peikonal-1659"><span class="linenos">1659</span></a>                <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">degree_vector</span><span class="p">()</span>
</span><span id="peikonal-1660"><a href="#peikonal-1660"><span class="linenos">1660</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span>
</span><span id="peikonal-1661"><a href="#peikonal-1661"><span class="linenos">1661</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="peikonal-1662"><a href="#peikonal-1662"><span class="linenos">1662</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="peikonal-1663"><a href="#peikonal-1663"><span class="linenos">1663</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="peikonal-1664"><a href="#peikonal-1664"><span class="linenos">1664</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="c1">#distance to furtherest neighbor</span>
</span><span id="peikonal-1665"><a href="#peikonal-1665"><span class="linenos">1665</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="o">**</span><span class="n">alpha</span>
</span><span id="peikonal-1666"><a href="#peikonal-1666"><span class="linenos">1666</span></a>
</span><span id="peikonal-1667"><a href="#peikonal-1667"><span class="linenos">1667</span></a>        <span class="c1">#Setup accuracy filename and model name</span>
</span><span id="peikonal-1668"><a href="#peikonal-1668"><span class="linenos">1668</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_peikonal_p</span><span class="si">%.2f</span><span class="s1">_alpha</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span> 
</span><span id="peikonal-1669"><a href="#peikonal-1669"><span class="linenos">1669</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;p-eikonal (p=</span><span class="si">%.2f</span><span class="s1">, alpha=</span><span class="si">%.2f</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
</span><span id="peikonal-1670"><a href="#peikonal-1670"><span class="linenos">1670</span></a>
</span><span id="peikonal-1671"><a href="#peikonal-1671"><span class="linenos">1671</span></a>
</span><span id="peikonal-1672"><a href="#peikonal-1672"><span class="linenos">1672</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="peikonal-1673"><a href="#peikonal-1673"><span class="linenos">1673</span></a>
</span><span id="peikonal-1674"><a href="#peikonal-1674"><span class="linenos">1674</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">peikonal</span><span class="p">(</span><span class="n">train_ind</span><span class="p">[</span><span class="n">train_labels</span><span class="p">],</span> <span class="n">bdy_val</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">max_num_it</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_num_it</span><span class="p">,</span> 
</span><span id="peikonal-1675"><a href="#peikonal-1675"><span class="linenos">1675</span></a>                                                <span class="n">tol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tol</span><span class="p">,</span> <span class="n">num_bisection_it</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_bisection_it</span><span class="p">,</span> <span class="n">prog</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="peikonal-1676"><a href="#peikonal-1676"><span class="linenos">1676</span></a>        <span class="k">return</span> <span class="n">u</span>
</span></pre></div>


    

                            <div id="peikonal.__init__" class="classattr">
                                        <input id="peikonal.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">peikonal</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">W</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">D</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">p</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">alpha</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">max_num_it</span><span class="o">=</span><span class="mf">100000.0</span>,</span><span class="param">	<span class="n">tol</span><span class="o">=</span><span class="mf">0.001</span>,</span><span class="param">	<span class="n">num_bisection_it</span><span class="o">=</span><span class="mi">30</span>,</span><span class="param">	<span class="n">eps_ball_graph</span><span class="o">=</span><span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="peikonal.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#peikonal.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="peikonal.__init__-1615"><a href="#peikonal.__init__-1615"><span class="linenos">1615</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_num_it</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">num_bisection_it</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">eps_ball_graph</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="peikonal.__init__-1616"><a href="#peikonal.__init__-1616"><span class="linenos">1616</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Graph p-eikonal classifier</span>
</span><span id="peikonal.__init__-1617"><a href="#peikonal.__init__-1617"><span class="linenos">1617</span></a><span class="sd">        ===================</span>
</span><span id="peikonal.__init__-1618"><a href="#peikonal.__init__-1618"><span class="linenos">1618</span></a>
</span><span id="peikonal.__init__-1619"><a href="#peikonal.__init__-1619"><span class="linenos">1619</span></a><span class="sd">        Semi-supervised learning by via the solution of the graph `graph.peikonal` equation.</span>
</span><span id="peikonal.__init__-1620"><a href="#peikonal.__init__-1620"><span class="linenos">1620</span></a>
</span><span id="peikonal.__init__-1621"><a href="#peikonal.__init__-1621"><span class="linenos">1621</span></a><span class="sd">        Parameters</span>
</span><span id="peikonal.__init__-1622"><a href="#peikonal.__init__-1622"><span class="linenos">1622</span></a><span class="sd">        ----------</span>
</span><span id="peikonal.__init__-1623"><a href="#peikonal.__init__-1623"><span class="linenos">1623</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="peikonal.__init__-1624"><a href="#peikonal.__init__-1624"><span class="linenos">1624</span></a><span class="sd">            (n,n) Weight matrix representing the graph.</span>
</span><span id="peikonal.__init__-1625"><a href="#peikonal.__init__-1625"><span class="linenos">1625</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="peikonal.__init__-1626"><a href="#peikonal.__init__-1626"><span class="linenos">1626</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="peikonal.__init__-1627"><a href="#peikonal.__init__-1627"><span class="linenos">1627</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="peikonal.__init__-1628"><a href="#peikonal.__init__-1628"><span class="linenos">1628</span></a><span class="sd">            nodes in each class.</span>
</span><span id="peikonal.__init__-1629"><a href="#peikonal.__init__-1629"><span class="linenos">1629</span></a><span class="sd">        D : numpy array or scipy sparse matrix (optional)</span>
</span><span id="peikonal.__init__-1630"><a href="#peikonal.__init__-1630"><span class="linenos">1630</span></a><span class="sd">            (n,n) Distance matrix, giving distances between neighbors. If provided,</span>
</span><span id="peikonal.__init__-1631"><a href="#peikonal.__init__-1631"><span class="linenos">1631</span></a><span class="sd">            this is used to construct a knn density estimator for reweighting the p-eikonal equation.</span>
</span><span id="peikonal.__init__-1632"><a href="#peikonal.__init__-1632"><span class="linenos">1632</span></a><span class="sd">        p : float (optional), default=1</span>
</span><span id="peikonal.__init__-1633"><a href="#peikonal.__init__-1633"><span class="linenos">1633</span></a><span class="sd">            Value of exponent p in the p-eikonal equation</span>
</span><span id="peikonal.__init__-1634"><a href="#peikonal.__init__-1634"><span class="linenos">1634</span></a><span class="sd">        alpha : float (optional), default=1</span>
</span><span id="peikonal.__init__-1635"><a href="#peikonal.__init__-1635"><span class="linenos">1635</span></a><span class="sd">            Reweighting exponent.</span>
</span><span id="peikonal.__init__-1636"><a href="#peikonal.__init__-1636"><span class="linenos">1636</span></a><span class="sd">        max_num_it : int (optional), default=1e5</span>
</span><span id="peikonal.__init__-1637"><a href="#peikonal.__init__-1637"><span class="linenos">1637</span></a><span class="sd">            Maximum number of iterations.</span>
</span><span id="peikonal.__init__-1638"><a href="#peikonal.__init__-1638"><span class="linenos">1638</span></a><span class="sd">        tol : float (optional), default=1e-3</span>
</span><span id="peikonal.__init__-1639"><a href="#peikonal.__init__-1639"><span class="linenos">1639</span></a><span class="sd">            Tolerance with which to solve the equation.</span>
</span><span id="peikonal.__init__-1640"><a href="#peikonal.__init__-1640"><span class="linenos">1640</span></a><span class="sd">        num_bisection_it : int (optional), default=30</span>
</span><span id="peikonal.__init__-1641"><a href="#peikonal.__init__-1641"><span class="linenos">1641</span></a><span class="sd">            Number of bisection iterations for solver.</span>
</span><span id="peikonal.__init__-1642"><a href="#peikonal.__init__-1642"><span class="linenos">1642</span></a><span class="sd">        eps_ball_graph : bool (optional), default=False</span>
</span><span id="peikonal.__init__-1643"><a href="#peikonal.__init__-1643"><span class="linenos">1643</span></a><span class="sd">            Whether the graph is an epsilon-ball graph or not. If it is, then the density reweighting</span>
</span><span id="peikonal.__init__-1644"><a href="#peikonal.__init__-1644"><span class="linenos">1644</span></a><span class="sd">            will be done with the degree vector, which is a kernel density estimator in this case</span>
</span><span id="peikonal.__init__-1645"><a href="#peikonal.__init__-1645"><span class="linenos">1645</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="peikonal.__init__-1646"><a href="#peikonal.__init__-1646"><span class="linenos">1646</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="peikonal.__init__-1647"><a href="#peikonal.__init__-1647"><span class="linenos">1647</span></a>
</span><span id="peikonal.__init__-1648"><a href="#peikonal.__init__-1648"><span class="linenos">1648</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="peikonal.__init__-1649"><a href="#peikonal.__init__-1649"><span class="linenos">1649</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="peikonal.__init__-1650"><a href="#peikonal.__init__-1650"><span class="linenos">1650</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_num_it</span> <span class="o">=</span> <span class="n">max_num_it</span>
</span><span id="peikonal.__init__-1651"><a href="#peikonal.__init__-1651"><span class="linenos">1651</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span>
</span><span id="peikonal.__init__-1652"><a href="#peikonal.__init__-1652"><span class="linenos">1652</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_bisection_it</span> <span class="o">=</span> <span class="n">num_bisection_it</span>
</span><span id="peikonal.__init__-1653"><a href="#peikonal.__init__-1653"><span class="linenos">1653</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onevsrest</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="peikonal.__init__-1654"><a href="#peikonal.__init__-1654"><span class="linenos">1654</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">similarity</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="peikonal.__init__-1655"><a href="#peikonal.__init__-1655"><span class="linenos">1655</span></a>
</span><span id="peikonal.__init__-1656"><a href="#peikonal.__init__-1656"><span class="linenos">1656</span></a>        <span class="c1">#Cannot reweight if distance matrix not provided</span>
</span><span id="peikonal.__init__-1657"><a href="#peikonal.__init__-1657"><span class="linenos">1657</span></a>        <span class="k">if</span> <span class="n">D</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="peikonal.__init__-1658"><a href="#peikonal.__init__-1658"><span class="linenos">1658</span></a>            <span class="k">if</span> <span class="n">eps_ball_graph</span><span class="p">:</span>
</span><span id="peikonal.__init__-1659"><a href="#peikonal.__init__-1659"><span class="linenos">1659</span></a>                <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">degree_vector</span><span class="p">()</span>
</span><span id="peikonal.__init__-1660"><a href="#peikonal.__init__-1660"><span class="linenos">1660</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span>
</span><span id="peikonal.__init__-1661"><a href="#peikonal.__init__-1661"><span class="linenos">1661</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="peikonal.__init__-1662"><a href="#peikonal.__init__-1662"><span class="linenos">1662</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="peikonal.__init__-1663"><a href="#peikonal.__init__-1663"><span class="linenos">1663</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="peikonal.__init__-1664"><a href="#peikonal.__init__-1664"><span class="linenos">1664</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="c1">#distance to furtherest neighbor</span>
</span><span id="peikonal.__init__-1665"><a href="#peikonal.__init__-1665"><span class="linenos">1665</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="o">**</span><span class="n">alpha</span>
</span><span id="peikonal.__init__-1666"><a href="#peikonal.__init__-1666"><span class="linenos">1666</span></a>
</span><span id="peikonal.__init__-1667"><a href="#peikonal.__init__-1667"><span class="linenos">1667</span></a>        <span class="c1">#Setup accuracy filename and model name</span>
</span><span id="peikonal.__init__-1668"><a href="#peikonal.__init__-1668"><span class="linenos">1668</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_peikonal_p</span><span class="si">%.2f</span><span class="s1">_alpha</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span> 
</span><span id="peikonal.__init__-1669"><a href="#peikonal.__init__-1669"><span class="linenos">1669</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;p-eikonal (p=</span><span class="si">%.2f</span><span class="s1">, alpha=</span><span class="si">%.2f</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h1 id="graph-p-eikonal-classifier">Graph p-eikonal classifier</h1>

<p>Semi-supervised learning by via the solution of the graph <code>graph.peikonal</code> equation.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>W</strong> (numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None):
(n,n) Weight matrix representing the graph.</li>
<li><strong>class_priors</strong> (numpy array (optional), default=None):
Class priors (fraction of data belonging to each class). If provided, the predict function
will attempt to automatic balance the label predictions to predict the correct number of
nodes in each class.</li>
<li><strong>D</strong> (numpy array or scipy sparse matrix (optional)):
(n,n) Distance matrix, giving distances between neighbors. If provided,
this is used to construct a knn density estimator for reweighting the p-eikonal equation.</li>
<li><strong>p</strong> (float (optional), default=1):
Value of exponent p in the p-eikonal equation</li>
<li><strong>alpha</strong> (float (optional), default=1):
Reweighting exponent.</li>
<li><strong>max_num_it</strong> (int (optional), default=1e5):
Maximum number of iterations.</li>
<li><strong>tol</strong> (float (optional), default=1e-3):
Tolerance with which to solve the equation.</li>
<li><strong>num_bisection_it</strong> (int (optional), default=30):
Number of bisection iterations for solver.</li>
<li><strong>eps_ball_graph</strong> (bool (optional), default=False):
Whether the graph is an epsilon-ball graph or not. If it is, then the density reweighting
will be done with the degree vector, which is a kernel density estimator in this case</li>
</ul>
</div>


                            </div>
                            <div id="peikonal.p" class="classattr">
                                <div class="attr variable">
            <span class="name">p</span>

        
    </div>
    <a class="headerlink" href="#peikonal.p"></a>
    
    

                            </div>
                            <div id="peikonal.alpha" class="classattr">
                                <div class="attr variable">
            <span class="name">alpha</span>

        
    </div>
    <a class="headerlink" href="#peikonal.alpha"></a>
    
    

                            </div>
                            <div id="peikonal.max_num_it" class="classattr">
                                <div class="attr variable">
            <span class="name">max_num_it</span>

        
    </div>
    <a class="headerlink" href="#peikonal.max_num_it"></a>
    
    

                            </div>
                            <div id="peikonal.tol" class="classattr">
                                <div class="attr variable">
            <span class="name">tol</span>

        
    </div>
    <a class="headerlink" href="#peikonal.tol"></a>
    
    

                            </div>
                            <div id="peikonal.num_bisection_it" class="classattr">
                                <div class="attr variable">
            <span class="name">num_bisection_it</span>

        
    </div>
    <a class="headerlink" href="#peikonal.num_bisection_it"></a>
    
    

                            </div>
                            <div id="peikonal.onevsrest" class="classattr">
                                <div class="attr variable">
            <span class="name">onevsrest</span>

        
    </div>
    <a class="headerlink" href="#peikonal.onevsrest"></a>
    
    

                            </div>
                            <div id="peikonal.similarity" class="classattr">
                                <div class="attr variable">
            <span class="name">similarity</span>

        
    </div>
    <a class="headerlink" href="#peikonal.similarity"></a>
    
    

                            </div>
                            <div id="peikonal.accuracy_filename" class="classattr">
                                <div class="attr variable">
            <span class="name">accuracy_filename</span>

        
    </div>
    <a class="headerlink" href="#peikonal.accuracy_filename"></a>
    
    

                            </div>
                            <div id="peikonal.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#peikonal.name"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#ssl">ssl</a></dt>
                                <dd id="peikonal.prob" class="variable"><a href="#ssl.prob">prob</a></dd>
                <dd id="peikonal.fitted" class="variable"><a href="#ssl.fitted">fitted</a></dd>
                <dd id="peikonal.requires_eig" class="variable"><a href="#ssl.requires_eig">requires_eig</a></dd>
                <dd id="peikonal.class_priors" class="variable"><a href="#ssl.class_priors">class_priors</a></dd>
                <dd id="peikonal.weights" class="variable"><a href="#ssl.weights">weights</a></dd>
                <dd id="peikonal.class_priors_error" class="variable"><a href="#ssl.class_priors_error">class_priors_error</a></dd>
                <dd id="peikonal.set_graph" class="function"><a href="#ssl.set_graph">set_graph</a></dd>
                <dd id="peikonal.volume_label_projection" class="function"><a href="#ssl.volume_label_projection">volume_label_projection</a></dd>
                <dd id="peikonal.get_accuracy_filename" class="function"><a href="#ssl.get_accuracy_filename">get_accuracy_filename</a></dd>
                <dd id="peikonal.predict" class="function"><a href="#ssl.predict">predict</a></dd>
                <dd id="peikonal.fit_predict" class="function"><a href="#ssl.fit_predict">fit_predict</a></dd>
                <dd id="peikonal.ssl_trials" class="function"><a href="#ssl.ssl_trials">ssl_trials</a></dd>
                <dd id="peikonal.trials_statistics" class="function"><a href="#ssl.trials_statistics">trials_statistics</a></dd>
                <dd id="peikonal.fit" class="function"><a href="#ssl.fit">fit</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="plaplace">
                            <input id="plaplace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">plaplace</span><wbr>(<span class="base"><a href="#ssl">ssl</a></span>):

                <label class="view-source-button" for="plaplace-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#plaplace"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="plaplace-1679"><a href="#plaplace-1679"><span class="linenos">1679</span></a><span class="k">class</span> <span class="nc">plaplace</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="plaplace-1680"><a href="#plaplace-1680"><span class="linenos">1680</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_num_it</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="plaplace-1681"><a href="#plaplace-1681"><span class="linenos">1681</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Graph p-laplace classifier</span>
</span><span id="plaplace-1682"><a href="#plaplace-1682"><span class="linenos">1682</span></a><span class="sd">        ===================</span>
</span><span id="plaplace-1683"><a href="#plaplace-1683"><span class="linenos">1683</span></a>
</span><span id="plaplace-1684"><a href="#plaplace-1684"><span class="linenos">1684</span></a><span class="sd">        Semi-supervised learning by via the solution of the game-theoretic p-Laplace equation [1].</span>
</span><span id="plaplace-1685"><a href="#plaplace-1685"><span class="linenos">1685</span></a>
</span><span id="plaplace-1686"><a href="#plaplace-1686"><span class="linenos">1686</span></a><span class="sd">        Parameters</span>
</span><span id="plaplace-1687"><a href="#plaplace-1687"><span class="linenos">1687</span></a><span class="sd">        ----------</span>
</span><span id="plaplace-1688"><a href="#plaplace-1688"><span class="linenos">1688</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="plaplace-1689"><a href="#plaplace-1689"><span class="linenos">1689</span></a><span class="sd">            (n,n) Weight matrix representing the graph.</span>
</span><span id="plaplace-1690"><a href="#plaplace-1690"><span class="linenos">1690</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="plaplace-1691"><a href="#plaplace-1691"><span class="linenos">1691</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="plaplace-1692"><a href="#plaplace-1692"><span class="linenos">1692</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="plaplace-1693"><a href="#plaplace-1693"><span class="linenos">1693</span></a><span class="sd">            nodes in each class.</span>
</span><span id="plaplace-1694"><a href="#plaplace-1694"><span class="linenos">1694</span></a><span class="sd">        p : float (optional), default=10</span>
</span><span id="plaplace-1695"><a href="#plaplace-1695"><span class="linenos">1695</span></a><span class="sd">            Value of p in the p-Laplace equation (\\( 2 \\leq p \\leq \\infty\\).</span>
</span><span id="plaplace-1696"><a href="#plaplace-1696"><span class="linenos">1696</span></a><span class="sd">        max_num_it : int (optional), default=1e5</span>
</span><span id="plaplace-1697"><a href="#plaplace-1697"><span class="linenos">1697</span></a><span class="sd">            Maximum number of iterations</span>
</span><span id="plaplace-1698"><a href="#plaplace-1698"><span class="linenos">1698</span></a><span class="sd">        tol : float (optional), default=1e-3</span>
</span><span id="plaplace-1699"><a href="#plaplace-1699"><span class="linenos">1699</span></a><span class="sd">            Tolerance with which to solve the equation.</span>
</span><span id="plaplace-1700"><a href="#plaplace-1700"><span class="linenos">1700</span></a><span class="sd">        fast : bool (optional), default=True</span>
</span><span id="plaplace-1701"><a href="#plaplace-1701"><span class="linenos">1701</span></a><span class="sd">            Whether to use constant \\(w_{ij}=1\\) weights for the infinity-Laplacian</span>
</span><span id="plaplace-1702"><a href="#plaplace-1702"><span class="linenos">1702</span></a><span class="sd">            which allows a faster algorithm to be used.</span>
</span><span id="plaplace-1703"><a href="#plaplace-1703"><span class="linenos">1703</span></a>
</span><span id="plaplace-1704"><a href="#plaplace-1704"><span class="linenos">1704</span></a><span class="sd">        References</span>
</span><span id="plaplace-1705"><a href="#plaplace-1705"><span class="linenos">1705</span></a><span class="sd">        ----------</span>
</span><span id="plaplace-1706"><a href="#plaplace-1706"><span class="linenos">1706</span></a><span class="sd">        [1] M. Flores Rios, J. Calder, and G. Lerman. [Algorithms for \\( \\ell_p\\)-based semi-supervised learning on graphs.](https://arxiv.org/abs/1901.05031) arXiv:1901.05031, 2019.</span>
</span><span id="plaplace-1707"><a href="#plaplace-1707"><span class="linenos">1707</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="plaplace-1708"><a href="#plaplace-1708"><span class="linenos">1708</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="plaplace-1709"><a href="#plaplace-1709"><span class="linenos">1709</span></a>
</span><span id="plaplace-1710"><a href="#plaplace-1710"><span class="linenos">1710</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="plaplace-1711"><a href="#plaplace-1711"><span class="linenos">1711</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_num_it</span> <span class="o">=</span> <span class="n">max_num_it</span>
</span><span id="plaplace-1712"><a href="#plaplace-1712"><span class="linenos">1712</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span>
</span><span id="plaplace-1713"><a href="#plaplace-1713"><span class="linenos">1713</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onevsrest</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="plaplace-1714"><a href="#plaplace-1714"><span class="linenos">1714</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fast</span> <span class="o">=</span> <span class="n">fast</span>
</span><span id="plaplace-1715"><a href="#plaplace-1715"><span class="linenos">1715</span></a>
</span><span id="plaplace-1716"><a href="#plaplace-1716"><span class="linenos">1716</span></a>        <span class="c1">#Setup accuracy filename and model name</span>
</span><span id="plaplace-1717"><a href="#plaplace-1717"><span class="linenos">1717</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_plaplace_p</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span> 
</span><span id="plaplace-1718"><a href="#plaplace-1718"><span class="linenos">1718</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;p-Laplace (p=</span><span class="si">%.2f</span><span class="s1">)&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span>
</span><span id="plaplace-1719"><a href="#plaplace-1719"><span class="linenos">1719</span></a>
</span><span id="plaplace-1720"><a href="#plaplace-1720"><span class="linenos">1720</span></a>
</span><span id="plaplace-1721"><a href="#plaplace-1721"><span class="linenos">1721</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="plaplace-1722"><a href="#plaplace-1722"><span class="linenos">1722</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">plaplace</span><span class="p">(</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">max_num_it</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_num_it</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tol</span><span class="p">,</span><span class="n">fast</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fast</span><span class="p">)</span>
</span><span id="plaplace-1723"><a href="#plaplace-1723"><span class="linenos">1723</span></a>        <span class="k">return</span> <span class="n">u</span>
</span></pre></div>


    

                            <div id="plaplace.__init__" class="classattr">
                                        <input id="plaplace.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">plaplace</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">W</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">p</span><span class="o">=</span><span class="mi">10</span>,</span><span class="param">	<span class="n">max_num_it</span><span class="o">=</span><span class="mf">1000000.0</span>,</span><span class="param">	<span class="n">tol</span><span class="o">=</span><span class="mf">0.1</span>,</span><span class="param">	<span class="n">fast</span><span class="o">=</span><span class="kc">True</span></span>)</span>

                <label class="view-source-button" for="plaplace.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#plaplace.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="plaplace.__init__-1680"><a href="#plaplace.__init__-1680"><span class="linenos">1680</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_num_it</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="plaplace.__init__-1681"><a href="#plaplace.__init__-1681"><span class="linenos">1681</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Graph p-laplace classifier</span>
</span><span id="plaplace.__init__-1682"><a href="#plaplace.__init__-1682"><span class="linenos">1682</span></a><span class="sd">        ===================</span>
</span><span id="plaplace.__init__-1683"><a href="#plaplace.__init__-1683"><span class="linenos">1683</span></a>
</span><span id="plaplace.__init__-1684"><a href="#plaplace.__init__-1684"><span class="linenos">1684</span></a><span class="sd">        Semi-supervised learning by via the solution of the game-theoretic p-Laplace equation [1].</span>
</span><span id="plaplace.__init__-1685"><a href="#plaplace.__init__-1685"><span class="linenos">1685</span></a>
</span><span id="plaplace.__init__-1686"><a href="#plaplace.__init__-1686"><span class="linenos">1686</span></a><span class="sd">        Parameters</span>
</span><span id="plaplace.__init__-1687"><a href="#plaplace.__init__-1687"><span class="linenos">1687</span></a><span class="sd">        ----------</span>
</span><span id="plaplace.__init__-1688"><a href="#plaplace.__init__-1688"><span class="linenos">1688</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="plaplace.__init__-1689"><a href="#plaplace.__init__-1689"><span class="linenos">1689</span></a><span class="sd">            (n,n) Weight matrix representing the graph.</span>
</span><span id="plaplace.__init__-1690"><a href="#plaplace.__init__-1690"><span class="linenos">1690</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="plaplace.__init__-1691"><a href="#plaplace.__init__-1691"><span class="linenos">1691</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="plaplace.__init__-1692"><a href="#plaplace.__init__-1692"><span class="linenos">1692</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="plaplace.__init__-1693"><a href="#plaplace.__init__-1693"><span class="linenos">1693</span></a><span class="sd">            nodes in each class.</span>
</span><span id="plaplace.__init__-1694"><a href="#plaplace.__init__-1694"><span class="linenos">1694</span></a><span class="sd">        p : float (optional), default=10</span>
</span><span id="plaplace.__init__-1695"><a href="#plaplace.__init__-1695"><span class="linenos">1695</span></a><span class="sd">            Value of p in the p-Laplace equation (\\( 2 \\leq p \\leq \\infty\\).</span>
</span><span id="plaplace.__init__-1696"><a href="#plaplace.__init__-1696"><span class="linenos">1696</span></a><span class="sd">        max_num_it : int (optional), default=1e5</span>
</span><span id="plaplace.__init__-1697"><a href="#plaplace.__init__-1697"><span class="linenos">1697</span></a><span class="sd">            Maximum number of iterations</span>
</span><span id="plaplace.__init__-1698"><a href="#plaplace.__init__-1698"><span class="linenos">1698</span></a><span class="sd">        tol : float (optional), default=1e-3</span>
</span><span id="plaplace.__init__-1699"><a href="#plaplace.__init__-1699"><span class="linenos">1699</span></a><span class="sd">            Tolerance with which to solve the equation.</span>
</span><span id="plaplace.__init__-1700"><a href="#plaplace.__init__-1700"><span class="linenos">1700</span></a><span class="sd">        fast : bool (optional), default=True</span>
</span><span id="plaplace.__init__-1701"><a href="#plaplace.__init__-1701"><span class="linenos">1701</span></a><span class="sd">            Whether to use constant \\(w_{ij}=1\\) weights for the infinity-Laplacian</span>
</span><span id="plaplace.__init__-1702"><a href="#plaplace.__init__-1702"><span class="linenos">1702</span></a><span class="sd">            which allows a faster algorithm to be used.</span>
</span><span id="plaplace.__init__-1703"><a href="#plaplace.__init__-1703"><span class="linenos">1703</span></a>
</span><span id="plaplace.__init__-1704"><a href="#plaplace.__init__-1704"><span class="linenos">1704</span></a><span class="sd">        References</span>
</span><span id="plaplace.__init__-1705"><a href="#plaplace.__init__-1705"><span class="linenos">1705</span></a><span class="sd">        ----------</span>
</span><span id="plaplace.__init__-1706"><a href="#plaplace.__init__-1706"><span class="linenos">1706</span></a><span class="sd">        [1] M. Flores Rios, J. Calder, and G. Lerman. [Algorithms for \\( \\ell_p\\)-based semi-supervised learning on graphs.](https://arxiv.org/abs/1901.05031) arXiv:1901.05031, 2019.</span>
</span><span id="plaplace.__init__-1707"><a href="#plaplace.__init__-1707"><span class="linenos">1707</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="plaplace.__init__-1708"><a href="#plaplace.__init__-1708"><span class="linenos">1708</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="plaplace.__init__-1709"><a href="#plaplace.__init__-1709"><span class="linenos">1709</span></a>
</span><span id="plaplace.__init__-1710"><a href="#plaplace.__init__-1710"><span class="linenos">1710</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="plaplace.__init__-1711"><a href="#plaplace.__init__-1711"><span class="linenos">1711</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_num_it</span> <span class="o">=</span> <span class="n">max_num_it</span>
</span><span id="plaplace.__init__-1712"><a href="#plaplace.__init__-1712"><span class="linenos">1712</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span>
</span><span id="plaplace.__init__-1713"><a href="#plaplace.__init__-1713"><span class="linenos">1713</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onevsrest</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="plaplace.__init__-1714"><a href="#plaplace.__init__-1714"><span class="linenos">1714</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fast</span> <span class="o">=</span> <span class="n">fast</span>
</span><span id="plaplace.__init__-1715"><a href="#plaplace.__init__-1715"><span class="linenos">1715</span></a>
</span><span id="plaplace.__init__-1716"><a href="#plaplace.__init__-1716"><span class="linenos">1716</span></a>        <span class="c1">#Setup accuracy filename and model name</span>
</span><span id="plaplace.__init__-1717"><a href="#plaplace.__init__-1717"><span class="linenos">1717</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_plaplace_p</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span> 
</span><span id="plaplace.__init__-1718"><a href="#plaplace.__init__-1718"><span class="linenos">1718</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;p-Laplace (p=</span><span class="si">%.2f</span><span class="s1">)&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span>
</span></pre></div>


            <div class="docstring"><h1 id="graph-p-laplace-classifier">Graph p-laplace classifier</h1>

<p>Semi-supervised learning by via the solution of the game-theoretic p-Laplace equation [1].</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>W</strong> (numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None):
(n,n) Weight matrix representing the graph.</li>
<li><strong>class_priors</strong> (numpy array (optional), default=None):
Class priors (fraction of data belonging to each class). If provided, the predict function
will attempt to automatic balance the label predictions to predict the correct number of
nodes in each class.</li>
<li><strong>p</strong> (float (optional), default=10):
Value of p in the p-Laplace equation (( 2 \leq p \leq \infty).</li>
<li><strong>max_num_it</strong> (int (optional), default=1e5):
Maximum number of iterations</li>
<li><strong>tol</strong> (float (optional), default=1e-3):
Tolerance with which to solve the equation.</li>
<li><strong>fast</strong> (bool (optional), default=True):
Whether to use constant (w_{ij}=1) weights for the infinity-Laplacian
which allows a faster algorithm to be used.</li>
</ul>

<h6 id="references">References</h6>

<p>[1] M. Flores Rios, J. Calder, and G. Lerman. <a href="https://arxiv.org/abs/1901.05031">Algorithms for ( \ell_p)-based semi-supervised learning on graphs.</a> arXiv:1901.05031, 2019.</p>
</div>


                            </div>
                            <div id="plaplace.p" class="classattr">
                                <div class="attr variable">
            <span class="name">p</span>

        
    </div>
    <a class="headerlink" href="#plaplace.p"></a>
    
    

                            </div>
                            <div id="plaplace.max_num_it" class="classattr">
                                <div class="attr variable">
            <span class="name">max_num_it</span>

        
    </div>
    <a class="headerlink" href="#plaplace.max_num_it"></a>
    
    

                            </div>
                            <div id="plaplace.tol" class="classattr">
                                <div class="attr variable">
            <span class="name">tol</span>

        
    </div>
    <a class="headerlink" href="#plaplace.tol"></a>
    
    

                            </div>
                            <div id="plaplace.onevsrest" class="classattr">
                                <div class="attr variable">
            <span class="name">onevsrest</span>

        
    </div>
    <a class="headerlink" href="#plaplace.onevsrest"></a>
    
    

                            </div>
                            <div id="plaplace.fast" class="classattr">
                                <div class="attr variable">
            <span class="name">fast</span>

        
    </div>
    <a class="headerlink" href="#plaplace.fast"></a>
    
    

                            </div>
                            <div id="plaplace.accuracy_filename" class="classattr">
                                <div class="attr variable">
            <span class="name">accuracy_filename</span>

        
    </div>
    <a class="headerlink" href="#plaplace.accuracy_filename"></a>
    
    

                            </div>
                            <div id="plaplace.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#plaplace.name"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#ssl">ssl</a></dt>
                                <dd id="plaplace.prob" class="variable"><a href="#ssl.prob">prob</a></dd>
                <dd id="plaplace.fitted" class="variable"><a href="#ssl.fitted">fitted</a></dd>
                <dd id="plaplace.requires_eig" class="variable"><a href="#ssl.requires_eig">requires_eig</a></dd>
                <dd id="plaplace.similarity" class="variable"><a href="#ssl.similarity">similarity</a></dd>
                <dd id="plaplace.class_priors" class="variable"><a href="#ssl.class_priors">class_priors</a></dd>
                <dd id="plaplace.weights" class="variable"><a href="#ssl.weights">weights</a></dd>
                <dd id="plaplace.class_priors_error" class="variable"><a href="#ssl.class_priors_error">class_priors_error</a></dd>
                <dd id="plaplace.set_graph" class="function"><a href="#ssl.set_graph">set_graph</a></dd>
                <dd id="plaplace.volume_label_projection" class="function"><a href="#ssl.volume_label_projection">volume_label_projection</a></dd>
                <dd id="plaplace.get_accuracy_filename" class="function"><a href="#ssl.get_accuracy_filename">get_accuracy_filename</a></dd>
                <dd id="plaplace.predict" class="function"><a href="#ssl.predict">predict</a></dd>
                <dd id="plaplace.fit_predict" class="function"><a href="#ssl.fit_predict">fit_predict</a></dd>
                <dd id="plaplace.ssl_trials" class="function"><a href="#ssl.ssl_trials">ssl_trials</a></dd>
                <dd id="plaplace.trials_statistics" class="function"><a href="#ssl.trials_statistics">trials_statistics</a></dd>
                <dd id="plaplace.fit" class="function"><a href="#ssl.fit">fit</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="randomwalk">
                            <input id="randomwalk-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">randomwalk</span><wbr>(<span class="base"><a href="#ssl">ssl</a></span>):

                <label class="view-source-button" for="randomwalk-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#randomwalk"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="randomwalk-1727"><a href="#randomwalk-1727"><span class="linenos">1727</span></a><span class="k">class</span> <span class="nc">randomwalk</span><span class="p">(</span><span class="n">ssl</span><span class="p">):</span>
</span><span id="randomwalk-1728"><a href="#randomwalk-1728"><span class="linenos">1728</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.95</span><span class="p">):</span>
</span><span id="randomwalk-1729"><a href="#randomwalk-1729"><span class="linenos">1729</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Lazy random walk classification</span>
</span><span id="randomwalk-1730"><a href="#randomwalk-1730"><span class="linenos">1730</span></a><span class="sd">        ===================</span>
</span><span id="randomwalk-1731"><a href="#randomwalk-1731"><span class="linenos">1731</span></a>
</span><span id="randomwalk-1732"><a href="#randomwalk-1732"><span class="linenos">1732</span></a><span class="sd">        Add description.</span>
</span><span id="randomwalk-1733"><a href="#randomwalk-1733"><span class="linenos">1733</span></a>
</span><span id="randomwalk-1734"><a href="#randomwalk-1734"><span class="linenos">1734</span></a><span class="sd">        The original method was introduced in [1], and can be interpreted as a lazy random walk. </span>
</span><span id="randomwalk-1735"><a href="#randomwalk-1735"><span class="linenos">1735</span></a>
</span><span id="randomwalk-1736"><a href="#randomwalk-1736"><span class="linenos">1736</span></a><span class="sd">        Parameters</span>
</span><span id="randomwalk-1737"><a href="#randomwalk-1737"><span class="linenos">1737</span></a><span class="sd">        ----------</span>
</span><span id="randomwalk-1738"><a href="#randomwalk-1738"><span class="linenos">1738</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="randomwalk-1739"><a href="#randomwalk-1739"><span class="linenos">1739</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="randomwalk-1740"><a href="#randomwalk-1740"><span class="linenos">1740</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="randomwalk-1741"><a href="#randomwalk-1741"><span class="linenos">1741</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="randomwalk-1742"><a href="#randomwalk-1742"><span class="linenos">1742</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="randomwalk-1743"><a href="#randomwalk-1743"><span class="linenos">1743</span></a><span class="sd">            nodes in each class.</span>
</span><span id="randomwalk-1744"><a href="#randomwalk-1744"><span class="linenos">1744</span></a><span class="sd">        alpha : float (optional), default=0.95</span>
</span><span id="randomwalk-1745"><a href="#randomwalk-1745"><span class="linenos">1745</span></a><span class="sd">            Parameter in model.</span>
</span><span id="randomwalk-1746"><a href="#randomwalk-1746"><span class="linenos">1746</span></a>
</span><span id="randomwalk-1747"><a href="#randomwalk-1747"><span class="linenos">1747</span></a><span class="sd">        References</span>
</span><span id="randomwalk-1748"><a href="#randomwalk-1748"><span class="linenos">1748</span></a><span class="sd">        ---------</span>
</span><span id="randomwalk-1749"><a href="#randomwalk-1749"><span class="linenos">1749</span></a><span class="sd">        [1] D. Zhou and B. Schlkopf. [Learning from labeled and unlabeled data using random walks.](https://link.springer.com/chapter/10.1007/978-3-540-28649-3_29) Joint Pattern Recognition Symposium. </span>
</span><span id="randomwalk-1750"><a href="#randomwalk-1750"><span class="linenos">1750</span></a><span class="sd">        Springer, Berlin, Heidelberg, 2004.</span>
</span><span id="randomwalk-1751"><a href="#randomwalk-1751"><span class="linenos">1751</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="randomwalk-1752"><a href="#randomwalk-1752"><span class="linenos">1752</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="randomwalk-1753"><a href="#randomwalk-1753"><span class="linenos">1753</span></a>
</span><span id="randomwalk-1754"><a href="#randomwalk-1754"><span class="linenos">1754</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="randomwalk-1755"><a href="#randomwalk-1755"><span class="linenos">1755</span></a>
</span><span id="randomwalk-1756"><a href="#randomwalk-1756"><span class="linenos">1756</span></a>        <span class="c1">#Setup accuracy filename and model name</span>
</span><span id="randomwalk-1757"><a href="#randomwalk-1757"><span class="linenos">1757</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_randomwalk&#39;</span> 
</span><span id="randomwalk-1758"><a href="#randomwalk-1758"><span class="linenos">1758</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Lazy Random Walks&#39;</span>
</span><span id="randomwalk-1759"><a href="#randomwalk-1759"><span class="linenos">1759</span></a>
</span><span id="randomwalk-1760"><a href="#randomwalk-1760"><span class="linenos">1760</span></a>
</span><span id="randomwalk-1761"><a href="#randomwalk-1761"><span class="linenos">1761</span></a>    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">all_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="randomwalk-1762"><a href="#randomwalk-1762"><span class="linenos">1762</span></a>        
</span><span id="randomwalk-1763"><a href="#randomwalk-1763"><span class="linenos">1763</span></a>        <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>
</span><span id="randomwalk-1764"><a href="#randomwalk-1764"><span class="linenos">1764</span></a>
</span><span id="randomwalk-1765"><a href="#randomwalk-1765"><span class="linenos">1765</span></a>        <span class="c1">#Zero diagonals</span>
</span><span id="randomwalk-1766"><a href="#randomwalk-1766"><span class="linenos">1766</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">num_nodes</span>
</span><span id="randomwalk-1767"><a href="#randomwalk-1767"><span class="linenos">1767</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">weight_matrix</span>
</span><span id="randomwalk-1768"><a href="#randomwalk-1768"><span class="linenos">1768</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="n">W</span> <span class="o">-</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">diagonal</span><span class="p">(),</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</span><span id="randomwalk-1769"><a href="#randomwalk-1769"><span class="linenos">1769</span></a>        <span class="n">G</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">graph</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</span><span id="randomwalk-1770"><a href="#randomwalk-1770"><span class="linenos">1770</span></a>
</span><span id="randomwalk-1771"><a href="#randomwalk-1771"><span class="linenos">1771</span></a>        <span class="c1">#Construct Laplacian matrix</span>
</span><span id="randomwalk-1772"><a href="#randomwalk-1772"><span class="linenos">1772</span></a>        <span class="n">L</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="n">sparse</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="n">G</span><span class="o">.</span><span class="n">laplacian</span><span class="p">(</span><span class="n">normalization</span><span class="o">=</span><span class="s1">&#39;normalized&#39;</span><span class="p">)</span>
</span><span id="randomwalk-1773"><a href="#randomwalk-1773"><span class="linenos">1773</span></a>
</span><span id="randomwalk-1774"><a href="#randomwalk-1774"><span class="linenos">1774</span></a>        <span class="c1">#Preconditioner</span>
</span><span id="randomwalk-1775"><a href="#randomwalk-1775"><span class="linenos">1775</span></a>        <span class="n">m</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="randomwalk-1776"><a href="#randomwalk-1776"><span class="linenos">1776</span></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span>
</span><span id="randomwalk-1777"><a href="#randomwalk-1777"><span class="linenos">1777</span></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">M</span><span class="o">+</span><span class="mf">1e-10</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">tocsr</span><span class="p">()</span>
</span><span id="randomwalk-1778"><a href="#randomwalk-1778"><span class="linenos">1778</span></a>       
</span><span id="randomwalk-1779"><a href="#randomwalk-1779"><span class="linenos">1779</span></a>        <span class="c1">#Right hand side</span>
</span><span id="randomwalk-1780"><a href="#randomwalk-1780"><span class="linenos">1780</span></a>        <span class="n">onehot</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">labels_to_onehot</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span>
</span><span id="randomwalk-1781"><a href="#randomwalk-1781"><span class="linenos">1781</span></a>        <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">onehot</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="randomwalk-1782"><a href="#randomwalk-1782"><span class="linenos">1782</span></a>        <span class="n">Y</span><span class="p">[</span><span class="n">train_ind</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">onehot</span>
</span><span id="randomwalk-1783"><a href="#randomwalk-1783"><span class="linenos">1783</span></a>
</span><span id="randomwalk-1784"><a href="#randomwalk-1784"><span class="linenos">1784</span></a>        <span class="c1">#Conjugate gradient solver</span>
</span><span id="randomwalk-1785"><a href="#randomwalk-1785"><span class="linenos">1785</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">conjgrad</span><span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="n">M</span><span class="p">,</span> <span class="n">M</span><span class="o">*</span><span class="n">Y</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
</span><span id="randomwalk-1786"><a href="#randomwalk-1786"><span class="linenos">1786</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">M</span><span class="o">*</span><span class="n">u</span>
</span><span id="randomwalk-1787"><a href="#randomwalk-1787"><span class="linenos">1787</span></a>
</span><span id="randomwalk-1788"><a href="#randomwalk-1788"><span class="linenos">1788</span></a>        <span class="k">return</span> <span class="n">u</span>
</span></pre></div>


    

                            <div id="randomwalk.__init__" class="classattr">
                                        <input id="randomwalk.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">randomwalk</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">W</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">alpha</span><span class="o">=</span><span class="mf">0.95</span></span>)</span>

                <label class="view-source-button" for="randomwalk.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#randomwalk.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="randomwalk.__init__-1728"><a href="#randomwalk.__init__-1728"><span class="linenos">1728</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.95</span><span class="p">):</span>
</span><span id="randomwalk.__init__-1729"><a href="#randomwalk.__init__-1729"><span class="linenos">1729</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Lazy random walk classification</span>
</span><span id="randomwalk.__init__-1730"><a href="#randomwalk.__init__-1730"><span class="linenos">1730</span></a><span class="sd">        ===================</span>
</span><span id="randomwalk.__init__-1731"><a href="#randomwalk.__init__-1731"><span class="linenos">1731</span></a>
</span><span id="randomwalk.__init__-1732"><a href="#randomwalk.__init__-1732"><span class="linenos">1732</span></a><span class="sd">        Add description.</span>
</span><span id="randomwalk.__init__-1733"><a href="#randomwalk.__init__-1733"><span class="linenos">1733</span></a>
</span><span id="randomwalk.__init__-1734"><a href="#randomwalk.__init__-1734"><span class="linenos">1734</span></a><span class="sd">        The original method was introduced in [1], and can be interpreted as a lazy random walk. </span>
</span><span id="randomwalk.__init__-1735"><a href="#randomwalk.__init__-1735"><span class="linenos">1735</span></a>
</span><span id="randomwalk.__init__-1736"><a href="#randomwalk.__init__-1736"><span class="linenos">1736</span></a><span class="sd">        Parameters</span>
</span><span id="randomwalk.__init__-1737"><a href="#randomwalk.__init__-1737"><span class="linenos">1737</span></a><span class="sd">        ----------</span>
</span><span id="randomwalk.__init__-1738"><a href="#randomwalk.__init__-1738"><span class="linenos">1738</span></a><span class="sd">        W : numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None</span>
</span><span id="randomwalk.__init__-1739"><a href="#randomwalk.__init__-1739"><span class="linenos">1739</span></a><span class="sd">            Weight matrix representing the graph.</span>
</span><span id="randomwalk.__init__-1740"><a href="#randomwalk.__init__-1740"><span class="linenos">1740</span></a><span class="sd">        class_priors : numpy array (optional), default=None</span>
</span><span id="randomwalk.__init__-1741"><a href="#randomwalk.__init__-1741"><span class="linenos">1741</span></a><span class="sd">            Class priors (fraction of data belonging to each class). If provided, the predict function</span>
</span><span id="randomwalk.__init__-1742"><a href="#randomwalk.__init__-1742"><span class="linenos">1742</span></a><span class="sd">            will attempt to automatic balance the label predictions to predict the correct number of</span>
</span><span id="randomwalk.__init__-1743"><a href="#randomwalk.__init__-1743"><span class="linenos">1743</span></a><span class="sd">            nodes in each class.</span>
</span><span id="randomwalk.__init__-1744"><a href="#randomwalk.__init__-1744"><span class="linenos">1744</span></a><span class="sd">        alpha : float (optional), default=0.95</span>
</span><span id="randomwalk.__init__-1745"><a href="#randomwalk.__init__-1745"><span class="linenos">1745</span></a><span class="sd">            Parameter in model.</span>
</span><span id="randomwalk.__init__-1746"><a href="#randomwalk.__init__-1746"><span class="linenos">1746</span></a>
</span><span id="randomwalk.__init__-1747"><a href="#randomwalk.__init__-1747"><span class="linenos">1747</span></a><span class="sd">        References</span>
</span><span id="randomwalk.__init__-1748"><a href="#randomwalk.__init__-1748"><span class="linenos">1748</span></a><span class="sd">        ---------</span>
</span><span id="randomwalk.__init__-1749"><a href="#randomwalk.__init__-1749"><span class="linenos">1749</span></a><span class="sd">        [1] D. Zhou and B. Schlkopf. [Learning from labeled and unlabeled data using random walks.](https://link.springer.com/chapter/10.1007/978-3-540-28649-3_29) Joint Pattern Recognition Symposium. </span>
</span><span id="randomwalk.__init__-1750"><a href="#randomwalk.__init__-1750"><span class="linenos">1750</span></a><span class="sd">        Springer, Berlin, Heidelberg, 2004.</span>
</span><span id="randomwalk.__init__-1751"><a href="#randomwalk.__init__-1751"><span class="linenos">1751</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="randomwalk.__init__-1752"><a href="#randomwalk.__init__-1752"><span class="linenos">1752</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">class_priors</span><span class="p">)</span>
</span><span id="randomwalk.__init__-1753"><a href="#randomwalk.__init__-1753"><span class="linenos">1753</span></a>
</span><span id="randomwalk.__init__-1754"><a href="#randomwalk.__init__-1754"><span class="linenos">1754</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="randomwalk.__init__-1755"><a href="#randomwalk.__init__-1755"><span class="linenos">1755</span></a>
</span><span id="randomwalk.__init__-1756"><a href="#randomwalk.__init__-1756"><span class="linenos">1756</span></a>        <span class="c1">#Setup accuracy filename and model name</span>
</span><span id="randomwalk.__init__-1757"><a href="#randomwalk.__init__-1757"><span class="linenos">1757</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_filename</span> <span class="o">=</span> <span class="s1">&#39;_randomwalk&#39;</span> 
</span><span id="randomwalk.__init__-1758"><a href="#randomwalk.__init__-1758"><span class="linenos">1758</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Lazy Random Walks&#39;</span>
</span></pre></div>


            <div class="docstring"><h1 id="lazy-random-walk-classification">Lazy random walk classification</h1>

<p>Add description.</p>

<p>The original method was introduced in [1], and can be interpreted as a lazy random walk. </p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>W</strong> (numpy array, scipy sparse matrix, or graphlearning graph object (optional), default=None):
Weight matrix representing the graph.</li>
<li><strong>class_priors</strong> (numpy array (optional), default=None):
Class priors (fraction of data belonging to each class). If provided, the predict function
will attempt to automatic balance the label predictions to predict the correct number of
nodes in each class.</li>
<li><strong>alpha</strong> (float (optional), default=0.95):
Parameter in model.</li>
</ul>

<h6 id="references">References</h6>

<p>[1] D. Zhou and B. Schlkopf. <a href="https://link.springer.com/chapter/10.1007/978-3-540-28649-3_29">Learning from labeled and unlabeled data using random walks.</a> Joint Pattern Recognition Symposium. 
Springer, Berlin, Heidelberg, 2004.</p>
</div>


                            </div>
                            <div id="randomwalk.alpha" class="classattr">
                                <div class="attr variable">
            <span class="name">alpha</span>

        
    </div>
    <a class="headerlink" href="#randomwalk.alpha"></a>
    
    

                            </div>
                            <div id="randomwalk.accuracy_filename" class="classattr">
                                <div class="attr variable">
            <span class="name">accuracy_filename</span>

        
    </div>
    <a class="headerlink" href="#randomwalk.accuracy_filename"></a>
    
    

                            </div>
                            <div id="randomwalk.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#randomwalk.name"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#ssl">ssl</a></dt>
                                <dd id="randomwalk.prob" class="variable"><a href="#ssl.prob">prob</a></dd>
                <dd id="randomwalk.fitted" class="variable"><a href="#ssl.fitted">fitted</a></dd>
                <dd id="randomwalk.requires_eig" class="variable"><a href="#ssl.requires_eig">requires_eig</a></dd>
                <dd id="randomwalk.onevsrest" class="variable"><a href="#ssl.onevsrest">onevsrest</a></dd>
                <dd id="randomwalk.similarity" class="variable"><a href="#ssl.similarity">similarity</a></dd>
                <dd id="randomwalk.class_priors" class="variable"><a href="#ssl.class_priors">class_priors</a></dd>
                <dd id="randomwalk.weights" class="variable"><a href="#ssl.weights">weights</a></dd>
                <dd id="randomwalk.class_priors_error" class="variable"><a href="#ssl.class_priors_error">class_priors_error</a></dd>
                <dd id="randomwalk.set_graph" class="function"><a href="#ssl.set_graph">set_graph</a></dd>
                <dd id="randomwalk.volume_label_projection" class="function"><a href="#ssl.volume_label_projection">volume_label_projection</a></dd>
                <dd id="randomwalk.get_accuracy_filename" class="function"><a href="#ssl.get_accuracy_filename">get_accuracy_filename</a></dd>
                <dd id="randomwalk.predict" class="function"><a href="#ssl.predict">predict</a></dd>
                <dd id="randomwalk.fit_predict" class="function"><a href="#ssl.fit_predict">fit_predict</a></dd>
                <dd id="randomwalk.ssl_trials" class="function"><a href="#ssl.ssl_trials">ssl_trials</a></dd>
                <dd id="randomwalk.trials_statistics" class="function"><a href="#ssl.trials_statistics">trials_statistics</a></dd>
                <dd id="randomwalk.fit" class="function"><a href="#ssl.fit">fit</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ssl_accuracy">
                            <input id="ssl_accuracy-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ssl_accuracy</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">pred_labels</span>, </span><span class="param"><span class="n">true_labels</span>, </span><span class="param"><span class="n">train_ind</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ssl_accuracy-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ssl_accuracy"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ssl_accuracy-1790"><a href="#ssl_accuracy-1790"><span class="linenos">1790</span></a><span class="k">def</span> <span class="nf">ssl_accuracy</span><span class="p">(</span><span class="n">pred_labels</span><span class="p">,</span> <span class="n">true_labels</span><span class="p">,</span> <span class="n">train_ind</span><span class="p">):</span>   
</span><span id="ssl_accuracy-1791"><a href="#ssl_accuracy-1791"><span class="linenos">1791</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;SSL Accuacy</span>
</span><span id="ssl_accuracy-1792"><a href="#ssl_accuracy-1792"><span class="linenos">1792</span></a><span class="sd">    ======</span>
</span><span id="ssl_accuracy-1793"><a href="#ssl_accuracy-1793"><span class="linenos">1793</span></a>
</span><span id="ssl_accuracy-1794"><a href="#ssl_accuracy-1794"><span class="linenos">1794</span></a><span class="sd">    Accuracy for semi-supervised graph learning, taking care to remove training set.</span>
</span><span id="ssl_accuracy-1795"><a href="#ssl_accuracy-1795"><span class="linenos">1795</span></a><span class="sd">    NOTE: Any true labels with negative values will be removed from </span>
</span><span id="ssl_accuracy-1796"><a href="#ssl_accuracy-1796"><span class="linenos">1796</span></a><span class="sd">    accuracy computation.</span>
</span><span id="ssl_accuracy-1797"><a href="#ssl_accuracy-1797"><span class="linenos">1797</span></a>
</span><span id="ssl_accuracy-1798"><a href="#ssl_accuracy-1798"><span class="linenos">1798</span></a><span class="sd">    Parameters</span>
</span><span id="ssl_accuracy-1799"><a href="#ssl_accuracy-1799"><span class="linenos">1799</span></a><span class="sd">    ----------</span>
</span><span id="ssl_accuracy-1800"><a href="#ssl_accuracy-1800"><span class="linenos">1800</span></a><span class="sd">    pred_labels : numpy array, int</span>
</span><span id="ssl_accuracy-1801"><a href="#ssl_accuracy-1801"><span class="linenos">1801</span></a><span class="sd">        Predicted labels</span>
</span><span id="ssl_accuracy-1802"><a href="#ssl_accuracy-1802"><span class="linenos">1802</span></a><span class="sd">    true_labels : numpy array, int</span>
</span><span id="ssl_accuracy-1803"><a href="#ssl_accuracy-1803"><span class="linenos">1803</span></a><span class="sd">        True labels</span>
</span><span id="ssl_accuracy-1804"><a href="#ssl_accuracy-1804"><span class="linenos">1804</span></a><span class="sd">    train_ind : numpy array, int </span>
</span><span id="ssl_accuracy-1805"><a href="#ssl_accuracy-1805"><span class="linenos">1805</span></a><span class="sd">        Indices of training points, which will be removed from the accuracy computation.</span>
</span><span id="ssl_accuracy-1806"><a href="#ssl_accuracy-1806"><span class="linenos">1806</span></a>
</span><span id="ssl_accuracy-1807"><a href="#ssl_accuracy-1807"><span class="linenos">1807</span></a><span class="sd">    Returns</span>
</span><span id="ssl_accuracy-1808"><a href="#ssl_accuracy-1808"><span class="linenos">1808</span></a><span class="sd">    -------</span>
</span><span id="ssl_accuracy-1809"><a href="#ssl_accuracy-1809"><span class="linenos">1809</span></a><span class="sd">    accuracy : float</span>
</span><span id="ssl_accuracy-1810"><a href="#ssl_accuracy-1810"><span class="linenos">1810</span></a><span class="sd">        Accuracy as a number in [0,100].</span>
</span><span id="ssl_accuracy-1811"><a href="#ssl_accuracy-1811"><span class="linenos">1811</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ssl_accuracy-1812"><a href="#ssl_accuracy-1812"><span class="linenos">1812</span></a>
</span><span id="ssl_accuracy-1813"><a href="#ssl_accuracy-1813"><span class="linenos">1813</span></a>        <span class="c1">#Remove labeled data</span>
</span><span id="ssl_accuracy-1814"><a href="#ssl_accuracy-1814"><span class="linenos">1814</span></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pred_labels</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
</span><span id="ssl_accuracy-1815"><a href="#ssl_accuracy-1815"><span class="linenos">1815</span></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">train_ind</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="ssl_accuracy-1816"><a href="#ssl_accuracy-1816"><span class="linenos">1816</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: ssl_accuracy has been updated and now requires the user to provide the indices of the labeled points, and not just the number of labels. Accuracy computation will be incorrect unless you update your code accordingly. See https://jwcalder.github.io/GraphLearning/ssl.html#two-moons-example&quot;</span><span class="p">)</span>
</span><span id="ssl_accuracy-1817"><a href="#ssl_accuracy-1817"><span class="linenos">1817</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="ssl_accuracy-1818"><a href="#ssl_accuracy-1818"><span class="linenos">1818</span></a>        <span class="n">mask</span><span class="p">[</span><span class="n">train_ind</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
</span><span id="ssl_accuracy-1819"><a href="#ssl_accuracy-1819"><span class="linenos">1819</span></a>
</span><span id="ssl_accuracy-1820"><a href="#ssl_accuracy-1820"><span class="linenos">1820</span></a>    <span class="n">pred_labels</span> <span class="o">=</span> <span class="n">pred_labels</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</span><span id="ssl_accuracy-1821"><a href="#ssl_accuracy-1821"><span class="linenos">1821</span></a>    <span class="n">true_labels</span> <span class="o">=</span> <span class="n">true_labels</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</span><span id="ssl_accuracy-1822"><a href="#ssl_accuracy-1822"><span class="linenos">1822</span></a>
</span><span id="ssl_accuracy-1823"><a href="#ssl_accuracy-1823"><span class="linenos">1823</span></a>    <span class="c1">#Remove unlabeled nodes</span>
</span><span id="ssl_accuracy-1824"><a href="#ssl_accuracy-1824"><span class="linenos">1824</span></a>    <span class="n">I</span> <span class="o">=</span> <span class="n">true_labels</span> <span class="o">&gt;=</span><span class="mi">0</span>
</span><span id="ssl_accuracy-1825"><a href="#ssl_accuracy-1825"><span class="linenos">1825</span></a>    <span class="n">pred_labels</span> <span class="o">=</span> <span class="n">pred_labels</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
</span><span id="ssl_accuracy-1826"><a href="#ssl_accuracy-1826"><span class="linenos">1826</span></a>    <span class="n">true_labels</span> <span class="o">=</span> <span class="n">true_labels</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
</span><span id="ssl_accuracy-1827"><a href="#ssl_accuracy-1827"><span class="linenos">1827</span></a>
</span><span id="ssl_accuracy-1828"><a href="#ssl_accuracy-1828"><span class="linenos">1828</span></a>    <span class="c1">#Compute accuracy</span>
</span><span id="ssl_accuracy-1829"><a href="#ssl_accuracy-1829"><span class="linenos">1829</span></a>    <span class="k">return</span> <span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pred_labels</span><span class="o">==</span><span class="n">true_labels</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h1 id="ssl-accuacy">SSL Accuacy</h1>

<p>Accuracy for semi-supervised graph learning, taking care to remove training set.
NOTE: Any true labels with negative values will be removed from 
accuracy computation.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>pred_labels</strong> (numpy array, int):
Predicted labels</li>
<li><strong>true_labels</strong> (numpy array, int):
True labels</li>
<li><strong>train_ind</strong> (numpy array, int):
Indices of training points, which will be removed from the accuracy computation.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>accuracy</strong> (float):
Accuracy as a number in [0,100].</li>
</ul>
</div>


                </section>
                <section id="accuracy_plot">
                            <input id="accuracy_plot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">accuracy_plot</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">model_list</span>,</span><span class="param">	<span class="n">tag</span><span class="o">=</span><span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">testerror</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">savefile</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">title</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">errorbars</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">loglog</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">ylim</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span>,</span><span class="param">	<span class="n">legend_fontsize</span><span class="o">=</span><span class="mi">16</span>,</span><span class="param">	<span class="n">label_fontsize</span><span class="o">=</span><span class="mi">16</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="accuracy_plot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#accuracy_plot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="accuracy_plot-1832"><a href="#accuracy_plot-1832"><span class="linenos">1832</span></a><span class="k">def</span> <span class="nf">accuracy_plot</span><span class="p">(</span><span class="n">model_list</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">testerror</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">savefile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">errorbars</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
</span><span id="accuracy_plot-1833"><a href="#accuracy_plot-1833"><span class="linenos">1833</span></a>                  <span class="n">loglog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">legend_fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">label_fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">):</span>
</span><span id="accuracy_plot-1834"><a href="#accuracy_plot-1834"><span class="linenos">1834</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Accuracy Plot</span>
</span><span id="accuracy_plot-1835"><a href="#accuracy_plot-1835"><span class="linenos">1835</span></a><span class="sd">    ======</span>
</span><span id="accuracy_plot-1836"><a href="#accuracy_plot-1836"><span class="linenos">1836</span></a>
</span><span id="accuracy_plot-1837"><a href="#accuracy_plot-1837"><span class="linenos">1837</span></a><span class="sd">    Creates a plot of accuracy scores for experiments run with `ssl_trials`.</span>
</span><span id="accuracy_plot-1838"><a href="#accuracy_plot-1838"><span class="linenos">1838</span></a>
</span><span id="accuracy_plot-1839"><a href="#accuracy_plot-1839"><span class="linenos">1839</span></a><span class="sd">    Parameters</span>
</span><span id="accuracy_plot-1840"><a href="#accuracy_plot-1840"><span class="linenos">1840</span></a><span class="sd">    ----------</span>
</span><span id="accuracy_plot-1841"><a href="#accuracy_plot-1841"><span class="linenos">1841</span></a><span class="sd">    model_list : list of ssl objects</span>
</span><span id="accuracy_plot-1842"><a href="#accuracy_plot-1842"><span class="linenos">1842</span></a><span class="sd">        Models to include in table.</span>
</span><span id="accuracy_plot-1843"><a href="#accuracy_plot-1843"><span class="linenos">1843</span></a><span class="sd">    tag : str (optional), default=&#39;&#39;</span>
</span><span id="accuracy_plot-1844"><a href="#accuracy_plot-1844"><span class="linenos">1844</span></a><span class="sd">        An extra identifying tag to add to the accuracy filename.</span>
</span><span id="accuracy_plot-1845"><a href="#accuracy_plot-1845"><span class="linenos">1845</span></a><span class="sd">    testerror : bool (optional), default=False</span>
</span><span id="accuracy_plot-1846"><a href="#accuracy_plot-1846"><span class="linenos">1846</span></a><span class="sd">        Show test error (instead of accuracy) in the table.</span>
</span><span id="accuracy_plot-1847"><a href="#accuracy_plot-1847"><span class="linenos">1847</span></a><span class="sd">    savefile : str (optional), default=None</span>
</span><span id="accuracy_plot-1848"><a href="#accuracy_plot-1848"><span class="linenos">1848</span></a><span class="sd">        If a savefile name is provided, then the plot is saved instead of displayed to the screen</span>
</span><span id="accuracy_plot-1849"><a href="#accuracy_plot-1849"><span class="linenos">1849</span></a><span class="sd">    title : str (optional), default=None</span>
</span><span id="accuracy_plot-1850"><a href="#accuracy_plot-1850"><span class="linenos">1850</span></a><span class="sd">        If title is provided, then it will be added to the plot.</span>
</span><span id="accuracy_plot-1851"><a href="#accuracy_plot-1851"><span class="linenos">1851</span></a><span class="sd">    errorbars : bool (optional), default=False</span>
</span><span id="accuracy_plot-1852"><a href="#accuracy_plot-1852"><span class="linenos">1852</span></a><span class="sd">        Whether to add error bars to plot.</span>
</span><span id="accuracy_plot-1853"><a href="#accuracy_plot-1853"><span class="linenos">1853</span></a><span class="sd">    loglog : bool (optional), default=False</span>
</span><span id="accuracy_plot-1854"><a href="#accuracy_plot-1854"><span class="linenos">1854</span></a><span class="sd">        Make the plot on a loglog scale.</span>
</span><span id="accuracy_plot-1855"><a href="#accuracy_plot-1855"><span class="linenos">1855</span></a><span class="sd">    ylim : tuple (optional), default=None</span>
</span><span id="accuracy_plot-1856"><a href="#accuracy_plot-1856"><span class="linenos">1856</span></a><span class="sd">        If provided, then y-limits are set with `plt.ylim(ylim)`</span>
</span><span id="accuracy_plot-1857"><a href="#accuracy_plot-1857"><span class="linenos">1857</span></a><span class="sd">    fontsize : int (optional), default=16</span>
</span><span id="accuracy_plot-1858"><a href="#accuracy_plot-1858"><span class="linenos">1858</span></a><span class="sd">        Font size text, other than legend and labels</span>
</span><span id="accuracy_plot-1859"><a href="#accuracy_plot-1859"><span class="linenos">1859</span></a><span class="sd">    legend_fontsize : int (optional), default=16</span>
</span><span id="accuracy_plot-1860"><a href="#accuracy_plot-1860"><span class="linenos">1860</span></a><span class="sd">        Font size for legend.</span>
</span><span id="accuracy_plot-1861"><a href="#accuracy_plot-1861"><span class="linenos">1861</span></a><span class="sd">    label_fontsize : int (optional), default=16</span>
</span><span id="accuracy_plot-1862"><a href="#accuracy_plot-1862"><span class="linenos">1862</span></a><span class="sd">        Font size for x and y labels.</span>
</span><span id="accuracy_plot-1863"><a href="#accuracy_plot-1863"><span class="linenos">1863</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="accuracy_plot-1864"><a href="#accuracy_plot-1864"><span class="linenos">1864</span></a>
</span><span id="accuracy_plot-1865"><a href="#accuracy_plot-1865"><span class="linenos">1865</span></a>    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="accuracy_plot-1866"><a href="#accuracy_plot-1866"><span class="linenos">1866</span></a>    <span class="k">if</span> <span class="n">errorbars</span><span class="p">:</span>
</span><span id="accuracy_plot-1867"><a href="#accuracy_plot-1867"><span class="linenos">1867</span></a>        <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;errorbar.capsize&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span>
</span><span id="accuracy_plot-1868"><a href="#accuracy_plot-1868"><span class="linenos">1868</span></a>    <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="n">fontsize</span><span class="p">})</span>
</span><span id="accuracy_plot-1869"><a href="#accuracy_plot-1869"><span class="linenos">1869</span></a>    <span class="n">styles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;^b-&#39;</span><span class="p">,</span><span class="s1">&#39;or-&#39;</span><span class="p">,</span><span class="s1">&#39;dg-&#39;</span><span class="p">,</span><span class="s1">&#39;sk-&#39;</span><span class="p">,</span><span class="s1">&#39;pm-&#39;</span><span class="p">,</span><span class="s1">&#39;xc-&#39;</span><span class="p">,</span><span class="s1">&#39;*y-&#39;</span><span class="p">]</span>
</span><span id="accuracy_plot-1870"><a href="#accuracy_plot-1870"><span class="linenos">1870</span></a>    <span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="accuracy_plot-1871"><a href="#accuracy_plot-1871"><span class="linenos">1871</span></a>    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model_list</span><span class="p">:</span>
</span><span id="accuracy_plot-1872"><a href="#accuracy_plot-1872"><span class="linenos">1872</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">7</span>
</span><span id="accuracy_plot-1873"><a href="#accuracy_plot-1873"><span class="linenos">1873</span></a>        <span class="n">num_train</span><span class="p">,</span><span class="n">acc_mean</span><span class="p">,</span><span class="n">acc_stddev</span><span class="p">,</span><span class="n">num_trials</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">trials_statistics</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
</span><span id="accuracy_plot-1874"><a href="#accuracy_plot-1874"><span class="linenos">1874</span></a>        <span class="k">if</span> <span class="n">testerror</span><span class="p">:</span>
</span><span id="accuracy_plot-1875"><a href="#accuracy_plot-1875"><span class="linenos">1875</span></a>            <span class="n">acc_mean</span> <span class="o">=</span> <span class="mi">100</span><span class="o">-</span><span class="n">acc_mean</span>
</span><span id="accuracy_plot-1876"><a href="#accuracy_plot-1876"><span class="linenos">1876</span></a>
</span><span id="accuracy_plot-1877"><a href="#accuracy_plot-1877"><span class="linenos">1877</span></a>        <span class="k">if</span> <span class="n">errorbars</span><span class="p">:</span>
</span><span id="accuracy_plot-1878"><a href="#accuracy_plot-1878"><span class="linenos">1878</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">num_train</span><span class="p">,</span> <span class="n">acc_mean</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">fmt</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">yerr</span><span class="o">=</span><span class="n">acc_stddev</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="accuracy_plot-1879"><a href="#accuracy_plot-1879"><span class="linenos">1879</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="accuracy_plot-1880"><a href="#accuracy_plot-1880"><span class="linenos">1880</span></a>            <span class="k">if</span> <span class="n">loglog</span><span class="p">:</span>
</span><span id="accuracy_plot-1881"><a href="#accuracy_plot-1881"><span class="linenos">1881</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">num_train</span><span class="p">,</span> <span class="n">acc_mean</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="accuracy_plot-1882"><a href="#accuracy_plot-1882"><span class="linenos">1882</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="accuracy_plot-1883"><a href="#accuracy_plot-1883"><span class="linenos">1883</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num_train</span><span class="p">,</span> <span class="n">acc_mean</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="c1">#3rd argumnet=styles[i]</span>
</span><span id="accuracy_plot-1884"><a href="#accuracy_plot-1884"><span class="linenos">1884</span></a>
</span><span id="accuracy_plot-1885"><a href="#accuracy_plot-1885"><span class="linenos">1885</span></a>        <span class="c1">#If class priors were run as well</span>
</span><span id="accuracy_plot-1886"><a href="#accuracy_plot-1886"><span class="linenos">1886</span></a>        <span class="k">if</span> <span class="n">acc_mean</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="accuracy_plot-1887"><a href="#accuracy_plot-1887"><span class="linenos">1887</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">7</span>
</span><span id="accuracy_plot-1888"><a href="#accuracy_plot-1888"><span class="linenos">1888</span></a>            <span class="k">if</span> <span class="n">errorbars</span><span class="p">:</span>
</span><span id="accuracy_plot-1889"><a href="#accuracy_plot-1889"><span class="linenos">1889</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">num_train</span><span class="p">,</span> <span class="n">acc_mean</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">fmt</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">yerr</span><span class="o">=</span><span class="n">acc_stddev</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;+CP&#39;</span><span class="p">)</span>
</span><span id="accuracy_plot-1890"><a href="#accuracy_plot-1890"><span class="linenos">1890</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="accuracy_plot-1891"><a href="#accuracy_plot-1891"><span class="linenos">1891</span></a>                <span class="k">if</span> <span class="n">loglog</span><span class="p">:</span>
</span><span id="accuracy_plot-1892"><a href="#accuracy_plot-1892"><span class="linenos">1892</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">num_train</span><span class="p">,</span> <span class="n">acc_mean</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;+CP&#39;</span><span class="p">)</span>
</span><span id="accuracy_plot-1893"><a href="#accuracy_plot-1893"><span class="linenos">1893</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="accuracy_plot-1894"><a href="#accuracy_plot-1894"><span class="linenos">1894</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num_train</span><span class="p">,</span> <span class="n">acc_mean</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;+CP&#39;</span><span class="p">)</span> <span class="c1">#3rd argumnet=styles[i]</span>
</span><span id="accuracy_plot-1895"><a href="#accuracy_plot-1895"><span class="linenos">1895</span></a>
</span><span id="accuracy_plot-1896"><a href="#accuracy_plot-1896"><span class="linenos">1896</span></a>     
</span><span id="accuracy_plot-1897"><a href="#accuracy_plot-1897"><span class="linenos">1897</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of labels&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">label_fontsize</span><span class="p">)</span>
</span><span id="accuracy_plot-1898"><a href="#accuracy_plot-1898"><span class="linenos">1898</span></a>    <span class="k">if</span> <span class="n">testerror</span><span class="p">:</span>
</span><span id="accuracy_plot-1899"><a href="#accuracy_plot-1899"><span class="linenos">1899</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Test error (%)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">label_fontsize</span><span class="p">)</span>
</span><span id="accuracy_plot-1900"><a href="#accuracy_plot-1900"><span class="linenos">1900</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">)</span>
</span><span id="accuracy_plot-1901"><a href="#accuracy_plot-1901"><span class="linenos">1901</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="accuracy_plot-1902"><a href="#accuracy_plot-1902"><span class="linenos">1902</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Accuracy (%)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">label_fontsize</span><span class="p">)</span>
</span><span id="accuracy_plot-1903"><a href="#accuracy_plot-1903"><span class="linenos">1903</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">)</span>
</span><span id="accuracy_plot-1904"><a href="#accuracy_plot-1904"><span class="linenos">1904</span></a>    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="accuracy_plot-1905"><a href="#accuracy_plot-1905"><span class="linenos">1905</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="accuracy_plot-1906"><a href="#accuracy_plot-1906"><span class="linenos">1906</span></a>
</span><span id="accuracy_plot-1907"><a href="#accuracy_plot-1907"><span class="linenos">1907</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="accuracy_plot-1908"><a href="#accuracy_plot-1908"><span class="linenos">1908</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="accuracy_plot-1909"><a href="#accuracy_plot-1909"><span class="linenos">1909</span></a>
</span><span id="accuracy_plot-1910"><a href="#accuracy_plot-1910"><span class="linenos">1910</span></a>    <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="accuracy_plot-1911"><a href="#accuracy_plot-1911"><span class="linenos">1911</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
</span><span id="accuracy_plot-1912"><a href="#accuracy_plot-1912"><span class="linenos">1912</span></a>
</span><span id="accuracy_plot-1913"><a href="#accuracy_plot-1913"><span class="linenos">1913</span></a>    <span class="c1">#ax.xaxis.set_major_locator(MaxNLocator(integer=True))</span>
</span><span id="accuracy_plot-1914"><a href="#accuracy_plot-1914"><span class="linenos">1914</span></a>
</span><span id="accuracy_plot-1915"><a href="#accuracy_plot-1915"><span class="linenos">1915</span></a>    <span class="k">if</span> <span class="n">savefile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="accuracy_plot-1916"><a href="#accuracy_plot-1916"><span class="linenos">1916</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savefile</span><span class="p">)</span>
</span><span id="accuracy_plot-1917"><a href="#accuracy_plot-1917"><span class="linenos">1917</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="accuracy_plot-1918"><a href="#accuracy_plot-1918"><span class="linenos">1918</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><h1 id="accuracy-plot">Accuracy Plot</h1>

<p>Creates a plot of accuracy scores for experiments run with <code>ssl_trials</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>model_list</strong> (list of ssl objects):
Models to include in table.</li>
<li><strong>tag</strong> (str (optional), default=''):
An extra identifying tag to add to the accuracy filename.</li>
<li><strong>testerror</strong> (bool (optional), default=False):
Show test error (instead of accuracy) in the table.</li>
<li><strong>savefile</strong> (str (optional), default=None):
If a savefile name is provided, then the plot is saved instead of displayed to the screen</li>
<li><strong>title</strong> (str (optional), default=None):
If title is provided, then it will be added to the plot.</li>
<li><strong>errorbars</strong> (bool (optional), default=False):
Whether to add error bars to plot.</li>
<li><strong>loglog</strong> (bool (optional), default=False):
Make the plot on a loglog scale.</li>
<li><strong>ylim</strong> (tuple (optional), default=None):
If provided, then y-limits are set with <code>plt.ylim(ylim)</code></li>
<li><strong>fontsize</strong> (int (optional), default=16):
Font size text, other than legend and labels</li>
<li><strong>legend_fontsize</strong> (int (optional), default=16):
Font size for legend.</li>
<li><strong>label_fontsize</strong> (int (optional), default=16):
Font size for x and y labels.</li>
</ul>
</div>


                </section>
                <section id="accuracy_table">
                            <input id="accuracy_table-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">accuracy_table</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">model_list</span>,</span><span class="param">	<span class="n">tag</span><span class="o">=</span><span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">testerror</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">savefile</span><span class="o">=</span><span class="s1">&#39;table.tex&#39;</span>,</span><span class="param">	<span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">append</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span>,</span><span class="param">	<span class="n">small_caps</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">two_column</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="accuracy_table-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#accuracy_table"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="accuracy_table-1920"><a href="#accuracy_table-1920"><span class="linenos">1920</span></a><span class="k">def</span> <span class="nf">accuracy_table</span><span class="p">(</span><span class="n">model_list</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">testerror</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">savefile</span><span class="o">=</span><span class="s1">&#39;table.tex&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> 
</span><span id="accuracy_table-1921"><a href="#accuracy_table-1921"><span class="linenos">1921</span></a>                               <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">,</span> <span class="n">small_caps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">two_column</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="accuracy_table-1922"><a href="#accuracy_table-1922"><span class="linenos">1922</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Accuracy table</span>
</span><span id="accuracy_table-1923"><a href="#accuracy_table-1923"><span class="linenos">1923</span></a><span class="sd">    ======</span>
</span><span id="accuracy_table-1924"><a href="#accuracy_table-1924"><span class="linenos">1924</span></a>
</span><span id="accuracy_table-1925"><a href="#accuracy_table-1925"><span class="linenos">1925</span></a><span class="sd">    Creates a table of accuracy scores for experiments run with `ssl_trials` to be</span>
</span><span id="accuracy_table-1926"><a href="#accuracy_table-1926"><span class="linenos">1926</span></a><span class="sd">    included in a LaTeX document.</span>
</span><span id="accuracy_table-1927"><a href="#accuracy_table-1927"><span class="linenos">1927</span></a>
</span><span id="accuracy_table-1928"><a href="#accuracy_table-1928"><span class="linenos">1928</span></a><span class="sd">    Parameters</span>
</span><span id="accuracy_table-1929"><a href="#accuracy_table-1929"><span class="linenos">1929</span></a><span class="sd">    ----------</span>
</span><span id="accuracy_table-1930"><a href="#accuracy_table-1930"><span class="linenos">1930</span></a><span class="sd">    model_list : list of ssl objects</span>
</span><span id="accuracy_table-1931"><a href="#accuracy_table-1931"><span class="linenos">1931</span></a><span class="sd">        Models to include in table.</span>
</span><span id="accuracy_table-1932"><a href="#accuracy_table-1932"><span class="linenos">1932</span></a><span class="sd">    tag : str (optional), default=&#39;&#39;</span>
</span><span id="accuracy_table-1933"><a href="#accuracy_table-1933"><span class="linenos">1933</span></a><span class="sd">        An extra identifying tag to add to the accuracy filename.</span>
</span><span id="accuracy_table-1934"><a href="#accuracy_table-1934"><span class="linenos">1934</span></a><span class="sd">    testerror : bool (optional), default=False</span>
</span><span id="accuracy_table-1935"><a href="#accuracy_table-1935"><span class="linenos">1935</span></a><span class="sd">        Show test error (instead of accuracy) in the table.</span>
</span><span id="accuracy_table-1936"><a href="#accuracy_table-1936"><span class="linenos">1936</span></a><span class="sd">    savefile : str (optional), default=&#39;table.tex&#39;</span>
</span><span id="accuracy_table-1937"><a href="#accuracy_table-1937"><span class="linenos">1937</span></a><span class="sd">        Filename to save tex code for table.</span>
</span><span id="accuracy_table-1938"><a href="#accuracy_table-1938"><span class="linenos">1938</span></a><span class="sd">    title : str (optional), default=&#39;&#39;</span>
</span><span id="accuracy_table-1939"><a href="#accuracy_table-1939"><span class="linenos">1939</span></a><span class="sd">        Title for table.</span>
</span><span id="accuracy_table-1940"><a href="#accuracy_table-1940"><span class="linenos">1940</span></a><span class="sd">    append : bool (optional), default=False</span>
</span><span id="accuracy_table-1941"><a href="#accuracy_table-1941"><span class="linenos">1941</span></a><span class="sd">        Whether to create a new tex file or append table to existing file.</span>
</span><span id="accuracy_table-1942"><a href="#accuracy_table-1942"><span class="linenos">1942</span></a><span class="sd">    fontsize : str (optional), default=&#39;small&#39;</span>
</span><span id="accuracy_table-1943"><a href="#accuracy_table-1943"><span class="linenos">1943</span></a><span class="sd">        LaTeX font size.</span>
</span><span id="accuracy_table-1944"><a href="#accuracy_table-1944"><span class="linenos">1944</span></a><span class="sd">    small_caps : bool (optional), default=True</span>
</span><span id="accuracy_table-1945"><a href="#accuracy_table-1945"><span class="linenos">1945</span></a><span class="sd">        Whether to use small caps in LaTeX for table.</span>
</span><span id="accuracy_table-1946"><a href="#accuracy_table-1946"><span class="linenos">1946</span></a><span class="sd">    two_column : bool (optional), default=True</span>
</span><span id="accuracy_table-1947"><a href="#accuracy_table-1947"><span class="linenos">1947</span></a><span class="sd">        Whether the table will be in a two-column LaTeX document.</span>
</span><span id="accuracy_table-1948"><a href="#accuracy_table-1948"><span class="linenos">1948</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="accuracy_table-1949"><a href="#accuracy_table-1949"><span class="linenos">1949</span></a>
</span><span id="accuracy_table-1950"><a href="#accuracy_table-1950"><span class="linenos">1950</span></a>
</span><span id="accuracy_table-1951"><a href="#accuracy_table-1951"><span class="linenos">1951</span></a>    <span class="n">num_train</span><span class="p">,</span><span class="n">acc_mean</span><span class="p">,</span><span class="n">acc_stddev</span><span class="p">,</span><span class="n">num_trials</span> <span class="o">=</span> <span class="n">model_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">trials_statistics</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
</span><span id="accuracy_table-1952"><a href="#accuracy_table-1952"><span class="linenos">1952</span></a>    <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">num_train</span><span class="p">)</span>
</span><span id="accuracy_table-1953"><a href="#accuracy_table-1953"><span class="linenos">1953</span></a>
</span><span id="accuracy_table-1954"><a href="#accuracy_table-1954"><span class="linenos">1954</span></a>    <span class="c1">#Determine best algorithm at each label rate</span>
</span><span id="accuracy_table-1955"><a href="#accuracy_table-1955"><span class="linenos">1955</span></a>    <span class="n">best</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="n">m</span>
</span><span id="accuracy_table-1956"><a href="#accuracy_table-1956"><span class="linenos">1956</span></a>    <span class="n">class_priors_best</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span><span class="o">*</span><span class="n">m</span>
</span><span id="accuracy_table-1957"><a href="#accuracy_table-1957"><span class="linenos">1957</span></a>    <span class="n">best_score</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">m</span>
</span><span id="accuracy_table-1958"><a href="#accuracy_table-1958"><span class="linenos">1958</span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model_list</span><span class="p">):</span>
</span><span id="accuracy_table-1959"><a href="#accuracy_table-1959"><span class="linenos">1959</span></a>        <span class="n">num_train</span><span class="p">,</span><span class="n">acc_mean</span><span class="p">,</span><span class="n">acc_stddev</span><span class="p">,</span><span class="n">num_trials</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">trials_statistics</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
</span><span id="accuracy_table-1960"><a href="#accuracy_table-1960"><span class="linenos">1960</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
</span><span id="accuracy_table-1961"><a href="#accuracy_table-1961"><span class="linenos">1961</span></a>            <span class="k">if</span> <span class="n">acc_mean</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">best_score</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
</span><span id="accuracy_table-1962"><a href="#accuracy_table-1962"><span class="linenos">1962</span></a>                <span class="n">best_score</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">acc_mean</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="accuracy_table-1963"><a href="#accuracy_table-1963"><span class="linenos">1963</span></a>                <span class="n">best</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="accuracy_table-1964"><a href="#accuracy_table-1964"><span class="linenos">1964</span></a>
</span><span id="accuracy_table-1965"><a href="#accuracy_table-1965"><span class="linenos">1965</span></a>        <span class="c1">#Check if class priors accuracy was included as well</span>
</span><span id="accuracy_table-1966"><a href="#accuracy_table-1966"><span class="linenos">1966</span></a>        <span class="k">if</span> <span class="n">acc_mean</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="accuracy_table-1967"><a href="#accuracy_table-1967"><span class="linenos">1967</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
</span><span id="accuracy_table-1968"><a href="#accuracy_table-1968"><span class="linenos">1968</span></a>                <span class="k">if</span> <span class="n">acc_mean</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">best_score</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
</span><span id="accuracy_table-1969"><a href="#accuracy_table-1969"><span class="linenos">1969</span></a>                    <span class="n">best_score</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">acc_mean</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="accuracy_table-1970"><a href="#accuracy_table-1970"><span class="linenos">1970</span></a>                    <span class="n">class_priors_best</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="accuracy_table-1971"><a href="#accuracy_table-1971"><span class="linenos">1971</span></a>                    <span class="n">best</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="accuracy_table-1972"><a href="#accuracy_table-1972"><span class="linenos">1972</span></a>
</span><span id="accuracy_table-1973"><a href="#accuracy_table-1973"><span class="linenos">1973</span></a>    
</span><span id="accuracy_table-1974"><a href="#accuracy_table-1974"><span class="linenos">1974</span></a>    <span class="k">if</span> <span class="n">append</span><span class="p">:</span>
</span><span id="accuracy_table-1975"><a href="#accuracy_table-1975"><span class="linenos">1975</span></a>        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">savefile</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-1976"><a href="#accuracy_table-1976"><span class="linenos">1976</span></a>        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</span><span id="accuracy_table-1977"><a href="#accuracy_table-1977"><span class="linenos">1977</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="accuracy_table-1978"><a href="#accuracy_table-1978"><span class="linenos">1978</span></a>        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">savefile</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-1979"><a href="#accuracy_table-1979"><span class="linenos">1979</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
</span><span id="accuracy_table-1980"><a href="#accuracy_table-1980"><span class="linenos">1980</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="accuracy_table-1981"><a href="#accuracy_table-1981"><span class="linenos">1981</span></a>        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">savefile</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-1982"><a href="#accuracy_table-1982"><span class="linenos">1982</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">documentclass</span><span class="si">{article}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-1983"><a href="#accuracy_table-1983"><span class="linenos">1983</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">usepackage[T1]</span><span class="si">{fontenc}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-1984"><a href="#accuracy_table-1984"><span class="linenos">1984</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">usepackage</span><span class="si">{booktabs}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-1985"><a href="#accuracy_table-1985"><span class="linenos">1985</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">usepackage[margin=1in]</span><span class="si">{geometry}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-1986"><a href="#accuracy_table-1986"><span class="linenos">1986</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin</span><span class="si">{document}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-1987"><a href="#accuracy_table-1987"><span class="linenos">1987</span></a>
</span><span id="accuracy_table-1988"><a href="#accuracy_table-1988"><span class="linenos">1988</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-1989"><a href="#accuracy_table-1989"><span class="linenos">1989</span></a>    <span class="k">if</span> <span class="n">two_column</span><span class="p">:</span>
</span><span id="accuracy_table-1990"><a href="#accuracy_table-1990"><span class="linenos">1990</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin{table*}[t!]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-1991"><a href="#accuracy_table-1991"><span class="linenos">1991</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="accuracy_table-1992"><a href="#accuracy_table-1992"><span class="linenos">1992</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin</span><span class="si">{table}</span><span class="s2">[t!]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-1993"><a href="#accuracy_table-1993"><span class="linenos">1993</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">vspace{-3mm}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-1994"><a href="#accuracy_table-1994"><span class="linenos">1994</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">caption{&quot;</span><span class="o">+</span><span class="n">title</span><span class="o">+</span><span class="s2">&quot;: Average (standard deviation) classification accuracy over </span><span class="si">%d</span><span class="s2"> trials.}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">num_trials</span><span class="p">)</span>
</span><span id="accuracy_table-1995"><a href="#accuracy_table-1995"><span class="linenos">1995</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">vspace{-3mm}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-1996"><a href="#accuracy_table-1996"><span class="linenos">1996</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">label{tab:&quot;</span><span class="o">+</span><span class="n">title</span><span class="o">+</span><span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-1997"><a href="#accuracy_table-1997"><span class="linenos">1997</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">vskip 0.15in</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-1998"><a href="#accuracy_table-1998"><span class="linenos">1998</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin</span><span class="si">{center}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-1999"><a href="#accuracy_table-1999"><span class="linenos">1999</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin{&quot;</span><span class="o">+</span><span class="n">fontsize</span><span class="o">+</span><span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-2000"><a href="#accuracy_table-2000"><span class="linenos">2000</span></a>    <span class="k">if</span> <span class="n">small_caps</span><span class="p">:</span>
</span><span id="accuracy_table-2001"><a href="#accuracy_table-2001"><span class="linenos">2001</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin</span><span class="si">{sc}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-2002"><a href="#accuracy_table-2002"><span class="linenos">2002</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin</span><span class="si">{tabular}</span><span class="s2">{l&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-2003"><a href="#accuracy_table-2003"><span class="linenos">2003</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
</span><span id="accuracy_table-2004"><a href="#accuracy_table-2004"><span class="linenos">2004</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-2005"><a href="#accuracy_table-2005"><span class="linenos">2005</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-2006"><a href="#accuracy_table-2006"><span class="linenos">2006</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">toprule</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-2007"><a href="#accuracy_table-2007"><span class="linenos">2007</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2"># Labels&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-2008"><a href="#accuracy_table-2008"><span class="linenos">2008</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
</span><span id="accuracy_table-2009"><a href="#accuracy_table-2009"><span class="linenos">2009</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&amp;</span><span class="se">\\</span><span class="s2">textbf{</span><span class="si">%d</span><span class="s2">}&quot;</span><span class="o">%</span><span class="nb">int</span><span class="p">(</span><span class="n">num_train</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span><span id="accuracy_table-2010"><a href="#accuracy_table-2010"><span class="linenos">2010</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\\\\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-2011"><a href="#accuracy_table-2011"><span class="linenos">2011</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">midrule</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-2012"><a href="#accuracy_table-2012"><span class="linenos">2012</span></a>    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="accuracy_table-2013"><a href="#accuracy_table-2013"><span class="linenos">2013</span></a>
</span><span id="accuracy_table-2014"><a href="#accuracy_table-2014"><span class="linenos">2014</span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model_list</span><span class="p">):</span>
</span><span id="accuracy_table-2015"><a href="#accuracy_table-2015"><span class="linenos">2015</span></a>        <span class="n">num_train</span><span class="p">,</span><span class="n">acc_mean</span><span class="p">,</span><span class="n">acc_stddev</span><span class="p">,</span><span class="n">num_trials</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">trials_statistics</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
</span><span id="accuracy_table-2016"><a href="#accuracy_table-2016"><span class="linenos">2016</span></a>
</span><span id="accuracy_table-2017"><a href="#accuracy_table-2017"><span class="linenos">2017</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>
</span><span id="accuracy_table-2018"><a href="#accuracy_table-2018"><span class="linenos">2018</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
</span><span id="accuracy_table-2019"><a href="#accuracy_table-2019"><span class="linenos">2019</span></a>            <span class="k">if</span> <span class="n">best</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">class_priors_best</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span> 
</span><span id="accuracy_table-2020"><a href="#accuracy_table-2020"><span class="linenos">2020</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&amp;{</span><span class="se">\\</span><span class="s2">bf </span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">acc_mean</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot; (</span><span class="si">%.1f</span><span class="s2">)}&quot;</span><span class="o">%</span><span class="n">acc_stddev</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</span><span id="accuracy_table-2021"><a href="#accuracy_table-2021"><span class="linenos">2021</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="accuracy_table-2022"><a href="#accuracy_table-2022"><span class="linenos">2022</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&amp;</span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">acc_mean</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot; (</span><span class="si">%.1f</span><span class="s2">)      &quot;</span><span class="o">%</span><span class="n">acc_stddev</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</span><span id="accuracy_table-2023"><a href="#accuracy_table-2023"><span class="linenos">2023</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\\\\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-2024"><a href="#accuracy_table-2024"><span class="linenos">2024</span></a>        
</span><span id="accuracy_table-2025"><a href="#accuracy_table-2025"><span class="linenos">2025</span></a>        <span class="c1">#Check if class priors accuracy was included as well</span>
</span><span id="accuracy_table-2026"><a href="#accuracy_table-2026"><span class="linenos">2026</span></a>        <span class="k">if</span> <span class="n">acc_mean</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="accuracy_table-2027"><a href="#accuracy_table-2027"><span class="linenos">2027</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;+CP&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>
</span><span id="accuracy_table-2028"><a href="#accuracy_table-2028"><span class="linenos">2028</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
</span><span id="accuracy_table-2029"><a href="#accuracy_table-2029"><span class="linenos">2029</span></a>                <span class="k">if</span> <span class="n">best</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span> <span class="ow">and</span> <span class="n">class_priors_best</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span> 
</span><span id="accuracy_table-2030"><a href="#accuracy_table-2030"><span class="linenos">2030</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&amp;{</span><span class="se">\\</span><span class="s2">bf </span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">acc_mean</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot; (</span><span class="si">%.1f</span><span class="s2">)}&quot;</span><span class="o">%</span><span class="n">acc_stddev</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</span><span id="accuracy_table-2031"><a href="#accuracy_table-2031"><span class="linenos">2031</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="accuracy_table-2032"><a href="#accuracy_table-2032"><span class="linenos">2032</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&amp;</span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">acc_mean</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot; (</span><span class="si">%.1f</span><span class="s2">)      &quot;</span><span class="o">%</span><span class="n">acc_stddev</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</span><span id="accuracy_table-2033"><a href="#accuracy_table-2033"><span class="linenos">2033</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\\\\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-2034"><a href="#accuracy_table-2034"><span class="linenos">2034</span></a>
</span><span id="accuracy_table-2035"><a href="#accuracy_table-2035"><span class="linenos">2035</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bottomrule</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-2036"><a href="#accuracy_table-2036"><span class="linenos">2036</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">end</span><span class="si">{tabular}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-2037"><a href="#accuracy_table-2037"><span class="linenos">2037</span></a>    <span class="k">if</span> <span class="n">small_caps</span><span class="p">:</span>
</span><span id="accuracy_table-2038"><a href="#accuracy_table-2038"><span class="linenos">2038</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">end</span><span class="si">{sc}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-2039"><a href="#accuracy_table-2039"><span class="linenos">2039</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">end{&quot;</span><span class="o">+</span><span class="n">fontsize</span><span class="o">+</span><span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-2040"><a href="#accuracy_table-2040"><span class="linenos">2040</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">end</span><span class="si">{center}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-2041"><a href="#accuracy_table-2041"><span class="linenos">2041</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">vskip -0.1in</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-2042"><a href="#accuracy_table-2042"><span class="linenos">2042</span></a>    <span class="k">if</span> <span class="n">two_column</span><span class="p">:</span>
</span><span id="accuracy_table-2043"><a href="#accuracy_table-2043"><span class="linenos">2043</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">end{table*}&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-2044"><a href="#accuracy_table-2044"><span class="linenos">2044</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="accuracy_table-2045"><a href="#accuracy_table-2045"><span class="linenos">2045</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">end</span><span class="si">{table}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-2046"><a href="#accuracy_table-2046"><span class="linenos">2046</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-2047"><a href="#accuracy_table-2047"><span class="linenos">2047</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">end</span><span class="si">{document}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="accuracy_table-2048"><a href="#accuracy_table-2048"><span class="linenos">2048</span></a>    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><h1 id="accuracy-table">Accuracy table</h1>

<p>Creates a table of accuracy scores for experiments run with <code>ssl_trials</code> to be
included in a LaTeX document.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>model_list</strong> (list of ssl objects):
Models to include in table.</li>
<li><strong>tag</strong> (str (optional), default=''):
An extra identifying tag to add to the accuracy filename.</li>
<li><strong>testerror</strong> (bool (optional), default=False):
Show test error (instead of accuracy) in the table.</li>
<li><strong>savefile</strong> (str (optional), default='table.tex'):
Filename to save tex code for table.</li>
<li><strong>title</strong> (str (optional), default=''):
Title for table.</li>
<li><strong>append</strong> (bool (optional), default=False):
Whether to create a new tex file or append table to existing file.</li>
<li><strong>fontsize</strong> (str (optional), default='small'):
LaTeX font size.</li>
<li><strong>small_caps</strong> (bool (optional), default=True):
Whether to use small caps in LaTeX for table.</li>
<li><strong>two_column</strong> (bool (optional), default=True):
Whether the table will be in a two-column LaTeX document.</li>
</ul>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>